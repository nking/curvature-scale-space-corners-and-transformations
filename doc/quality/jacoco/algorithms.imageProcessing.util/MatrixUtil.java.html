<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>MatrixUtil.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Jacoco Report</a> &gt; <a href="index.source.html" class="el_package">algorithms.imageProcessing.util</a> &gt; <span class="el_source">MatrixUtil.java</span></div><h1>MatrixUtil.java</h1><pre class="source lang-java linenums">package algorithms.imageProcessing.util;

import algorithms.misc.Complex;
import org.ejml.simple.*;

/**
 *
 * @author nichole
 */
<span class="nc" id="L10">public class MatrixUtil {</span>
    
    public static double[] add(double[] m, double[] n) {

<span class="pc bpc" id="L14" title="2 of 4 branches missed.">        if (m == null || m.length == 0) {</span>
<span class="nc" id="L15">            throw new IllegalArgumentException(&quot;m cannot be null or empty&quot;);</span>
        }
<span class="pc bpc" id="L17" title="2 of 4 branches missed.">        if (n == null || n.length == 0) {</span>
<span class="nc" id="L18">            throw new IllegalArgumentException(&quot;n cannot be null or empty&quot;);</span>
        }
<span class="pc bpc" id="L20" title="1 of 2 branches missed.">        if (m.length != n.length) {</span>
<span class="nc" id="L21">            throw new IllegalArgumentException(&quot;m and n must be same length&quot;);</span>
        }
        
<span class="fc" id="L24">        int len = m.length;</span>
     
<span class="fc" id="L26">        double[] c = new double[len];</span>
        
<span class="fc bfc" id="L28" title="All 2 branches covered.">        for (int i = 0; i &lt; len; i++) {</span>
<span class="fc" id="L29">            c[i] = m[i] + n[i];</span>
        }

<span class="fc" id="L32">        return c;</span>
    }
    
    public static float[] add(float[] m, float[] n) {

<span class="pc bpc" id="L37" title="2 of 4 branches missed.">        if (m == null || m.length == 0) {</span>
<span class="nc" id="L38">            throw new IllegalArgumentException(&quot;m cannot be null or empty&quot;);</span>
        }
<span class="pc bpc" id="L40" title="2 of 4 branches missed.">        if (n == null || n.length == 0) {</span>
<span class="nc" id="L41">            throw new IllegalArgumentException(&quot;n cannot be null or empty&quot;);</span>
        }
<span class="pc bpc" id="L43" title="1 of 2 branches missed.">        if (m.length != n.length) {</span>
<span class="nc" id="L44">            throw new IllegalArgumentException(&quot;m and n must be same length&quot;);</span>
        }
        
<span class="fc" id="L47">        int len = m.length;</span>
     
<span class="fc" id="L49">        float[] c = new float[len];</span>
        
<span class="fc bfc" id="L51" title="All 2 branches covered.">        for (int i = 0; i &lt; len; i++) {</span>
<span class="fc" id="L52">            c[i] = m[i] + n[i];</span>
        }

<span class="fc" id="L55">        return c;</span>
    }
    
    public static float[] subtract(float[] m, float[] n) {

<span class="pc bpc" id="L60" title="2 of 4 branches missed.">        if (m == null || m.length == 0) {</span>
<span class="nc" id="L61">            throw new IllegalArgumentException(&quot;m cannot be null or empty&quot;);</span>
        }
<span class="pc bpc" id="L63" title="2 of 4 branches missed.">        if (n == null || n.length == 0) {</span>
<span class="nc" id="L64">            throw new IllegalArgumentException(&quot;n cannot be null or empty&quot;);</span>
        }
<span class="pc bpc" id="L66" title="1 of 2 branches missed.">        if (m.length != n.length) {</span>
<span class="nc" id="L67">            throw new IllegalArgumentException(&quot;m and n must be same length&quot;);</span>
        }
        
<span class="fc" id="L70">        int len = m.length;</span>
     
<span class="fc" id="L72">        float[] c = new float[len];</span>
        
<span class="fc bfc" id="L74" title="All 2 branches covered.">        for (int i = 0; i &lt; len; i++) {</span>
<span class="fc" id="L75">            c[i] = m[i] - n[i];</span>
        }

<span class="fc" id="L78">        return c;</span>
    }
    
    public static void add(int[] m, int n) {

<span class="pc bpc" id="L83" title="2 of 4 branches missed.">        if (m == null || m.length == 0) {</span>
<span class="nc" id="L84">            throw new IllegalArgumentException(&quot;m cannot be null or empty&quot;);</span>
        }
        
<span class="fc" id="L87">        int len = m.length;</span>
             
<span class="fc bfc" id="L89" title="All 2 branches covered.">        for (int i = 0; i &lt; len; i++) {</span>
<span class="fc" id="L90">            m[i] += n;</span>
        }
<span class="fc" id="L92">    }</span>
    
    public static double[] multiply(double[][] m, double[] n) {

<span class="pc bpc" id="L96" title="2 of 4 branches missed.">        if (m == null || m.length == 0) {</span>
<span class="nc" id="L97">            throw new IllegalArgumentException(&quot;m cannot be null or empty&quot;);</span>
        }
<span class="pc bpc" id="L99" title="2 of 4 branches missed.">        if (n == null || n.length == 0) {</span>
<span class="nc" id="L100">            throw new IllegalArgumentException(&quot;n cannot be null or empty&quot;);</span>
        }
        
<span class="fc" id="L103">        int mcols = m.length;</span>

<span class="fc" id="L105">        int mrows = m[0].length;</span>

<span class="fc" id="L107">        int ncols = n.length;</span>
        
<span class="pc bpc" id="L109" title="1 of 2 branches missed.">        if (mcols != ncols) {</span>
<span class="nc" id="L110">            throw new IllegalArgumentException(</span>
                &quot;the number of columns in m must equal the number of rows in n&quot;);
        }
        
<span class="fc" id="L114">        double[] c = new double[mrows];</span>

<span class="fc" id="L116">        int cCol = 0;</span>
        
<span class="fc bfc" id="L118" title="All 2 branches covered.">        for (int row = 0; row &lt; mrows; row++) {</span>
                        
<span class="fc bfc" id="L120" title="All 2 branches covered.">            for (int col = 0; col &lt; mcols; col++) {</span>
                
<span class="fc" id="L122">                c[cCol] += (m[col][row] * n[col]);</span>
            }
            
<span class="fc" id="L125">            cCol++;        </span>
        }

<span class="fc" id="L128">        return c;</span>
    }
    
    public static float[] multiply(float[][] m, float[] n) {

<span class="pc bpc" id="L133" title="2 of 4 branches missed.">        if (m == null || m.length == 0) {</span>
<span class="nc" id="L134">            throw new IllegalArgumentException(&quot;m cannot be null or empty&quot;);</span>
        }
<span class="pc bpc" id="L136" title="2 of 4 branches missed.">        if (n == null || n.length == 0) {</span>
<span class="nc" id="L137">            throw new IllegalArgumentException(&quot;n cannot be null or empty&quot;);</span>
        }
        
<span class="fc" id="L140">        int mcols = m.length;</span>

<span class="fc" id="L142">        int mrows = m[0].length;</span>

<span class="fc" id="L144">        int ncols = n.length;</span>
        
<span class="pc bpc" id="L146" title="1 of 2 branches missed.">        if (mcols != ncols) {</span>
<span class="nc" id="L147">            throw new IllegalArgumentException(</span>
                &quot;the number of columns in m must equal the number of rows in n&quot;);
        }
        
<span class="fc" id="L151">        float[] c = new float[mrows];</span>

<span class="fc" id="L153">        int cCol = 0;</span>
        
<span class="fc bfc" id="L155" title="All 2 branches covered.">        for (int row = 0; row &lt; mrows; row++) {</span>
                        
<span class="fc bfc" id="L157" title="All 2 branches covered.">            for (int col = 0; col &lt; mcols; col++) {</span>
                
<span class="fc" id="L159">                c[cCol] += (m[col][row] * n[col]);</span>
            }
            
<span class="fc" id="L162">            cCol++;        </span>
        }

<span class="fc" id="L165">        return c;</span>
    }
    
    public static void multiply(int[] m, int factor) {

<span class="pc bpc" id="L170" title="2 of 4 branches missed.">        if (m == null || m.length == 0) {</span>
<span class="nc" id="L171">            throw new IllegalArgumentException(&quot;m cannot be null or empty&quot;);</span>
        }
        
<span class="fc" id="L174">        int len = m.length;</span>
                
<span class="fc bfc" id="L176" title="All 2 branches covered.">        for (int i = 0; i &lt; len; i++) {                        </span>
<span class="fc" id="L177">            m[i] *= factor;</span>
        }
<span class="fc" id="L179">    }</span>
    
    public static void multiply(int[] m, int[] n) {

<span class="nc bnc" id="L183" title="All 4 branches missed.">        if (m == null || m.length == 0) {</span>
<span class="nc" id="L184">            throw new IllegalArgumentException(&quot;m cannot be null or empty&quot;);</span>
        }
        
<span class="nc bnc" id="L187" title="All 4 branches missed.">        if (n == null || n.length == 0) {</span>
<span class="nc" id="L188">            throw new IllegalArgumentException(&quot;n cannot be null or empty&quot;);</span>
        }
        
<span class="nc bnc" id="L191" title="All 2 branches missed.">        if (m.length != n.length) {</span>
<span class="nc" id="L192">            throw new IllegalArgumentException(&quot;m must be the same size as n&quot;);</span>
        }
        
<span class="nc" id="L195">        int len = m.length;</span>
                
<span class="nc bnc" id="L197" title="All 2 branches missed.">        for (int i = 0; i &lt; len; i++) {                        </span>
<span class="nc" id="L198">            m[i] *= n[i];</span>
        }
<span class="nc" id="L200">    }</span>
    
    public static double[][] multiply(double[][] m, double[][] n) {

<span class="pc bpc" id="L204" title="2 of 4 branches missed.">        if (m == null || m.length == 0) {</span>
<span class="nc" id="L205">            throw new IllegalArgumentException(&quot;m cannot be null or empty&quot;);</span>
        }
<span class="pc bpc" id="L207" title="2 of 4 branches missed.">        if (n == null || n.length == 0) {</span>
<span class="nc" id="L208">            throw new IllegalArgumentException(&quot;n cannot be null or empty&quot;);</span>
        }
        
<span class="fc" id="L211">        int mrows = m.length;</span>

<span class="fc" id="L213">        int mcols = m[0].length;</span>

<span class="fc" id="L215">        int nrows = n.length;</span>
        
<span class="fc" id="L217">        int ncols = n[0].length;</span>
        
<span class="pc bpc" id="L219" title="1 of 2 branches missed.">        if (mcols != nrows) {</span>
<span class="nc" id="L220">            throw new IllegalArgumentException(</span>
                &quot;the number of columns in m must equal the number of rows in n&quot;);
        }
        
        /*
        a b c      p0 p1 p2
        d e f      p3 p4 p5
                   p6 p7 p8        
        a*p0+... a*p a*p
        d*p0+... d*p d*p
        */
        
<span class="fc" id="L232">        double[][] c = new double[mrows][];</span>
        
<span class="fc bfc" id="L234" title="All 2 branches covered.">        for (int row = 0; row &lt; mrows; row++) {</span>
<span class="fc" id="L235">            c[row] = new double[ncols];</span>
<span class="fc bfc" id="L236" title="All 2 branches covered.">            for (int ncol = 0; ncol &lt; ncols; ncol++) {</span>
<span class="fc" id="L237">                double sum = 0;                </span>
<span class="fc bfc" id="L238" title="All 2 branches covered.">                for (int mcol = 0; mcol &lt; mcols; mcol++) {</span>
<span class="fc" id="L239">                    sum += (m[row][mcol] * n[mcol][ncol]);                    </span>
                }
<span class="fc" id="L241">                c[row][ncol] = sum;</span>
            }            
        }

<span class="fc" id="L245">        return c;</span>
    }
    
    public static double[][] dot(SimpleMatrix m1, SimpleMatrix m2) {
        
<span class="pc bpc" id="L250" title="1 of 2 branches missed.">        if (m1 == null) {</span>
<span class="nc" id="L251">            throw new IllegalArgumentException(&quot;m1 cannot be null&quot;);</span>
        }
<span class="pc bpc" id="L253" title="1 of 2 branches missed.">        if (m2 == null) {</span>
<span class="nc" id="L254">            throw new IllegalArgumentException(&quot;m2 cannot be null&quot;);</span>
        }
<span class="pc bpc" id="L256" title="1 of 2 branches missed.">        if (m1.numCols() != m2.numRows()) {</span>
<span class="nc" id="L257">            throw new IllegalArgumentException(</span>
                &quot;the number of columns in m1 != number of rows in m2&quot;);
        }
        
<span class="fc" id="L261">        int cCols = m2.numCols();</span>
<span class="fc" id="L262">        int cRows = m1.numRows();</span>
        
        // m1 dot m2
<span class="fc" id="L265">        double[][] m = new double[cRows][cCols];</span>
<span class="fc bfc" id="L266" title="All 2 branches covered.">        for (int i = 0; i &lt; cRows; i++) {</span>
<span class="fc" id="L267">            m[i] = new double[cCols];</span>
        }
        
        /*
        t00  t01  t02       x1  x2  x3  x4
        t10  t11  t12       y1  y2  y3  y4
        t20  t21  t22       1    1   1   1
        
        row=0, col=0:nCols0  times and plus col=0, row=0:nRows1 --&gt; stored in row, row + (cAdd=0)
        row=1, col=0:nCols0  times and plus col=0, row=0:nRows1 --&gt; stored in row, row + (cAdd=0)
                
        row=0, col=0:nCols0  times and plus col=(cAdd=1), row=0:nRows1 --&gt; stored in row, row + (cAdd=0)
        */
        
<span class="fc bfc" id="L281" title="All 2 branches covered.">        for (int colAdd = 0; colAdd &lt; m2.numCols(); colAdd++) {</span>
<span class="fc bfc" id="L282" title="All 2 branches covered.">            for (int row = 0; row &lt; m1.numRows(); ++row) {</span>
<span class="fc bfc" id="L283" title="All 2 branches covered.">                for (int col = 0; col &lt; m1.numCols(); col++) {</span>
<span class="fc" id="L284">                    double a = m1.get(row, col);</span>
<span class="fc" id="L285">                    double b = m2.get(col, colAdd);</span>
<span class="fc" id="L286">                    m[row][colAdd] += (a * b);</span>
                }
            }
        }

<span class="fc" id="L291">        return m;</span>
    }
    
    public static float[][] transpose(float[][] m) {

<span class="pc bpc" id="L296" title="2 of 4 branches missed.">        if (m == null || m.length == 0) {</span>
<span class="nc" id="L297">            throw new IllegalArgumentException(&quot;m cannot be null or empty&quot;);</span>
        }
        
<span class="fc" id="L300">        int mRows = m.length;</span>
<span class="fc" id="L301">        int mCols = m[0].length;</span>
        
<span class="fc" id="L303">        float[][] t = new float[mCols][];</span>
<span class="fc bfc" id="L304" title="All 2 branches covered.">        for (int i = 0; i &lt; mCols; i++) {</span>
<span class="fc" id="L305">            t[i] = new float[mRows];</span>
        }
        
<span class="fc bfc" id="L308" title="All 2 branches covered.">        for (int i = 0; i &lt; mRows; i++) {</span>
<span class="fc bfc" id="L309" title="All 2 branches covered.">            for (int j = 0; j &lt; mCols; j++) {</span>
<span class="fc" id="L310">                t[j][i] = m[i][j];</span>
            }
        }
        
<span class="fc" id="L314">        return t;</span>
    }
    
    public static Complex[][] transpose(Complex[][] m) {

<span class="pc bpc" id="L319" title="2 of 4 branches missed.">        if (m == null || m.length == 0) {</span>
<span class="nc" id="L320">            throw new IllegalArgumentException(&quot;m cannot be null or empty&quot;);</span>
        }
        
<span class="fc" id="L323">        int mRows = m.length;</span>
<span class="fc" id="L324">        int mCols = m[0].length;</span>
        
<span class="fc" id="L326">        Complex[][] t = new Complex[mCols][];</span>
<span class="fc bfc" id="L327" title="All 2 branches covered.">        for (int i = 0; i &lt; mCols; i++) {</span>
<span class="fc" id="L328">            t[i] = new Complex[mRows];</span>
        }
        
<span class="fc bfc" id="L331" title="All 2 branches covered.">        for (int i = 0; i &lt; mRows; i++) {</span>
<span class="fc bfc" id="L332" title="All 2 branches covered.">            for (int j = 0; j &lt; mCols; j++) {</span>
<span class="fc" id="L333">                t[j][i] = m[i][j];</span>
            }
        }
        
<span class="fc" id="L337">        return t;</span>
    }
    
    /**
     * multiply matrix m by the transpose of n
     * @param p
     * @param n
     * @return 
     */
    public static double[][] multiplyByTranspose(double[][] p, double[][] n) {

<span class="pc bpc" id="L348" title="2 of 4 branches missed.">        if (p == null || p.length == 0) {</span>
<span class="nc" id="L349">            throw new IllegalArgumentException(&quot;p cannot be null or empty&quot;);</span>
        }
<span class="pc bpc" id="L351" title="2 of 4 branches missed.">        if (n == null || n.length == 0) {</span>
<span class="nc" id="L352">            throw new IllegalArgumentException(&quot;n cannot be null or empty&quot;);</span>
        }
        
<span class="fc" id="L355">        int prows = p.length;</span>

<span class="fc" id="L357">        int pcols = p[0].length;</span>

<span class="fc" id="L359">        int nrows = n.length;</span>
        
<span class="fc" id="L361">        int ncols = n[0].length;</span>
        
<span class="pc bpc" id="L363" title="1 of 2 branches missed.">        if (pcols != ncols) {</span>
<span class="nc" id="L364">            throw new IllegalArgumentException(</span>
                &quot;the number of columns in p must equal the number of cols in n &quot;
                + &quot;for multiplication of m by transpose of n&quot;);
        }
        
        /*
        example:  m is p0 p1 p2
                       p3 p4 p5
                       p6 p7 p8
        
                  n is x1  y1  1
                       x2  y2  1
        
        multiply m by transpose of n:
        
        p0 p1 p2     x1  y2
        p3 p4 p5     y1  y2
        p6 p7 p8      1   1
        
        (p0*x1 + p1*y1 + p2*1)  (p0*x2 + p1*y2 + p2*1)
        (p3*x1 + p4*y1 + p5*1)  (p3*x2 + p4*y2 + p5*1)
        (p6*x1 + p7*y1 + p8*1)  (p6*x2 + p7*y2 + p8*1)
        */
        
<span class="fc" id="L388">        double[][] c = new double[prows][];</span>
       
<span class="fc bfc" id="L390" title="All 2 branches covered.">        for (int row = 0; row &lt; prows; row++) {</span>
<span class="fc" id="L391">            c[row] = new double[nrows];</span>
<span class="fc bfc" id="L392" title="All 2 branches covered.">            for (int nrow = 0; nrow &lt; nrows; nrow++) {</span>
<span class="fc" id="L393">                double sum = 0;                </span>
<span class="fc bfc" id="L394" title="All 2 branches covered.">                for (int mcol = 0; mcol &lt; pcols; mcol++) {</span>
<span class="fc" id="L395">                    sum += (p[row][mcol] * n[nrow][mcol]);                    </span>
                }
<span class="fc" id="L397">                c[row][nrow] = sum;</span>
            }            
        }

<span class="fc" id="L401">        return c;</span>
    }
    
    
    public static double[] extractRawPitchRollFromRotation(SimpleMatrix rotMatrix) {
        
<span class="nc" id="L407">        double yaw = Math.atan(rotMatrix.get(1, 0)/ rotMatrix.get(0, 0));</span>
        
<span class="nc" id="L409">        double pitch = Math.atan(-rotMatrix.get(2, 0)/</span>
<span class="nc" id="L410">            Math.sqrt(rotMatrix.get(2, 1)*rotMatrix.get(2, 1) +</span>
<span class="nc" id="L411">                rotMatrix.get(2, 2)*rotMatrix.get(2, 2)));</span>
         
<span class="nc" id="L413">        double roll = Math.atan(rotMatrix.get(2, 1)/ rotMatrix.get(2, 2));</span>
        
<span class="nc" id="L415">        return new double[]{yaw, pitch, roll};</span>
    }
    
    public static SimpleMatrix calculateRotationMatrix(double yaw,
        double pitch, double roll) {
                
<span class="nc" id="L421">        SimpleMatrix rot = new SimpleMatrix(3, 3);</span>
        
<span class="nc" id="L423">        return calculateRotationMatrix(rot, yaw, pitch, roll);</span>
    }
    
    protected static SimpleMatrix calculateRotationMatrix(
        SimpleMatrix m, double yaw, double pitch, double roll) {
                        
<span class="nc" id="L429">        m.set(0, 0, Math.cos(yaw) * Math.cos(pitch));</span>
<span class="nc" id="L430">        m.set(0, 1, </span>
<span class="nc" id="L431">            (Math.cos(yaw)*Math.sin(pitch)*Math.sin(roll) - </span>
<span class="nc" id="L432">            Math.sin(yaw)*Math.cos(roll)));</span>
<span class="nc" id="L433">        m.set(0, 2, </span>
<span class="nc" id="L434">            (Math.cos(yaw)*Math.sin(pitch)*Math.cos(roll) + </span>
<span class="nc" id="L435">            Math.sin(yaw)*Math.sin(roll)));</span>
        
<span class="nc" id="L437">        m.set(1, 0, Math.sin(yaw) * Math.cos(pitch));</span>
<span class="nc" id="L438">        m.set(1, 1, </span>
<span class="nc" id="L439">            (Math.sin(yaw)*Math.sin(pitch)*Math.sin(roll) + </span>
<span class="nc" id="L440">            Math.cos(yaw)*Math.cos(roll)));</span>
<span class="nc" id="L441">        m.set(1, 2, </span>
<span class="nc" id="L442">            (Math.sin(yaw)*Math.sin(pitch)*Math.cos(roll) - </span>
<span class="nc" id="L443">            Math.cos(yaw)*Math.sin(roll)));</span>
        
<span class="nc" id="L445">        m.set(2, 0, -Math.sin(pitch));</span>
<span class="nc" id="L446">        m.set(0, 0, Math.cos(pitch) * Math.sin(roll));</span>
<span class="nc" id="L447">        m.set(0, 0, Math.cos(pitch) * Math.cos(roll));</span>
        
<span class="nc" id="L449">        return m;</span>
    }
    
    public static String printMatrix(double[][] params) {
        
<span class="nc bnc" id="L454" title="All 2 branches missed.">        if (params == null) {</span>
<span class="nc" id="L455">            return &quot;&quot;;</span>
        }
        
<span class="nc" id="L458">        StringBuffer sb = new StringBuffer();</span>
<span class="nc bnc" id="L459" title="All 2 branches missed.">        for (int row = 0; row &lt; params.length; row++) {</span>
<span class="nc" id="L460">            sb.append(&quot;row &quot;).append(Integer.toString(row)).append(&quot;:&quot;);</span>
<span class="nc bnc" id="L461" title="All 2 branches missed.">            for (int col = 0; col &lt; params[0].length; col++) {</span>
<span class="nc" id="L462">                sb.append(&quot; &quot;).append(Double.toString(params[row][col]));</span>
            }
<span class="nc" id="L464">            sb.append(&quot;\n&quot;);</span>
        }
        
<span class="nc" id="L467">        return sb.toString();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>