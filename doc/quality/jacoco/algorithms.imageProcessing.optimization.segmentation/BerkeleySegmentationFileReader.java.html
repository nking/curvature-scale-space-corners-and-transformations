<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>BerkeleySegmentationFileReader.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Jacoco Report</a> &gt; <a href="index.source.html" class="el_package">algorithms.imageProcessing.optimization.segmentation</a> &gt; <span class="el_source">BerkeleySegmentationFileReader.java</span></div><h1>BerkeleySegmentationFileReader.java</h1><pre class="source lang-java linenums">package algorithms.imageProcessing.optimization.segmentation;

import algorithms.imageProcessing.MiscellaneousCurveHelper;
import algorithms.util.PairInt;
import java.io.BufferedReader;
import java.io.FileReader;
import java.io.IOException;
import java.util.ArrayList;
import java.util.HashSet;
import java.util.List;
import java.util.Set;

/**
 *
 * @author nichole
 */
<span class="nc bnc" id="L17" title="All 2 branches missed.">public class BerkeleySegmentationFileReader {</span>
    
<span class="nc" id="L19">    public BerkeleySegmentationFileReader() {</span>
<span class="nc" id="L20">    }</span>
    
    /**
     * read the file and calculate the segmented region centroids and return double
     * array of int[0][segmentNumber] = x centroid, 
     * int[1][segmentNumber] = y centroid, int[2][segmentNumber] = number of 
     * points in segmented region.
     *  
     * @param filePath
     * @return
     * @throws IOException 
     */
    public int[][] readCentroids(String filePath) throws IOException {
        
<span class="nc" id="L34">        List&lt;Set&lt;PairInt&gt;&gt; sets = readFile(filePath);</span>
        
<span class="nc" id="L36">        int n = sets.size();</span>
        
<span class="nc" id="L38">        int[][] xyCenN = new int[3][n];</span>
        
<span class="nc bnc" id="L40" title="All 2 branches missed.">        for (int i = 0; i &lt; 3; ++i) {</span>
<span class="nc" id="L41">            xyCenN[i] = new int[n];</span>
        }
        
<span class="nc" id="L44">        MiscellaneousCurveHelper curveHelper = new MiscellaneousCurveHelper();</span>
        
<span class="nc bnc" id="L46" title="All 2 branches missed.">        for (int i = 0; i &lt; n; ++i) {</span>
            
<span class="nc" id="L48">            Set&lt;PairInt&gt; set = sets.get(i);</span>
            
<span class="nc" id="L50">            double[] xyCen = curveHelper.calculateXYCentroids(set);</span>
            
<span class="nc" id="L52">            xyCenN[0][i] = (int)Math.round(xyCen[0]);</span>
            
<span class="nc" id="L54">            xyCenN[1][i] = (int)Math.round(xyCen[1]);</span>
            
<span class="nc" id="L56">            xyCenN[2][i] = set.size();</span>
        }
        
<span class="nc" id="L59">        return xyCenN;</span>
    }
    
    public List&lt;Set&lt;PairInt&gt;&gt; readFile(String filePath) throws IOException {
        
<span class="nc" id="L64">        List&lt;Set&lt;PairInt&gt;&gt; output = new ArrayList&lt;Set&lt;PairInt&gt;&gt;();</span>
        
<span class="nc" id="L66">        FileReader reader = null;</span>
<span class="nc" id="L67">        BufferedReader in = null;</span>

        try {
<span class="nc" id="L70">            reader = new FileReader(filePath);</span>
<span class="nc" id="L71">            in = new BufferedReader(reader);</span>

<span class="nc" id="L73">            String line = &quot;&quot;;</span>
<span class="nc bnc" id="L74" title="All 2 branches missed.">            while (!line.contains(&quot;segments&quot;)) {</span>
<span class="nc" id="L75">                line = in.readLine();</span>
            }
<span class="nc" id="L77">            String nStr = line.split(&quot; &quot;)[1];</span>
<span class="nc" id="L78">            int nSegments = Integer.valueOf(nStr).intValue();</span>
<span class="nc bnc" id="L79" title="All 2 branches missed.">            for (int i = 0; i &lt; nSegments; ++i) {</span>
<span class="nc" id="L80">                output.add(new HashSet&lt;PairInt&gt;());</span>
            }
            
<span class="nc bnc" id="L83" title="All 2 branches missed.">            while (!line.contains(&quot;data&quot;)) {</span>
<span class="nc" id="L84">                line = in.readLine();</span>
            }
<span class="nc" id="L86">            line = in.readLine();</span>
            
<span class="nc bnc" id="L88" title="All 2 branches missed.">            while (line != null) {</span>
                
<span class="nc" id="L90">                String[] items = line.split(&quot; &quot;);</span>
<span class="nc bnc" id="L91" title="All 4 branches missed.">                assert(items.length == 4);</span>
                
<span class="nc" id="L93">                int segmentNumber = Integer.valueOf(items[0]).intValue();</span>
                
<span class="nc" id="L95">                int row = Integer.valueOf(items[1]).intValue();</span>
                
<span class="nc" id="L97">                int colStart = Integer.valueOf(items[2]).intValue();</span>
                
<span class="nc" id="L99">                int colStop = Integer.valueOf(items[3]).intValue();</span>
                
<span class="nc" id="L101">                Set&lt;PairInt&gt; set = output.get(segmentNumber);</span>
                
<span class="nc bnc" id="L103" title="All 2 branches missed.">                for (int col = colStart; col &lt;= colStop; ++col) {</span>
<span class="nc" id="L104">                    set.add(new PairInt(col, row));</span>
                }
                
<span class="nc" id="L107">                line = in.readLine();</span>
<span class="nc" id="L108">            }</span>
            
<span class="nc" id="L110">            return output;</span>
            
        } finally {
<span class="nc bnc" id="L113" title="All 4 branches missed.">            if (reader != null) {</span>
<span class="nc" id="L114">                reader.close();</span>
            }
<span class="nc bnc" id="L116" title="All 4 branches missed.">            if (in != null) {</span>
<span class="nc" id="L117">                in.close();</span>
            }
        }        
    }
    
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>