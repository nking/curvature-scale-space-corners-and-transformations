<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>BlobPerimeterRegion.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Jacoco Report</a> &gt; <a href="index.source.html" class="el_package">algorithms.imageProcessing</a> &gt; <span class="el_source">BlobPerimeterRegion.java</span></div><h1>BlobPerimeterRegion.java</h1><pre class="source lang-java linenums">package algorithms.imageProcessing;

import algorithms.imageProcessing.util.AngleUtil;
import algorithms.util.PairInt;
import algorithms.util.PairIntArray;
import java.util.Arrays;
import java.util.Set;

/**
 *
 * @author nichole
 */
public class BlobPerimeterRegion extends CornerRegion {
    
    /**
     * this is released after the orientation is calculated.
    */
<span class="pc" id="L18">    protected Set&lt;PairInt&gt; blob = null;</span>
        
    public BlobPerimeterRegion(final int theEdgeIndex, final int prevXCoord, 
        final int prevYCoord, final int xCoord, final int yCoord, 
        final int nextXCoord, final int nextYCoord,
        Set&lt;PairInt&gt; theBlob, final float sigma) {
        
<span class="fc" id="L25">        super(theEdgeIndex, 3, 1);</span>

<span class="fc" id="L27">        dummyValuesInKNeighbors = true;</span>
        
<span class="fc" id="L29">        float dummyKValue = -99;</span>
        
<span class="fc" id="L31">        set(0, dummyKValue, prevXCoord, prevYCoord);</span>
        
<span class="fc" id="L33">        set(1, sigma, xCoord, yCoord);</span>
        
<span class="fc" id="L35">        set(2, dummyKValue, nextXCoord, nextYCoord);</span>
        
<span class="fc" id="L37">        blob = theBlob;</span>
<span class="fc" id="L38">    }</span>
    
    public BlobPerimeterRegion(final int theEdgeIndex, final int prevXCoord, 
        final int prevYCoord, final int xCoord, final int yCoord, 
        final int nextXCoord, final int nextYCoord,
        double theOrientation, final float sigma) {
        
<span class="nc" id="L45">        super(theEdgeIndex, 3, 1);</span>

<span class="nc" id="L47">        dummyValuesInKNeighbors = true;</span>
        
<span class="nc" id="L49">        float dummyKValue = -99;</span>
        
<span class="nc" id="L51">        set(0, dummyKValue, prevXCoord, prevYCoord);</span>
        
<span class="nc" id="L53">        set(1, sigma, xCoord, yCoord);</span>
        
<span class="nc" id="L55">        set(2, dummyKValue, nextXCoord, nextYCoord);</span>
        
<span class="nc" id="L57">        orientation = theOrientation;</span>
<span class="nc" id="L58">    }</span>
    
    public void overrideRelativeOrientation(final double thetaInRadians) {
        
<span class="fc" id="L62">        this.orientation = thetaInRadians;</span>
        
<span class="fc" id="L64">        this.blob = null;</span>
<span class="fc" id="L65">    }</span>
    
    /**
     * NOT READY FOR USE YET.  NEEDs MORE TESTING
     * calculate the angle perpendicular to the maximum of curvature.
     * The curvature has to be large enough so that a change in the neighboring
     * points is present (slopes cannot both be the same on both sides of the
     * maximum for all the points given) else an exception is thrown.
     * @return the angle perpendicular to the maximum of curvature at the
     * location along the edge in units of radians.
     */
    @Override
    protected double calculateOrientation() {
        
<span class="fc" id="L79">        int dx0 = x[1] - x[0];</span>
<span class="fc" id="L80">        int dy0 = y[1] - y[0];</span>

<span class="fc" id="L82">        double theta0 = AngleUtil.polarAngleCCW(dx0, dy0);</span>
<span class="fc bfc" id="L83" title="All 2 branches covered.">        if (theta0 != 0) {</span>
<span class="fc" id="L84">            theta0 = (2.*Math.PI) - theta0;</span>
        }

<span class="fc" id="L87">        int dx1 = x[2] - x[1];</span>
<span class="fc" id="L88">        int dy1 = y[2] - y[1];</span>

<span class="fc" id="L90">        double theta1 = AngleUtil.polarAngleCCW(dx1, dy1);</span>
<span class="fc bfc" id="L91" title="All 2 branches covered.">        if (theta1 != 0) {</span>
<span class="fc" id="L92">            theta1 = (2.*Math.PI) - theta1;</span>
        }

        /* determine whether to add or subtract 90 for each vector:

        the centroid of the middle and neighboring points determines the
        opposite side of the vector pointing outwards from the edge.
        */

<span class="fc" id="L101">        PairIntArray xy = new PairIntArray(3);</span>
<span class="fc" id="L102">        xy.add(x[0], y[0]);</span>
<span class="fc" id="L103">        xy.add(x[1], y[1]);</span>
<span class="fc" id="L104">        xy.add(x[2], y[2]);</span>

<span class="fc" id="L106">        MiscellaneousCurveHelper curveHelper = new MiscellaneousCurveHelper();</span>

<span class="fc" id="L108">        double[] centroidXY = curveHelper.calculateXYCentroids(xy);</span>

        // may need special handling for ((dx1 == dx0) &amp;&amp; (dy1 == dy0))

        // determine weighted average theta first, then calculate the perpendicular
        // angle pointing out from the edge at the maximum of curvature:
        
<span class="fc" id="L115">        double theta = AngleUtil.getAngleAverageInRadians(theta0, theta1);</span>
                
<span class="fc" id="L117">        double perp = curveHelper.calculatePerpendicularAngleAwayFromCentroid(</span>
            theta, x[0], y[0], x[1], y[1], centroidXY, blob);

<span class="fc" id="L120">        return perp;</span>
    }
    
    @Override
    public boolean equals(Object obj) {
        
<span class="nc bnc" id="L126" title="All 2 branches missed.">        if (!(obj instanceof BlobPerimeterRegion)) {</span>
<span class="nc" id="L127">            return false;</span>
        }
            
<span class="nc" id="L130">        BlobPerimeterRegion other = (BlobPerimeterRegion)obj;</span>
            
<span class="nc bnc" id="L132" title="All 2 branches missed.">        if (x.length != other.getX().length) {</span>
<span class="nc" id="L133">            return false;</span>
        }
        
<span class="nc bnc" id="L136" title="All 2 branches missed.">        if (!Arrays.equals(x, other.getX())) {</span>
<span class="nc" id="L137">            return false;</span>
        }
     
<span class="nc" id="L140">        return Arrays.equals(y, other.getY());</span>
    }
    
    public float getSigma() {
<span class="fc" id="L144">        return k[1];</span>
    }
    
    @Override
    public BlobPerimeterRegion copy() {
        
<span class="pc bpc" id="L150" title="1 of 2 branches missed.">        if (blob == null) {</span>
            
<span class="nc" id="L152">            BlobPerimeterRegion c = new BlobPerimeterRegion(edgeListIdx, </span>
                x[0], y[0], x[1], y[1], x[2], y[2], orientation, k[1]);
<span class="nc" id="L154">            c.setIndexWithinCurve(this.getIndexWithinCurve());</span>
<span class="nc bnc" id="L155" title="All 2 branches missed.">            if (dummyValuesInKNeighbors) {</span>
<span class="nc" id="L156">                c.setFlagThatNeighborsHoldDummyValues();</span>
            }
<span class="nc" id="L158">            return c;</span>
        }
        
<span class="fc" id="L161">        BlobPerimeterRegion c = new BlobPerimeterRegion(edgeListIdx, </span>
            x[0], y[0], x[1], y[1], x[2], y[2], blob, k[1]);
<span class="fc" id="L163">        c.setIndexWithinCurve(this.getIndexWithinCurve());</span>
<span class="pc bpc" id="L164" title="1 of 2 branches missed.">        if (dummyValuesInKNeighbors) {</span>
<span class="fc" id="L165">            c.setFlagThatNeighborsHoldDummyValues();</span>
        }
        
<span class="fc" id="L168">        return c;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>