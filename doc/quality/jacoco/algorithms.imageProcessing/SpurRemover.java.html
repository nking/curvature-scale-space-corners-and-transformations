<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>SpurRemover.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Jacoco Report</a> &gt; <a href="index.source.html" class="el_package">algorithms.imageProcessing</a> &gt; <span class="el_source">SpurRemover.java</span></div><h1>SpurRemover.java</h1><pre class="source lang-java linenums">package algorithms.imageProcessing;

import algorithms.misc.MiscDebug;
import algorithms.util.PairInt;
import java.util.HashSet;
import java.util.Set;

/**
 * and incomplete class to remove single pixels spur patterns from curves, 
 * with the assumption that the given points are curves.  It also corrects
 * a few features to make the main use of the results easier, that is,
 * assembly of the border points of a curve into an ordered sequence around
 * the perimeter.
 * 
 * @author nichole
 */
<span class="fc" id="L17">class SpurRemover {</span>
    
<span class="fc" id="L19">    private boolean debug = false;</span>
    
    public void setToDebug() {
<span class="nc" id="L22">        debug = true;</span>
<span class="nc" id="L23">    }</span>
    
    /**
     * an incomplete set of patterns are applied to the curve to remove spurs
     * that are longer than a pixel and are 1 pixel wide.  this method is not
     * complete.
     * 
     * @param points 
     */
    public void remove(Set&lt;PairInt&gt; curve, int imageWidth, int imageHeight) {
        
<span class="fc" id="L34">        int nChanged = 0;</span>
<span class="fc" id="L35">        int nMaxIter = 10;</span>
<span class="fc" id="L36">        int nIter = 0;</span>

<span class="pc bpc" id="L38" title="1 of 6 branches missed.">        while ((nIter == 0) || ((nChanged &gt; 0) &amp;&amp; (nIter &lt; nMaxIter))) {</span>
        
<span class="pc bpc" id="L40" title="1 of 2 branches missed.">if (debug) {        </span>
<span class="nc" id="L41">Image img3 = new Image(imageWidth, imageHeight);</span>
<span class="nc bnc" id="L42" title="All 2 branches missed.">for (PairInt p : curve) {</span>
<span class="nc" id="L43">    img3.setRGB(p.getX(), p.getY(), 255, 0, 0);</span>
<span class="nc" id="L44">}</span>
<span class="nc" id="L45">MiscDebug.writeImageCopy(img3, &quot;spur_removal_&quot; + nIter + &quot;_&quot; </span>
<span class="nc" id="L46">+ MiscDebug.getCurrentTimeFormatted() + &quot;.png&quot;);</span>
}

<span class="fc" id="L49">            nChanged = 0;</span>
            
<span class="fc" id="L51">            nChanged += pattern0(curve, imageWidth, imageHeight);</span>

<span class="fc" id="L53">            nChanged += pattern00(curve, imageWidth, imageHeight);</span>

<span class="fc" id="L55">            nChanged += pattern1(curve, imageWidth, imageHeight);</span>

<span class="fc" id="L57">            nChanged += pattern2(curve, imageWidth, imageHeight);</span>

<span class="fc" id="L59">            nChanged += pattern3(curve, imageWidth, imageHeight);</span>

<span class="fc" id="L61">            nChanged += pattern4(curve, imageWidth, imageHeight);</span>
            
<span class="fc" id="L63">            nChanged += pattern5(curve, imageWidth, imageHeight);</span>
            
<span class="fc" id="L65">            nChanged += pattern6(curve, imageWidth, imageHeight);</span>
            
<span class="fc" id="L67">            nChanged += pattern7(curve, imageWidth, imageHeight);</span>
            
<span class="fc" id="L69">            nChanged += pattern8(curve, imageWidth, imageHeight);</span>
            
<span class="fc" id="L71">            nChanged += pattern9(curve, imageWidth, imageHeight);</span>
            
<span class="fc" id="L73">            nChanged += pattern10(curve, imageWidth, imageHeight);</span>
            
<span class="fc" id="L75">            nChanged += pattern11(curve, imageWidth, imageHeight);</span>
                        
<span class="fc bfc" id="L77" title="All 2 branches covered.">            if ((nIter &amp; 1) == 1) {</span>
                // not technically a spur:
<span class="fc" id="L79">                nChanged += </span>
<span class="fc" id="L80">                    PostLineThinnerCorrections.correctForHoleArtifacts00_10(</span>
                    curve, imageWidth, imageHeight);
            }
            
<span class="fc" id="L84">            nChanged += curveCorrection12(curve, imageWidth, imageHeight);</span>
            
<span class="fc" id="L86">            ++nIter;</span>
        }
        
<span class="pc bpc" id="L89" title="1 of 2 branches missed.">if (debug) {        </span>
<span class="nc" id="L90">Image img3 = new Image(imageWidth, imageHeight);</span>
<span class="nc bnc" id="L91" title="All 2 branches missed.">for (PairInt p : curve) {</span>
<span class="nc" id="L92">    img3.setRGB(p.getX(), p.getY(), 255, 0, 0);</span>
<span class="nc" id="L93">}</span>
<span class="nc" id="L94">MiscDebug.writeImageCopy(img3, &quot;spur_removal_&quot; + nIter + &quot;_&quot; </span>
<span class="nc" id="L95">+ MiscDebug.getCurrentTimeFormatted() + &quot;.png&quot;);</span>
}

<span class="fc" id="L98">    }</span>
    
    public boolean isASpur(int xCoord, int yCoord, Set&lt;PairInt&gt; curve, 
        int imageWidth, int imageHeight) {
        
<span class="nc" id="L103">        boolean hasPattern = testPatternSwapDirections(xCoord, yCoord, curve, </span>
<span class="nc" id="L104">            imageWidth, imageHeight, getPattern0());</span>
        
<span class="nc bnc" id="L106" title="All 2 branches missed.">        if (hasPattern) {</span>
<span class="nc" id="L107">            return true;</span>
        }

<span class="nc" id="L110">        hasPattern = testPatternSwapDirections(xCoord, yCoord, curve, </span>
<span class="nc" id="L111">            imageWidth, imageHeight, getPattern00());</span>
        
<span class="nc bnc" id="L113" title="All 2 branches missed.">        if (hasPattern) {</span>
<span class="nc" id="L114">            return true;</span>
        }
        
<span class="nc" id="L117">        hasPattern = testPatternSwapDirections(xCoord, yCoord, curve, </span>
<span class="nc" id="L118">            imageWidth, imageHeight, getPattern1());</span>
        
<span class="nc bnc" id="L120" title="All 2 branches missed.">        if (hasPattern) {</span>
<span class="nc" id="L121">            return true;</span>
        }

<span class="nc" id="L124">        hasPattern = testPatternSwapDirections(xCoord, yCoord, curve, </span>
<span class="nc" id="L125">            imageWidth, imageHeight, getPattern2());</span>
        
<span class="nc bnc" id="L127" title="All 2 branches missed.">        if (hasPattern) {</span>
<span class="nc" id="L128">            return true;</span>
        }

<span class="nc" id="L131">        hasPattern = testPatternSwapDirections(xCoord, yCoord, curve, </span>
<span class="nc" id="L132">            imageWidth, imageHeight, getPattern3());</span>
        
<span class="nc bnc" id="L134" title="All 2 branches missed.">        if (hasPattern) {</span>
<span class="nc" id="L135">            return true;</span>
        }

<span class="nc" id="L138">        hasPattern = testPatternSwapDirections(xCoord, yCoord, curve, </span>
<span class="nc" id="L139">            imageWidth, imageHeight, getPattern4());</span>
        
<span class="nc bnc" id="L141" title="All 2 branches missed.">        if (hasPattern) {</span>
<span class="nc" id="L142">            return true;</span>
        }
            
<span class="nc" id="L145">        hasPattern = testPatternSwapDirections(xCoord, yCoord, curve, </span>
<span class="nc" id="L146">            imageWidth, imageHeight, getPattern5());</span>
        
<span class="nc bnc" id="L148" title="All 2 branches missed.">        if (hasPattern) {</span>
<span class="nc" id="L149">            return true;</span>
        }
            
<span class="nc" id="L152">        hasPattern = testPatternSwapDirections(xCoord, yCoord, curve, </span>
<span class="nc" id="L153">            imageWidth, imageHeight, getPattern6());</span>
        
<span class="nc bnc" id="L155" title="All 2 branches missed.">        if (hasPattern) {</span>
<span class="nc" id="L156">            return true;</span>
        }
            
<span class="nc" id="L159">        hasPattern = testPatternSwapDirections(xCoord, yCoord, curve, </span>
<span class="nc" id="L160">            imageWidth, imageHeight, getPattern7());</span>
        
<span class="nc bnc" id="L162" title="All 2 branches missed.">        if (hasPattern) {</span>
<span class="nc" id="L163">            return true;</span>
        }
            
<span class="nc" id="L166">        hasPattern = testPatternSwapDirections(xCoord, yCoord, curve, </span>
<span class="nc" id="L167">            imageWidth, imageHeight, getPattern8());</span>
        
<span class="nc bnc" id="L169" title="All 2 branches missed.">        if (hasPattern) {</span>
<span class="nc" id="L170">            return true;</span>
        }
            
<span class="nc" id="L173">        hasPattern = testPatternSwapDirections(xCoord, yCoord, curve, </span>
<span class="nc" id="L174">            imageWidth, imageHeight, getPattern9());</span>
        
<span class="nc bnc" id="L176" title="All 2 branches missed.">        if (hasPattern) {</span>
<span class="nc" id="L177">            return true;</span>
        }
            
<span class="nc" id="L180">        hasPattern = testPatternSwapDirections(xCoord, yCoord, curve, </span>
<span class="nc" id="L181">            imageWidth, imageHeight, getPattern10());</span>
        
<span class="nc bnc" id="L183" title="All 2 branches missed.">        if (hasPattern) {</span>
<span class="nc" id="L184">            return true;</span>
        }
            
<span class="nc" id="L187">        hasPattern = testPatternSwapDirections(xCoord, yCoord, curve, </span>
<span class="nc" id="L188">            imageWidth, imageHeight, getPattern11());</span>
        
<span class="nc bnc" id="L190" title="All 2 branches missed.">        if (hasPattern) {</span>
<span class="nc" id="L191">            return true;</span>
        }
            
<span class="nc" id="L194">        hasPattern = testPatternSwapDirections(xCoord, yCoord, curve, </span>
<span class="nc" id="L195">            imageWidth, imageHeight, getPattern12());</span>
        
<span class="nc" id="L197">        return hasPattern;</span>
    }
    
<span class="fc" id="L200">    public static class PatternReplacement {</span>
        Set&lt;PairInt&gt; ones;
        Set&lt;PairInt&gt; zeroes;
        Set&lt;PairInt&gt; changeToZeroes;
    }
    
    private PatternReplacement getPattern0() {
        
        /*
          0  #  0        1
          0 &gt;#  0        0
          0  0  0       -1
         -1  0  1  2  3
         */
<span class="fc" id="L214">        PatternReplacement pr = new PatternReplacement();</span>
<span class="fc" id="L215">        pr.ones = new HashSet&lt;PairInt&gt;();</span>
<span class="fc" id="L216">        pr.zeroes = new HashSet&lt;PairInt&gt;();</span>
<span class="fc" id="L217">        pr.changeToZeroes = new HashSet&lt;PairInt&gt;();</span>

<span class="fc" id="L219">        pr.zeroes.add(new PairInt(-1, -1)); pr.zeroes.add(new PairInt(-1, 0)); pr.zeroes.add(new PairInt(-1, 1));</span>
<span class="fc" id="L220">        pr.zeroes.add(new PairInt(0, -1));</span>
<span class="fc" id="L221">        pr.zeroes.add(new PairInt(1, -1)); pr.zeroes.add(new PairInt(1, 0)); pr.zeroes.add(new PairInt(1, 1));</span>
        
<span class="fc" id="L223">        pr.ones.add(new PairInt(0, 1)); </span>
        
<span class="fc" id="L225">        pr.changeToZeroes.add(new PairInt(0, 0));</span>
        
<span class="fc" id="L227">        return pr;</span>
    }

    private int pattern0(Set&lt;PairInt&gt; curve, int imageWidth, int imageHeight) {
        
<span class="fc" id="L232">        PatternReplacement pr = getPattern0();</span>
        
<span class="fc" id="L234">        int nChanged = 0;</span>
        
        /*
        invoke pattern and then reversed for Y
        */

<span class="fc" id="L240">        nChanged += replacePattern(curve, imageWidth, imageHeight, pr);</span>

        // ----- change the sign of x to handle other direction -----
<span class="fc" id="L243">        reverseYs(pr);</span>

<span class="fc" id="L245">        nChanged += replacePattern(curve, imageWidth, imageHeight, pr);</span>
        
<span class="fc" id="L247">        return nChanged;</span>
    }
    
    private PatternReplacement getPattern00() {
         
        /*
          0  0  0        1
          0 &gt;#  #        0
          0  0  0       -1
         -1  0  1  2  3
         */
<span class="fc" id="L258">        PatternReplacement pr = new PatternReplacement();</span>
<span class="fc" id="L259">        pr.ones = new HashSet&lt;PairInt&gt;();</span>
<span class="fc" id="L260">        pr.zeroes = new HashSet&lt;PairInt&gt;();</span>
<span class="fc" id="L261">        pr.changeToZeroes = new HashSet&lt;PairInt&gt;();</span>

<span class="fc" id="L263">        pr.zeroes.add(new PairInt(-1, -1)); pr.zeroes.add(new PairInt(-1, 0)); pr.zeroes.add(new PairInt(-1, 1));</span>
<span class="fc" id="L264">        pr.zeroes.add(new PairInt(0, -1)); pr.zeroes.add(new PairInt(0, 1));</span>
<span class="fc" id="L265">        pr.zeroes.add(new PairInt(1, -1)); pr.zeroes.add(new PairInt(1, 1));</span>
        
<span class="fc" id="L267">        pr.ones.add(new PairInt(1, 0)); </span>
        
<span class="fc" id="L269">        pr.changeToZeroes.add(new PairInt(0, 0));</span>
        
<span class="fc" id="L271">        return pr;</span>
    }
    
    private int pattern00(Set&lt;PairInt&gt; curve, int imageWidth, int imageHeight) {
       
<span class="fc" id="L276">        int nChanged = 0;</span>
        
<span class="fc" id="L278">        PatternReplacement pr = getPattern00();</span>
        
<span class="fc" id="L280">        nChanged += replacePattern(curve, imageWidth, imageHeight, pr);</span>
        
        // ----- change the sign of x to handle other direction -----
<span class="fc" id="L283">        reverseXs(pr);</span>

<span class="fc" id="L285">        nChanged += replacePattern(curve, imageWidth, imageHeight, pr);</span>
            
<span class="fc" id="L287">        return nChanged;</span>
    }
    
    private PatternReplacement getPattern1() {
        
        /*
          #  #  0        1
          0 &gt;#  0        0
          0  0  0       -1
         -1  0  1  2  3
         */
<span class="fc" id="L298">        PatternReplacement pr = new PatternReplacement();</span>
<span class="fc" id="L299">        pr.ones = new HashSet&lt;PairInt&gt;();</span>
<span class="fc" id="L300">        pr.zeroes = new HashSet&lt;PairInt&gt;();</span>
<span class="fc" id="L301">        pr.changeToZeroes = new HashSet&lt;PairInt&gt;();</span>

<span class="fc" id="L303">        pr.zeroes.add(new PairInt(-1, -1)); pr.zeroes.add(new PairInt(-1, 0));</span>
<span class="fc" id="L304">        pr.zeroes.add(new PairInt(0, -1));</span>
<span class="fc" id="L305">        pr.zeroes.add(new PairInt(1, -1)); pr.zeroes.add(new PairInt(1, 0)); pr.zeroes.add(new PairInt(1, 1));</span>
        
<span class="fc" id="L307">        pr.ones.add(new PairInt(-1, 1));</span>
<span class="fc" id="L308">        pr.ones.add(new PairInt(0, 1)); </span>
        
<span class="fc" id="L310">        pr.changeToZeroes.add(new PairInt(0, 0));</span>
        
<span class="fc" id="L312">        return pr;</span>
    }
    
    private int pattern1(Set&lt;PairInt&gt; curve, int imageWidth, int imageHeight) {
        
<span class="fc" id="L317">        int nChanged = 0;</span>
        
<span class="fc" id="L319">        PatternReplacement pr = getPattern1();</span>
        
<span class="fc" id="L321">        nChanged = replacePatternSwapDirections(curve, imageWidth, imageHeight, </span>
            pr);
       
<span class="fc" id="L324">        return nChanged;</span>
    }
    
    private PatternReplacement getPattern2() {
         
        /*
          #              2
          0  #  0        1
          0 &gt;#  0        0
          0  0  0       -1
         -1  0  1  2  3
         */
<span class="fc" id="L336">        PatternReplacement pr = new PatternReplacement();</span>
<span class="fc" id="L337">        pr.ones = new HashSet&lt;PairInt&gt;();</span>
<span class="fc" id="L338">        pr.zeroes = new HashSet&lt;PairInt&gt;();</span>
<span class="fc" id="L339">        pr.changeToZeroes = new HashSet&lt;PairInt&gt;();</span>

<span class="fc" id="L341">        pr.zeroes.add(new PairInt(-1, -1)); pr.zeroes.add(new PairInt(-1, 0)); pr.zeroes.add(new PairInt(-1, 1));</span>
<span class="fc" id="L342">        pr.zeroes.add(new PairInt(0, -1));</span>
<span class="fc" id="L343">        pr.zeroes.add(new PairInt(1, -1)); pr.zeroes.add(new PairInt(1, 0)); pr.zeroes.add(new PairInt(1, 1));</span>
        
<span class="fc" id="L345">        pr.ones.add(new PairInt(-1, 2));</span>
<span class="fc" id="L346">        pr.ones.add(new PairInt(0, 1)); </span>
        
<span class="fc" id="L348">        pr.changeToZeroes.add(new PairInt(0, 0));</span>
        
<span class="fc" id="L350">        return pr;</span>
    }
    
    private int pattern2(Set&lt;PairInt&gt; curve, int imageWidth, int imageHeight) {
       
<span class="fc" id="L355">        int nChanged = 0;</span>
                
<span class="fc" id="L357">        PatternReplacement pr = getPattern2();</span>
        
<span class="fc" id="L359">        nChanged = replacePatternSwapDirections(curve, imageWidth, imageHeight, </span>
            pr);
           
<span class="fc" id="L362">        return nChanged;</span>
    }
    
    private PatternReplacement getPattern3() {
          
        /*
          0  0  #        1
          0 &gt;#  #        0
          0  0  0       -1
         -1  0  1  2  3
         */
<span class="fc" id="L373">        PatternReplacement pr = new PatternReplacement();</span>
<span class="fc" id="L374">        pr.ones = new HashSet&lt;PairInt&gt;();</span>
<span class="fc" id="L375">        pr.zeroes = new HashSet&lt;PairInt&gt;();</span>
<span class="fc" id="L376">        pr.changeToZeroes = new HashSet&lt;PairInt&gt;();</span>

<span class="fc" id="L378">        pr.zeroes.add(new PairInt(-1, -1)); pr.zeroes.add(new PairInt(-1, 0)); pr.zeroes.add(new PairInt(-1, 1));</span>
<span class="fc" id="L379">        pr.zeroes.add(new PairInt(0, -1)); pr.zeroes.add(new PairInt(0, 1));</span>
<span class="fc" id="L380">        pr.zeroes.add(new PairInt(1, -1));</span>
        
<span class="fc" id="L382">        pr.ones.add(new PairInt(1, 0)); pr.ones.add(new PairInt(1, 1)); </span>
        
<span class="fc" id="L384">        pr.changeToZeroes.add(new PairInt(0, 0));</span>
        
<span class="fc" id="L386">        return pr;</span>
    }
    
    private int pattern3(Set&lt;PairInt&gt; curve, int imageWidth, int imageHeight) {
      
<span class="fc" id="L391">        int nChanged = 0;</span>
        
<span class="fc" id="L393">        PatternReplacement pr = getPattern3();</span>
        
<span class="fc" id="L395">        nChanged = replacePatternSwapDirections(curve, imageWidth, imageHeight, </span>
            pr);
        
<span class="fc" id="L398">        return nChanged;</span>
    }
    
    private PatternReplacement getPattern4() {
          
        /*
          0  0  0  #     1
          0 &gt;#  #        0
          0  0  0       -1
         -1  0  1  2  3
         */
<span class="fc" id="L409">        PatternReplacement pr = new PatternReplacement();</span>
<span class="fc" id="L410">        pr.ones = new HashSet&lt;PairInt&gt;();</span>
<span class="fc" id="L411">        pr.zeroes = new HashSet&lt;PairInt&gt;();</span>
<span class="fc" id="L412">        pr.changeToZeroes = new HashSet&lt;PairInt&gt;();</span>

<span class="fc" id="L414">        pr.zeroes.add(new PairInt(-1, -1)); pr.zeroes.add(new PairInt(-1, 0)); pr.zeroes.add(new PairInt(-1, 1));</span>
<span class="fc" id="L415">        pr.zeroes.add(new PairInt(0, -1)); pr.zeroes.add(new PairInt(0, 1));</span>
<span class="fc" id="L416">        pr.zeroes.add(new PairInt(1, -1)); pr.zeroes.add(new PairInt(1, 1));</span>
        
<span class="fc" id="L418">        pr.ones.add(new PairInt(1, 0)); </span>
<span class="fc" id="L419">        pr.ones.add(new PairInt(2, 1)); </span>
        
<span class="fc" id="L421">        pr.changeToZeroes.add(new PairInt(0, 0));</span>
        
<span class="fc" id="L423">        return pr;</span>
    }
    
    private int pattern4(Set&lt;PairInt&gt; curve, int imageWidth, int imageHeight) {
      
<span class="fc" id="L428">        int nChanged = 0;</span>
                   
<span class="fc" id="L430">        PatternReplacement pr = getPattern4();</span>
        
<span class="fc" id="L432">        nChanged = replacePatternSwapDirections(curve, imageWidth, imageHeight, </span>
            pr);
        
<span class="fc" id="L435">        return nChanged;</span>
    }
    
    private PatternReplacement getPattern5() {
          
        /*
             0  0  0     2
          0  0  #  #     1
          0 &gt;#  0        0
          0  0  0       -1
         -1  0  1  2  3
         */
<span class="fc" id="L447">        PatternReplacement pr = new PatternReplacement();</span>
<span class="fc" id="L448">        pr.ones = new HashSet&lt;PairInt&gt;();</span>
<span class="fc" id="L449">        pr.zeroes = new HashSet&lt;PairInt&gt;();</span>
<span class="fc" id="L450">        pr.changeToZeroes = new HashSet&lt;PairInt&gt;();</span>

<span class="fc" id="L452">        pr.zeroes.add(new PairInt(-1, -1)); pr.zeroes.add(new PairInt(-1, 0)); pr.zeroes.add(new PairInt(-1, 1));</span>
<span class="fc" id="L453">        pr.zeroes.add(new PairInt(0, -1)); pr.zeroes.add(new PairInt(0, 1)); pr.zeroes.add(new PairInt(0, 2));</span>
<span class="fc" id="L454">        pr.zeroes.add(new PairInt(1, -1)); pr.zeroes.add(new PairInt(1, 0)); pr.zeroes.add(new PairInt(1, 2));</span>
<span class="fc" id="L455">        pr.zeroes.add(new PairInt(2, 2));</span>
        
<span class="fc" id="L457">        pr.ones.add(new PairInt(1, 1)); </span>
<span class="fc" id="L458">        pr.ones.add(new PairInt(2, 1)); </span>
        
<span class="fc" id="L460">        pr.changeToZeroes.add(new PairInt(0, 0));</span>
        
<span class="fc" id="L462">        return pr;</span>
    }
    
    private int pattern5(Set&lt;PairInt&gt; curve, int imageWidth, int imageHeight) {
      
<span class="fc" id="L467">        int nChanged = 0;</span>
                        
<span class="fc" id="L469">        PatternReplacement pr = getPattern5();</span>
        
<span class="fc" id="L471">        nChanged = replacePatternSwapDirections(curve, imageWidth, imageHeight, </span>
            pr);
        
<span class="fc" id="L474">        return nChanged;</span>
    }
    
    private PatternReplacement getPattern6() {
         /*
                         
             #           2
          0  #  0  0     1
          0  0 &gt;#  0     0
          0  0  0  0    -1
         -2 -1  0  1  2  3
         */
<span class="fc" id="L486">        PatternReplacement pr = new PatternReplacement();</span>
<span class="fc" id="L487">        pr.ones = new HashSet&lt;PairInt&gt;();</span>
<span class="fc" id="L488">        pr.zeroes = new HashSet&lt;PairInt&gt;();</span>
<span class="fc" id="L489">        pr.changeToZeroes = new HashSet&lt;PairInt&gt;();</span>

<span class="fc" id="L491">        pr.zeroes.add(new PairInt(-2, -1)); pr.zeroes.add(new PairInt(-2, 0)); pr.zeroes.add(new PairInt(-2, 1));</span>
<span class="fc" id="L492">        pr.zeroes.add(new PairInt(-1, -1)); pr.zeroes.add(new PairInt(-1, 0));</span>
<span class="fc" id="L493">        pr.zeroes.add(new PairInt(0, -1)); pr.zeroes.add(new PairInt(0, 1));</span>
<span class="fc" id="L494">        pr.zeroes.add(new PairInt(1, -1)); pr.zeroes.add(new PairInt(1, 0)); pr.zeroes.add(new PairInt(1, 1));</span>
        
<span class="fc" id="L496">        pr.ones.add(new PairInt(-1, 1)); pr.ones.add(new PairInt(-1, 2));</span>
        
<span class="fc" id="L498">        pr.changeToZeroes.add(new PairInt(0, 0));</span>
        
<span class="fc" id="L500">        return pr;</span>
    }
    
    private int pattern6(Set&lt;PairInt&gt; curve, int imageWidth, int imageHeight) {
        
<span class="fc" id="L505">        PatternReplacement pr = getPattern6();</span>
       
<span class="fc" id="L507">        int nChanged = 0;</span>
                        
<span class="fc" id="L509">        nChanged = replacePatternSwapDirections(curve, imageWidth, imageHeight, </span>
            pr);
        
<span class="fc" id="L512">        return nChanged;</span>
    }
    
    private PatternReplacement getPattern7() {
        
        /*
             0  0        2
          0  0  #  #     1
          0 &gt;#  0  0     0
          0  0  0       -1
         -1  0  1  2  3
         */
<span class="fc" id="L524">        PatternReplacement pr = new PatternReplacement();</span>
<span class="fc" id="L525">        pr.ones = new HashSet&lt;PairInt&gt;();</span>
<span class="fc" id="L526">        pr.zeroes = new HashSet&lt;PairInt&gt;();</span>
<span class="fc" id="L527">        pr.changeToZeroes = new HashSet&lt;PairInt&gt;();</span>

<span class="fc" id="L529">        pr.zeroes.add(new PairInt(-1, -1)); pr.zeroes.add(new PairInt(-1, 0)); pr.zeroes.add(new PairInt(-1, 1));</span>
<span class="fc" id="L530">        pr.zeroes.add(new PairInt(0, -1)); pr.zeroes.add(new PairInt(0, 1)); pr.zeroes.add(new PairInt(0, 2));</span>
<span class="fc" id="L531">        pr.zeroes.add(new PairInt(1, -1)); pr.zeroes.add(new PairInt(1, 0)); pr.zeroes.add(new PairInt(1, 2));</span>
<span class="fc" id="L532">        pr.zeroes.add(new PairInt(2, 0));</span>
        
<span class="fc" id="L534">        pr.ones.add(new PairInt(1, 1)); </span>
<span class="fc" id="L535">        pr.ones.add(new PairInt(2, 1)); </span>
        
<span class="fc" id="L537">        pr.changeToZeroes.add(new PairInt(0, 0));</span>
        
<span class="fc" id="L539">        return pr;</span>
    }
    
    private int pattern7(Set&lt;PairInt&gt; curve, int imageWidth, int imageHeight) {
        
<span class="fc" id="L544">        PatternReplacement pr = getPattern7();</span>
        
<span class="fc" id="L546">        int nChanged = 0;</span>
                        
<span class="fc" id="L548">        nChanged = replacePatternSwapDirections(curve, imageWidth, imageHeight, </span>
            pr);
        
<span class="fc" id="L551">        return nChanged;</span>
    }
    
    private PatternReplacement getPattern8() {
        /*
                         2
             #  0        1
          0  #  0  0     0
          0  0 &gt;#  0    -1
          0  0  0  0    -2
         -1  0  1  2  3
         */
<span class="fc" id="L563">        PatternReplacement pr = new PatternReplacement();</span>
<span class="fc" id="L564">        pr.ones = new HashSet&lt;PairInt&gt;();</span>
<span class="fc" id="L565">        pr.zeroes = new HashSet&lt;PairInt&gt;();</span>
<span class="fc" id="L566">        pr.changeToZeroes = new HashSet&lt;PairInt&gt;();</span>

<span class="fc" id="L568">        pr.zeroes.add(new PairInt(-1, -1)); pr.zeroes.add(new PairInt(-1, 0)); pr.zeroes.add(new PairInt(-1, 1));</span>
<span class="fc" id="L569">        pr.zeroes.add(new PairInt(0, -2)); pr.zeroes.add(new PairInt(0, -1));</span>
<span class="fc" id="L570">        pr.zeroes.add(new PairInt(1, -2)); pr.zeroes.add(new PairInt(1, 0)); pr.zeroes.add(new PairInt(1, 1));</span>
<span class="fc" id="L571">        pr.zeroes.add(new PairInt(2, -2)); pr.zeroes.add(new PairInt(2, -1)); pr.zeroes.add(new PairInt(2, 0));</span>
        
<span class="fc" id="L573">        pr.ones.add(new PairInt(0, 1)); </span>
<span class="fc" id="L574">        pr.ones.add(new PairInt(1, -1)); </span>
        
<span class="fc" id="L576">        pr.changeToZeroes.add(new PairInt(1, -1));</span>
        
<span class="fc" id="L578">        return pr;</span>
    }
    
    private int pattern8(Set&lt;PairInt&gt; curve, int imageWidth, int imageHeight) {
        
<span class="fc" id="L583">        PatternReplacement pr = getPattern8();</span>
        
<span class="fc" id="L585">        int nChanged = 0;</span>
                        
<span class="fc" id="L587">        nChanged = replacePatternSwapDirections(curve, imageWidth, imageHeight, </span>
            pr);
        
<span class="fc" id="L590">        return nChanged;</span>
    }
    
    private PatternReplacement getPattern9() {
         
        /*
                         2
          #  0  0        1
          0  #  0  0     0
          #  0 &gt;#  0    -1
          0  0  0  0    -2
         -1  0  1  2  3
         */
<span class="fc" id="L603">        PatternReplacement pr = new PatternReplacement();</span>
<span class="fc" id="L604">        pr.ones = new HashSet&lt;PairInt&gt;();</span>
<span class="fc" id="L605">        pr.zeroes = new HashSet&lt;PairInt&gt;();</span>
<span class="fc" id="L606">        pr.changeToZeroes = new HashSet&lt;PairInt&gt;();</span>

<span class="fc" id="L608">        pr.zeroes.add(new PairInt(-1, -2)); pr.zeroes.add(new PairInt(-1, 0));</span>
<span class="fc" id="L609">        pr.zeroes.add(new PairInt(0, -2)); pr.zeroes.add(new PairInt(0, -1)); pr.zeroes.add(new PairInt(0, 1));</span>
<span class="fc" id="L610">        pr.zeroes.add(new PairInt(1, -2)); pr.zeroes.add(new PairInt(1, 0)); pr.zeroes.add(new PairInt(1, 1));</span>
<span class="fc" id="L611">        pr.zeroes.add(new PairInt(2, -2)); pr.zeroes.add(new PairInt(2, -1)); pr.zeroes.add(new PairInt(2, 0));</span>
        
<span class="fc" id="L613">        pr.ones.add(new PairInt(-1, -1)); pr.ones.add(new PairInt(-1, 1));</span>
<span class="fc" id="L614">        pr.ones.add(new PairInt(1, -1)); </span>
        
<span class="fc" id="L616">        pr.changeToZeroes.add(new PairInt(1, -1));</span>
        
<span class="fc" id="L618">        return pr;</span>
    }
    
    private int pattern9(Set&lt;PairInt&gt; curve, int imageWidth, int imageHeight) {
       
<span class="fc" id="L623">        int nChanged = 0;</span>
                  
<span class="fc" id="L625">        PatternReplacement pr = getPattern9();</span>
        
<span class="fc" id="L627">        nChanged = replacePatternSwapDirections(curve, imageWidth, imageHeight, </span>
            pr);
        
<span class="fc" id="L630">        return nChanged;</span>
    }
    
    private PatternReplacement getPattern10() {
         
        /*
                         2
             #  0  #        1
             0  #  0  0     0
             0  0  #  0    -1
             0  0  0  0    -2
            -1  0  1  2  3
         */
<span class="fc" id="L643">        PatternReplacement pr = new PatternReplacement();</span>
<span class="fc" id="L644">        pr.ones = new HashSet&lt;PairInt&gt;();</span>
<span class="fc" id="L645">        pr.zeroes = new HashSet&lt;PairInt&gt;();</span>
<span class="fc" id="L646">        pr.changeToZeroes = new HashSet&lt;PairInt&gt;();</span>

<span class="fc" id="L648">        pr.zeroes.add(new PairInt(-1, -2)); pr.zeroes.add(new PairInt(-1, 0));</span>
<span class="fc" id="L649">        pr.zeroes.add(new PairInt(0, -2)); pr.zeroes.add(new PairInt(0, -1)); pr.zeroes.add(new PairInt(0, 1));</span>
<span class="fc" id="L650">        pr.zeroes.add(new PairInt(1, -2)); pr.zeroes.add(new PairInt(1, -1)); pr.zeroes.add(new PairInt(1, 0));</span>
<span class="fc" id="L651">        pr.zeroes.add(new PairInt(2, -2)); pr.zeroes.add(new PairInt(2, -1)); pr.zeroes.add(new PairInt(2, 0));</span>
        
<span class="fc" id="L653">        pr.ones.add(new PairInt(-1, 1));</span>
<span class="fc" id="L654">        pr.ones.add(new PairInt(1, -1)); pr.ones.add(new PairInt(1, 1)); </span>
        
<span class="fc" id="L656">        pr.changeToZeroes.add(new PairInt(1, -1));</span>
        
<span class="fc" id="L658">        return pr;</span>
    }
    
    private int pattern10(Set&lt;PairInt&gt; curve, int imageWidth, int imageHeight) {
       
<span class="fc" id="L663">        int nChanged = 0;</span>
                    
<span class="fc" id="L665">        PatternReplacement pr = getPattern10();</span>
        
<span class="fc" id="L667">        nChanged = replacePatternSwapDirections(curve, imageWidth, imageHeight, </span>
            pr);
        
<span class="fc" id="L670">        return nChanged;</span>
    }
    
    private PatternReplacement getPattern11() {
         
        /*
             0  0  #        2
             #  #  0  0     1
             0  0 &gt;#  0     0
                0  0  0    -1
            -2 -1  0  1  2  3
         */
<span class="fc" id="L682">        PatternReplacement pr = new PatternReplacement();</span>
<span class="fc" id="L683">        pr.ones = new HashSet&lt;PairInt&gt;();</span>
<span class="fc" id="L684">        pr.zeroes = new HashSet&lt;PairInt&gt;();</span>
<span class="fc" id="L685">        pr.changeToZeroes = new HashSet&lt;PairInt&gt;();</span>

<span class="fc" id="L687">        pr.zeroes.add(new PairInt(-2, 0)); pr.zeroes.add(new PairInt(-2, 2));</span>
<span class="fc" id="L688">        pr.zeroes.add(new PairInt(-1, -1)); pr.zeroes.add(new PairInt(-1, 0)); pr.zeroes.add(new PairInt(-1, 2));</span>
<span class="fc" id="L689">        pr.zeroes.add(new PairInt(0, -1)); pr.zeroes.add(new PairInt(0, 1));</span>
<span class="fc" id="L690">        pr.zeroes.add(new PairInt(1, -1)); pr.zeroes.add(new PairInt(1, 0)); pr.zeroes.add(new PairInt(1, 1));</span>
        
<span class="fc" id="L692">        pr.ones.add(new PairInt(-2, 1));</span>
<span class="fc" id="L693">        pr.ones.add(new PairInt(-1, 1)); </span>
<span class="fc" id="L694">        pr.ones.add(new PairInt(0, 2)); </span>
        
<span class="fc" id="L696">        pr.changeToZeroes.add(new PairInt(0, 0));</span>
        
<span class="fc" id="L698">        return pr;</span>
    }
    
    private int pattern11(Set&lt;PairInt&gt; curve, int imageWidth, int imageHeight) {
       
<span class="fc" id="L703">        int nChanged = 0;</span>
                    
<span class="fc" id="L705">        PatternReplacement pr = getPattern11();</span>
        
<span class="fc" id="L707">        nChanged = replacePatternSwapDirections(curve, imageWidth, imageHeight, </span>
            pr);
        
<span class="fc" id="L710">        return nChanged;</span>
    }
    
    private PatternReplacement getPattern12() {
        
        /*
                0  #  0     1
                0 &gt;#  #     0
                0  0  0    -1
               -1  0  1  2  3
         */
<span class="fc" id="L721">        PatternReplacement pr = new PatternReplacement();</span>
<span class="fc" id="L722">        pr.ones = new HashSet&lt;PairInt&gt;();</span>
<span class="fc" id="L723">        pr.zeroes = new HashSet&lt;PairInt&gt;();</span>
<span class="fc" id="L724">        pr.changeToZeroes = new HashSet&lt;PairInt&gt;();</span>

<span class="fc" id="L726">        pr.zeroes.add(new PairInt(-1, -1)); pr.zeroes.add(new PairInt(-1, 0)); pr.zeroes.add(new PairInt(-1, 1));</span>
<span class="fc" id="L727">        pr.zeroes.add(new PairInt(0, -1));</span>
<span class="fc" id="L728">        pr.zeroes.add(new PairInt(1, -1)); pr.zeroes.add(new PairInt(1, 1));</span>
        
<span class="fc" id="L730">        pr.ones.add(new PairInt(0, 1));</span>
<span class="fc" id="L731">        pr.ones.add(new PairInt(1, 0)); </span>
        
<span class="fc" id="L733">        pr.changeToZeroes.add(new PairInt(0, 0));</span>
        
<span class="fc" id="L735">        return pr;</span>
    }
    
    private int curveCorrection12(Set&lt;PairInt&gt; curve, int imageWidth, int imageHeight) {
       
<span class="fc" id="L740">        int nChanged = 0;</span>
                    
<span class="fc" id="L742">        PatternReplacement pr = getPattern12();</span>
        
<span class="fc" id="L744">        nChanged = replacePatternSwapDirections(curve, imageWidth, imageHeight, </span>
            pr);
        
<span class="fc" id="L747">        return nChanged;</span>
    }
    
    private int replacePattern(Set&lt;PairInt&gt; points, int imageWidth, 
        int imageHeight, final PatternReplacement pr) {
        
<span class="fc" id="L753">        int w = imageWidth;</span>
<span class="fc" id="L754">        int h = imageHeight;</span>

<span class="fc" id="L756">        Set&lt;PairInt&gt; tmpPointsRemoved = new HashSet&lt;PairInt&gt;();</span>
<span class="fc" id="L757">        Set&lt;PairInt&gt; tmpPointsAdded = new HashSet&lt;PairInt&gt;();</span>

<span class="fc bfc" id="L759" title="All 2 branches covered.">        for (PairInt p : points) {</span>
            
<span class="fc" id="L761">            boolean isNotPresent = tmpPointsRemoved.contains(p);</span>
<span class="pc bpc" id="L762" title="1 of 2 branches missed.">            if (isNotPresent) {</span>
<span class="nc" id="L763">                continue;</span>
            }
            
<span class="fc" id="L766">            int col = p.getX();</span>
<span class="fc" id="L767">            int row = p.getY();           </span>
                
<span class="fc" id="L769">            boolean foundPattern = true;</span>
            
<span class="fc bfc" id="L771" title="All 2 branches covered.">            for (PairInt p2 : pr.zeroes) {</span>
<span class="fc" id="L772">                int x = col + p2.getX();</span>
<span class="fc" id="L773">                int y = row + p2.getY();</span>
<span class="pc bpc" id="L774" title="4 of 8 branches missed.">                if ((x &lt; 0) || (y &lt; 0) || (x &gt; (w - 1)) || (y &gt; (h - 1))) {</span>
                    //TODO: revisit this
<span class="nc" id="L776">                    foundPattern = false;</span>
<span class="nc" id="L777">                    break;</span>
                }
<span class="fc" id="L779">                PairInt p3 = new PairInt(x, y);</span>
<span class="pc bpc" id="L780" title="1 of 2 branches missed.">                if (!tmpPointsRemoved.contains(p3)</span>
<span class="pc bpc" id="L781" title="1 of 4 branches missed.">                    &amp;&amp; (points.contains(p3) || tmpPointsAdded.contains(p3))) {</span>
<span class="fc" id="L782">                    foundPattern = false;</span>
              
<span class="fc" id="L784">                    break;</span>
                }
<span class="fc" id="L786">            }</span>
               
<span class="fc bfc" id="L788" title="All 2 branches covered.">            if (!foundPattern) {</span>
<span class="fc" id="L789">                continue;</span>
            }

<span class="fc bfc" id="L792" title="All 2 branches covered.">            for (PairInt p2 : pr.ones) {</span>
<span class="fc" id="L793">                int x = col + p2.getX();</span>
<span class="fc" id="L794">                int y = row + p2.getY();</span>
<span class="pc bpc" id="L795" title="4 of 8 branches missed.">                if ((x &lt; 0) || (y &lt; 0) || (x &gt; (w - 1)) || (y &gt; (h - 1))) {</span>
<span class="nc" id="L796">                    foundPattern = false;</span>
<span class="nc" id="L797">                    break;</span>
                }
<span class="fc" id="L799">                PairInt p3 = new PairInt(x, y);</span>
<span class="pc bpc" id="L800" title="1 of 2 branches missed.">                if (tmpPointsRemoved.contains(p3) ||</span>
<span class="pc bpc" id="L801" title="3 of 4 branches missed.">                    (!points.contains(p3) &amp;&amp; !tmpPointsAdded.contains(p3))) {</span>
<span class="nc" id="L802">                    foundPattern = false;</span>

<span class="nc" id="L804">                    break;</span>
                }
<span class="fc" id="L806">            }</span>
          
<span class="pc bpc" id="L808" title="1 of 2 branches missed.">            if (!foundPattern) {</span>
<span class="nc" id="L809">                continue;</span>
            }
            
<span class="fc bfc" id="L812" title="All 2 branches covered.">            for (PairInt p2 : pr.changeToZeroes) {</span>
<span class="fc" id="L813">                int x = col + p2.getX();</span>
<span class="fc" id="L814">                int y = row + p2.getY();</span>
<span class="pc bpc" id="L815" title="4 of 8 branches missed.">                if ((x &lt; 0) || (y &lt; 0) || (x &gt; (w - 1)) || (y &gt; (h - 1))) {</span>
<span class="nc" id="L816">                    continue;</span>
                }
<span class="fc" id="L818">                PairInt p3 = new PairInt(x, y);</span>
<span class="fc" id="L819">                tmpPointsAdded.remove(p3);                </span>
<span class="fc" id="L820">                tmpPointsRemoved.add(p3);</span>
<span class="fc" id="L821">            }</span>
<span class="fc" id="L822">        }</span>
        
<span class="fc" id="L824">        int nCorrections = tmpPointsRemoved.size() + tmpPointsAdded.size();</span>
        
<span class="fc bfc" id="L826" title="All 2 branches covered.">        for (PairInt p2 : tmpPointsRemoved) {</span>
<span class="fc" id="L827">            points.remove(p2);</span>
<span class="fc" id="L828">        }</span>
<span class="pc bpc" id="L829" title="1 of 2 branches missed.">        for (PairInt p2 : tmpPointsAdded) {</span>
<span class="nc" id="L830">            points.add(p2);</span>
<span class="nc" id="L831">        }</span>
        
<span class="fc" id="L833">        return nCorrections;</span>
    }

    private int replacePatternSwapDirections(Set&lt;PairInt&gt; curve, 
        int imageWidth, int imageHeight, PatternReplacement pr) {
        
<span class="fc" id="L839">        int nChanged = replacePattern(curve, imageWidth, imageHeight, pr);</span>
        
        // ----- change the sign of x to handle other direction -----
<span class="fc" id="L842">        reverseXs(pr);</span>
        
<span class="fc" id="L844">        nChanged += replacePattern(curve, imageWidth, imageHeight, pr);</span>
        
        // ----- change the sign of y to handle other direction -----
<span class="fc" id="L847">        reverseYs(pr);</span>
        
<span class="fc" id="L849">        nChanged = replacePattern(curve, imageWidth, imageHeight, pr);</span>
        
        // ----- change the sign of x to handle other direction -----
<span class="fc" id="L852">        reverseXs(pr);</span>
        
<span class="fc" id="L854">        nChanged += replacePattern(curve, imageWidth, imageHeight, pr);</span>
        
        // ----- change the sign of y to handle other direction -----
<span class="fc" id="L857">        reverseYs(pr);</span>
        
<span class="fc" id="L859">        return nChanged;</span>
    }
    
    protected void reverseXs(final PatternReplacement pr) {
        
        // ----- change the sign of x to handle other direction -----
<span class="fc bfc" id="L865" title="All 2 branches covered.">        for (PairInt p : pr.zeroes) {</span>
<span class="fc" id="L866">            p.setX(-1 * p.getX());</span>
<span class="fc" id="L867">        }</span>
        
<span class="fc bfc" id="L869" title="All 2 branches covered.">        for (PairInt p : pr.ones) {</span>
<span class="fc" id="L870">            p.setX(-1 * p.getX());</span>
<span class="fc" id="L871">        }</span>
          
<span class="fc bfc" id="L873" title="All 2 branches covered.">        for (PairInt p : pr.changeToZeroes) {</span>
<span class="fc" id="L874">            p.setX(-1 * p.getX());</span>
<span class="fc" id="L875">        }</span>
<span class="fc" id="L876">    }</span>
    
    protected void reverseYs(final PatternReplacement pr) {
        
        // ----- change the sign of y  -----
<span class="fc bfc" id="L881" title="All 2 branches covered.">        for (PairInt p : pr.zeroes) {</span>
<span class="fc" id="L882">            p.setY(-1 * p.getY());</span>
<span class="fc" id="L883">        }</span>
        
<span class="fc bfc" id="L885" title="All 2 branches covered.">        for (PairInt p : pr.ones) {</span>
<span class="fc" id="L886">            p.setY(-1 * p.getY());</span>
<span class="fc" id="L887">        }</span>
        
<span class="fc bfc" id="L889" title="All 2 branches covered.">        for (PairInt p : pr.changeToZeroes) {</span>
<span class="fc" id="L890">            p.setY(-1 * p.getY());</span>
<span class="fc" id="L891">        }</span>
<span class="fc" id="L892">    }</span>
    
    private boolean testPatternSwapDirections(
        final int xCoord, final int yCoord, Set&lt;PairInt&gt; curve, 
        int imageWidth, int imageHeight, PatternReplacement pr) {
        
<span class="nc" id="L898">        boolean hasPattern = testPattern(xCoord, yCoord, curve, imageWidth, </span>
            imageHeight, pr);
        
<span class="nc bnc" id="L901" title="All 2 branches missed.">        if (hasPattern) {</span>
<span class="nc" id="L902">            return hasPattern;</span>
        }
        
        // ----- change the sign of x to handle other direction -----
<span class="nc" id="L906">        reverseXs(pr);</span>
        
<span class="nc" id="L908">        hasPattern = testPattern(xCoord, yCoord, curve, imageWidth, </span>
            imageHeight, pr);
        
<span class="nc bnc" id="L911" title="All 2 branches missed.">        if (hasPattern) {</span>
<span class="nc" id="L912">            return hasPattern;</span>
        }
        
        // ----- change the sign of y to handle other direction -----
<span class="nc" id="L916">        reverseYs(pr);</span>
        
<span class="nc" id="L918">        hasPattern = testPattern(xCoord, yCoord, curve, imageWidth, </span>
            imageHeight, pr);
        
<span class="nc bnc" id="L921" title="All 2 branches missed.">        if (hasPattern) {</span>
<span class="nc" id="L922">            return hasPattern;</span>
        }
        
        // ----- change the sign of x to handle other direction -----
<span class="nc" id="L926">        reverseXs(pr);</span>
        
<span class="nc" id="L928">        hasPattern = testPattern(xCoord, yCoord, curve, imageWidth, </span>
            imageHeight, pr);
        
<span class="nc bnc" id="L931" title="All 2 branches missed.">        if (hasPattern) {</span>
<span class="nc" id="L932">            return hasPattern;</span>
        }
        
        // ----- change the sign of y to handle other direction -----
<span class="nc" id="L936">        reverseYs(pr);</span>
        
<span class="nc" id="L938">        return hasPattern;</span>
    }
    
    private boolean testPattern(int xCoord, int yCoord, Set&lt;PairInt&gt; points, 
        int imageWidth, int imageHeight, final PatternReplacement pr) {
        
<span class="nc" id="L944">        int w = imageWidth;</span>
<span class="nc" id="L945">        int h = imageHeight;</span>

<span class="nc" id="L947">        Set&lt;PairInt&gt; tmpPointsRemoved = new HashSet&lt;PairInt&gt;();</span>

<span class="nc" id="L949">        PairInt p = new PairInt(xCoord, yCoord);</span>
            
<span class="nc bnc" id="L951" title="All 2 branches missed.">        if (!points.contains(p)) {</span>
<span class="nc" id="L952">            return false;</span>
        }
            
<span class="nc" id="L955">        boolean foundPattern = true;</span>

<span class="nc bnc" id="L957" title="All 2 branches missed.">        for (PairInt p2 : pr.zeroes) {</span>
<span class="nc" id="L958">            int x = xCoord + p2.getX();</span>
<span class="nc" id="L959">            int y = yCoord + p2.getY();</span>
<span class="nc bnc" id="L960" title="All 8 branches missed.">            if ((x &lt; 0) || (y &lt; 0) || (x &gt; (w - 1)) || (y &gt; (h - 1))) {</span>
                //TODO: revisit this
<span class="nc" id="L962">                foundPattern = false;</span>
<span class="nc" id="L963">                break;</span>
            }
<span class="nc" id="L965">            PairInt p3 = new PairInt(x, y);</span>
<span class="nc bnc" id="L966" title="All 4 branches missed.">            if (!tmpPointsRemoved.contains(p3) &amp;&amp; points.contains(p3)) {</span>
<span class="nc" id="L967">                foundPattern = false;</span>
<span class="nc" id="L968">                break;</span>
            }
<span class="nc" id="L970">        }</span>
               
<span class="nc bnc" id="L972" title="All 2 branches missed.">        if (!foundPattern) {</span>
<span class="nc" id="L973">            return false;</span>
        }

<span class="nc bnc" id="L976" title="All 2 branches missed.">        for (PairInt p2 : pr.ones) {</span>
<span class="nc" id="L977">            int x = xCoord + p2.getX();</span>
<span class="nc" id="L978">            int y = yCoord + p2.getY();</span>
<span class="nc bnc" id="L979" title="All 8 branches missed.">            if ((x &lt; 0) || (y &lt; 0) || (x &gt; (w - 1)) || (y &gt; (h - 1))) {</span>
<span class="nc" id="L980">                foundPattern = false;</span>
<span class="nc" id="L981">                break;</span>
            }
<span class="nc" id="L983">            PairInt p3 = new PairInt(x, y);</span>
<span class="nc bnc" id="L984" title="All 4 branches missed.">            if (tmpPointsRemoved.contains(p3) || !points.contains(p3)) {</span>
<span class="nc" id="L985">                foundPattern = false;</span>
<span class="nc" id="L986">                break;</span>
            }
<span class="nc" id="L988">        }</span>
          
<span class="nc bnc" id="L990" title="All 2 branches missed.">        if (!foundPattern) {</span>
<span class="nc" id="L991">            return false;</span>
        }
            
<span class="nc bnc" id="L994" title="All 2 branches missed.">        for (PairInt p2 : pr.changeToZeroes) {</span>
<span class="nc" id="L995">            int x = xCoord + p2.getX();</span>
<span class="nc" id="L996">            int y = yCoord + p2.getY();</span>
<span class="nc bnc" id="L997" title="All 8 branches missed.">            if ((x &lt; 0) || (y &lt; 0) || (x &gt; (w - 1)) || (y &gt; (h - 1))) {</span>
<span class="nc" id="L998">                continue;</span>
            }
<span class="nc" id="L1000">            PairInt p3 = new PairInt(x, y);</span>
<span class="nc" id="L1001">            tmpPointsRemoved.add(p3);</span>
<span class="nc" id="L1002">        }</span>
        
<span class="nc" id="L1004">        int nCorrections = tmpPointsRemoved.size();</span>
        
<span class="nc bnc" id="L1006" title="All 2 branches missed.">        return (nCorrections &gt; 0);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>