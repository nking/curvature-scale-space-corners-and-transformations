<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ImageIOHelper.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Jacoco Report</a> &gt; <a href="index.source.html" class="el_package">algorithms.imageProcessing</a> &gt; <span class="el_source">ImageIOHelper.java</span></div><h1>ImageIOHelper.java</h1><pre class="source lang-java linenums">package algorithms.imageProcessing;

import algorithms.imageProcessing.features.CornerRegion;
import algorithms.imageProcessing.features.FeatureComparisonStat;
import algorithms.imageProcessing.scaleSpace.CurvatureScaleSpaceContour;
import algorithms.imageProcessing.scaleSpace.CurvatureScaleSpaceImagePoint;
import algorithms.imageProcessing.scaleSpace.ScaleSpaceCurve;
import algorithms.util.PairFloatArray;
import algorithms.util.PairInt;
import algorithms.util.PairIntArray;
import algorithms.util.ResourceFinder;
import algorithms.misc.MiscMath;
import gnu.trove.TIntCollection;
import gnu.trove.iterator.TIntIterator;
import gnu.trove.iterator.TIntObjectIterator;
import gnu.trove.map.TIntObjectMap;
import gnu.trove.set.TIntSet;
import java.awt.Color;
import java.awt.color.ColorSpace;
import java.awt.image.BufferedImage;
import java.awt.image.ColorConvertOp;
import java.awt.image.ColorModel;
import java.awt.image.Raster;
import java.awt.image.WritableRaster;
import java.io.File;
import java.io.IOException;
import java.nio.file.Path;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collection;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.Map.Entry;
import java.util.Set;
import java.util.logging.Logger;
import javax.imageio.IIOImage;
import javax.imageio.ImageIO;
import javax.imageio.ImageReadParam;
import javax.imageio.ImageReader;
import javax.imageio.metadata.IIOMetadata;
import javax.imageio.stream.FileImageInputStream;
import javax.imageio.stream.ImageInputStream;
import javax.swing.ImageIcon;

/**
 *
 * @author nichole
 */
<span class="pc bpc" id="L52" title="1 of 2 branches missed.">public class ImageIOHelper {</span>
    
    public static Image readImage(String filePath) throws IOException {
     
<span class="pc bpc" id="L56" title="1 of 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L57">            throw new IllegalStateException(&quot;filePath cannot be null&quot;);</span>
        }
                
        try {
<span class="fc" id="L61">            File file = new File(filePath);</span>
<span class="pc bpc" id="L62" title="1 of 2 branches missed.">            if (!file.exists()) {</span>
<span class="nc" id="L63">                throw new IllegalStateException(filePath + &quot; does not exist&quot;);</span>
            }
            
<span class="fc" id="L66">            String lstPth = null;</span>
<span class="fc" id="L67">            Iterator&lt;Path&gt; iter0 = file.toPath().iterator();</span>
<span class="fc bfc" id="L68" title="All 2 branches covered.">            while (iter0.hasNext()) {</span>
<span class="fc" id="L69">                lstPth = iter0.next().toString();</span>
            }
            
<span class="pc bpc" id="L72" title="1 of 4 branches missed.">            if (lstPth.endsWith(&quot;jpg&quot;) || lstPth.endsWith(&quot;jpeg&quot;) </span>
<span class="pc bpc" id="L73" title="2 of 4 branches missed.">                || lstPth.endsWith(&quot;jPG&quot;) || lstPth.endsWith(&quot;JPEG&quot;)) {</span>
<span class="fc" id="L74">                return readJPEGImage(filePath);</span>
            }
            
            BufferedImage img;
<span class="pc bpc" id="L78" title="1 of 4 branches missed.">            if (filePath.endsWith(&quot;png&quot;) || filePath.endsWith(&quot;PNG&quot;)) {</span>
<span class="fc" id="L79">                ImageIcon imageIcon = new ImageIcon(filePath);</span>
<span class="fc" id="L80">                java.awt.Image tmpImage = imageIcon.getImage();</span>

<span class="fc" id="L82">                img = new BufferedImage(</span>
<span class="fc" id="L83">                    imageIcon.getIconWidth(), imageIcon.getIconHeight(), BufferedImage.TYPE_INT_ARGB);</span>
<span class="fc" id="L84">                img.getGraphics().drawImage(tmpImage, 0, 0, null);</span>
<span class="fc" id="L85">                tmpImage.flush();</span>
<span class="fc" id="L86">            } else {</span>
<span class="fc" id="L87">                img = ImageIO.read(file);</span>
            }
            
            //System.out.println(&quot;imageType=&quot; + img.getType());
            
<span class="fc" id="L92">            int h = img.getHeight();</span>
<span class="fc" id="L93">            int w = img.getWidth();</span>
            
<span class="fc" id="L95">            Image image = new Image(w, h);</span>
            
<span class="fc" id="L97">            convertImage(img, image);</span>
            
<span class="fc" id="L99">            return image;</span>
            
<span class="nc" id="L101">        } catch (IOException e) {</span>
        }
        
<span class="nc" id="L104">        return null;</span>
    }
    
    public static Image readJPEGImage(String filePath) throws IOException {
     
<span class="pc bpc" id="L109" title="1 of 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L110">            throw new IllegalStateException(&quot;filePath cannot be null&quot;);</span>
        }
                
<span class="fc" id="L113">        File file = null;</span>
        
<span class="fc" id="L115">        FileImageInputStream in = null;</span>
        
        try {
<span class="fc" id="L118">            file = new File(filePath);</span>
<span class="pc bpc" id="L119" title="1 of 2 branches missed.">            if (!file.exists()) {</span>
<span class="nc" id="L120">                throw new IllegalStateException(filePath + &quot; does not exist&quot;);</span>
            }
            
<span class="fc" id="L123">            String lstPth = null;</span>
<span class="fc" id="L124">            Iterator&lt;Path&gt; iter0 = file.toPath().iterator();</span>
<span class="fc bfc" id="L125" title="All 2 branches covered.">            while (iter0.hasNext()) {</span>
<span class="fc" id="L126">                lstPth = iter0.next().toString();</span>
            }
            
<span class="pc bpc" id="L129" title="5 of 6 branches missed.">            assert(lstPth.endsWith(&quot;jpg&quot;) || lstPth.endsWith(&quot;jpeg&quot;) </span>
<span class="nc bnc" id="L130" title="All 4 branches missed.">                || lstPth.endsWith(&quot;jPG&quot;) || lstPth.endsWith(&quot;JPEG&quot;));</span>
            
<span class="fc" id="L132">            in = new FileImageInputStream(file);</span>
            
<span class="fc" id="L134">            Iterator&lt;ImageReader&gt; iter = </span>
<span class="fc" id="L135">                ImageIO.getImageReadersByMIMEType(&quot;image/jpeg&quot;);</span>
                    
<span class="fc" id="L137">            Image output = null;</span>
            
<span class="pc bpc" id="L139" title="1 of 2 branches missed.">            while (iter.hasNext()) {</span>
                
<span class="fc" id="L141">                ImageReader rdr = iter.next();</span>
<span class="fc" id="L142">                System.out.println(&quot;jpegreader instance &quot; + </span>
<span class="fc" id="L143">                    rdr.getClass().getName());</span>
                
<span class="fc" id="L145">                rdr.setInput(in);</span>
                
<span class="fc" id="L147">                ImageReadParam rdrParam = rdr.getDefaultReadParam();</span>
               
<span class="fc" id="L149">                int nImages = rdr.getNumImages(true);</span>
                
<span class="fc" id="L151">                System.out.println(&quot;nJPEG bands=&quot; + nImages);</span>
                
<span class="pc bpc" id="L153" title="3 of 4 branches missed.">                assert(nImages &gt;= 1);</span>
                                
<span class="fc" id="L155">                int w = rdr.getWidth(0);</span>
<span class="fc" id="L156">                int h = rdr.getHeight(0);</span>
                                
<span class="fc" id="L158">                output = new Image(w, h);</span>
                
<span class="fc" id="L160">                BufferedImage im = rdr.read(0, rdrParam);</span>
                
<span class="fc" id="L162">                int[] col = new int[w];</span>
<span class="fc" id="L163">                int offset = 0;</span>
<span class="fc bfc" id="L164" title="All 2 branches covered.">                for (int y = 0; y &lt; h; ++y) {</span>
<span class="fc" id="L165">                    im.getRGB(0, y, w, 1, col, offset, 1);</span>
<span class="fc bfc" id="L166" title="All 2 branches covered.">                    for (int x = 0; x &lt; w; ++x) {</span>
<span class="fc" id="L167">                        int rgb = col[x];</span>
                        
<span class="fc" id="L169">                        int r = (rgb &gt;&gt; 16) &amp; 0xFF;</span>
<span class="fc" id="L170">                        int g = (rgb &gt;&gt; 8) &amp; 0xFF;</span>
<span class="fc" id="L171">                        int b = rgb &amp; 0xFF;</span>

<span class="fc" id="L173">                        output.setRGB(x, y, r, g, b);</span>
                    }
                }
               
<span class="fc" id="L177">                return output;</span>
            }
          
<span class="nc" id="L180">            return output;</span>
            
<span class="nc" id="L182">        } catch (IOException e) {</span>
      
<span class="nc" id="L184">            System.err.println(e.getMessage());</span>
            
<span class="nc bnc" id="L186" title="All 2 branches missed.">            if (in != null) {</span>
<span class="nc" id="L187">                in.close();</span>
            }
        }

<span class="nc" id="L191">        return null;        </span>
    }
    
    public static GreyscaleImage readImageAsGreyscaleFullRange(String filePath) 
        throws IOException {
     
<span class="pc bpc" id="L197" title="1 of 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L198">            throw new IllegalStateException(&quot;filePath cannot be null&quot;);</span>
        }
                
        try {
<span class="fc" id="L202">            File file = new File(filePath);</span>
<span class="pc bpc" id="L203" title="1 of 2 branches missed.">            if (!file.exists()) {</span>
<span class="nc" id="L204">                throw new IllegalStateException(filePath + &quot; does not exist&quot;);</span>
            }
            
            BufferedImage img;
<span class="pc bpc" id="L208" title="1 of 4 branches missed.">            if (filePath.endsWith(&quot;png&quot;) || filePath.endsWith(&quot;PNG&quot;)) {</span>
<span class="fc" id="L209">                ImageIcon imageIcon = new ImageIcon(filePath);</span>
<span class="fc" id="L210">                java.awt.Image tmpImage = imageIcon.getImage();</span>

<span class="fc" id="L212">                img = new BufferedImage(</span>
<span class="fc" id="L213">                    imageIcon.getIconWidth(), imageIcon.getIconHeight(), BufferedImage.TYPE_INT_ARGB);</span>
<span class="fc" id="L214">                img.getGraphics().drawImage(tmpImage, 0, 0, null);</span>
<span class="fc" id="L215">                tmpImage.flush();</span>
<span class="fc" id="L216">            } else {</span>
<span class="fc" id="L217">                img = ImageIO.read(file);</span>
            }
            
            //System.out.println(&quot;imageType=&quot; + img.getType());
            
<span class="fc" id="L222">            int h = img.getHeight();</span>
<span class="fc" id="L223">            int w = img.getWidth();</span>
            
<span class="fc" id="L225">            ColorSpace cs = ColorSpace.getInstance(ColorSpace.CS_GRAY);  </span>
<span class="fc" id="L226">            ColorConvertOp op = new ColorConvertOp(cs, null);</span>
            try {
<span class="fc" id="L228">                BufferedImage image2 = op.filter(img, null);</span>
<span class="fc" id="L229">                img = image2;</span>
<span class="nc" id="L230">            } catch (NullPointerException e) {</span>
                // if type is custom, the source color space destination is not defined.
<span class="fc" id="L232">            } </span>
            
<span class="fc" id="L234">            GreyscaleImage image = new GreyscaleImage(w, h, </span>
                GreyscaleImage.Type.Bits32FullRangeInt);
                        
<span class="fc bfc" id="L237" title="All 2 branches covered.">            for (int i = 0; i &lt; w; i++) {</span>
<span class="fc bfc" id="L238" title="All 2 branches covered.">                for (int j = 0; j &lt; h; j++) {</span>
                    
<span class="fc" id="L240">                    int rgb = img.getRGB(i, j);</span>
                                        
<span class="fc" id="L242">                    int g = (rgb &gt;&gt; 8) &amp; 0xFF;</span>
                    
<span class="fc" id="L244">                    image.setValue(i, j, g);</span>
                }
            }
                        
<span class="fc" id="L248">            return image;</span>
            
<span class="nc" id="L250">        } catch (IOException e) {</span>
        }
        
<span class="nc" id="L253">        return null;</span>
    }
   
    public static ImageExt readImageExt(String filePath) throws IOException {
     
<span class="pc bpc" id="L258" title="1 of 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L259">            throw new IllegalStateException(&quot;filePath cannot be null&quot;);</span>
        }
            
        try {
<span class="fc" id="L263">            File file = new File(filePath);</span>
<span class="pc bpc" id="L264" title="1 of 2 branches missed.">            if (!file.exists()) {</span>
<span class="nc" id="L265">                throw new IllegalStateException(filePath + &quot; does not exist&quot;);</span>
            }
            
            BufferedImage img;
<span class="pc bpc" id="L269" title="1 of 4 branches missed.">            if (filePath.endsWith(&quot;png&quot;) || filePath.endsWith(&quot;PNG&quot;)) {</span>
<span class="fc" id="L270">                ImageIcon imageIcon = new ImageIcon(filePath);</span>
<span class="fc" id="L271">                java.awt.Image tmpImage = imageIcon.getImage();</span>

<span class="fc" id="L273">                img = new BufferedImage(</span>
<span class="fc" id="L274">                    imageIcon.getIconWidth(), imageIcon.getIconHeight(), BufferedImage.TYPE_INT_ARGB);</span>
<span class="fc" id="L275">                img.getGraphics().drawImage(tmpImage, 0, 0, null);</span>
<span class="fc" id="L276">                tmpImage.flush();</span>
<span class="fc" id="L277">            } else {</span>
<span class="fc" id="L278">                img = ImageIO.read(file);</span>
            }
            
            //System.out.println(&quot;imageType=&quot; + img.getType());
            
<span class="fc" id="L283">            int h = img.getHeight();</span>
<span class="fc" id="L284">            int w = img.getWidth();</span>
            
<span class="fc" id="L286">            ImageExt image = new ImageExt(w, h);</span>
            
<span class="fc" id="L288">            convertImage(img, image);</span>
            
<span class="fc" id="L290">            return image;</span>
            
<span class="nc" id="L292">        } catch (IOException e) {</span>
        }
        
<span class="nc" id="L295">        return null;</span>
    }
    
    private static void convertImage(BufferedImage fromImage, Image toImage) 
        throws IOException {
     
<span class="pc bpc" id="L301" title="1 of 2 branches missed.">        if (fromImage == null) {</span>
<span class="nc" id="L302">            return;</span>
        }
               
<span class="fc" id="L305">        int h = fromImage.getHeight();</span>
<span class="fc" id="L306">        int w = fromImage.getWidth();</span>

<span class="fc bfc" id="L308" title="All 2 branches covered.">        for (int i = 0; i &lt; w; i++) {</span>
<span class="fc bfc" id="L309" title="All 2 branches covered.">            for (int j = 0; j &lt; h; j++) {</span>

                //TYPE_INT_RGB) and default sRGB colorspace
<span class="fc" id="L312">                int rgb = fromImage.getRGB(i, j);</span>

<span class="fc" id="L314">                int r = (rgb &gt;&gt; 16) &amp; 0xFF;</span>
<span class="fc" id="L315">                int g = (rgb &gt;&gt; 8) &amp; 0xFF;</span>
<span class="fc" id="L316">                int b = rgb &amp; 0xFF;</span>

<span class="fc" id="L318">                toImage.setRGB(i, j, r, g, b);</span>
            }
        }
<span class="fc" id="L321">    }</span>
    
    public static ImageExt convertImage(GreyscaleImage fromImage) {
     
<span class="nc bnc" id="L325" title="All 2 branches missed.">        if (fromImage == null) {</span>
<span class="nc" id="L326">            return null;</span>
        }
        
<span class="nc" id="L329">        int h = fromImage.getHeight();</span>
<span class="nc" id="L330">        int w = fromImage.getWidth();</span>

<span class="nc" id="L332">        ImageExt toImage = new ImageExt(w, h);</span>
                
<span class="nc bnc" id="L334" title="All 2 branches missed.">        for (int i = 0; i &lt; w; i++) {</span>
<span class="nc bnc" id="L335" title="All 2 branches missed.">            for (int j = 0; j &lt; h; j++) {</span>
                
<span class="nc" id="L337">                int v = fromImage.getValue(i, j);</span>

<span class="nc" id="L339">                toImage.setRGB(i, j, v, v, v);</span>
            }
        }
        
<span class="nc" id="L343">        return toImage;</span>
    }
    
    /**
     * 
     * @param filePath
     * @return
     * @throws Exception 
     */
    public static GreyscaleImage readImageAsGrayScaleG(String filePath) 
        throws IOException {
     
<span class="pc bpc" id="L355" title="1 of 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L356">            throw new IllegalStateException(&quot;filePath cannot be null&quot;);</span>
        }
                
        try {
<span class="fc" id="L360">            File file = new File(filePath);</span>
<span class="pc bpc" id="L361" title="1 of 2 branches missed.">            if (!file.exists()) {</span>
<span class="nc" id="L362">                throw new IllegalStateException(filePath + &quot; does not exist&quot;);</span>
            }
            
            BufferedImage img;
<span class="pc bpc" id="L366" title="1 of 4 branches missed.">            if (filePath.endsWith(&quot;png&quot;) || filePath.endsWith(&quot;PNG&quot;)) {</span>
<span class="fc" id="L367">                ImageIcon imageIcon = new ImageIcon(filePath);</span>
<span class="fc" id="L368">                java.awt.Image tmpImage = imageIcon.getImage();</span>

<span class="fc" id="L370">                img = new BufferedImage(</span>
<span class="fc" id="L371">                    imageIcon.getIconWidth(), imageIcon.getIconHeight(), BufferedImage.TYPE_INT_ARGB);</span>
<span class="fc" id="L372">                img.getGraphics().drawImage(tmpImage, 0, 0, null);</span>
<span class="fc" id="L373">                tmpImage.flush();</span>
<span class="fc" id="L374">            } else {</span>
<span class="fc" id="L375">                img = ImageIO.read(file);</span>
            }
            
<span class="fc" id="L378">            ColorSpace cs = ColorSpace.getInstance(ColorSpace.CS_GRAY);  </span>
<span class="fc" id="L379">            ColorConvertOp op = new ColorConvertOp(cs, null);</span>
            try {
<span class="fc" id="L381">                BufferedImage image2 = op.filter(img, null);</span>
<span class="fc" id="L382">                img = image2;</span>
<span class="nc" id="L383">            } catch (NullPointerException e) {</span>
                // if type is custom, the source color space destination is not defined.
<span class="fc" id="L385">            }       </span>
<span class="fc" id="L386">            int h = img.getHeight();</span>
<span class="fc" id="L387">            int w = img.getWidth();</span>
            
<span class="fc" id="L389">            GreyscaleImage image = new GreyscaleImage(w, h);</span>
<span class="fc bfc" id="L390" title="All 2 branches covered.">            for (int i = 0; i &lt; w; i++) {</span>
<span class="fc bfc" id="L391" title="All 2 branches covered.">                for (int j = 0; j &lt; h; j++) {</span>
                    
<span class="fc" id="L393">                    int rgb = img.getRGB(i, j);</span>
                                        
<span class="fc" id="L395">                    int g = (rgb &gt;&gt; 8) &amp; 0xFF;</span>
                    
<span class="fc" id="L397">                    image.setValue(i, j, g);</span>
                }
            }
            
<span class="fc" id="L401">            return image;</span>
            
<span class="nc" id="L403">        } catch (IOException e) {</span>
        }
        
<span class="nc" id="L406">        return null;</span>
    }
    
    /**
     * read the Red channel of the image at filePath into a single channel
     * GreyscaleImage image.
     * 
     * @param filePath
     * @return
     * @throws Exception 
     */
    public static GreyscaleImage readImageAsGrayScaleR(String filePath) 
        throws IOException {
     
<span class="nc bnc" id="L420" title="All 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L421">            throw new IllegalStateException(&quot;filePath cannot be null&quot;);</span>
        }
                
        try {
<span class="nc" id="L425">            File file = new File(filePath);</span>
<span class="nc bnc" id="L426" title="All 2 branches missed.">            if (!file.exists()) {</span>
<span class="nc" id="L427">                throw new IllegalStateException(filePath + &quot; does not exist&quot;);</span>
            }
            
            BufferedImage img;
<span class="nc bnc" id="L431" title="All 4 branches missed.">            if (filePath.endsWith(&quot;png&quot;) || filePath.endsWith(&quot;PNG&quot;)) {</span>
<span class="nc" id="L432">                ImageIcon imageIcon = new ImageIcon(filePath);</span>
<span class="nc" id="L433">                java.awt.Image tmpImage = imageIcon.getImage();</span>

<span class="nc" id="L435">                img = new BufferedImage(</span>
<span class="nc" id="L436">                    imageIcon.getIconWidth(), imageIcon.getIconHeight(), BufferedImage.TYPE_INT_ARGB);</span>
<span class="nc" id="L437">                img.getGraphics().drawImage(tmpImage, 0, 0, null);</span>
<span class="nc" id="L438">                tmpImage.flush();</span>
<span class="nc" id="L439">            } else {</span>
<span class="nc" id="L440">                img = ImageIO.read(file);</span>
            }
                       
<span class="nc" id="L443">            ColorSpace cs = ColorSpace.getInstance(ColorSpace.CS_GRAY);  </span>
<span class="nc" id="L444">            ColorConvertOp op = new ColorConvertOp(cs, null);</span>
            try {
<span class="nc" id="L446">                BufferedImage image2 = op.filter(img, null);</span>
<span class="nc" id="L447">                img = image2;</span>
<span class="nc" id="L448">            } catch (NullPointerException e) {</span>
                // if type is custom, the source color space destination is not defined.
<span class="nc" id="L450">            }       </span>
<span class="nc" id="L451">            int h = img.getHeight();</span>
<span class="nc" id="L452">            int w = img.getWidth();</span>
            
<span class="nc" id="L454">            GreyscaleImage image = new GreyscaleImage(w, h);</span>
<span class="nc bnc" id="L455" title="All 2 branches missed.">            for (int i = 0; i &lt; w; i++) {</span>
<span class="nc bnc" id="L456" title="All 2 branches missed.">                for (int j = 0; j &lt; h; j++) {</span>
                    
<span class="nc" id="L458">                    int rgb = img.getRGB(i, j);</span>
                                        
<span class="nc" id="L460">                    int r = (rgb &gt;&gt; 16) &amp; 0xFF;</span>
                    
<span class="nc" id="L462">                    image.setValue(i, j, r);</span>
                }
            }
            
<span class="nc" id="L466">            return image;</span>
            
<span class="nc" id="L468">        } catch (IOException e) {</span>
        }
        
<span class="nc" id="L471">        return null;</span>
    }
    
    /**
     * read the Blue channel of the image at filePath into a single channel
     * GreyscaleImage image.
     * 
     * @param filePath
     * @return
     * @throws Exception 
     */
    public static GreyscaleImage readImageAsGrayScaleB(String filePath) 
        throws IOException {
     
<span class="nc bnc" id="L485" title="All 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L486">            throw new IllegalStateException(&quot;filePath cannot be null&quot;);</span>
        }
                
        try {
<span class="nc" id="L490">            File file = new File(filePath);</span>
<span class="nc bnc" id="L491" title="All 2 branches missed.">            if (!file.exists()) {</span>
<span class="nc" id="L492">                throw new IllegalStateException(filePath + &quot; does not exist&quot;);</span>
            }
            
            BufferedImage img;
<span class="nc bnc" id="L496" title="All 4 branches missed.">            if (filePath.endsWith(&quot;png&quot;) || filePath.endsWith(&quot;PNG&quot;)) {</span>
<span class="nc" id="L497">                ImageIcon imageIcon = new ImageIcon(filePath);</span>
<span class="nc" id="L498">                java.awt.Image tmpImage = imageIcon.getImage();</span>

<span class="nc" id="L500">                img = new BufferedImage(</span>
<span class="nc" id="L501">                    imageIcon.getIconWidth(), imageIcon.getIconHeight(), BufferedImage.TYPE_INT_ARGB);</span>
<span class="nc" id="L502">                img.getGraphics().drawImage(tmpImage, 0, 0, null);</span>
<span class="nc" id="L503">                tmpImage.flush();</span>
<span class="nc" id="L504">            } else {</span>
<span class="nc" id="L505">                img = ImageIO.read(file);</span>
            }
                       
<span class="nc" id="L508">            ColorSpace cs = ColorSpace.getInstance(ColorSpace.CS_GRAY);  </span>
<span class="nc" id="L509">            ColorConvertOp op = new ColorConvertOp(cs, null);</span>
            try {
<span class="nc" id="L511">                BufferedImage image2 = op.filter(img, null);</span>
<span class="nc" id="L512">                img = image2;</span>
<span class="nc" id="L513">            } catch (NullPointerException e) {</span>
                // if type is custom, the source color space destination is not defined.
<span class="nc" id="L515">            }       </span>
<span class="nc" id="L516">            int h = img.getHeight();</span>
<span class="nc" id="L517">            int w = img.getWidth();</span>
            
<span class="nc" id="L519">            GreyscaleImage image = new GreyscaleImage(w, h);</span>
<span class="nc bnc" id="L520" title="All 2 branches missed.">            for (int i = 0; i &lt; w; i++) {</span>
<span class="nc bnc" id="L521" title="All 2 branches missed.">                for (int j = 0; j &lt; h; j++) {</span>
                    
<span class="nc" id="L523">                    int rgb = img.getRGB(i, j);</span>
                                        
<span class="nc" id="L525">                    int b = rgb &amp; 0xFF;</span>
                    
<span class="nc" id="L527">                    image.setValue(i, j, b);</span>
                }
            }
            
<span class="nc" id="L531">            return image;</span>
            
<span class="nc" id="L533">        } catch (IOException e) {</span>
<span class="nc" id="L534">            Logger.getLogger(ImageIOHelper.class.getName()).severe(e.getMessage());</span>
        }
        
<span class="nc" id="L537">        return null;</span>
    }
    
    /**
     * read image at filePath into a greyscale image.
     * 
     * @param filePath
     * @return
     * @throws IOException 
     */
    public static Image readImageAsGrayScale(String filePath) 
        throws IOException {
     
<span class="pc bpc" id="L550" title="1 of 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L551">            throw new IllegalStateException(&quot;filePath cannot be null&quot;);</span>
        }
                
        try {
<span class="fc" id="L555">            File file = new File(filePath);</span>
<span class="pc bpc" id="L556" title="1 of 2 branches missed.">            if (!file.exists()) {</span>
<span class="nc" id="L557">                throw new IllegalStateException(filePath + &quot; does not exist&quot;);</span>
            }
            
            BufferedImage img;
<span class="pc bpc" id="L561" title="1 of 4 branches missed.">            if (filePath.endsWith(&quot;png&quot;) || filePath.endsWith(&quot;PNG&quot;)) {</span>
<span class="fc" id="L562">                ImageIcon imageIcon = new ImageIcon(filePath);</span>
<span class="fc" id="L563">                java.awt.Image tmpImage = imageIcon.getImage();</span>

<span class="fc" id="L565">                img = new BufferedImage(</span>
<span class="fc" id="L566">                    imageIcon.getIconWidth(), imageIcon.getIconHeight(), BufferedImage.TYPE_INT_ARGB);</span>
<span class="fc" id="L567">                img.getGraphics().drawImage(tmpImage, 0, 0, null);</span>
<span class="fc" id="L568">                tmpImage.flush();</span>
<span class="fc" id="L569">            } else {</span>
<span class="fc" id="L570">                img = ImageIO.read(file);</span>
            }

            //ImageDisplayer.displayDisposableImage(&quot;buffered&quot;, img);

<span class="fc" id="L575">            ColorSpace cs = ColorSpace.getInstance(ColorSpace.CS_GRAY);  </span>
<span class="fc" id="L576">            ColorConvertOp op = new ColorConvertOp(cs, null);</span>
            try {
<span class="fc" id="L578">                BufferedImage image2 = op.filter(img, null);</span>
<span class="fc" id="L579">                img = image2;</span>
 
                //ImageDisplayer.displayDisposableImage(&quot;buffered2&quot;, img);
 
<span class="nc" id="L583">            } catch (NullPointerException e) {</span>
                // if type is custom, the source color space destination is not defined.
<span class="fc" id="L585">            }       </span>
<span class="fc" id="L586">            int h = img.getHeight();</span>
<span class="fc" id="L587">            int w = img.getWidth();</span>
            
<span class="fc" id="L589">            Image image = new Image(w, h);</span>
<span class="fc bfc" id="L590" title="All 2 branches covered.">            for (int i = 0; i &lt; w; i++) {</span>
<span class="fc bfc" id="L591" title="All 2 branches covered.">                for (int j = 0; j &lt; h; j++) {</span>
                    
<span class="fc" id="L593">                    int rgb = img.getRGB(i, j);</span>
                    
<span class="fc" id="L595">                    int r = (rgb &gt;&gt; 16) &amp; 0xFF;</span>
<span class="fc" id="L596">                    int g = (rgb &gt;&gt; 8) &amp; 0xFF;</span>
<span class="fc" id="L597">                    int b = rgb &amp; 0xFF;         </span>
                    
<span class="fc" id="L599">                    image.setRGB(i, j, r, g, b);</span>
                }
            }
       
            //ImageDisplayer.displayImageGrey(&quot;image&quot;, image);
       
<span class="fc" id="L605">            return image;</span>
            
<span class="nc" id="L607">        } catch (IOException e) {</span>
        }
        
<span class="nc" id="L610">        return null;</span>
    }
    
    /**
     * read image at filePath into a greyscale image with assumptions that pixel
     * value '0' is '0' and anything else gets stored in output as a '1'.
     * 
     * @param filePath
     * @return
     * @throws Exception 
     */
    public static GreyscaleImage readImageAsBinary(String filePath) 
        throws IOException {
     
<span class="pc bpc" id="L624" title="1 of 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L625">            throw new IllegalStateException(&quot;filePath cannot be null&quot;);</span>
        }
                
        try {
<span class="fc" id="L629">            File file = new File(filePath);</span>
<span class="pc bpc" id="L630" title="1 of 2 branches missed.">            if (!file.exists()) {</span>
<span class="nc" id="L631">                throw new IllegalStateException(filePath + &quot; does not exist&quot;);</span>
            }
            
            BufferedImage img;
<span class="pc bpc" id="L635" title="3 of 4 branches missed.">            if (filePath.endsWith(&quot;png&quot;) || filePath.endsWith(&quot;PNG&quot;)) {</span>
<span class="fc" id="L636">                ImageIcon imageIcon = new ImageIcon(filePath);</span>
<span class="fc" id="L637">                java.awt.Image tmpImage = imageIcon.getImage();</span>

<span class="fc" id="L639">                img = new BufferedImage(</span>
<span class="fc" id="L640">                    imageIcon.getIconWidth(), imageIcon.getIconHeight(), BufferedImage.TYPE_INT_ARGB);</span>
<span class="fc" id="L641">                img.getGraphics().drawImage(tmpImage, 0, 0, null);</span>
<span class="fc" id="L642">                tmpImage.flush();</span>
<span class="fc" id="L643">            } else {</span>
<span class="nc" id="L644">                img = ImageIO.read(file);</span>
            }
                 
<span class="fc" id="L647">            int h = img.getHeight();</span>
<span class="fc" id="L648">            int w = img.getWidth();</span>
           
<span class="fc" id="L650">            Raster raster = img.getData();</span>
            
<span class="fc" id="L652">            GreyscaleImage image = new GreyscaleImage(w, h);</span>
            
<span class="fc" id="L654">            int[] data = null;</span>
<span class="fc bfc" id="L655" title="All 2 branches covered.">            for (int i = 0; i &lt; w; i++) {</span>
<span class="fc bfc" id="L656" title="All 2 branches covered.">                for (int j = 0; j &lt; h; j++) {</span>
<span class="fc" id="L657">                    data = raster.getPixel(i, j, data);</span>
<span class="fc" id="L658">                    int value = data[0];</span>
<span class="fc" id="L659">                    image.setValue(i, j, value);</span>
                }
            }
            
<span class="fc" id="L663">            return image;</span>
            
<span class="nc" id="L665">        } catch (IOException e) {</span>
        }
        
<span class="nc" id="L668">        return null;</span>
    }
    
    /**
     * 
     * @param filePath
     * @return
     * @throws Exception 
     */
    public static GreyscaleImage readImageAsGrayScaleAvgRGB(String filePath)
        throws IOException {
     
<span class="pc bpc" id="L680" title="1 of 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L681">            throw new IllegalStateException(&quot;filePath cannot be null&quot;);</span>
        }
                
        try {
<span class="fc" id="L685">            File file = new File(filePath);</span>
<span class="pc bpc" id="L686" title="1 of 2 branches missed.">            if (!file.exists()) {</span>
<span class="nc" id="L687">                throw new IllegalStateException(filePath + &quot; does not exist&quot;);</span>
            }
            
            BufferedImage img;
<span class="pc bpc" id="L691" title="1 of 4 branches missed.">            if (filePath.endsWith(&quot;png&quot;) || filePath.endsWith(&quot;PNG&quot;)) {</span>
<span class="fc" id="L692">                ImageIcon imageIcon = new ImageIcon(filePath);</span>
<span class="fc" id="L693">                java.awt.Image tmpImage = imageIcon.getImage();</span>

<span class="fc" id="L695">                img = new BufferedImage(</span>
<span class="fc" id="L696">                    imageIcon.getIconWidth(), imageIcon.getIconHeight(), BufferedImage.TYPE_INT_ARGB);</span>
<span class="fc" id="L697">                img.getGraphics().drawImage(tmpImage, 0, 0, null);</span>
<span class="fc" id="L698">                tmpImage.flush();</span>
<span class="fc" id="L699">            } else {</span>
<span class="fc" id="L700">                img = ImageIO.read(file);</span>
            }
            
<span class="fc" id="L703">            ColorSpace cs = ColorSpace.getInstance(ColorSpace.CS_GRAY);  </span>
<span class="fc" id="L704">            ColorConvertOp op = new ColorConvertOp(cs, null);  </span>
            try {
<span class="fc" id="L706">                BufferedImage image2 = op.filter(img, null);</span>
<span class="fc" id="L707">                img = image2;</span>
<span class="nc" id="L708">            } catch (NullPointerException e) {</span>
                // if type is custom, the source color space destination is not defined.
<span class="fc" id="L710">            }</span>
                        
<span class="fc" id="L712">            int h = img.getHeight();</span>
<span class="fc" id="L713">            int w = img.getWidth();</span>
            
<span class="fc" id="L715">            GreyscaleImage image = new GreyscaleImage(w, h);</span>
<span class="fc bfc" id="L716" title="All 2 branches covered.">            for (int i = 0; i &lt; w; i++) {</span>
<span class="fc bfc" id="L717" title="All 2 branches covered.">                for (int j = 0; j &lt; h; j++) {</span>
                    
<span class="fc" id="L719">                    int rgb = img.getRGB(i, j);</span>
                                        
<span class="fc" id="L721">                    int r = (rgb &gt;&gt; 16) &amp; 0xFF;</span>
<span class="fc" id="L722">                    int g = (rgb &gt;&gt; 8) &amp; 0xFF;</span>
<span class="fc" id="L723">                    int b = rgb &amp; 0xFF;</span>
<span class="fc" id="L724">                    float v = (r + g + b)/3.f;</span>
                    
<span class="fc" id="L726">                    image.setValue(i, j, (int)v);</span>
                }
            }
            
<span class="fc" id="L730">            return image;</span>
            
<span class="nc" id="L732">        } catch (IOException e) {</span>
        }
        
<span class="nc" id="L735">        return null;</span>
    }
    
    public static void writeOutputImage(String filePath, Image data) 
        throws IOException {
        
<span class="fc" id="L741">        writeOutputImage(filePath, data,  BufferedImage.TYPE_INT_RGB);       </span>
<span class="fc" id="L742">    }</span>
    
    public static void writeOutputImage(String filePath, Image data, 
        final int imageType) throws IOException {
                
<span class="pc bpc" id="L747" title="1 of 2 branches missed.">        if (data == null) {</span>
<span class="nc" id="L748">            return;</span>
        }
<span class="pc bpc" id="L750" title="1 of 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L751">            throw new IllegalArgumentException(&quot;filePath cannot be null&quot;);</span>
        }
        
<span class="fc" id="L754">        int w = data.getWidth();</span>
        
<span class="fc" id="L756">        int h = data.getHeight();</span>
        
<span class="fc" id="L758">        BufferedImage outputImage = new BufferedImage(w, h, </span>
            BufferedImage.TYPE_INT_RGB);
        
<span class="fc bfc" id="L761" title="All 2 branches covered.">        for (int i = 0; i &lt; w; i++) {</span>
<span class="fc bfc" id="L762" title="All 2 branches covered.">            for (int j = 0; j &lt; h; j++) {</span>
<span class="fc" id="L763">                int rgbValue = data.getRGB(i, j);</span>
<span class="fc" id="L764">                outputImage.setRGB(i, j, rgbValue);</span>
            }
        }
        
<span class="fc" id="L768">        ImageIO.write(outputImage, &quot;PNG&quot;, new File(filePath));</span>
        
<span class="fc" id="L770">    }</span>
    
    public static void writeOutputImage(String filePath, GreyscaleImage data) 
        throws IOException {
                
<span class="pc bpc" id="L775" title="1 of 2 branches missed.">        if (data == null) {</span>
<span class="nc" id="L776">            return;</span>
        }
<span class="pc bpc" id="L778" title="1 of 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L779">            throw new IllegalArgumentException(&quot;filePath cannot be null&quot;);</span>
        }
        
<span class="fc" id="L782">        int w = data.getWidth();</span>
        
<span class="fc" id="L784">        int h = data.getHeight();</span>
        
<span class="fc" id="L786">        BufferedImage outputImage = new BufferedImage(w, h, </span>
            BufferedImage.TYPE_BYTE_GRAY);
        
<span class="fc" id="L789">        WritableRaster raster = outputImage.getRaster();</span>
        
<span class="fc bfc" id="L791" title="All 2 branches covered.">        for (int i = 0; i &lt; w; i++) {</span>
            
<span class="fc bfc" id="L793" title="All 2 branches covered.">            for (int j = 0; j &lt; h; j++) {</span>
                
<span class="fc" id="L795">                int value = data.getValue(i, j);</span>
                
<span class="fc" id="L797">                raster.setSample(i, j, 0, value);</span>
            }
        }
        
<span class="fc" id="L801">        ImageIO.write(outputImage, &quot;PNG&quot;, new File(filePath));</span>
<span class="fc" id="L802">    }</span>
    
    public static void writeOutputGreyscaleImage(String filePath, Image data) 
        throws IOException {
                
<span class="nc bnc" id="L807" title="All 2 branches missed.">        if (data == null) {</span>
<span class="nc" id="L808">            return;</span>
        }
<span class="nc bnc" id="L810" title="All 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L811">            throw new IllegalArgumentException(&quot;filePath cannot be null&quot;);</span>
        }
        
<span class="nc" id="L814">        int w = data.getWidth();</span>
        
<span class="nc" id="L816">        int h = data.getHeight();</span>
        
<span class="nc" id="L818">        BufferedImage outputImage = new BufferedImage(w, h, </span>
            BufferedImage.TYPE_BYTE_GRAY);
        
<span class="nc" id="L821">        WritableRaster raster = outputImage.getRaster();</span>
        
<span class="nc bnc" id="L823" title="All 2 branches missed.">        for (int i = 0; i &lt; w; i++) {</span>
            
<span class="nc bnc" id="L825" title="All 2 branches missed.">            for (int j = 0; j &lt; h; j++) {</span>
                
<span class="nc" id="L827">                int rgb = data.getRGB(i, j);</span>
                
<span class="nc" id="L829">                int r = (rgb &gt;&gt; 16) &amp; 0xFF;</span>
<span class="nc" id="L830">                int g = (rgb &gt;&gt; 8) &amp; 0xFF;</span>
<span class="nc" id="L831">                int b = rgb &amp; 0xFF;  </span>
                
                // from wikipedia, srgb conversion
<span class="nc" id="L834">                double yLinear = 0.2126 * r + 0.7152 * g + 0.0722 * b;</span>
                /*if (yLinear &gt; 0.0031308) {
                    yLinear = 1.033 * Math.pow(yLinear, 1./2.4) - 0.055f;
                } else {
                    yLinear *= 12.92;
                }*/
<span class="nc" id="L840">                int v = (int)Math.round(yLinear);</span>
                
<span class="nc" id="L842">                raster.setSample(i, j, 0, v);</span>
            }
        }
        
<span class="nc" id="L846">        ImageIO.write(outputImage, &quot;PNG&quot;, new File(filePath));</span>
<span class="nc" id="L847">    }</span>
    
    /**
     * draw the edges over input and mark the corners.  The edges are drawn
     * in rotating colors to make it easier to see closed curves.
     * The corners are drawn in red dots of size 2. For best results, the
     * input image should be greyscale.
     * @param input
     * @param edges
     * @param corners
     * @param fileName
     * @param width
     * @param height
     * @throws IOException 
     */
    public static void writeImage(Image input, PairIntArray[] edges, 
        PairIntArray corners, String fileName, int width, int height) throws 
        IOException {
                
<span class="nc bnc" id="L866" title="All 6 branches missed.">        if (edges == null || input == null || corners == null) {</span>
<span class="nc" id="L867">            return;</span>
        }
<span class="nc bnc" id="L869" title="All 2 branches missed.">        if (fileName == null) {</span>
<span class="nc" id="L870">            throw new IllegalArgumentException(&quot;fileName cannot be null&quot;);</span>
        }
        
<span class="nc" id="L873">        addAlternatingColorCurvesToImage(edges, fileName, false, input);</span>
                
<span class="nc" id="L875">        addCurveToImage(corners, input, 1, 255, 0, 0);</span>
        
<span class="nc" id="L877">        String dirPath = ResourceFinder.findDirectory(&quot;bin&quot;);</span>
       
<span class="nc" id="L879">        ImageIOHelper.writeOutputImage(dirPath + &quot;/&quot; + fileName, input);</span>
<span class="nc" id="L880">    }</span>
    
    public static void addContoursToImage(List&lt;CurvatureScaleSpaceContour&gt; result, 
        ImageExt img, int xOffset, int yOffset,
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="pc bpc" id="L886" title="1 of 2 branches missed.">        if (result.isEmpty()) {</span>
<span class="nc" id="L887">            return;</span>
        }
        
<span class="fc bfc" id="L890" title="All 2 branches covered.">        for (int i = 0; i &lt; result.size(); i++) {</span>
            
<span class="fc" id="L892">            CurvatureScaleSpaceContour cssC = result.get(i);</span>
            
<span class="fc" id="L894">            addContoursToImage(cssC, img, xOffset, yOffset, nExtraForDot, </span>
                rClr, gClr, bClr);
        }
<span class="fc" id="L897">    }</span>
    
    public static void addContoursToImage(CurvatureScaleSpaceContour contour, 
        ImageExt img, int xOffset, int yOffset,
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="pc bpc" id="L903" title="1 of 2 branches missed.">        if (contour == null) {</span>
<span class="nc" id="L904">            return;</span>
        }
                    
<span class="fc" id="L907">        CurvatureScaleSpaceImagePoint[] peakDetails = contour.getPeakDetails();</span>

<span class="fc bfc" id="L909" title="All 2 branches covered.">        for (CurvatureScaleSpaceImagePoint peakDetail : peakDetails) {</span>
            
<span class="fc" id="L911">            int x = peakDetail.getXCoord() + xOffset;</span>
<span class="fc" id="L912">            int y = peakDetail.getYCoord() + yOffset;</span>
            
<span class="fc" id="L914">            addPointToImage(x, y, img, xOffset, yOffset, nExtraForDot, </span>
                rClr, gClr, bClr);
        }            
<span class="fc" id="L917">    }</span>
    
    public static void addPointToImage(final int x, final int y, 
        Image img, int xOffset, int yOffset,
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="fc bfc" id="L923" title="All 2 branches covered.">        for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
<span class="fc" id="L924">            float xx = x + dx;</span>
<span class="pc bpc" id="L925" title="2 of 4 branches missed.">            if ((xx &gt; -1) &amp;&amp; (xx &lt; (img.getWidth() - 1))) {</span>
<span class="fc bfc" id="L926" title="All 2 branches covered.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); </span>
<span class="fc" id="L927">                    dy++) {</span>
<span class="fc" id="L928">                    float yy = y + dy;</span>
<span class="pc bpc" id="L929" title="2 of 4 branches missed.">                    if ((yy &gt; -1) &amp;&amp; (yy &lt; (img.getHeight() - 1))) {</span>
<span class="fc" id="L930">                        img.setRGB((int)xx, (int)yy, rClr, gClr, bClr);</span>
                    }
                }
            }
        }
<span class="fc" id="L935">    }</span>
    
    private static PairFloatArray getXYOfContourPeaks(
        List&lt;CurvatureScaleSpaceContour&gt; contours, int xOffset, int yOffset) {
        
<span class="nc" id="L940">        PairFloatArray xy = new PairFloatArray();</span>
        
<span class="nc bnc" id="L942" title="All 2 branches missed.">        for (int i = 0; i &lt; contours.size(); ++i) {</span>
            
<span class="nc" id="L944">            CurvatureScaleSpaceContour contour = contours.get(i);</span>
            
<span class="nc" id="L946">            CurvatureScaleSpaceImagePoint[] peakDetails = contour.getPeakDetails();</span>
            
<span class="nc bnc" id="L948" title="All 2 branches missed.">            for (CurvatureScaleSpaceImagePoint peakDetail : peakDetails) {</span>
<span class="nc" id="L949">                int x = peakDetail.getXCoord() + xOffset;</span>
<span class="nc" id="L950">                int y = peakDetail.getYCoord() + yOffset;</span>
<span class="nc" id="L951">                xy.add(x, y);</span>
            }
        }
        
<span class="nc" id="L955">        return xy;</span>
    }
    
    /**
     * draw the edge over the image using the given rgb colors and the size
     * of the dot beyond 1 pixel.
     * 
     * @param edge
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void addCurveToImage(PairIntArray edge, Image input, 
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="pc bpc" id="L972" title="2 of 4 branches missed.">        if (edge == null || input == null) {</span>
<span class="nc" id="L973">            return;</span>
        }
        
<span class="fc" id="L976">        int w = input.getWidth();</span>
<span class="fc" id="L977">        int h = input.getHeight();</span>
        
<span class="fc bfc" id="L979" title="All 2 branches covered.">        for (int i = 0; i &lt; edge.getN(); i++) {</span>
<span class="fc" id="L980">            int x = edge.getX(i);</span>
<span class="fc" id="L981">            int y = edge.getY(i);</span>
            
<span class="fc bfc" id="L983" title="All 2 branches covered.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
                
<span class="fc" id="L985">                int xx = x + dx;</span>
                
<span class="fc bfc" id="L987" title="All 4 branches covered.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="fc" id="L988">                    continue;</span>
                }
<span class="fc bfc" id="L990" title="All 2 branches covered.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="fc" id="L991">                    int yy = y + dy;</span>
<span class="fc bfc" id="L992" title="All 4 branches covered.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="fc" id="L993">                        continue;</span>
                    }
<span class="fc" id="L995">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
        }
<span class="fc" id="L999">    }</span>
    
    /**
     * draw the edge over the image using the given rgb colors and the size
     * of the dot beyond 1 pixel.
     * 
     * @param pixIdxs
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void addCurveToImage(TIntCollection pixIdxs, Image input, 
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="pc bpc" id="L1015" title="2 of 4 branches missed.">        if (pixIdxs == null || input == null) {</span>
<span class="nc" id="L1016">            return;</span>
        }
        
<span class="fc" id="L1019">        int w = input.getWidth();</span>
<span class="fc" id="L1020">        int h = input.getHeight();</span>
        
<span class="fc" id="L1022">        TIntIterator iter = pixIdxs.iterator();</span>
<span class="fc bfc" id="L1023" title="All 2 branches covered.">        while (iter.hasNext()) {</span>
            
<span class="fc" id="L1025">            int pixIdx = iter.next();</span>
            
<span class="fc" id="L1027">            int y = pixIdx/w;</span>
<span class="fc" id="L1028">            int x = pixIdx - (y * w);</span>
            
<span class="fc bfc" id="L1030" title="All 2 branches covered.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
                
<span class="fc" id="L1032">                int xx = x + dx;</span>
                
<span class="pc bpc" id="L1034" title="2 of 4 branches missed.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L1035">                    continue;</span>
                }
<span class="fc bfc" id="L1037" title="All 2 branches covered.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="fc" id="L1038">                    int yy = y + dy;</span>
<span class="pc bpc" id="L1039" title="2 of 4 branches missed.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L1040">                        continue;</span>
                    }
<span class="fc" id="L1042">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
<span class="fc" id="L1045">        }</span>
<span class="fc" id="L1046">    }</span>
    
    /**
     * draw the edge over the image using the given rgb colors and the size
     * of the dot beyond 1 pixel.
     * 
     * @param points
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void addCurveToImage(Collection&lt;PairInt&gt; points, Image input, 
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="pc bpc" id="L1062" title="2 of 4 branches missed.">        if (points == null || input == null) {</span>
<span class="nc" id="L1063">            return;</span>
        }
        
<span class="fc" id="L1066">        int w = input.getWidth();</span>
<span class="fc" id="L1067">        int h = input.getHeight();</span>
        
<span class="fc bfc" id="L1069" title="All 2 branches covered.">        for (PairInt p : points) {</span>
<span class="fc" id="L1070">            int x = p.getX();</span>
<span class="fc" id="L1071">            int y = p.getY();</span>
            
<span class="fc bfc" id="L1073" title="All 2 branches covered.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
                
<span class="fc" id="L1075">                int xx = x + dx;</span>
                
<span class="pc bpc" id="L1077" title="1 of 4 branches missed.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L1078">                    continue;</span>
                }
<span class="fc bfc" id="L1080" title="All 2 branches covered.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="fc" id="L1081">                    int yy = y + dy;</span>
<span class="pc bpc" id="L1082" title="1 of 4 branches missed.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="fc" id="L1083">                        continue;</span>
                    }
<span class="fc" id="L1085">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
<span class="fc" id="L1088">        }</span>
<span class="fc" id="L1089">    }</span>
    
    /**
     * draw the edge over the image using the given rgb colors and the size
     * of the dot beyond 1 pixel.
     * 
     * @param pointGroups
     * @param input
     * @param nExtraForDot
     */
    public static &lt;T extends Collection&lt;PairInt&gt;&gt; void addAlternatingColorCurvesToImage0(
        List&lt;T&gt; pointGroups, Image input, int nExtraForDot) {
        
<span class="nc bnc" id="L1102" title="All 4 branches missed.">        if (pointGroups == null || input == null) {</span>
<span class="nc" id="L1103">            return;</span>
        }
        
<span class="nc bnc" id="L1106" title="All 2 branches missed.">        for (int i = 0; i &lt; pointGroups.size(); ++i) {</span>
            
<span class="nc" id="L1108">            int[] clr = getNextRGB(i);</span>
            
<span class="nc" id="L1110">            addCurveToImage(pointGroups.get(i), input, nExtraForDot,</span>
                clr[0], clr[1], clr[2]);
        }
        
<span class="nc" id="L1114">    }</span>
    
    /**
     * draw the edge over the image using the given rgb colors and the size
     * of the dot beyond 1 pixel.
     * 
     * @param pointGroups
     * @param input
     * @param nExtraForDot
     */
    public static void addAlternatingColorCurvesToImage3(
        List&lt;TIntSet&gt; pointGroups, Image input, int nExtraForDot) {
        
<span class="pc bpc" id="L1127" title="2 of 4 branches missed.">        if (pointGroups == null || input == null) {</span>
<span class="nc" id="L1128">            return;</span>
        }
        
<span class="fc bfc" id="L1131" title="All 2 branches covered.">        for (int i = 0; i &lt; pointGroups.size(); ++i) {</span>
            
<span class="fc" id="L1133">            int[] clr = getNextRGB(i);</span>
            
<span class="fc" id="L1135">            addCurveToImage(pointGroups.get(i), input, nExtraForDot,</span>
                clr[0], clr[1], clr[2]);
        }
        
<span class="fc" id="L1139">    }</span>
    
    /**
     * draw lines from points at index i to index i+1 
     * in the requested color onto the input.
     * 
     * @param xVertexes
     * @param yVertexes
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void drawLinesInImage(
        int[] xVertexes, int[] yVertexes, 
        Image input, int nExtraForDot, 
        int rClr, int gClr, int bClr) {
        
<span class="nc bnc" id="L1158" title="All 6 branches missed.">        if (xVertexes == null || yVertexes == null || input == null) {</span>
<span class="nc" id="L1159">            return;</span>
        }
<span class="nc bnc" id="L1161" title="All 2 branches missed.">        if (xVertexes.length != yVertexes.length) {</span>
<span class="nc" id="L1162">            return;</span>
        }
        
<span class="nc" id="L1165">        int w = input.getWidth();</span>
<span class="nc" id="L1166">        int h = input.getHeight();</span>
        
<span class="nc bnc" id="L1168" title="All 2 branches missed.">        for (int i = 0; i &lt; (xVertexes.length - 1); i++) {</span>
            
<span class="nc" id="L1170">            int x1 = xVertexes[i];</span>
<span class="nc" id="L1171">            int y1 = yVertexes[i];</span>
            
<span class="nc" id="L1173">            int x2 = xVertexes[i + 1];</span>
<span class="nc" id="L1174">            int y2 = yVertexes[i + 1];</span>
            
<span class="nc" id="L1176">            drawLineInImage(x1, y1, x2, y2, input, </span>
                nExtraForDot, rClr, gClr, bClr);
        }
<span class="nc" id="L1179">    }</span>
    
    /**
     * draw lines from points at index i to index i+1 in the requested color
     * onto the input.
     * 
     * @param x1
     * @param y1
     * @param x2
     * @param y2
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void drawLineInImage(int x1, int y1, 
        int x2, int y2,
        Image input, int nExtraForDot, int rgbClr) {
        
<span class="nc" id="L1199">        int r = (rgbClr &gt;&gt; 16) &amp; 0xFF;</span>
<span class="nc" id="L1200">        int g = (rgbClr &gt;&gt; 8) &amp; 0xFF;</span>
<span class="nc" id="L1201">        int b = rgbClr &amp; 0xFF;</span>
        
<span class="nc" id="L1203">        drawLineInImage(x1, y1, x2, y2, input, nExtraForDot, r, g, b);</span>
<span class="nc" id="L1204">    }</span>
    
    /**
     * draw lines from points at index i to index i+1 in the requested color
     * onto the input.
     * 
     * @param x1
     * @param y1
     * @param x2
     * @param y2
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void drawLineInImage(int x1, int y1, 
        int x2, int y2,
        Image input, int nExtraForDot, int rClr, int gClr, 
        int bClr) {
        
<span class="fc" id="L1225">        int w = input.getWidth();</span>
<span class="fc" id="L1226">        int h = input.getHeight();</span>

<span class="fc" id="L1228">        Set&lt;PairInt&gt; output = new HashSet&lt;PairInt&gt;();</span>
        
<span class="fc" id="L1230">        BresenhamsLine.createLinePoints(x1, y1, x2, y2,</span>
            output);
        
<span class="fc bfc" id="L1233" title="All 2 branches covered.">        for (PairInt p : output) {</span>

<span class="fc" id="L1235">            int x = p.getX();</span>
<span class="fc" id="L1236">            int y = p.getY();</span>
            
<span class="fc bfc" id="L1238" title="All 2 branches covered.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); </span>
<span class="fc" id="L1239">                dx++) {</span>

<span class="fc" id="L1241">                int xx = x + dx;</span>

<span class="pc bpc" id="L1243" title="2 of 4 branches missed.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L1244">                    continue;</span>
                }
<span class="fc bfc" id="L1246" title="All 2 branches covered.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="fc" id="L1247">                    int yy = y + dy;</span>
<span class="pc bpc" id="L1248" title="2 of 4 branches missed.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L1249">                        continue;</span>
                    }
<span class="fc" id="L1251">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
<span class="fc" id="L1254">        }</span>
<span class="fc" id="L1255">    }</span>
    
    /**
     * draw lines from points at index i to index i+1 in the requested color
     * onto the input.
     * 
     * @param x1
     * @param y1
     * @param x2
     * @param y2
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void drawLineInImage(int x1, int y1, 
        int x2, int y2, Image input, int nExtraForDot, int gapLength,
        int rClr, int gClr, int bClr) {
        
<span class="fc" id="L1275">        int w = input.getWidth();</span>
<span class="fc" id="L1276">        int h = input.getHeight();</span>

<span class="fc" id="L1278">        Set&lt;PairInt&gt; output = new HashSet&lt;PairInt&gt;();</span>
        
<span class="fc" id="L1280">        BresenhamsLine.createLinePoints(x1, y1, x2, y2, gapLength,</span>
            output);
        
<span class="fc bfc" id="L1283" title="All 2 branches covered.">        for (PairInt p : output) {</span>

<span class="fc" id="L1285">            int x = p.getX();</span>
<span class="fc" id="L1286">            int y = p.getY();</span>
            
<span class="fc bfc" id="L1288" title="All 2 branches covered.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); </span>
<span class="fc" id="L1289">                dx++) {</span>

<span class="fc" id="L1291">                int xx = x + dx;</span>

<span class="pc bpc" id="L1293" title="2 of 4 branches missed.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L1294">                    continue;</span>
                }
<span class="fc bfc" id="L1296" title="All 2 branches covered.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="fc" id="L1297">                    int yy = y + dy;</span>
<span class="pc bpc" id="L1298" title="2 of 4 branches missed.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L1299">                        continue;</span>
                    }
<span class="fc" id="L1301">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
<span class="fc" id="L1304">        }</span>
<span class="fc" id="L1305">    }</span>
    
    /**
     * draw lines from points at index i to index i+1 in the requested color
     * onto the input.
     * 
     * @param xVertexes
     * @param yVertexes
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void addCurveToImage(int[] xVertexes, int[] yVertexes, 
        Image input, int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="nc bnc" id="L1322" title="All 6 branches missed.">        if (xVertexes == null || yVertexes == null || input == null) {</span>
<span class="nc" id="L1323">            return;</span>
        }
<span class="nc bnc" id="L1325" title="All 2 branches missed.">        if (xVertexes.length != yVertexes.length) {</span>
<span class="nc" id="L1326">            return;</span>
        }
        
<span class="nc" id="L1329">        int w = input.getWidth();</span>
<span class="nc" id="L1330">        int h = input.getHeight();</span>
        
<span class="nc bnc" id="L1332" title="All 2 branches missed.">        for (int i = 0; i &lt; xVertexes.length; i++) {</span>
            
<span class="nc" id="L1334">            int x = xVertexes[i];</span>
<span class="nc" id="L1335">            int y = yVertexes[i];</span>
            
<span class="nc bnc" id="L1337" title="All 2 branches missed.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>

<span class="nc" id="L1339">                int xx = x + dx;</span>

<span class="nc bnc" id="L1341" title="All 4 branches missed.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L1342">                    continue;</span>
                }
<span class="nc bnc" id="L1344" title="All 2 branches missed.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L1345">                    int yy = y + dy;</span>
<span class="nc bnc" id="L1346" title="All 4 branches missed.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L1347">                        continue;</span>
                    }
<span class="nc" id="L1349">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
        }
<span class="nc" id="L1353">    }</span>
    
    /**
     * draw the edge over the image using the given rgb colors and the size
     * of the dot beyond 1 pixel.
     * 
     * @param edge
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void addCurveToImage(PairFloatArray edge, Image input, 
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="nc bnc" id="L1369" title="All 4 branches missed.">        if (edge == null || input == null) {</span>
<span class="nc" id="L1370">            return;</span>
        }
        
<span class="nc" id="L1373">        int w = input.getWidth();</span>
<span class="nc" id="L1374">        int h = input.getHeight();</span>
        
<span class="nc bnc" id="L1376" title="All 2 branches missed.">        for (int i = 0; i &lt; edge.getN(); i++) {</span>
<span class="nc" id="L1377">            int x = Math.round(edge.getX(i));</span>
<span class="nc" id="L1378">            int y = Math.round(edge.getY(i));</span>
            
<span class="nc bnc" id="L1380" title="All 2 branches missed.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
                
<span class="nc" id="L1382">                int xx = x + dx;</span>
                
<span class="nc bnc" id="L1384" title="All 4 branches missed.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L1385">                    continue;</span>
                }
<span class="nc bnc" id="L1387" title="All 2 branches missed.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L1388">                    int yy = y + dy;</span>
<span class="nc bnc" id="L1389" title="All 4 branches missed.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L1390">                        continue;</span>
                    }
<span class="nc" id="L1392">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
        }
<span class="nc" id="L1396">    }</span>
    
    /**
     * draw the point over the image using the given rgb colors and the size
     * of the dot beyond 1 pixel.
     * 
     * @param x of point
     * @param y of point
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void addPointToImage(int x, int y, Image input, 
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="fc" id="L1413">        int w = input.getWidth();</span>
<span class="fc" id="L1414">        int h = input.getHeight();</span>
        
<span class="fc bfc" id="L1416" title="All 2 branches covered.">        for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>

<span class="fc" id="L1418">            int xx = x + dx;</span>

<span class="pc bpc" id="L1420" title="1 of 4 branches missed.">            if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L1421">                continue;</span>
            }
<span class="fc bfc" id="L1423" title="All 2 branches covered.">            for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="fc" id="L1424">                int yy = y + dy;</span>
<span class="fc bfc" id="L1425" title="All 4 branches covered.">                if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="fc" id="L1426">                    continue;</span>
                }
<span class="fc" id="L1428">                input.setRGB(xx, yy, rClr, gClr, bClr);</span>
            }
        }
<span class="fc" id="L1431">    }</span>
    /**
     * draw the point over the image using the given rgb colors and the size
     * of the dot beyond 1 pixel.
     * 
     * @param x of point
     * @param y of point
     * @param input
     * @param nExtraForDot
     * @param rgbClr
     */
    public static void addPointToImage(int x, int y, Image input, 
        int nExtraForDot, int rgbClr) {
        
<span class="nc" id="L1445">        int w = input.getWidth();</span>
<span class="nc" id="L1446">        int h = input.getHeight();</span>
        
<span class="nc bnc" id="L1448" title="All 2 branches missed.">        for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>

<span class="nc" id="L1450">            int xx = x + dx;</span>

<span class="nc bnc" id="L1452" title="All 4 branches missed.">            if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L1453">                continue;</span>
            }
<span class="nc bnc" id="L1455" title="All 2 branches missed.">            for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L1456">                int yy = y + dy;</span>
<span class="nc bnc" id="L1457" title="All 4 branches missed.">                if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L1458">                    continue;</span>
                }
<span class="nc" id="L1460">                input.setRGB(xx, yy, rgbClr);</span>
            }
        }
<span class="nc" id="L1463">    }</span>
    
    /**
     * draw the point over the image using the given rgb colors and the size
     * of the dot beyond 1 pixel.
     * 
     * @param x of point
     * @param y of point
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void addPointToImage(float x, float y, Image input, 
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="fc" id="L1480">        int w = input.getWidth();</span>
<span class="fc" id="L1481">        int h = input.getHeight();</span>
        
<span class="fc bfc" id="L1483" title="All 2 branches covered.">        for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>

<span class="fc" id="L1485">            int xx = Math.round(x + dx);</span>

<span class="pc bpc" id="L1487" title="2 of 4 branches missed.">            if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L1488">                continue;</span>
            }
<span class="fc bfc" id="L1490" title="All 2 branches covered.">            for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="fc" id="L1491">                int yy = Math.round(y + dy);</span>
<span class="pc bpc" id="L1492" title="2 of 4 branches missed.">                if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L1493">                    continue;</span>
                }
<span class="fc" id="L1495">                input.setRGB(xx, yy, rClr, gClr, bClr);</span>
            }
        }
<span class="fc" id="L1498">    }</span>
    
    /**
     * draw the edge over the image using the given rgb colors and the size
     * of the dot beyond 1 pixel.
     * 
     * @param edgeX x points of pair (edgeX, edgeY)
     * @param edgeY y points of pair (edgeX, edgeY)
     * @param nPointsInEdge number of points in edgeX 
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void addCurveToImage(int[] edgeX, int[] edgeY, 
        final int nPointsInEdge, Image input, int nExtraForDot, int rClr, 
        int gClr, int bClr) {
        
<span class="nc bnc" id="L1517" title="All 4 branches missed.">        if (edgeX == null || edgeY == null) {</span>
<span class="nc" id="L1518">            return;</span>
        }
<span class="nc bnc" id="L1520" title="All 2 branches missed.">        if (edgeX.length != edgeY.length) {</span>
<span class="nc" id="L1521">            throw new IllegalArgumentException(</span>
                &quot;edgeX and edgeY should be same length&quot;);
        }
        
<span class="nc" id="L1525">        int w = input.getWidth();</span>
<span class="nc" id="L1526">        int h = input.getHeight();</span>
        
<span class="nc bnc" id="L1528" title="All 2 branches missed.">        for (int i = 0; i &lt; nPointsInEdge; i++) {</span>
            
<span class="nc" id="L1530">            int x = edgeX[i];</span>
<span class="nc" id="L1531">            int y = edgeY[i];</span>
            
<span class="nc bnc" id="L1533" title="All 2 branches missed.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
                
<span class="nc" id="L1535">                int xx = x + dx;</span>
                
<span class="nc bnc" id="L1537" title="All 4 branches missed.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L1538">                    continue;</span>
                }
<span class="nc bnc" id="L1540" title="All 2 branches missed.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L1541">                    int yy = y + dy;</span>
<span class="nc bnc" id="L1542" title="All 4 branches missed.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L1543">                        continue;</span>
                    }
<span class="nc" id="L1545">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
        }
<span class="nc" id="L1549">    }</span>
    
    public static void addAlternatingColorCurvesToImage(
        PairIntArray[] curves, String fileName, boolean writeImage, 
        Image input) throws IOException {
        
<span class="nc bnc" id="L1555" title="All 4 branches missed.">        if (curves == null || input == null) {</span>
<span class="nc" id="L1556">            return;</span>
        }
<span class="nc bnc" id="L1558" title="All 2 branches missed.">        if (fileName == null) {</span>
<span class="nc" id="L1559">            throw new IllegalArgumentException(&quot;fileName cannot be null&quot;);</span>
        }
        
<span class="nc" id="L1562">        List&lt;PairIntArray&gt; c = new ArrayList&lt;PairIntArray&gt;();</span>
        
<span class="nc bnc" id="L1564" title="All 2 branches missed.">        for (PairIntArray a : curves) {</span>
<span class="nc" id="L1565">            c.add(a);</span>
        }
        
<span class="nc" id="L1568">        addAlternatingColorCurvesToImage(c, fileName, writeImage, input);</span>
<span class="nc" id="L1569">    }</span>
    
    public static void addAlternatingColorLabelsToRegion(Image img, int[] labels) {
    
<span class="fc" id="L1573">        int nPixels = img.getNPixels();</span>
        
<span class="pc bpc" id="L1575" title="1 of 2 branches missed.">        if (labels.length != nPixels) {</span>
<span class="nc" id="L1576">            throw new IllegalArgumentException(</span>
                &quot;labels.length should == img.nPixels&quot;);
        }
        
<span class="fc" id="L1580">        Map&lt;Integer, Integer&gt; labelColorMap = new HashMap&lt;Integer, Integer&gt;();</span>
        
<span class="fc" id="L1582">        int count = 0;</span>
        
<span class="fc bfc" id="L1584" title="All 2 branches covered.">        for (int i = 0; i &lt; nPixels; ++i) {</span>
            
<span class="fc" id="L1586">            int label = labels[i];</span>
            
<span class="fc" id="L1588">            Integer key = Integer.valueOf(label);            </span>
            
<span class="fc" id="L1590">            Integer clr = labelColorMap.get(key);</span>
            
<span class="fc bfc" id="L1592" title="All 2 branches covered.">            if (clr == null) {</span>
                                
<span class="fc" id="L1594">                clr = Integer.valueOf(getNextColorRGB(count));</span>
                
<span class="fc" id="L1596">                labelColorMap.put(key, clr);</span>
<span class="fc" id="L1597">                count++;</span>
            }
            
<span class="fc" id="L1600">            img.setRGB(img.getCol(i), img.getRow(i), clr);</span>
        }
<span class="fc" id="L1602">    }</span>
    
    public static void addAlternatingColorLabelsToRegion(
        Image img, TIntObjectMap&lt;TIntSet&gt; labelsMap) {
                    
<span class="nc" id="L1607">        TIntObjectIterator&lt;TIntSet&gt; iter = labelsMap.iterator();</span>
<span class="nc bnc" id="L1608" title="All 2 branches missed.">        for (int i = 0; i &lt; labelsMap.size(); ++i) {</span>

<span class="nc" id="L1610">            iter.advance();</span>
            
<span class="nc" id="L1612">            int clr = getNextColorRGB(i);</span>
            
<span class="nc" id="L1614">            TIntSet indexes = iter.value();</span>
<span class="nc" id="L1615">            TIntIterator iter2 = indexes.iterator();</span>
<span class="nc bnc" id="L1616" title="All 2 branches missed.">            while (iter2.hasNext()) {</span>
<span class="nc" id="L1617">                int pixIdx = iter2.next();</span>
<span class="nc" id="L1618">                img.setRGB(img.getCol(pixIdx), </span>
<span class="nc" id="L1619">                    img.getRow(pixIdx), clr);</span>
<span class="nc" id="L1620">            }</span>
        }
<span class="nc" id="L1622">    }</span>
    
    public static void addAlternatingColorPointsToImages(
        Map&lt;PairInt, List&lt;PairInt&gt;&gt; points, Image imgCp1, 
        Image imgCp2, int nExtraForDot) {
        
<span class="nc" id="L1628">        int w1 = imgCp1.getWidth();</span>
<span class="nc" id="L1629">        int h1 = imgCp1.getHeight();</span>
<span class="nc" id="L1630">        int w2 = imgCp2.getWidth();</span>
<span class="nc" id="L1631">        int h2 = imgCp2.getHeight();</span>
        
<span class="nc" id="L1633">        int count = 0;</span>
<span class="nc bnc" id="L1634" title="All 2 branches missed.">        for (Entry&lt;PairInt, List&lt;PairInt&gt;&gt; entry : points.entrySet()) {</span>
<span class="nc" id="L1635">            int clr = getNextColorRGB(count);</span>
<span class="nc" id="L1636">            PairInt p1 = entry.getKey();</span>
<span class="nc" id="L1637">            int x1 = p1.getX();</span>
<span class="nc" id="L1638">            int y1 = p1.getY();</span>
<span class="nc bnc" id="L1639" title="All 2 branches missed.">            for (int dx = (-1 * nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
<span class="nc" id="L1640">                int xx1 = x1 + dx;</span>
<span class="nc bnc" id="L1641" title="All 4 branches missed.">                if ((xx1 &lt; 0) || (xx1 &gt; (w1 - 1))) {</span>
<span class="nc" id="L1642">                    continue;</span>
                }
<span class="nc bnc" id="L1644" title="All 2 branches missed.">                for (int dy = (-1 * nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L1645">                    int yy1 = y1 + dy;</span>
<span class="nc bnc" id="L1646" title="All 4 branches missed.">                    if ((yy1 &lt; 0) || (yy1 &gt; (h1 - 1))) {</span>
<span class="nc" id="L1647">                        continue;</span>
                    }
<span class="nc" id="L1649">                    imgCp1.setRGB(xx1, yy1, clr);</span>
                }
            }                    
<span class="nc bnc" id="L1652" title="All 2 branches missed.">            for (PairInt p2 : entry.getValue()) {</span>
<span class="nc" id="L1653">                int x2 = p2.getX();</span>
<span class="nc" id="L1654">                int y2 = p2.getY();</span>
<span class="nc bnc" id="L1655" title="All 2 branches missed.">                for (int dx = (-1 * nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
<span class="nc" id="L1656">                    int xx2 = x2 + dx;</span>
<span class="nc bnc" id="L1657" title="All 4 branches missed.">                    if ((xx2 &lt; 0) || (xx2 &gt; (w2 - 1))) {</span>
<span class="nc" id="L1658">                        continue;</span>
                    }
<span class="nc bnc" id="L1660" title="All 2 branches missed.">                    for (int dy = (-1 * nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L1661">                        int yy2 = y2 + dy;</span>
<span class="nc bnc" id="L1662" title="All 4 branches missed.">                        if ((yy2 &lt; 0) || (yy2 &gt; (h2 - 1))) {</span>
<span class="nc" id="L1663">                            continue;</span>
                        }
<span class="nc" id="L1665">                        imgCp2.setRGB(xx2, yy2, clr);</span>
                    }
                }
<span class="nc" id="L1668">            }</span>
<span class="nc" id="L1669">            count++;</span>
<span class="nc" id="L1670">        }</span>
<span class="nc" id="L1671">    }</span>
    
    public static void addAlternatingColorPointsToImages(
        List&lt;FeatureComparisonStat&gt; stats, Image imgCp1, 
        Image imgCp2, int nExtraForDot) {
        
<span class="nc" id="L1677">        int w1 = imgCp1.getWidth();</span>
<span class="nc" id="L1678">        int h1 = imgCp1.getHeight();</span>
<span class="nc" id="L1679">        int w2 = imgCp2.getWidth();</span>
<span class="nc" id="L1680">        int h2 = imgCp2.getHeight();</span>
        
<span class="nc" id="L1682">        int count = 0;</span>
<span class="nc bnc" id="L1683" title="All 2 branches missed.">        for (FeatureComparisonStat stat : stats) {</span>
<span class="nc" id="L1684">            int clr = getNextColorRGB(count);</span>
<span class="nc" id="L1685">            PairInt p1 = stat.getImg1Point();</span>
<span class="nc" id="L1686">            PairInt p2 = stat.getImg2Point();</span>
<span class="nc" id="L1687">            int x1 = p1.getX();</span>
<span class="nc" id="L1688">            int y1 = p1.getY();</span>
<span class="nc bnc" id="L1689" title="All 2 branches missed.">            for (int dx = (-1 * nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
<span class="nc" id="L1690">                int xx1 = x1 + dx;</span>
<span class="nc bnc" id="L1691" title="All 4 branches missed.">                if ((xx1 &lt; 0) || (xx1 &gt; (w1 - 1))) {</span>
<span class="nc" id="L1692">                    continue;</span>
                }
<span class="nc bnc" id="L1694" title="All 2 branches missed.">                for (int dy = (-1 * nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L1695">                    int yy1 = y1 + dy;</span>
<span class="nc bnc" id="L1696" title="All 4 branches missed.">                    if ((yy1 &lt; 0) || (yy1 &gt; (h1 - 1))) {</span>
<span class="nc" id="L1697">                        continue;</span>
                    }
<span class="nc" id="L1699">                    imgCp1.setRGB(xx1, yy1, clr);</span>
                }
            }                    
<span class="nc" id="L1702">            int x2 = p2.getX();</span>
<span class="nc" id="L1703">            int y2 = p2.getY();</span>
<span class="nc bnc" id="L1704" title="All 2 branches missed.">            for (int dx = (-1 * nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
<span class="nc" id="L1705">                int xx2 = x2 + dx;</span>
<span class="nc bnc" id="L1706" title="All 4 branches missed.">                if ((xx2 &lt; 0) || (xx2 &gt; (w2 - 1))) {</span>
<span class="nc" id="L1707">                    continue;</span>
                }
<span class="nc bnc" id="L1709" title="All 2 branches missed.">                for (int dy = (-1 * nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L1710">                    int yy2 = y2 + dy;</span>
<span class="nc bnc" id="L1711" title="All 4 branches missed.">                    if ((yy2 &lt; 0) || (yy2 &gt; (h2 - 1))) {</span>
<span class="nc" id="L1712">                        continue;</span>
                    }
<span class="nc" id="L1714">                    imgCp2.setRGB(xx2, yy2, clr);</span>
                }
            }
<span class="nc" id="L1717">            count++;</span>
<span class="nc" id="L1718">        }</span>
<span class="nc" id="L1719">    }</span>
    
    public static void addAlternatingColorCurvesToImage(
        List&lt;PairIntArray&gt; curves, Image input, int nExtraForDot) {
        
<span class="pc bpc" id="L1724" title="2 of 4 branches missed.">        if (curves == null || input == null) {</span>
<span class="nc" id="L1725">            return;</span>
        }
        
<span class="fc" id="L1728">        addAlternatingColorCurvesToImage(</span>
<span class="fc" id="L1729">            curves.toArray(new PairIntArray[curves.size()]),</span>
            input, nExtraForDot);
<span class="fc" id="L1731">    }</span>
    
    public static void addAlternatingColorCurvesToImage(
        List&lt;PairIntArray&gt; curves, Image input, int xOffset, int yOffset,
        int nExtraForDot) {
        
<span class="nc bnc" id="L1737" title="All 4 branches missed.">        if (curves == null || input == null) {</span>
<span class="nc" id="L1738">            return;</span>
        }
        
<span class="nc bnc" id="L1741" title="All 6 branches missed.">        if (curves == null || input == null || curves.isEmpty()) {</span>
<span class="nc" id="L1742">            return;</span>
        }
                
<span class="nc" id="L1745">        int clr = 0;</span>
<span class="nc" id="L1746">        int w = input.getWidth();</span>
<span class="nc" id="L1747">        int h = input.getHeight();</span>
        
<span class="nc bnc" id="L1749" title="All 2 branches missed.">        for (int i = 0; i &lt; curves.size(); i++) {</span>
            
<span class="nc" id="L1751">            PairIntArray edge = curves.get(i);</span>
            
<span class="nc" id="L1753">            int c = getNextColorRGB(clr);</span>
            
<span class="nc bnc" id="L1755" title="All 2 branches missed.">            for (int ii = 0; ii &lt; edge.getN(); ii++) {</span>
                
<span class="nc" id="L1757">                int col = edge.getX(ii) + xOffset;</span>
<span class="nc" id="L1758">                int row = edge.getY(ii) + yOffset;</span>
                
<span class="nc bnc" id="L1760" title="All 2 branches missed.">                for (int dx = (-1 * nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
<span class="nc" id="L1761">                    int xx = col + dx;</span>
<span class="nc bnc" id="L1762" title="All 4 branches missed.">                    if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L1763">                        continue;</span>
                    }
<span class="nc bnc" id="L1765" title="All 2 branches missed.">                    for (int dy = (-1 * nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L1766">                        int yy = row + dy;</span>
<span class="nc bnc" id="L1767" title="All 4 branches missed.">                        if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L1768">                            continue;</span>
                        }
<span class="nc" id="L1770">                        input.setRGB(xx, yy, c);</span>
                    }
                }                
            }
<span class="nc" id="L1774">            clr++;</span>
        }
<span class="nc" id="L1776">    }</span>
    
    public static void addAlternatingColorCurvesToImage2(
        List&lt;PairIntArray&gt; curves, Image input, int nExtraForDot) {
        
<span class="nc bnc" id="L1781" title="All 4 branches missed.">        if (curves == null || input == null) {</span>
<span class="nc" id="L1782">            return;</span>
        }
        
<span class="nc" id="L1785">        addAlternatingColorCurvesToImage(</span>
<span class="nc" id="L1786">            curves.toArray(new PairIntArray[curves.size()]),</span>
            input, nExtraForDot);
<span class="nc" id="L1788">    }</span>
    
    public static void addAlternatingColorCurvesToImage(
        List&lt;PairIntArray&gt; curves, Image input) {
        
<span class="pc bpc" id="L1793" title="2 of 4 branches missed.">        if (curves == null || input == null) {</span>
<span class="nc" id="L1794">            return;</span>
        }
        
<span class="fc" id="L1797">        addAlternatingColorCurvesToImage(</span>
<span class="fc" id="L1798">            curves.toArray(new PairIntArray[curves.size()]),</span>
            input, 1);
<span class="fc" id="L1800">    }</span>
    
    public static int getNextColorRGB(int count) {
        
<span class="fc" id="L1804">        int[] c = getNextRGB(count);</span>
        
<span class="fc" id="L1806">        int rgb = (((c[0] &amp; 0x0ff) &lt;&lt; 16) | ((c[1] &amp; 0x0ff) &lt;&lt; 8) | </span>
            (c[2] &amp; 0x0ff));
        
<span class="fc" id="L1809">        return rgb;</span>
    }
    
    /*
    http://graphicdesign.stackexchange.com/questions/3682/where-can-i-find-a-large-palette-set-of-contrasting-colors-for-coloring-many-d
    
    */
    public static int[] getNextRGB(int count) {
        
        //http://godsnotwheregodsnot.blogspot.ru/2013/11/kmeans-color-quantization-seeding.html
<span class="fc" id="L1819">        String[] indexcolors = new String[]{</span>
            &quot;FFFF00&quot;, &quot;1CE6FF&quot;, &quot;FF34FF&quot;, &quot;FF4A46&quot;, &quot;008941&quot;, &quot;006FA6&quot;, &quot;A30059&quot;,
            &quot;FFDBE5&quot;, &quot;7A4900&quot;, &quot;0000A6&quot;, &quot;63FFAC&quot;, &quot;B79762&quot;, &quot;004D43&quot;, &quot;8FB0FF&quot;, &quot;997D87&quot;,
            &quot;5A0007&quot;, &quot;809693&quot;, &quot;FEFFE6&quot;, &quot;1B4400&quot;, &quot;4FC601&quot;, &quot;3B5DFF&quot;, &quot;4A3B53&quot;, &quot;FF2F80&quot;,
            &quot;61615A&quot;, &quot;BA0900&quot;, &quot;6B7900&quot;, &quot;00C2A0&quot;, &quot;FFAA92&quot;, &quot;FF90C9&quot;, &quot;B903AA&quot;, &quot;D16100&quot;,
            &quot;DDEFFF&quot;, &quot;000035&quot;, &quot;7B4F4B&quot;, &quot;A1C299&quot;, &quot;300018&quot;, &quot;0AA6D8&quot;, &quot;013349&quot;, &quot;00846F&quot;,
            &quot;372101&quot;, &quot;FFB500&quot;, &quot;C2FFED&quot;, &quot;A079BF&quot;, &quot;CC0744&quot;, &quot;C0B9B2&quot;, &quot;C2FF99&quot;, &quot;001E09&quot;,
            &quot;00489C&quot;, &quot;6F0062&quot;, &quot;0CBD66&quot;, &quot;EEC3FF&quot;, &quot;456D75&quot;, &quot;B77B68&quot;, &quot;7A87A1&quot;, &quot;788D66&quot;,
            &quot;885578&quot;, &quot;FAD09F&quot;, &quot;FF8A9A&quot;, &quot;D157A0&quot;, &quot;BEC459&quot;, &quot;456648&quot;, &quot;0086ED&quot;, &quot;886F4C&quot;,
            &quot;34362D&quot;, &quot;B4A8BD&quot;, &quot;00A6AA&quot;, &quot;452C2C&quot;, &quot;636375&quot;, &quot;A3C8C9&quot;, &quot;FF913F&quot;, &quot;938A81&quot;,
            &quot;575329&quot;, &quot;00FECF&quot;, &quot;B05B6F&quot;, &quot;8CD0FF&quot;, &quot;3B9700&quot;, &quot;04F757&quot;, &quot;C8A1A1&quot;, &quot;1E6E00&quot;,
            &quot;7900D7&quot;, &quot;A77500&quot;, &quot;6367A9&quot;, &quot;A05837&quot;, &quot;6B002C&quot;, &quot;772600&quot;, &quot;D790FF&quot;, &quot;9B9700&quot;,
            &quot;549E79&quot;, &quot;FFF69F&quot;, &quot;201625&quot;, &quot;72418F&quot;, &quot;BC23FF&quot;, &quot;99ADC0&quot;, &quot;3A2465&quot;, &quot;922329&quot;,
            &quot;5B4534&quot;, &quot;FDE8DC&quot;, &quot;404E55&quot;, &quot;0089A3&quot;, &quot;CB7E98&quot;, &quot;A4E804&quot;, &quot;324E72&quot;, &quot;6A3A4C&quot;,
            &quot;83AB58&quot;, &quot;001C1E&quot;, &quot;D1F7CE&quot;, &quot;004B28&quot;, &quot;C8D0F6&quot;, &quot;A3A489&quot;, &quot;806C66&quot;, &quot;222800&quot;,
            &quot;BF5650&quot;, &quot;E83000&quot;, &quot;66796D&quot;, &quot;DA007C&quot;, &quot;FF1A59&quot;, &quot;8ADBB4&quot;, &quot;1E0200&quot;, &quot;5B4E51&quot;,
            &quot;C895C5&quot;, &quot;320033&quot;, &quot;FF6832&quot;, &quot;66E1D3&quot;, &quot;CFCDAC&quot;, &quot;D0AC94&quot;, &quot;7ED379&quot;, &quot;012C58&quot;,
            &quot;7A7BFF&quot;, &quot;D68E01&quot;, &quot;353339&quot;, &quot;78AFA1&quot;, &quot;FEB2C6&quot;, &quot;75797C&quot;, &quot;837393&quot;, &quot;943A4D&quot;,
            &quot;B5F4FF&quot;, &quot;D2DCD5&quot;, &quot;9556BD&quot;, &quot;6A714A&quot;, &quot;001325&quot;, &quot;02525F&quot;, &quot;0AA3F7&quot;, &quot;E98176&quot;,
            &quot;DBD5DD&quot;, &quot;5EBCD1&quot;, &quot;3D4F44&quot;, &quot;7E6405&quot;, &quot;02684E&quot;, &quot;962B75&quot;, &quot;8D8546&quot;, &quot;9695C5&quot;,
            &quot;E773CE&quot;, &quot;D86A78&quot;, &quot;3E89BE&quot;, &quot;CA834E&quot;, &quot;518A87&quot;, &quot;5B113C&quot;, &quot;55813B&quot;, &quot;E704C4&quot;,
            &quot;00005F&quot;, &quot;A97399&quot;, &quot;4B8160&quot;, &quot;59738A&quot;, &quot;FF5DA7&quot;, &quot;F7C9BF&quot;, &quot;643127&quot;, &quot;513A01&quot;,
            &quot;6B94AA&quot;, &quot;51A058&quot;, &quot;A45B02&quot;, &quot;1D1702&quot;, &quot;E20027&quot;, &quot;E7AB63&quot;, &quot;4C6001&quot;, &quot;9C6966&quot;,
            &quot;64547B&quot;, &quot;97979E&quot;, &quot;006A66&quot;, &quot;391406&quot;, &quot;F4D749&quot;, &quot;0045D2&quot;, &quot;006C31&quot;, &quot;DDB6D0&quot;,
            &quot;7C6571&quot;, &quot;9FB2A4&quot;, &quot;00D891&quot;, &quot;15A08A&quot;, &quot;BC65E9&quot;, &quot;FFFFFE&quot;, &quot;C6DC99&quot;, &quot;203B3C&quot;,
            &quot;671190&quot;, &quot;6B3A64&quot;, &quot;F5E1FF&quot;, &quot;FFA0F2&quot;, &quot;CCAA35&quot;, &quot;374527&quot;, &quot;8BB400&quot;, &quot;797868&quot;,
            &quot;C6005A&quot;, &quot;3B000A&quot;, &quot;C86240&quot;, &quot;29607C&quot;, &quot;402334&quot;, &quot;7D5A44&quot;, &quot;CCB87C&quot;, &quot;B88183&quot;,
            &quot;AA5199&quot;, &quot;B5D6C3&quot;, &quot;A38469&quot;, &quot;9F94F0&quot;, &quot;A74571&quot;, &quot;B894A6&quot;, &quot;71BB8C&quot;, &quot;00B433&quot;,
            &quot;789EC9&quot;, &quot;6D80BA&quot;, &quot;953F00&quot;, &quot;5EFF03&quot;, &quot;E4FFFC&quot;, &quot;1BE177&quot;, &quot;BCB1E5&quot;, &quot;76912F&quot;,
            &quot;003109&quot;, &quot;0060CD&quot;, &quot;D20096&quot;, &quot;895563&quot;, &quot;29201D&quot;, &quot;5B3213&quot;, &quot;A76F42&quot;, &quot;89412E&quot;,
            &quot;1A3A2A&quot;, &quot;494B5A&quot;, &quot;A88C85&quot;, &quot;F4ABAA&quot;, &quot;A3F3AB&quot;, &quot;00C6C8&quot;, &quot;EA8B66&quot;, &quot;958A9F&quot;,
            &quot;BDC9D2&quot;, &quot;9FA064&quot;, &quot;BE4700&quot;, &quot;658188&quot;, &quot;83A485&quot;, &quot;453C23&quot;, &quot;47675D&quot;, &quot;3A3F00&quot;,
            &quot;061203&quot;, &quot;DFFB71&quot;, &quot;868E7E&quot;, &quot;98D058&quot;, &quot;6C8F7D&quot;, &quot;D7BFC2&quot;, &quot;3C3E6E&quot;, &quot;D83D66&quot;,
            &quot;2F5D9B&quot;, &quot;6C5E46&quot;, &quot;D25B88&quot;, &quot;5B656C&quot;, &quot;00B57F&quot;, &quot;545C46&quot;, &quot;866097&quot;, &quot;365D25&quot;,
            &quot;252F99&quot;, &quot;00CCFF&quot;, &quot;674E60&quot;, &quot;FC009C&quot;, &quot;92896B&quot;
        };
        
<span class="fc" id="L1856">        int n = indexcolors.length - 1;</span>
        
<span class="pc bpc" id="L1858" title="1 of 2 branches missed.">        if (count &lt; 0) {</span>
<span class="nc" id="L1859">            count = 0;</span>
        } else {
<span class="fc" id="L1861">            count = count % n;</span>
        }
    
<span class="fc" id="L1864">        String str = indexcolors[count];</span>
        
<span class="fc" id="L1866">        int rgb = Integer.parseInt(str, 16);</span>
<span class="fc" id="L1867">        int r = (rgb &gt;&gt; 16) &amp; 0xFF;</span>
<span class="fc" id="L1868">        int g = (rgb &gt;&gt; 8) &amp; 0xFF;</span>
<span class="fc" id="L1869">        int b = rgb &amp; 0xFF;</span>
                
<span class="fc" id="L1871">        return new int[]{r, g, b};</span>
    }
    
    public static void addAlternatingColorCurvesToImage(
        PairIntArray[] curves, Image input) {
        
<span class="nc bnc" id="L1877" title="All 4 branches missed.">        if (curves == null || input == null) {</span>
<span class="nc" id="L1878">            return;</span>
        }
        
<span class="nc" id="L1881">        int nExtraForDot = 1;</span>
        
<span class="nc" id="L1883">        addAlternatingColorCurvesToImage(curves, input, nExtraForDot);</span>
<span class="nc" id="L1884">    }</span>
    
    public static void addAlternatingColorCurvesToImage(
        PairIntArray[] curves, Image input, int nExtraForDot) {
        
<span class="pc bpc" id="L1889" title="2 of 4 branches missed.">        if (curves == null || input == null) {</span>
<span class="nc" id="L1890">            return;</span>
        }
                
<span class="fc" id="L1893">        int clr = 0;</span>
<span class="fc" id="L1894">        int w = input.getWidth();</span>
<span class="fc" id="L1895">        int h = input.getHeight();</span>
        
<span class="fc bfc" id="L1897" title="All 2 branches covered.">        for (int i = 0; i &lt; curves.length; i++) {</span>
            
<span class="fc" id="L1899">            PairIntArray edge = curves[i];</span>
            
<span class="fc" id="L1901">            int c = getNextColorRGB(clr);</span>
            
<span class="fc bfc" id="L1903" title="All 2 branches covered.">            for (int ii = 0; ii &lt; edge.getN(); ii++) {</span>
                
<span class="fc" id="L1905">                int col = edge.getX(ii);</span>
<span class="fc" id="L1906">                int row = edge.getY(ii);</span>
                
<span class="fc bfc" id="L1908" title="All 2 branches covered.">                for (int dx = (-1 * nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
<span class="fc" id="L1909">                    int xx = col + dx;</span>
<span class="fc bfc" id="L1910" title="All 4 branches covered.">                    if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="fc" id="L1911">                        continue;</span>
                    }
<span class="fc bfc" id="L1913" title="All 2 branches covered.">                    for (int dy = (-1 * nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="fc" id="L1914">                        int yy = row + dy;</span>
<span class="fc bfc" id="L1915" title="All 4 branches covered.">                        if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="fc" id="L1916">                            continue;</span>
                        }
<span class="fc" id="L1918">                        input.setRGB(xx, yy, c);</span>
                    }
                }                
            }
<span class="fc" id="L1922">            clr++;</span>
        }
<span class="fc" id="L1924">    }</span>
    
    public static void addAlternatingColorPointSetsToImage(
        List&lt;Set&lt;PairInt&gt;&gt; pointSets, int xOffset, int yOffset, 
        int nExtraForDot, Image input) {
        
<span class="pc bpc" id="L1930" title="2 of 4 branches missed.">        if (pointSets == null || input == null) {</span>
<span class="nc" id="L1931">            return;</span>
        }
                
<span class="fc bfc" id="L1934" title="All 2 branches covered.">        for (int i = 0; i &lt; pointSets.size(); i++) {</span>
            
<span class="fc" id="L1936">            Set&lt;PairInt&gt; points = pointSets.get(i);</span>
            
<span class="fc" id="L1938">            int[] c = getNextRGB(i);</span>
            
<span class="fc" id="L1940">            addToImage(points, 0, 0, input, nExtraForDot, c[0], c[1], c[2]);</span>
        }
<span class="fc" id="L1942">    }</span>
    
    public static void addAlternatingColorPointSetsToImage2(
        List&lt;TIntSet&gt; pointSets, int xOffset, int yOffset, 
        int nExtraForDot, Image input) {
        
<span class="pc bpc" id="L1948" title="2 of 4 branches missed.">        if (pointSets == null || input == null) {</span>
<span class="nc" id="L1949">            return;</span>
        }
                
<span class="fc bfc" id="L1952" title="All 2 branches covered.">        for (int i = 0; i &lt; pointSets.size(); i++) {</span>
            
<span class="fc" id="L1954">            TIntSet pIdxs = pointSets.get(i);</span>
            
<span class="fc" id="L1956">            int[] c = getNextRGB(i);</span>
            
<span class="fc" id="L1958">            addToImage(pIdxs, 0, 0, input, nExtraForDot, c[0], c[1], c[2]);</span>
        }
<span class="fc" id="L1960">    }</span>
    
    public static &lt;T extends Collection&lt;PairInt&gt;&gt; void addToImage(
        T points, int xOffsetToApply, int yOffsetToApply, Image input) {
        
<span class="nc bnc" id="L1965" title="All 4 branches missed.">        if (points == null || input == null) {</span>
<span class="nc" id="L1966">            return;</span>
        }
        
<span class="nc" id="L1969">        int w = input.getWidth();</span>
<span class="nc" id="L1970">        int h = input.getHeight();</span>
        
<span class="nc" id="L1972">        int c = Color.BLUE.getRGB();</span>
          
<span class="nc bnc" id="L1974" title="All 2 branches missed.">        for (PairInt p : points) {</span>

<span class="nc" id="L1976">            int col = p.getX() + xOffsetToApply;</span>
<span class="nc" id="L1977">            int row = p.getY() + yOffsetToApply;</span>

<span class="nc bnc" id="L1979" title="All 8 branches missed.">            if ((col &lt; 0) || (row &lt; 0) || (col &gt; (w - 1)) || (row &gt; (h - 1))) {</span>
<span class="nc" id="L1980">                continue;</span>
            }

<span class="nc" id="L1983">            input.setRGB(col, row, c);</span>
<span class="nc" id="L1984">        }</span>
<span class="nc" id="L1985">    }</span>
    
    public static &lt;T extends Collection&lt;PairInt&gt;&gt; void addToImage(
        T points, int xOffsetToApply, 
        int yOffsetToApply, Image input, int rClr, int gClr, int bClr) throws 
        IOException {
        
<span class="nc bnc" id="L1992" title="All 4 branches missed.">        if (points == null || input == null) {</span>
<span class="nc" id="L1993">            return;</span>
        }
        
<span class="nc" id="L1996">        int w = input.getWidth();</span>
<span class="nc" id="L1997">        int h = input.getHeight();</span>
                  
<span class="nc bnc" id="L1999" title="All 2 branches missed.">        for (PairInt p : points) {</span>

<span class="nc" id="L2001">            int col = p.getX() + xOffsetToApply;</span>
<span class="nc" id="L2002">            int row = p.getY() + yOffsetToApply;</span>
            
<span class="nc bnc" id="L2004" title="All 8 branches missed.">            if ((col &lt; 0) || (row &lt; 0) || (col &gt; (w - 1)) || (row &gt; (h - 1))) {</span>
<span class="nc" id="L2005">                continue;</span>
            }

<span class="nc" id="L2008">            input.setRGB(col, row, rClr, gClr, bClr);</span>
<span class="nc" id="L2009">        }</span>
<span class="nc" id="L2010">    }</span>
    
    public static &lt;T extends Collection&lt;PairInt&gt;&gt; void addToImage(
        T points, int xOffsetToApply, 
        int yOffsetToApply, Image input, int nExtraForDot,
        int rClr, int gClr, int bClr) {
        
<span class="pc bpc" id="L2017" title="2 of 4 branches missed.">        if (points == null || input == null) {</span>
<span class="nc" id="L2018">            return;</span>
        }
        
<span class="fc" id="L2021">        int w = input.getWidth();</span>
<span class="fc" id="L2022">        int h = input.getHeight();</span>
                  
<span class="fc bfc" id="L2024" title="All 2 branches covered.">        for (PairInt p : points) {</span>

<span class="fc" id="L2026">            int x = p.getX() + xOffsetToApply;</span>
<span class="fc" id="L2027">            int y = p.getY() + yOffsetToApply;</span>
            
<span class="fc bfc" id="L2029" title="All 2 branches covered.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); ++dx) {</span>
<span class="fc" id="L2030">                int xx = x + dx;</span>
<span class="fc bfc" id="L2031" title="All 4 branches covered.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="fc" id="L2032">                    continue;</span>
                }
<span class="fc bfc" id="L2034" title="All 2 branches covered.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="fc" id="L2035">                    int yy = y + dy;</span>
<span class="fc bfc" id="L2036" title="All 4 branches covered.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="fc" id="L2037">                        continue;</span>
                    }
<span class="fc" id="L2039">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
<span class="fc" id="L2042">        }</span>
<span class="fc" id="L2043">    }</span>

    public static void addToImage(
        TIntSet pIdxs, int xOffsetToApply, 
        int yOffsetToApply, Image input, int nExtraForDot,
        int rClr, int gClr, int bClr) {
        
<span class="pc bpc" id="L2050" title="2 of 4 branches missed.">        if (pIdxs == null || input == null) {</span>
<span class="nc" id="L2051">            return;</span>
        }
        
<span class="fc" id="L2054">        int w = input.getWidth();</span>
<span class="fc" id="L2055">        int h = input.getHeight();</span>
             
<span class="fc" id="L2057">        TIntIterator iter = pIdxs.iterator();</span>
<span class="fc bfc" id="L2058" title="All 2 branches covered.">        while (iter.hasNext()) {</span>
<span class="fc" id="L2059">            int pixIdx = iter.next();</span>
<span class="fc" id="L2060">            int y = pixIdx/w;</span>
<span class="fc" id="L2061">            int x = pixIdx - (y * w);</span>
<span class="fc" id="L2062">            x += xOffsetToApply;</span>
<span class="fc" id="L2063">            y += yOffsetToApply;</span>
            
<span class="fc bfc" id="L2065" title="All 2 branches covered.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); ++dx) {</span>
<span class="fc" id="L2066">                int xx = x + dx;</span>
<span class="pc bpc" id="L2067" title="2 of 4 branches missed.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L2068">                    continue;</span>
                }
<span class="fc bfc" id="L2070" title="All 2 branches covered.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="fc" id="L2071">                    int yy = y + dy;</span>
<span class="pc bpc" id="L2072" title="2 of 4 branches missed.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L2073">                        continue;</span>
                    }
<span class="fc" id="L2075">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
<span class="fc" id="L2078">        }</span>
<span class="fc" id="L2079">    }</span>

    public static void addAlternatingColorCurvesToImage(
        List&lt;PairIntArray&gt; curves, String fileName, boolean writeImage, 
        Image input) throws IOException {
        
<span class="nc bnc" id="L2085" title="All 4 branches missed.">        if (curves == null || input == null) {</span>
<span class="nc" id="L2086">            return;</span>
        }
<span class="nc bnc" id="L2088" title="All 2 branches missed.">        if (fileName == null) {</span>
<span class="nc" id="L2089">            throw new IllegalArgumentException(&quot;fileName cannot be null&quot;);</span>
        }
        
<span class="nc" id="L2092">        addAlternatingColorCurvesToImage(curves, input);</span>
       
<span class="nc bnc" id="L2094" title="All 2 branches missed.">        if (!writeImage) {</span>
<span class="nc" id="L2095">            return;</span>
        }
        
        try {
<span class="nc" id="L2099">            String dirPath = ResourceFinder.findDirectory(&quot;bin&quot;);</span>
<span class="nc" id="L2100">            ImageIOHelper.writeOutputImage(dirPath + &quot;/&quot; + fileName, input);</span>
<span class="nc" id="L2101">        } catch (IOException ex) {</span>
<span class="nc" id="L2102">            Logger.getLogger(ImageIOHelper.class.getName()).severe(</span>
<span class="nc" id="L2103">                &quot;ERROR: l446&quot; + ex.getMessage());</span>
<span class="nc" id="L2104">        }</span>
<span class="nc" id="L2105">    }</span>

    public static void addCurveToImage(ScaleSpaceCurve curve, Image input, 
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="nc bnc" id="L2110" title="All 4 branches missed.">        if (curve == null || input == null) {</span>
<span class="nc" id="L2111">            return;</span>
        }
        
<span class="nc" id="L2114">        int w = input.getWidth();</span>
<span class="nc" id="L2115">        int h = input.getHeight();</span>
        
<span class="nc bnc" id="L2117" title="All 2 branches missed.">        for (int i = 0; i &lt; curve.getSize(); i++) {</span>
<span class="nc" id="L2118">            int x = Math.round(curve.getX(i));</span>
<span class="nc" id="L2119">            int y = Math.round(curve.getY(i));</span>
            
<span class="nc bnc" id="L2121" title="All 2 branches missed.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); ++dx) {</span>
<span class="nc" id="L2122">                int xx = x + dx;</span>
<span class="nc bnc" id="L2123" title="All 4 branches missed.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L2124">                    continue;</span>
                }
<span class="nc bnc" id="L2126" title="All 2 branches missed.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L2127">                    int yy = y + dy;</span>
<span class="nc bnc" id="L2128" title="All 4 branches missed.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L2129">                        continue;</span>
                    }
<span class="nc" id="L2131">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
        }
<span class="nc" id="L2135">    }</span>

    public static void addToImage(float[] xP, float[] yP, 
        int xOffsetToApply, int yOffsetToApply, Image input,
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="nc bnc" id="L2141" title="All 6 branches missed.">        if (xP == null || yP == null || input == null) {</span>
<span class="nc" id="L2142">            return;</span>
        }
        
<span class="nc" id="L2145">        int w = input.getWidth();</span>
<span class="nc" id="L2146">        int h = input.getHeight();</span>
        
<span class="nc bnc" id="L2148" title="All 2 branches missed.">        for (int i = 0; i &lt; xP.length; i++) {</span>
            
<span class="nc" id="L2150">            int x = Math.round(xP[i]) + xOffsetToApply;</span>
            
<span class="nc" id="L2152">            int y = Math.round(yP[i]) + yOffsetToApply;</span>
            
<span class="nc bnc" id="L2154" title="All 2 branches missed.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); ++dx) {</span>
<span class="nc" id="L2155">                int xx = x + dx;</span>
<span class="nc bnc" id="L2156" title="All 4 branches missed.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L2157">                    continue;</span>
                }
<span class="nc bnc" id="L2159" title="All 2 branches missed.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L2160">                    int yy = y + dy;</span>
<span class="nc bnc" id="L2161" title="All 4 branches missed.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L2162">                        continue;</span>
                    }
<span class="nc" id="L2164">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
        }
<span class="nc" id="L2168">    }</span>
    
    public static void addToImage(int[] xP, int[] yP, 
        int xOffsetToApply, int yOffsetToApply, Image input,
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="nc bnc" id="L2174" title="All 6 branches missed.">        if (xP == null || yP == null || input == null) {</span>
<span class="nc" id="L2175">            return;</span>
        }
        
<span class="nc" id="L2178">        int w = input.getWidth();</span>
<span class="nc" id="L2179">        int h = input.getHeight();</span>
        
<span class="nc bnc" id="L2181" title="All 2 branches missed.">        for (int i = 0; i &lt; xP.length; i++) {</span>
            
<span class="nc" id="L2183">            int x = xP[i] + xOffsetToApply;</span>
            
<span class="nc" id="L2185">            int y = yP[i] + yOffsetToApply;</span>
            
<span class="nc bnc" id="L2187" title="All 2 branches missed.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
<span class="nc" id="L2188">                int xx = x + dx;</span>
<span class="nc bnc" id="L2189" title="All 4 branches missed.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L2190">                    continue;</span>
                }
<span class="nc bnc" id="L2192" title="All 2 branches missed.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L2193">                    int yy = y + dy;</span>
<span class="nc bnc" id="L2194" title="All 4 branches missed.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L2195">                        continue;</span>
                    }
<span class="nc" id="L2197">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
        }
<span class="nc" id="L2201">    }</span>
    
    /**
     * given data, apply a factor and offset to put it in range 0 to 255 and
     * return an image from it.
     * @param data
     * @return 
     */
    public static GreyscaleImage scaleToImgRange(double[][] data) {
        
<span class="nc" id="L2211">        double maxValue = Double.MIN_VALUE;</span>
<span class="nc" id="L2212">        double minValue = Double.MAX_VALUE;</span>
<span class="nc bnc" id="L2213" title="All 2 branches missed.">        for (int i = 0; i &lt; data.length; ++i) {</span>
<span class="nc bnc" id="L2214" title="All 2 branches missed.">            for (int j = 0; j &lt; data[i].length; ++j) {</span>
<span class="nc" id="L2215">                double v = data[i][j];</span>
<span class="nc bnc" id="L2216" title="All 2 branches missed.">                if (v &lt; minValue) {</span>
<span class="nc" id="L2217">                    minValue = v;</span>
                }
<span class="nc bnc" id="L2219" title="All 2 branches missed.">                if (v &gt; maxValue) {</span>
<span class="nc" id="L2220">                    maxValue = v;</span>
                }
            }
        }
        
        /* scale data between 0 and 255
               
        (max - min) * factor = 255 --&gt; factor = 255/(max - min)
        then subtract min, min*factor
        for example 10  20, delta=10, factor = 25.5
        (10*25.5)-(10*25.5) = 0
        (20*25.5)-(10*25.5) = 255
        */
<span class="nc" id="L2233">        double factor = 255./(maxValue - minValue);</span>
<span class="nc" id="L2234">        double zp = minValue * factor;</span>
        
<span class="nc" id="L2236">        GreyscaleImage img = new GreyscaleImage(data.length, data[0].length);</span>
        
<span class="nc bnc" id="L2238" title="All 2 branches missed.">        for (int i = 0; i &lt; data.length; ++i) {</span>
<span class="nc bnc" id="L2239" title="All 2 branches missed.">            for (int j = 0; j &lt; data[i].length; ++j) {</span>
<span class="nc" id="L2240">                double v = data[i][j];</span>
<span class="nc" id="L2241">                int vs = (int)Math.round((v * factor) - zp);</span>
<span class="nc" id="L2242">                img.setValue(i, j, vs);</span>
            }
        }
        
<span class="nc" id="L2246">        return img;</span>
    }
    
    /**
     * given data, apply a factor and offset to put it in range 0 to 255 and
     * return an image from it.
     * @param data
     * @return 
     */
    public static GreyscaleImage scaleToImgRange(int[][] data) {
        
<span class="fc" id="L2257">        int maxValue = Integer.MIN_VALUE;</span>
<span class="fc" id="L2258">        int minValue = Integer.MAX_VALUE;</span>
<span class="fc bfc" id="L2259" title="All 2 branches covered.">        for (int i = 0; i &lt; data.length; ++i) {</span>
<span class="fc bfc" id="L2260" title="All 2 branches covered.">            for (int j = 0; j &lt; data[i].length; ++j) {</span>
<span class="fc" id="L2261">                int v = data[i][j];</span>
<span class="fc bfc" id="L2262" title="All 2 branches covered.">                if (v &lt; minValue) {</span>
<span class="fc" id="L2263">                    minValue = v;</span>
                }
<span class="fc bfc" id="L2265" title="All 2 branches covered.">                if (v &gt; maxValue) {</span>
<span class="fc" id="L2266">                    maxValue = v;</span>
                }
            }
        }
        
        /* scale data between 0 and 255
               
        (max - min) * factor = 255 --&gt; factor = 255/(max - min)
        then subtract min, min*factor
        for example 10  20, delta=10, factor = 25.5
        (10*25.5)-(10*25.5) = 0
        (20*25.5)-(10*25.5) = 255
        */
<span class="fc" id="L2279">        double factor = 255./(double)(maxValue - minValue);</span>
<span class="fc" id="L2280">        double zp = minValue * factor;</span>
        
<span class="fc" id="L2282">        GreyscaleImage img = new GreyscaleImage(data.length, data[0].length);</span>
        
<span class="fc bfc" id="L2284" title="All 2 branches covered.">        for (int i = 0; i &lt; data.length; ++i) {</span>
<span class="fc bfc" id="L2285" title="All 2 branches covered.">            for (int j = 0; j &lt; data[i].length; ++j) {</span>
<span class="fc" id="L2286">                int v = data[i][j];</span>
<span class="fc" id="L2287">                int vs = (int)Math.round((v * factor) - zp);</span>
<span class="fc" id="L2288">                img.setValue(i, j, vs);</span>
            }
        }
        
<span class="fc" id="L2292">        return img;</span>
    }

    public static void addAlternatingColorContoursToImage(
        List&lt;CurvatureScaleSpaceContour&gt; contours, ImageExt img, 
        int xOffset, int yOffset, int nExtraForDot) {
        
        //StringBuilder sb = new StringBuilder();
        
<span class="nc bnc" id="L2301" title="All 2 branches missed.">        for (int i = 0; i &lt; contours.size(); i++) {</span>
            
<span class="nc" id="L2303">            CurvatureScaleSpaceContour cssC = contours.get(i);</span>
            
            /*sb.append(&quot;[&quot;).append(Integer.toString(i))
                .append(&quot;] t=&quot;)
                .append(Float.toString(cssC.getPeakScaleFreeLength()))
                .append(&quot;, s=&quot;)
                .append(Float.toString(cssC.getPeakSigma()))
                .append(&quot; &quot;);*/
            
<span class="nc" id="L2312">            int[] c = getNextRGB(i);</span>
            
<span class="nc" id="L2314">            addContoursToImage(cssC, img, xOffset, yOffset, nExtraForDot, </span>
                c[0], c[1], c[2]);
        }
        
        //Logger.getLogger(ImageIOHelper.class.getName()).info(sb.toString());
<span class="nc" id="L2319">    }</span>

    public static void addAlternatingColorCornerRegionsToImage(
        List&lt;CornerRegion&gt; regions, Image img, 
        int xOffset, int yOffset, int nExtraForDot) {
        
<span class="nc bnc" id="L2325" title="All 2 branches missed.">        for (int i = 0; i &lt; regions.size(); i++) {</span>
            
<span class="nc" id="L2327">            CornerRegion br = regions.get(i);</span>
            
<span class="nc" id="L2329">            int[] c = getNextRGB(i);</span>

<span class="nc" id="L2331">            int x = br.getX()[br.getKMaxIdx()];</span>
<span class="nc" id="L2332">            int y = br.getY()[br.getKMaxIdx()];</span>
            
<span class="nc" id="L2334">            addPointToImage(x, y, img, xOffset, yOffset, nExtraForDot, </span>
                c[0], c[1], c[2]);
        }
<span class="nc" id="L2337">    }</span>
    
    public static &lt;T extends CornerRegion&gt; void 
        addAlternatingColorCornerRegionListsToImage(
        List&lt;List&lt;T&gt;&gt; regions, Image img, int xOffset, int yOffset, 
            int nExtraForDot) {
        
<span class="nc bnc" id="L2344" title="All 2 branches missed.">        for (int i = 0; i &lt; regions.size(); i++) {</span>
            
<span class="nc" id="L2346">            List&lt;T&gt; corners = regions.get(i);</span>
            
<span class="nc" id="L2348">            int[] c = getNextRGB(i);</span>
            
<span class="nc" id="L2350">            addCornerRegionsToImage(corners, img, xOffset, yOffset, </span>
                nExtraForDot, c[0], c[1], c[2]);
        }
<span class="nc" id="L2353">    }</span>
    
    public static void addCornerRegionsToImage(Collection&lt;CornerRegion&gt; regions,
        Image img, int xOffset, int yOffset, int nExtraForDot) {

<span class="nc bnc" id="L2358" title="All 2 branches missed.">        for (CornerRegion br : regions) {</span>

<span class="nc" id="L2360">            int x = br.getX()[br.getKMaxIdx()];</span>
<span class="nc" id="L2361">            int y = br.getY()[br.getKMaxIdx()];</span>

<span class="nc" id="L2363">            addPointToImage(x, y, img, xOffset, yOffset, nExtraForDot, 255, 0, 0);</span>
<span class="nc" id="L2364">        }</span>
<span class="nc" id="L2365">    }</span>
    
    public static &lt;T extends CornerRegion&gt; void addCornerRegionsToImage(
        Collection&lt;T&gt; regions, Image img, int xOffset, int yOffset, 
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="nc bnc" id="L2371" title="All 2 branches missed.">        for (T br : regions ) {</span>
            
<span class="nc" id="L2373">            int x = br.getX()[br.getKMaxIdx()];</span>
<span class="nc" id="L2374">            int y = br.getY()[br.getKMaxIdx()];</span>
            
<span class="nc" id="L2376">            addPointToImage(x, y, img, xOffset, yOffset, nExtraForDot, </span>
                rClr, gClr, bClr);
<span class="nc" id="L2378">        }</span>
<span class="nc" id="L2379">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>