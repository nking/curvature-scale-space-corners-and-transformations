<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ImageIOHelper.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Jacoco Report</a> &gt; <a href="index.source.html" class="el_package">algorithms.imageProcessing</a> &gt; <span class="el_source">ImageIOHelper.java</span></div><h1>ImageIOHelper.java</h1><pre class="source lang-java linenums">package algorithms.imageProcessing;

import algorithms.imageProcessing.features.CornerRegion;
import algorithms.imageProcessing.features.FeatureComparisonStat;
import algorithms.imageProcessing.scaleSpace.CurvatureScaleSpaceContour;
import algorithms.imageProcessing.scaleSpace.CurvatureScaleSpaceImagePoint;
import algorithms.imageProcessing.scaleSpace.ScaleSpaceCurve;
import algorithms.util.PairFloatArray;
import algorithms.util.PairInt;
import algorithms.util.PairIntArray;
import algorithms.util.ResourceFinder;
import algorithms.misc.MiscMath;
import gnu.trove.TIntCollection;
import gnu.trove.iterator.TIntIterator;
import gnu.trove.iterator.TIntObjectIterator;
import gnu.trove.map.TIntObjectMap;
import gnu.trove.set.TIntSet;
import java.awt.Color;
import java.awt.color.ColorSpace;
import java.awt.image.BufferedImage;
import java.awt.image.ColorConvertOp;
import java.awt.image.ColorModel;
import java.awt.image.Raster;
import java.awt.image.WritableRaster;
import java.io.File;
import java.io.IOException;
import java.nio.file.Path;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collection;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.Map.Entry;
import java.util.Set;
import java.util.logging.Logger;
import javax.imageio.IIOImage;
import javax.imageio.ImageIO;
import javax.imageio.ImageReadParam;
import javax.imageio.ImageReader;
import javax.imageio.metadata.IIOMetadata;
import javax.imageio.stream.FileImageInputStream;
import javax.imageio.stream.ImageInputStream;
import javax.swing.ImageIcon;

/**
 *
 * @author nichole
 */
<span class="pc bpc" id="L52" title="1 of 2 branches missed.">public class ImageIOHelper {</span>
    
    public static Image readImage(String filePath) throws IOException {
     
<span class="pc bpc" id="L56" title="1 of 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L57">            throw new IllegalStateException(&quot;filePath cannot be null&quot;);</span>
        }
                
        try {
<span class="fc" id="L61">            File file = new File(filePath);</span>
<span class="pc bpc" id="L62" title="1 of 2 branches missed.">            if (!file.exists()) {</span>
<span class="nc" id="L63">                throw new IllegalStateException(filePath + &quot; does not exist&quot;);</span>
            }
            
<span class="fc" id="L66">            String lstPth = null;</span>
<span class="fc" id="L67">            Iterator&lt;Path&gt; iter0 = file.toPath().iterator();</span>
<span class="fc bfc" id="L68" title="All 2 branches covered.">            while (iter0.hasNext()) {</span>
<span class="fc" id="L69">                lstPth = iter0.next().toString();</span>
            }
            
<span class="pc bpc" id="L72" title="1 of 4 branches missed.">            if (lstPth.endsWith(&quot;jpg&quot;) || lstPth.endsWith(&quot;jpeg&quot;) </span>
<span class="pc bpc" id="L73" title="2 of 4 branches missed.">                || lstPth.endsWith(&quot;jPG&quot;) || lstPth.endsWith(&quot;JPEG&quot;)) {</span>
<span class="fc" id="L74">                return readJPEGImage(filePath);</span>
            }
            
            BufferedImage img;
<span class="pc bpc" id="L78" title="1 of 4 branches missed.">            if (filePath.endsWith(&quot;png&quot;) || filePath.endsWith(&quot;PNG&quot;)) {</span>
<span class="fc" id="L79">                ImageIcon imageIcon = new ImageIcon(filePath);</span>
<span class="fc" id="L80">                java.awt.Image tmpImage = imageIcon.getImage();</span>

<span class="fc" id="L82">                img = new BufferedImage(</span>
<span class="fc" id="L83">                    imageIcon.getIconWidth(), imageIcon.getIconHeight(), BufferedImage.TYPE_INT_ARGB);</span>
<span class="fc" id="L84">                img.getGraphics().drawImage(tmpImage, 0, 0, null);</span>
<span class="fc" id="L85">                tmpImage.flush();</span>
<span class="fc" id="L86">            } else {</span>
<span class="fc" id="L87">                img = ImageIO.read(file);</span>
            }
            
            //System.out.println(&quot;imageType=&quot; + img.getType());
            
<span class="fc" id="L92">            int h = img.getHeight();</span>
<span class="fc" id="L93">            int w = img.getWidth();</span>
            
<span class="fc" id="L95">            Image image = new Image(w, h);</span>
            
<span class="fc" id="L97">            convertImage(img, image);</span>
            
<span class="fc" id="L99">            return image;</span>
            
<span class="nc" id="L101">        } catch (IOException e) {</span>
        }
        
<span class="nc" id="L104">        return null;</span>
    }
    
    public static Image readJPEGImage(String filePath) throws IOException {
     
<span class="pc bpc" id="L109" title="1 of 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L110">            throw new IllegalStateException(&quot;filePath cannot be null&quot;);</span>
        }
                
<span class="fc" id="L113">        File file = null;</span>
        
<span class="fc" id="L115">        FileImageInputStream in = null;</span>
        
        try {
<span class="fc" id="L118">            file = new File(filePath);</span>
<span class="pc bpc" id="L119" title="1 of 2 branches missed.">            if (!file.exists()) {</span>
<span class="nc" id="L120">                throw new IllegalStateException(filePath + &quot; does not exist&quot;);</span>
            }
            
<span class="fc" id="L123">            String lstPth = null;</span>
<span class="fc" id="L124">            Iterator&lt;Path&gt; iter0 = file.toPath().iterator();</span>
<span class="fc bfc" id="L125" title="All 2 branches covered.">            while (iter0.hasNext()) {</span>
<span class="fc" id="L126">                lstPth = iter0.next().toString();</span>
            }
            
<span class="pc bpc" id="L129" title="5 of 6 branches missed.">            assert(lstPth.endsWith(&quot;jpg&quot;) || lstPth.endsWith(&quot;jpeg&quot;) </span>
<span class="nc bnc" id="L130" title="All 4 branches missed.">                || lstPth.endsWith(&quot;jPG&quot;) || lstPth.endsWith(&quot;JPEG&quot;));</span>
            
<span class="fc" id="L132">            in = new FileImageInputStream(file);</span>
            
<span class="fc" id="L134">            Iterator&lt;ImageReader&gt; iter = </span>
<span class="fc" id="L135">                ImageIO.getImageReadersByMIMEType(&quot;image/jpeg&quot;);</span>
                    
<span class="fc" id="L137">            Image output = null;</span>
            
<span class="pc bpc" id="L139" title="1 of 2 branches missed.">            while (iter.hasNext()) {</span>
                
<span class="fc" id="L141">                ImageReader rdr = iter.next();</span>
<span class="fc" id="L142">                System.out.println(&quot;jpegreader instance &quot; + </span>
<span class="fc" id="L143">                    rdr.getClass().getName());</span>
                
<span class="fc" id="L145">                rdr.setInput(in);</span>
                
<span class="fc" id="L147">                ImageReadParam rdrParam = rdr.getDefaultReadParam();</span>
               
<span class="fc" id="L149">                int nImages = rdr.getNumImages(true);</span>
                
<span class="fc" id="L151">                System.out.println(&quot;nJPEG bands=&quot; + nImages);</span>
                
<span class="pc bpc" id="L153" title="3 of 4 branches missed.">                assert(nImages &gt;= 1);</span>
                                
<span class="fc" id="L155">                int w = rdr.getWidth(0);</span>
<span class="fc" id="L156">                int h = rdr.getHeight(0);</span>
                                
<span class="fc" id="L158">                output = new Image(w, h);</span>
                
<span class="fc" id="L160">                BufferedImage im = rdr.read(0, rdrParam);</span>
                
<span class="fc" id="L162">                int[] col = new int[w];</span>
<span class="fc" id="L163">                int offset = 0;</span>
<span class="fc bfc" id="L164" title="All 2 branches covered.">                for (int y = 0; y &lt; h; ++y) {</span>
<span class="fc" id="L165">                    im.getRGB(0, y, w, 1, col, offset, 1);</span>
<span class="fc bfc" id="L166" title="All 2 branches covered.">                    for (int x = 0; x &lt; w; ++x) {</span>
<span class="fc" id="L167">                        int rgb = col[x];</span>
                        
<span class="fc" id="L169">                        int r = (rgb &gt;&gt; 16) &amp; 0xFF;</span>
<span class="fc" id="L170">                        int g = (rgb &gt;&gt; 8) &amp; 0xFF;</span>
<span class="fc" id="L171">                        int b = rgb &amp; 0xFF;</span>

<span class="fc" id="L173">                        output.setRGB(x, y, r, g, b);</span>
                    }
                }
               
<span class="fc" id="L177">                return output;</span>
            }
          
<span class="nc" id="L180">            return output;</span>
            
<span class="nc" id="L182">        } catch (IOException e) {</span>
      
<span class="nc" id="L184">            System.err.println(e.getMessage());</span>
            
<span class="nc bnc" id="L186" title="All 2 branches missed.">            if (in != null) {</span>
<span class="nc" id="L187">                in.close();</span>
            }
        }

<span class="nc" id="L191">        return null;        </span>
    }
    
    public static GreyscaleImage readImageAsGreyscaleFullRange(String filePath) 
        throws IOException {
     
<span class="pc bpc" id="L197" title="1 of 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L198">            throw new IllegalStateException(&quot;filePath cannot be null&quot;);</span>
        }
                
        try {
<span class="fc" id="L202">            File file = new File(filePath);</span>
<span class="pc bpc" id="L203" title="1 of 2 branches missed.">            if (!file.exists()) {</span>
<span class="nc" id="L204">                throw new IllegalStateException(filePath + &quot; does not exist&quot;);</span>
            }
            
            BufferedImage img;
<span class="pc bpc" id="L208" title="1 of 4 branches missed.">            if (filePath.endsWith(&quot;png&quot;) || filePath.endsWith(&quot;PNG&quot;)) {</span>
<span class="fc" id="L209">                ImageIcon imageIcon = new ImageIcon(filePath);</span>
<span class="fc" id="L210">                java.awt.Image tmpImage = imageIcon.getImage();</span>

<span class="fc" id="L212">                img = new BufferedImage(</span>
<span class="fc" id="L213">                    imageIcon.getIconWidth(), imageIcon.getIconHeight(), BufferedImage.TYPE_INT_ARGB);</span>
<span class="fc" id="L214">                img.getGraphics().drawImage(tmpImage, 0, 0, null);</span>
<span class="fc" id="L215">                tmpImage.flush();</span>
<span class="fc" id="L216">            } else {</span>
<span class="fc" id="L217">                img = ImageIO.read(file);</span>
            }
            
            //System.out.println(&quot;imageType=&quot; + img.getType());
            
<span class="fc" id="L222">            int h = img.getHeight();</span>
<span class="fc" id="L223">            int w = img.getWidth();</span>
            
<span class="fc" id="L225">            ColorSpace cs = ColorSpace.getInstance(ColorSpace.CS_GRAY);  </span>
<span class="fc" id="L226">            ColorConvertOp op = new ColorConvertOp(cs, null);</span>
            try {
<span class="fc" id="L228">                BufferedImage image2 = op.filter(img, null);</span>
<span class="fc" id="L229">                img = image2;</span>
<span class="nc" id="L230">            } catch (NullPointerException e) {</span>
                // if type is custom, the source color space destination is not defined.
<span class="fc" id="L232">            } </span>
            
<span class="fc" id="L234">            GreyscaleImage image = new GreyscaleImage(w, h, </span>
                GreyscaleImage.Type.Bits32FullRangeInt);
                        
<span class="fc bfc" id="L237" title="All 2 branches covered.">            for (int i = 0; i &lt; w; i++) {</span>
<span class="fc bfc" id="L238" title="All 2 branches covered.">                for (int j = 0; j &lt; h; j++) {</span>
                    
<span class="fc" id="L240">                    int rgb = img.getRGB(i, j);</span>
                                        
<span class="fc" id="L242">                    int g = (rgb &gt;&gt; 8) &amp; 0xFF;</span>
                    
<span class="fc" id="L244">                    image.setValue(i, j, g);</span>
                }
            }
                        
<span class="fc" id="L248">            return image;</span>
            
<span class="nc" id="L250">        } catch (IOException e) {</span>
        }
        
<span class="nc" id="L253">        return null;</span>
    }
   
    public static ImageExt readImageExt(String filePath) throws IOException {
     
<span class="pc bpc" id="L258" title="1 of 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L259">            throw new IllegalStateException(&quot;filePath cannot be null&quot;);</span>
        }
            
        try {
<span class="fc" id="L263">            File file = new File(filePath);</span>
<span class="pc bpc" id="L264" title="1 of 2 branches missed.">            if (!file.exists()) {</span>
<span class="nc" id="L265">                throw new IllegalStateException(filePath + &quot; does not exist&quot;);</span>
            }
            
            BufferedImage img;
<span class="pc bpc" id="L269" title="1 of 4 branches missed.">            if (filePath.endsWith(&quot;png&quot;) || filePath.endsWith(&quot;PNG&quot;)) {</span>
<span class="fc" id="L270">                ImageIcon imageIcon = new ImageIcon(filePath);</span>
<span class="fc" id="L271">                java.awt.Image tmpImage = imageIcon.getImage();</span>

<span class="fc" id="L273">                img = new BufferedImage(</span>
<span class="fc" id="L274">                    imageIcon.getIconWidth(), imageIcon.getIconHeight(), BufferedImage.TYPE_INT_ARGB);</span>
<span class="fc" id="L275">                img.getGraphics().drawImage(tmpImage, 0, 0, null);</span>
<span class="fc" id="L276">                tmpImage.flush();</span>
<span class="fc" id="L277">            } else {</span>
<span class="fc" id="L278">                img = ImageIO.read(file);</span>
            }
            
            //System.out.println(&quot;imageType=&quot; + img.getType());
            
<span class="fc" id="L283">            int h = img.getHeight();</span>
<span class="fc" id="L284">            int w = img.getWidth();</span>
            
<span class="fc" id="L286">            ImageExt image = new ImageExt(w, h);</span>
            
<span class="fc" id="L288">            convertImage(img, image);</span>
            
<span class="fc" id="L290">            return image;</span>
            
<span class="nc" id="L292">        } catch (IOException e) {</span>
        }
        
<span class="nc" id="L295">        return null;</span>
    }
    
    private static void convertImage(BufferedImage fromImage, Image toImage) 
        throws IOException {
     
<span class="pc bpc" id="L301" title="1 of 2 branches missed.">        if (fromImage == null) {</span>
<span class="nc" id="L302">            return;</span>
        }
               
<span class="fc" id="L305">        int h = fromImage.getHeight();</span>
<span class="fc" id="L306">        int w = fromImage.getWidth();</span>

<span class="fc bfc" id="L308" title="All 2 branches covered.">        for (int i = 0; i &lt; w; i++) {</span>
<span class="fc bfc" id="L309" title="All 2 branches covered.">            for (int j = 0; j &lt; h; j++) {</span>

                //TYPE_INT_RGB) and default sRGB colorspace
<span class="fc" id="L312">                int rgb = fromImage.getRGB(i, j);</span>

<span class="fc" id="L314">                int r = (rgb &gt;&gt; 16) &amp; 0xFF;</span>
<span class="fc" id="L315">                int g = (rgb &gt;&gt; 8) &amp; 0xFF;</span>
<span class="fc" id="L316">                int b = rgb &amp; 0xFF;</span>

<span class="fc" id="L318">                toImage.setRGB(i, j, r, g, b);</span>
            }
        }
<span class="fc" id="L321">    }</span>
    
    public static ImageExt convertImage(GreyscaleImage fromImage) {
     
<span class="nc bnc" id="L325" title="All 2 branches missed.">        if (fromImage == null) {</span>
<span class="nc" id="L326">            return null;</span>
        }
        
<span class="nc" id="L329">        int h = fromImage.getHeight();</span>
<span class="nc" id="L330">        int w = fromImage.getWidth();</span>

<span class="nc" id="L332">        ImageExt toImage = new ImageExt(w, h);</span>
                
<span class="nc bnc" id="L334" title="All 2 branches missed.">        for (int i = 0; i &lt; w; i++) {</span>
<span class="nc bnc" id="L335" title="All 2 branches missed.">            for (int j = 0; j &lt; h; j++) {</span>
                
<span class="nc" id="L337">                int v = fromImage.getValue(i, j);</span>

<span class="nc" id="L339">                toImage.setRGB(i, j, v, v, v);</span>
            }
        }
        
<span class="nc" id="L343">        return toImage;</span>
    }
    
    /**
     * 
     * @param filePath
     * @return
     * @throws Exception 
     */
    public static GreyscaleImage readImageAsGrayScaleG(String filePath) 
        throws IOException {
     
<span class="pc bpc" id="L355" title="1 of 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L356">            throw new IllegalStateException(&quot;filePath cannot be null&quot;);</span>
        }
                
        try {
<span class="fc" id="L360">            File file = new File(filePath);</span>
<span class="pc bpc" id="L361" title="1 of 2 branches missed.">            if (!file.exists()) {</span>
<span class="nc" id="L362">                throw new IllegalStateException(filePath + &quot; does not exist&quot;);</span>
            }
            
            BufferedImage img;
<span class="pc bpc" id="L366" title="1 of 4 branches missed.">            if (filePath.endsWith(&quot;png&quot;) || filePath.endsWith(&quot;PNG&quot;)) {</span>
<span class="fc" id="L367">                ImageIcon imageIcon = new ImageIcon(filePath);</span>
<span class="fc" id="L368">                java.awt.Image tmpImage = imageIcon.getImage();</span>

<span class="fc" id="L370">                img = new BufferedImage(</span>
<span class="fc" id="L371">                    imageIcon.getIconWidth(), imageIcon.getIconHeight(), BufferedImage.TYPE_INT_ARGB);</span>
<span class="fc" id="L372">                img.getGraphics().drawImage(tmpImage, 0, 0, null);</span>
<span class="fc" id="L373">                tmpImage.flush();</span>
<span class="fc" id="L374">            } else {</span>
<span class="fc" id="L375">                img = ImageIO.read(file);</span>
            }
            
<span class="fc" id="L378">            ColorSpace cs = ColorSpace.getInstance(ColorSpace.CS_GRAY);  </span>
<span class="fc" id="L379">            ColorConvertOp op = new ColorConvertOp(cs, null);</span>
            try {
<span class="fc" id="L381">                BufferedImage image2 = op.filter(img, null);</span>
<span class="fc" id="L382">                img = image2;</span>
<span class="nc" id="L383">            } catch (NullPointerException e) {</span>
                // if type is custom, the source color space destination is not defined.
<span class="fc" id="L385">            }       </span>
<span class="fc" id="L386">            int h = img.getHeight();</span>
<span class="fc" id="L387">            int w = img.getWidth();</span>
            
<span class="fc" id="L389">            GreyscaleImage image = new GreyscaleImage(w, h);</span>
<span class="fc bfc" id="L390" title="All 2 branches covered.">            for (int i = 0; i &lt; w; i++) {</span>
<span class="fc bfc" id="L391" title="All 2 branches covered.">                for (int j = 0; j &lt; h; j++) {</span>
                    
<span class="fc" id="L393">                    int rgb = img.getRGB(i, j);</span>
                                        
<span class="fc" id="L395">                    int g = (rgb &gt;&gt; 8) &amp; 0xFF;</span>
                    
<span class="fc" id="L397">                    image.setValue(i, j, g);</span>
                }
            }
            
<span class="fc" id="L401">            return image;</span>
            
<span class="nc" id="L403">        } catch (IOException e) {</span>
        }
        
<span class="nc" id="L406">        return null;</span>
    }
    
    /**
     * read the Red channel of the image at filePath into a single channel
     * GreyscaleImage image.
     * 
     * @param filePath
     * @return
     * @throws Exception 
     */
    public static GreyscaleImage readImageAsGrayScaleR(String filePath) 
        throws IOException {
     
<span class="nc bnc" id="L420" title="All 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L421">            throw new IllegalStateException(&quot;filePath cannot be null&quot;);</span>
        }
                
        try {
<span class="nc" id="L425">            File file = new File(filePath);</span>
<span class="nc bnc" id="L426" title="All 2 branches missed.">            if (!file.exists()) {</span>
<span class="nc" id="L427">                throw new IllegalStateException(filePath + &quot; does not exist&quot;);</span>
            }
            
            BufferedImage img;
<span class="nc bnc" id="L431" title="All 4 branches missed.">            if (filePath.endsWith(&quot;png&quot;) || filePath.endsWith(&quot;PNG&quot;)) {</span>
<span class="nc" id="L432">                ImageIcon imageIcon = new ImageIcon(filePath);</span>
<span class="nc" id="L433">                java.awt.Image tmpImage = imageIcon.getImage();</span>

<span class="nc" id="L435">                img = new BufferedImage(</span>
<span class="nc" id="L436">                    imageIcon.getIconWidth(), imageIcon.getIconHeight(), BufferedImage.TYPE_INT_ARGB);</span>
<span class="nc" id="L437">                img.getGraphics().drawImage(tmpImage, 0, 0, null);</span>
<span class="nc" id="L438">                tmpImage.flush();</span>
<span class="nc" id="L439">            } else {</span>
<span class="nc" id="L440">                img = ImageIO.read(file);</span>
            }
                       
<span class="nc" id="L443">            ColorSpace cs = ColorSpace.getInstance(ColorSpace.CS_GRAY);  </span>
<span class="nc" id="L444">            ColorConvertOp op = new ColorConvertOp(cs, null);</span>
            try {
<span class="nc" id="L446">                BufferedImage image2 = op.filter(img, null);</span>
<span class="nc" id="L447">                img = image2;</span>
<span class="nc" id="L448">            } catch (NullPointerException e) {</span>
                // if type is custom, the source color space destination is not defined.
<span class="nc" id="L450">            }       </span>
<span class="nc" id="L451">            int h = img.getHeight();</span>
<span class="nc" id="L452">            int w = img.getWidth();</span>
            
<span class="nc" id="L454">            GreyscaleImage image = new GreyscaleImage(w, h);</span>
<span class="nc bnc" id="L455" title="All 2 branches missed.">            for (int i = 0; i &lt; w; i++) {</span>
<span class="nc bnc" id="L456" title="All 2 branches missed.">                for (int j = 0; j &lt; h; j++) {</span>
                    
<span class="nc" id="L458">                    int rgb = img.getRGB(i, j);</span>
                                        
<span class="nc" id="L460">                    int r = (rgb &gt;&gt; 16) &amp; 0xFF;</span>
                    
<span class="nc" id="L462">                    image.setValue(i, j, r);</span>
                }
            }
            
<span class="nc" id="L466">            return image;</span>
            
<span class="nc" id="L468">        } catch (IOException e) {</span>
        }
        
<span class="nc" id="L471">        return null;</span>
    }
    
    /**
     * read the Blue channel of the image at filePath into a single channel
     * GreyscaleImage image.
     * 
     * @param filePath
     * @return
     * @throws Exception 
     */
    public static GreyscaleImage readImageAsGrayScaleB(String filePath) 
        throws IOException {
     
<span class="nc bnc" id="L485" title="All 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L486">            throw new IllegalStateException(&quot;filePath cannot be null&quot;);</span>
        }
                
        try {
<span class="nc" id="L490">            File file = new File(filePath);</span>
<span class="nc bnc" id="L491" title="All 2 branches missed.">            if (!file.exists()) {</span>
<span class="nc" id="L492">                throw new IllegalStateException(filePath + &quot; does not exist&quot;);</span>
            }
            
            BufferedImage img;
<span class="nc bnc" id="L496" title="All 4 branches missed.">            if (filePath.endsWith(&quot;png&quot;) || filePath.endsWith(&quot;PNG&quot;)) {</span>
<span class="nc" id="L497">                ImageIcon imageIcon = new ImageIcon(filePath);</span>
<span class="nc" id="L498">                java.awt.Image tmpImage = imageIcon.getImage();</span>

<span class="nc" id="L500">                img = new BufferedImage(</span>
<span class="nc" id="L501">                    imageIcon.getIconWidth(), imageIcon.getIconHeight(), BufferedImage.TYPE_INT_ARGB);</span>
<span class="nc" id="L502">                img.getGraphics().drawImage(tmpImage, 0, 0, null);</span>
<span class="nc" id="L503">                tmpImage.flush();</span>
<span class="nc" id="L504">            } else {</span>
<span class="nc" id="L505">                img = ImageIO.read(file);</span>
            }
                       
<span class="nc" id="L508">            ColorSpace cs = ColorSpace.getInstance(ColorSpace.CS_GRAY);  </span>
<span class="nc" id="L509">            ColorConvertOp op = new ColorConvertOp(cs, null);</span>
            try {
<span class="nc" id="L511">                BufferedImage image2 = op.filter(img, null);</span>
<span class="nc" id="L512">                img = image2;</span>
<span class="nc" id="L513">            } catch (NullPointerException e) {</span>
                // if type is custom, the source color space destination is not defined.
<span class="nc" id="L515">            }       </span>
<span class="nc" id="L516">            int h = img.getHeight();</span>
<span class="nc" id="L517">            int w = img.getWidth();</span>
            
<span class="nc" id="L519">            GreyscaleImage image = new GreyscaleImage(w, h);</span>
<span class="nc bnc" id="L520" title="All 2 branches missed.">            for (int i = 0; i &lt; w; i++) {</span>
<span class="nc bnc" id="L521" title="All 2 branches missed.">                for (int j = 0; j &lt; h; j++) {</span>
                    
<span class="nc" id="L523">                    int rgb = img.getRGB(i, j);</span>
                                        
<span class="nc" id="L525">                    int b = rgb &amp; 0xFF;</span>
                    
<span class="nc" id="L527">                    image.setValue(i, j, b);</span>
                }
            }
            
<span class="nc" id="L531">            return image;</span>
            
<span class="nc" id="L533">        } catch (IOException e) {</span>
<span class="nc" id="L534">            Logger.getLogger(ImageIOHelper.class.getName()).severe(e.getMessage());</span>
        }
        
<span class="nc" id="L537">        return null;</span>
    }
    
    /**
     * read image at filePath into a greyscale image.
     * 
     * @param filePath
     * @return
     * @throws IOException 
     */
    public static Image readImageAsGrayScale(String filePath) 
        throws IOException {
     
<span class="pc bpc" id="L550" title="1 of 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L551">            throw new IllegalStateException(&quot;filePath cannot be null&quot;);</span>
        }
                
        try {
<span class="fc" id="L555">            File file = new File(filePath);</span>
<span class="pc bpc" id="L556" title="1 of 2 branches missed.">            if (!file.exists()) {</span>
<span class="nc" id="L557">                throw new IllegalStateException(filePath + &quot; does not exist&quot;);</span>
            }
            
            BufferedImage img;
<span class="pc bpc" id="L561" title="1 of 4 branches missed.">            if (filePath.endsWith(&quot;png&quot;) || filePath.endsWith(&quot;PNG&quot;)) {</span>
<span class="fc" id="L562">                ImageIcon imageIcon = new ImageIcon(filePath);</span>
<span class="fc" id="L563">                java.awt.Image tmpImage = imageIcon.getImage();</span>

<span class="fc" id="L565">                img = new BufferedImage(</span>
<span class="fc" id="L566">                    imageIcon.getIconWidth(), imageIcon.getIconHeight(), BufferedImage.TYPE_INT_ARGB);</span>
<span class="fc" id="L567">                img.getGraphics().drawImage(tmpImage, 0, 0, null);</span>
<span class="fc" id="L568">                tmpImage.flush();</span>
<span class="fc" id="L569">            } else {</span>
<span class="fc" id="L570">                img = ImageIO.read(file);</span>
            }

            //ImageDisplayer.displayDisposableImage(&quot;buffered&quot;, img);

<span class="fc" id="L575">            ColorSpace cs = ColorSpace.getInstance(ColorSpace.CS_GRAY);  </span>
<span class="fc" id="L576">            ColorConvertOp op = new ColorConvertOp(cs, null);</span>
            try {
<span class="fc" id="L578">                BufferedImage image2 = op.filter(img, null);</span>
<span class="fc" id="L579">                img = image2;</span>
 
                //ImageDisplayer.displayDisposableImage(&quot;buffered2&quot;, img);
 
<span class="nc" id="L583">            } catch (NullPointerException e) {</span>
                // if type is custom, the source color space destination is not defined.
<span class="fc" id="L585">            }       </span>
<span class="fc" id="L586">            int h = img.getHeight();</span>
<span class="fc" id="L587">            int w = img.getWidth();</span>
            
<span class="fc" id="L589">            Image image = new Image(w, h);</span>
<span class="fc bfc" id="L590" title="All 2 branches covered.">            for (int i = 0; i &lt; w; i++) {</span>
<span class="fc bfc" id="L591" title="All 2 branches covered.">                for (int j = 0; j &lt; h; j++) {</span>
                    
<span class="fc" id="L593">                    int rgb = img.getRGB(i, j);</span>
                    
<span class="fc" id="L595">                    int r = (rgb &gt;&gt; 16) &amp; 0xFF;</span>
<span class="fc" id="L596">                    int g = (rgb &gt;&gt; 8) &amp; 0xFF;</span>
<span class="fc" id="L597">                    int b = rgb &amp; 0xFF;         </span>
                    
<span class="fc" id="L599">                    image.setRGB(i, j, r, g, b);</span>
                }
            }
       
            //ImageDisplayer.displayImageGrey(&quot;image&quot;, image);
       
<span class="fc" id="L605">            return image;</span>
            
<span class="nc" id="L607">        } catch (IOException e) {</span>
        }
        
<span class="nc" id="L610">        return null;</span>
    }
    
    /**
     * read image at filePath into a greyscale image with assumptions that pixel
     * value '0' is '0' and anything else gets stored in output as a '1'.
     * 
     * @param filePath
     * @return
     * @throws Exception 
     */
    public static GreyscaleImage readImageAsBinary(String filePath) 
        throws IOException {
     
<span class="pc bpc" id="L624" title="1 of 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L625">            throw new IllegalStateException(&quot;filePath cannot be null&quot;);</span>
        }
                
        try {
<span class="fc" id="L629">            File file = new File(filePath);</span>
<span class="pc bpc" id="L630" title="1 of 2 branches missed.">            if (!file.exists()) {</span>
<span class="nc" id="L631">                throw new IllegalStateException(filePath + &quot; does not exist&quot;);</span>
            }
            
            BufferedImage img;
<span class="pc bpc" id="L635" title="3 of 4 branches missed.">            if (filePath.endsWith(&quot;png&quot;) || filePath.endsWith(&quot;PNG&quot;)) {</span>
<span class="fc" id="L636">                ImageIcon imageIcon = new ImageIcon(filePath);</span>
<span class="fc" id="L637">                java.awt.Image tmpImage = imageIcon.getImage();</span>

<span class="fc" id="L639">                img = new BufferedImage(</span>
<span class="fc" id="L640">                    imageIcon.getIconWidth(), imageIcon.getIconHeight(), BufferedImage.TYPE_INT_ARGB);</span>
<span class="fc" id="L641">                img.getGraphics().drawImage(tmpImage, 0, 0, null);</span>
<span class="fc" id="L642">                tmpImage.flush();</span>
<span class="fc" id="L643">            } else {</span>
<span class="nc" id="L644">                img = ImageIO.read(file);</span>
            }
                 
<span class="fc" id="L647">            int h = img.getHeight();</span>
<span class="fc" id="L648">            int w = img.getWidth();</span>
           
<span class="fc" id="L650">            Raster raster = img.getData();</span>
            
<span class="fc" id="L652">            GreyscaleImage image = new GreyscaleImage(w, h);</span>
            
<span class="fc" id="L654">            int[] data = null;</span>
<span class="fc bfc" id="L655" title="All 2 branches covered.">            for (int i = 0; i &lt; w; i++) {</span>
<span class="fc bfc" id="L656" title="All 2 branches covered.">                for (int j = 0; j &lt; h; j++) {</span>
<span class="fc" id="L657">                    data = raster.getPixel(i, j, data);</span>
<span class="fc" id="L658">                    int value = data[0];</span>
<span class="fc" id="L659">                    image.setValue(i, j, value);</span>
                }
            }
            
<span class="fc" id="L663">            return image;</span>
            
<span class="nc" id="L665">        } catch (IOException e) {</span>
        }
        
<span class="nc" id="L668">        return null;</span>
    }
    
    /**
     * 
     * @param filePath
     * @return
     * @throws Exception 
     */
    public static GreyscaleImage readImageAsGrayScaleAvgRGB(String filePath)
        throws IOException {
     
<span class="pc bpc" id="L680" title="1 of 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L681">            throw new IllegalStateException(&quot;filePath cannot be null&quot;);</span>
        }
                
        try {
<span class="fc" id="L685">            File file = new File(filePath);</span>
<span class="pc bpc" id="L686" title="1 of 2 branches missed.">            if (!file.exists()) {</span>
<span class="nc" id="L687">                throw new IllegalStateException(filePath + &quot; does not exist&quot;);</span>
            }
            
            BufferedImage img;
<span class="pc bpc" id="L691" title="1 of 4 branches missed.">            if (filePath.endsWith(&quot;png&quot;) || filePath.endsWith(&quot;PNG&quot;)) {</span>
<span class="fc" id="L692">                ImageIcon imageIcon = new ImageIcon(filePath);</span>
<span class="fc" id="L693">                java.awt.Image tmpImage = imageIcon.getImage();</span>

<span class="fc" id="L695">                img = new BufferedImage(</span>
<span class="fc" id="L696">                    imageIcon.getIconWidth(), imageIcon.getIconHeight(), BufferedImage.TYPE_INT_ARGB);</span>
<span class="fc" id="L697">                img.getGraphics().drawImage(tmpImage, 0, 0, null);</span>
<span class="fc" id="L698">                tmpImage.flush();</span>
<span class="fc" id="L699">            } else {</span>
<span class="fc" id="L700">                img = ImageIO.read(file);</span>
            }
            
<span class="fc" id="L703">            ColorSpace cs = ColorSpace.getInstance(ColorSpace.CS_GRAY);  </span>
<span class="fc" id="L704">            ColorConvertOp op = new ColorConvertOp(cs, null);  </span>
            try {
<span class="fc" id="L706">                BufferedImage image2 = op.filter(img, null);</span>
<span class="fc" id="L707">                img = image2;</span>
<span class="nc" id="L708">            } catch (NullPointerException e) {</span>
                // if type is custom, the source color space destination is not defined.
<span class="fc" id="L710">            }</span>
                        
<span class="fc" id="L712">            int h = img.getHeight();</span>
<span class="fc" id="L713">            int w = img.getWidth();</span>
            
<span class="fc" id="L715">            GreyscaleImage image = new GreyscaleImage(w, h);</span>
<span class="fc bfc" id="L716" title="All 2 branches covered.">            for (int i = 0; i &lt; w; i++) {</span>
<span class="fc bfc" id="L717" title="All 2 branches covered.">                for (int j = 0; j &lt; h; j++) {</span>
                    
<span class="fc" id="L719">                    int rgb = img.getRGB(i, j);</span>
                                        
<span class="fc" id="L721">                    int r = (rgb &gt;&gt; 16) &amp; 0xFF;</span>
<span class="fc" id="L722">                    int g = (rgb &gt;&gt; 8) &amp; 0xFF;</span>
<span class="fc" id="L723">                    int b = rgb &amp; 0xFF;</span>
<span class="fc" id="L724">                    float v = (r + g + b)/3.f;</span>
                    
<span class="fc" id="L726">                    image.setValue(i, j, (int)v);</span>
                }
            }
            
<span class="fc" id="L730">            return image;</span>
            
<span class="nc" id="L732">        } catch (IOException e) {</span>
        }
        
<span class="nc" id="L735">        return null;</span>
    }
    
    public static String writeOutputImage(String filePath, Image data) 
        throws IOException {
        
<span class="fc" id="L741">        return writeOutputImage(filePath, data,  BufferedImage.TYPE_INT_RGB);       </span>
    }
    
    public static String writeOutputImage(String filePath, Image data, 
        final int imageType) throws IOException {
                
<span class="pc bpc" id="L747" title="1 of 2 branches missed.">        if (data == null) {</span>
<span class="nc" id="L748">            return &quot;&quot;;</span>
        }
<span class="pc bpc" id="L750" title="1 of 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L751">            throw new IllegalArgumentException(&quot;filePath cannot be null&quot;);</span>
        }
        
<span class="fc" id="L754">        int w = data.getWidth();</span>
        
<span class="fc" id="L756">        int h = data.getHeight();</span>
        
<span class="fc" id="L758">        BufferedImage outputImage = new BufferedImage(w, h, </span>
            BufferedImage.TYPE_INT_RGB);
        
<span class="fc bfc" id="L761" title="All 2 branches covered.">        for (int i = 0; i &lt; w; i++) {</span>
<span class="fc bfc" id="L762" title="All 2 branches covered.">            for (int j = 0; j &lt; h; j++) {</span>
<span class="fc" id="L763">                int rgbValue = data.getRGB(i, j);</span>
<span class="fc" id="L764">                outputImage.setRGB(i, j, rgbValue);</span>
            }
        }
        
<span class="fc" id="L768">        ImageIO.write(outputImage, &quot;PNG&quot;, new File(filePath));</span>
        
<span class="fc" id="L770">        return filePath.toString();</span>
    }
    
    public static void writeOutputImage(String filePath, GreyscaleImage data) 
        throws IOException {
                
<span class="pc bpc" id="L776" title="1 of 2 branches missed.">        if (data == null) {</span>
<span class="nc" id="L777">            return;</span>
        }
<span class="pc bpc" id="L779" title="1 of 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L780">            throw new IllegalArgumentException(&quot;filePath cannot be null&quot;);</span>
        }
        
<span class="fc" id="L783">        int w = data.getWidth();</span>
        
<span class="fc" id="L785">        int h = data.getHeight();</span>
        
<span class="fc" id="L787">        BufferedImage outputImage = new BufferedImage(w, h, </span>
            BufferedImage.TYPE_BYTE_GRAY);
        
<span class="fc" id="L790">        WritableRaster raster = outputImage.getRaster();</span>
        
<span class="fc bfc" id="L792" title="All 2 branches covered.">        for (int i = 0; i &lt; w; i++) {</span>
            
<span class="fc bfc" id="L794" title="All 2 branches covered.">            for (int j = 0; j &lt; h; j++) {</span>
                
<span class="fc" id="L796">                int value = data.getValue(i, j);</span>
                
<span class="fc" id="L798">                raster.setSample(i, j, 0, value);</span>
            }
        }
        
<span class="fc" id="L802">        ImageIO.write(outputImage, &quot;PNG&quot;, new File(filePath));</span>
<span class="fc" id="L803">    }</span>
    
    public static void writeOutputGreyscaleImage(String filePath, Image data) 
        throws IOException {
                
<span class="nc bnc" id="L808" title="All 2 branches missed.">        if (data == null) {</span>
<span class="nc" id="L809">            return;</span>
        }
<span class="nc bnc" id="L811" title="All 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L812">            throw new IllegalArgumentException(&quot;filePath cannot be null&quot;);</span>
        }
        
<span class="nc" id="L815">        int w = data.getWidth();</span>
        
<span class="nc" id="L817">        int h = data.getHeight();</span>
        
<span class="nc" id="L819">        BufferedImage outputImage = new BufferedImage(w, h, </span>
            BufferedImage.TYPE_BYTE_GRAY);
        
<span class="nc" id="L822">        WritableRaster raster = outputImage.getRaster();</span>
        
<span class="nc bnc" id="L824" title="All 2 branches missed.">        for (int i = 0; i &lt; w; i++) {</span>
            
<span class="nc bnc" id="L826" title="All 2 branches missed.">            for (int j = 0; j &lt; h; j++) {</span>
                
<span class="nc" id="L828">                int rgb = data.getRGB(i, j);</span>
                
<span class="nc" id="L830">                int r = (rgb &gt;&gt; 16) &amp; 0xFF;</span>
<span class="nc" id="L831">                int g = (rgb &gt;&gt; 8) &amp; 0xFF;</span>
<span class="nc" id="L832">                int b = rgb &amp; 0xFF;  </span>
                
                // from wikipedia, srgb conversion
<span class="nc" id="L835">                double yLinear = 0.2126 * r + 0.7152 * g + 0.0722 * b;</span>
                /*if (yLinear &gt; 0.0031308) {
                    yLinear = 1.033 * Math.pow(yLinear, 1./2.4) - 0.055f;
                } else {
                    yLinear *= 12.92;
                }*/
<span class="nc" id="L841">                int v = (int)Math.round(yLinear);</span>
                
<span class="nc" id="L843">                raster.setSample(i, j, 0, v);</span>
            }
        }
        
<span class="nc" id="L847">        ImageIO.write(outputImage, &quot;PNG&quot;, new File(filePath));</span>
<span class="nc" id="L848">    }</span>
    
    /**
     * draw the edges over input and mark the corners.  The edges are drawn
     * in rotating colors to make it easier to see closed curves.
     * The corners are drawn in red dots of size 2. For best results, the
     * input image should be greyscale.
     * @param input
     * @param edges
     * @param corners
     * @param fileName
     * @param width
     * @param height
     * @throws IOException 
     */
    public static void writeImage(Image input, PairIntArray[] edges, 
        PairIntArray corners, String fileName, int width, int height) throws 
        IOException {
                
<span class="nc bnc" id="L867" title="All 6 branches missed.">        if (edges == null || input == null || corners == null) {</span>
<span class="nc" id="L868">            return;</span>
        }
<span class="nc bnc" id="L870" title="All 2 branches missed.">        if (fileName == null) {</span>
<span class="nc" id="L871">            throw new IllegalArgumentException(&quot;fileName cannot be null&quot;);</span>
        }
        
<span class="nc" id="L874">        addAlternatingColorCurvesToImage(edges, fileName, false, input);</span>
                
<span class="nc" id="L876">        addCurveToImage(corners, input, 1, 255, 0, 0);</span>
        
<span class="nc" id="L878">        String dirPath = ResourceFinder.findDirectory(&quot;bin&quot;);</span>
       
<span class="nc" id="L880">        ImageIOHelper.writeOutputImage(dirPath + &quot;/&quot; + fileName, input);</span>
<span class="nc" id="L881">    }</span>
    
    public static void addContoursToImage(List&lt;CurvatureScaleSpaceContour&gt; result, 
        ImageExt img, int xOffset, int yOffset,
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="pc bpc" id="L887" title="1 of 2 branches missed.">        if (result.isEmpty()) {</span>
<span class="nc" id="L888">            return;</span>
        }
        
<span class="fc bfc" id="L891" title="All 2 branches covered.">        for (int i = 0; i &lt; result.size(); i++) {</span>
            
<span class="fc" id="L893">            CurvatureScaleSpaceContour cssC = result.get(i);</span>
            
<span class="fc" id="L895">            addContoursToImage(cssC, img, xOffset, yOffset, nExtraForDot, </span>
                rClr, gClr, bClr);
        }
<span class="fc" id="L898">    }</span>
    
    public static void addContoursToImage(CurvatureScaleSpaceContour contour, 
        ImageExt img, int xOffset, int yOffset,
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="pc bpc" id="L904" title="1 of 2 branches missed.">        if (contour == null) {</span>
<span class="nc" id="L905">            return;</span>
        }
                    
<span class="fc" id="L908">        CurvatureScaleSpaceImagePoint[] peakDetails = contour.getPeakDetails();</span>

<span class="fc bfc" id="L910" title="All 2 branches covered.">        for (CurvatureScaleSpaceImagePoint peakDetail : peakDetails) {</span>
            
<span class="fc" id="L912">            int x = peakDetail.getXCoord() + xOffset;</span>
<span class="fc" id="L913">            int y = peakDetail.getYCoord() + yOffset;</span>
            
<span class="fc" id="L915">            addPointToImage(x, y, img, xOffset, yOffset, nExtraForDot, </span>
                rClr, gClr, bClr);
        }            
<span class="fc" id="L918">    }</span>
    
    public static void addPointToImage(final int x, final int y, 
        Image img, int xOffset, int yOffset,
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="fc bfc" id="L924" title="All 2 branches covered.">        for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
<span class="fc" id="L925">            float xx = x + dx;</span>
<span class="pc bpc" id="L926" title="2 of 4 branches missed.">            if ((xx &gt; -1) &amp;&amp; (xx &lt; (img.getWidth() - 1))) {</span>
<span class="fc bfc" id="L927" title="All 2 branches covered.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); </span>
<span class="fc" id="L928">                    dy++) {</span>
<span class="fc" id="L929">                    float yy = y + dy;</span>
<span class="pc bpc" id="L930" title="2 of 4 branches missed.">                    if ((yy &gt; -1) &amp;&amp; (yy &lt; (img.getHeight() - 1))) {</span>
<span class="fc" id="L931">                        img.setRGB((int)xx, (int)yy, rClr, gClr, bClr);</span>
                    }
                }
            }
        }
<span class="fc" id="L936">    }</span>
    
    private static PairFloatArray getXYOfContourPeaks(
        List&lt;CurvatureScaleSpaceContour&gt; contours, int xOffset, int yOffset) {
        
<span class="nc" id="L941">        PairFloatArray xy = new PairFloatArray();</span>
        
<span class="nc bnc" id="L943" title="All 2 branches missed.">        for (int i = 0; i &lt; contours.size(); ++i) {</span>
            
<span class="nc" id="L945">            CurvatureScaleSpaceContour contour = contours.get(i);</span>
            
<span class="nc" id="L947">            CurvatureScaleSpaceImagePoint[] peakDetails = contour.getPeakDetails();</span>
            
<span class="nc bnc" id="L949" title="All 2 branches missed.">            for (CurvatureScaleSpaceImagePoint peakDetail : peakDetails) {</span>
<span class="nc" id="L950">                int x = peakDetail.getXCoord() + xOffset;</span>
<span class="nc" id="L951">                int y = peakDetail.getYCoord() + yOffset;</span>
<span class="nc" id="L952">                xy.add(x, y);</span>
            }
        }
        
<span class="nc" id="L956">        return xy;</span>
    }
    
    /**
     * draw the edge over the image using the given rgb colors and the size
     * of the dot beyond 1 pixel.
     * 
     * @param edge
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void addCurveToImage(PairIntArray edge, Image input, 
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="pc bpc" id="L973" title="2 of 4 branches missed.">        if (edge == null || input == null) {</span>
<span class="nc" id="L974">            return;</span>
        }
        
<span class="fc" id="L977">        int w = input.getWidth();</span>
<span class="fc" id="L978">        int h = input.getHeight();</span>
        
<span class="fc bfc" id="L980" title="All 2 branches covered.">        for (int i = 0; i &lt; edge.getN(); i++) {</span>
<span class="fc" id="L981">            int x = edge.getX(i);</span>
<span class="fc" id="L982">            int y = edge.getY(i);</span>
            
<span class="fc bfc" id="L984" title="All 2 branches covered.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
                
<span class="fc" id="L986">                int xx = x + dx;</span>
                
<span class="fc bfc" id="L988" title="All 4 branches covered.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="fc" id="L989">                    continue;</span>
                }
<span class="fc bfc" id="L991" title="All 2 branches covered.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="fc" id="L992">                    int yy = y + dy;</span>
<span class="fc bfc" id="L993" title="All 4 branches covered.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="fc" id="L994">                        continue;</span>
                    }
<span class="fc" id="L996">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
        }
<span class="fc" id="L1000">    }</span>
    
    /**
     * draw the edge over the image using the given rgb colors and the size
     * of the dot beyond 1 pixel.
     * 
     * @param pixIdxs
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void addCurveToImage(TIntCollection pixIdxs, Image input, 
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="pc bpc" id="L1016" title="2 of 4 branches missed.">        if (pixIdxs == null || input == null) {</span>
<span class="nc" id="L1017">            return;</span>
        }
        
<span class="fc" id="L1020">        int w = input.getWidth();</span>
<span class="fc" id="L1021">        int h = input.getHeight();</span>
        
<span class="fc" id="L1023">        TIntIterator iter = pixIdxs.iterator();</span>
<span class="fc bfc" id="L1024" title="All 2 branches covered.">        while (iter.hasNext()) {</span>
            
<span class="fc" id="L1026">            int pixIdx = iter.next();</span>
            
<span class="fc" id="L1028">            int y = pixIdx/w;</span>
<span class="fc" id="L1029">            int x = pixIdx - (y * w);</span>
            
<span class="fc bfc" id="L1031" title="All 2 branches covered.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
                
<span class="fc" id="L1033">                int xx = x + dx;</span>
                
<span class="pc bpc" id="L1035" title="2 of 4 branches missed.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L1036">                    continue;</span>
                }
<span class="fc bfc" id="L1038" title="All 2 branches covered.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="fc" id="L1039">                    int yy = y + dy;</span>
<span class="pc bpc" id="L1040" title="2 of 4 branches missed.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L1041">                        continue;</span>
                    }
<span class="fc" id="L1043">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
<span class="fc" id="L1046">        }</span>
<span class="fc" id="L1047">    }</span>
    
    /**
     * draw the edge over the image using the given rgb colors and the size
     * of the dot beyond 1 pixel.
     * 
     * @param points
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void addCurveToImage(Collection&lt;PairInt&gt; points, Image input, 
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="pc bpc" id="L1063" title="2 of 4 branches missed.">        if (points == null || input == null) {</span>
<span class="nc" id="L1064">            return;</span>
        }
        
<span class="fc" id="L1067">        int w = input.getWidth();</span>
<span class="fc" id="L1068">        int h = input.getHeight();</span>
        
<span class="fc bfc" id="L1070" title="All 2 branches covered.">        for (PairInt p : points) {</span>
<span class="fc" id="L1071">            int x = p.getX();</span>
<span class="fc" id="L1072">            int y = p.getY();</span>
            
<span class="fc bfc" id="L1074" title="All 2 branches covered.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
                
<span class="fc" id="L1076">                int xx = x + dx;</span>
                
<span class="pc bpc" id="L1078" title="1 of 4 branches missed.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="fc" id="L1079">                    continue;</span>
                }
<span class="fc bfc" id="L1081" title="All 2 branches covered.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="fc" id="L1082">                    int yy = y + dy;</span>
<span class="pc bpc" id="L1083" title="2 of 4 branches missed.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L1084">                        continue;</span>
                    }
<span class="fc" id="L1086">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
<span class="fc" id="L1089">        }</span>
<span class="fc" id="L1090">    }</span>
    
    /**
     * draw the edge over the image using the given rgb colors and the size
     * of the dot beyond 1 pixel.
     * 
     * @param pointGroups
     * @param input
     * @param nExtraForDot
     */
    public static &lt;T extends Collection&lt;PairInt&gt;&gt; void addAlternatingColorCurvesToImage0(
        List&lt;T&gt; pointGroups, Image input, int nExtraForDot) {
        
<span class="nc bnc" id="L1103" title="All 4 branches missed.">        if (pointGroups == null || input == null) {</span>
<span class="nc" id="L1104">            return;</span>
        }
        
<span class="nc bnc" id="L1107" title="All 2 branches missed.">        for (int i = 0; i &lt; pointGroups.size(); ++i) {</span>
            
<span class="nc" id="L1109">            int[] clr = getNextRGB(i);</span>
            
<span class="nc" id="L1111">            addCurveToImage(pointGroups.get(i), input, nExtraForDot,</span>
                clr[0], clr[1], clr[2]);
        }
        
<span class="nc" id="L1115">    }</span>
    
    /**
     * draw the edge over the image using the given rgb colors and the size
     * of the dot beyond 1 pixel.
     * 
     * @param pointGroups
     * @param input
     * @param nExtraForDot
     */
    public static void addAlternatingColorCurvesToImage3(
        List&lt;TIntSet&gt; pointGroups, Image input, int nExtraForDot) {
        
<span class="nc bnc" id="L1128" title="All 4 branches missed.">        if (pointGroups == null || input == null) {</span>
<span class="nc" id="L1129">            return;</span>
        }
        
<span class="nc bnc" id="L1132" title="All 2 branches missed.">        for (int i = 0; i &lt; pointGroups.size(); ++i) {</span>
            
<span class="nc" id="L1134">            int[] clr = getNextRGB(i);</span>
            
<span class="nc" id="L1136">            addCurveToImage(pointGroups.get(i), input, nExtraForDot,</span>
                clr[0], clr[1], clr[2]);
        }
        
<span class="nc" id="L1140">    }</span>
    
    /**
     * draw lines from points at index i to index i+1 
     * in the requested color onto the input.
     * 
     * @param xVertexes
     * @param yVertexes
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void drawLinesInImage(
        int[] xVertexes, int[] yVertexes, 
        Image input, int nExtraForDot, 
        int rClr, int gClr, int bClr) {
        
<span class="nc bnc" id="L1159" title="All 6 branches missed.">        if (xVertexes == null || yVertexes == null || input == null) {</span>
<span class="nc" id="L1160">            return;</span>
        }
<span class="nc bnc" id="L1162" title="All 2 branches missed.">        if (xVertexes.length != yVertexes.length) {</span>
<span class="nc" id="L1163">            return;</span>
        }
        
<span class="nc" id="L1166">        int w = input.getWidth();</span>
<span class="nc" id="L1167">        int h = input.getHeight();</span>
        
<span class="nc bnc" id="L1169" title="All 2 branches missed.">        for (int i = 0; i &lt; (xVertexes.length - 1); i++) {</span>
            
<span class="nc" id="L1171">            int x1 = xVertexes[i];</span>
<span class="nc" id="L1172">            int y1 = yVertexes[i];</span>
            
<span class="nc" id="L1174">            int x2 = xVertexes[i + 1];</span>
<span class="nc" id="L1175">            int y2 = yVertexes[i + 1];</span>
            
<span class="nc" id="L1177">            drawLineInImage(x1, y1, x2, y2, input, </span>
                nExtraForDot, rClr, gClr, bClr);
        }
<span class="nc" id="L1180">    }</span>
    
    /**
     * draw lines from points at index i to index i+1 in the requested color
     * onto the input.
     * 
     * @param x1
     * @param y1
     * @param x2
     * @param y2
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void drawLineInImage(int x1, int y1, 
        int x2, int y2,
        Image input, int nExtraForDot, int rgbClr) {
        
<span class="nc" id="L1200">        int r = (rgbClr &gt;&gt; 16) &amp; 0xFF;</span>
<span class="nc" id="L1201">        int g = (rgbClr &gt;&gt; 8) &amp; 0xFF;</span>
<span class="nc" id="L1202">        int b = rgbClr &amp; 0xFF;</span>
        
<span class="nc" id="L1204">        drawLineInImage(x1, y1, x2, y2, input, nExtraForDot, r, g, b);</span>
<span class="nc" id="L1205">    }</span>
    
    /**
     * draw lines from points at index i to index i+1 in the requested color
     * onto the input.
     * 
     * @param x1
     * @param y1
     * @param x2
     * @param y2
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void drawLineInImage(int x1, int y1, 
        int x2, int y2,
        Image input, int nExtraForDot, int rClr, int gClr, 
        int bClr) {
        
<span class="fc" id="L1226">        int w = input.getWidth();</span>
<span class="fc" id="L1227">        int h = input.getHeight();</span>

<span class="fc" id="L1229">        Set&lt;PairInt&gt; output = new HashSet&lt;PairInt&gt;();</span>
        
<span class="fc" id="L1231">        BresenhamsLine.createLinePoints(x1, y1, x2, y2,</span>
            output);
        
<span class="fc bfc" id="L1234" title="All 2 branches covered.">        for (PairInt p : output) {</span>

<span class="fc" id="L1236">            int x = p.getX();</span>
<span class="fc" id="L1237">            int y = p.getY();</span>
            
<span class="fc bfc" id="L1239" title="All 2 branches covered.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); </span>
<span class="fc" id="L1240">                dx++) {</span>

<span class="fc" id="L1242">                int xx = x + dx;</span>

<span class="pc bpc" id="L1244" title="2 of 4 branches missed.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L1245">                    continue;</span>
                }
<span class="fc bfc" id="L1247" title="All 2 branches covered.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="fc" id="L1248">                    int yy = y + dy;</span>
<span class="pc bpc" id="L1249" title="2 of 4 branches missed.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L1250">                        continue;</span>
                    }
<span class="fc" id="L1252">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
<span class="fc" id="L1255">        }</span>
<span class="fc" id="L1256">    }</span>
    
    /**
     * draw lines from points at index i to index i+1 in the requested color
     * onto the input.
     * 
     * @param x1
     * @param y1
     * @param x2
     * @param y2
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void drawLineInImage(int x1, int y1, 
        int x2, int y2, Image input, int nExtraForDot, int gapLength,
        int rClr, int gClr, int bClr) {
        
<span class="fc" id="L1276">        int w = input.getWidth();</span>
<span class="fc" id="L1277">        int h = input.getHeight();</span>

<span class="fc" id="L1279">        Set&lt;PairInt&gt; output = new HashSet&lt;PairInt&gt;();</span>
        
<span class="fc" id="L1281">        BresenhamsLine.createLinePoints(x1, y1, x2, y2, gapLength,</span>
            output);
        
<span class="fc bfc" id="L1284" title="All 2 branches covered.">        for (PairInt p : output) {</span>

<span class="fc" id="L1286">            int x = p.getX();</span>
<span class="fc" id="L1287">            int y = p.getY();</span>
            
<span class="fc bfc" id="L1289" title="All 2 branches covered.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); </span>
<span class="fc" id="L1290">                dx++) {</span>

<span class="fc" id="L1292">                int xx = x + dx;</span>

<span class="pc bpc" id="L1294" title="2 of 4 branches missed.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L1295">                    continue;</span>
                }
<span class="fc bfc" id="L1297" title="All 2 branches covered.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="fc" id="L1298">                    int yy = y + dy;</span>
<span class="pc bpc" id="L1299" title="2 of 4 branches missed.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L1300">                        continue;</span>
                    }
<span class="fc" id="L1302">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
<span class="fc" id="L1305">        }</span>
<span class="fc" id="L1306">    }</span>
    
    /**
     * draw lines from points at index i to index i+1 in the requested color
     * onto the input.
     * 
     * @param xVertexes
     * @param yVertexes
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void addCurveToImage(int[] xVertexes, int[] yVertexes, 
        Image input, int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="nc bnc" id="L1323" title="All 6 branches missed.">        if (xVertexes == null || yVertexes == null || input == null) {</span>
<span class="nc" id="L1324">            return;</span>
        }
<span class="nc bnc" id="L1326" title="All 2 branches missed.">        if (xVertexes.length != yVertexes.length) {</span>
<span class="nc" id="L1327">            return;</span>
        }
        
<span class="nc" id="L1330">        int w = input.getWidth();</span>
<span class="nc" id="L1331">        int h = input.getHeight();</span>
        
<span class="nc bnc" id="L1333" title="All 2 branches missed.">        for (int i = 0; i &lt; xVertexes.length; i++) {</span>
            
<span class="nc" id="L1335">            int x = xVertexes[i];</span>
<span class="nc" id="L1336">            int y = yVertexes[i];</span>
            
<span class="nc bnc" id="L1338" title="All 2 branches missed.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>

<span class="nc" id="L1340">                int xx = x + dx;</span>

<span class="nc bnc" id="L1342" title="All 4 branches missed.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L1343">                    continue;</span>
                }
<span class="nc bnc" id="L1345" title="All 2 branches missed.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L1346">                    int yy = y + dy;</span>
<span class="nc bnc" id="L1347" title="All 4 branches missed.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L1348">                        continue;</span>
                    }
<span class="nc" id="L1350">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
        }
<span class="nc" id="L1354">    }</span>
    
    /**
     * draw the edge over the image using the given rgb colors and the size
     * of the dot beyond 1 pixel.
     * 
     * @param edge
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void addCurveToImage(PairFloatArray edge, Image input, 
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="nc bnc" id="L1370" title="All 4 branches missed.">        if (edge == null || input == null) {</span>
<span class="nc" id="L1371">            return;</span>
        }
        
<span class="nc" id="L1374">        int w = input.getWidth();</span>
<span class="nc" id="L1375">        int h = input.getHeight();</span>
        
<span class="nc bnc" id="L1377" title="All 2 branches missed.">        for (int i = 0; i &lt; edge.getN(); i++) {</span>
<span class="nc" id="L1378">            int x = Math.round(edge.getX(i));</span>
<span class="nc" id="L1379">            int y = Math.round(edge.getY(i));</span>
            
<span class="nc bnc" id="L1381" title="All 2 branches missed.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
                
<span class="nc" id="L1383">                int xx = x + dx;</span>
                
<span class="nc bnc" id="L1385" title="All 4 branches missed.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L1386">                    continue;</span>
                }
<span class="nc bnc" id="L1388" title="All 2 branches missed.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L1389">                    int yy = y + dy;</span>
<span class="nc bnc" id="L1390" title="All 4 branches missed.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L1391">                        continue;</span>
                    }
<span class="nc" id="L1393">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
        }
<span class="nc" id="L1397">    }</span>
    
    /**
     * draw the point over the image using the given rgb colors and the size
     * of the dot beyond 1 pixel.
     * 
     * @param x of point
     * @param y of point
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void addPointToImage(int x, int y, Image input, 
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="fc" id="L1414">        int w = input.getWidth();</span>
<span class="fc" id="L1415">        int h = input.getHeight();</span>
        
<span class="fc bfc" id="L1417" title="All 2 branches covered.">        for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>

<span class="fc" id="L1419">            int xx = x + dx;</span>

<span class="pc bpc" id="L1421" title="1 of 4 branches missed.">            if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L1422">                continue;</span>
            }
<span class="fc bfc" id="L1424" title="All 2 branches covered.">            for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="fc" id="L1425">                int yy = y + dy;</span>
<span class="pc bpc" id="L1426" title="1 of 4 branches missed.">                if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L1427">                    continue;</span>
                }
<span class="fc" id="L1429">                input.setRGB(xx, yy, rClr, gClr, bClr);</span>
            }
        }
<span class="fc" id="L1432">    }</span>
    /**
     * draw the point over the image using the given rgb colors and the size
     * of the dot beyond 1 pixel.
     * 
     * @param x of point
     * @param y of point
     * @param input
     * @param nExtraForDot
     * @param rgbClr
     */
    public static void addPointToImage(int x, int y, Image input, 
        int nExtraForDot, int rgbClr) {
        
<span class="nc" id="L1446">        int w = input.getWidth();</span>
<span class="nc" id="L1447">        int h = input.getHeight();</span>
        
<span class="nc bnc" id="L1449" title="All 2 branches missed.">        for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>

<span class="nc" id="L1451">            int xx = x + dx;</span>

<span class="nc bnc" id="L1453" title="All 4 branches missed.">            if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L1454">                continue;</span>
            }
<span class="nc bnc" id="L1456" title="All 2 branches missed.">            for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L1457">                int yy = y + dy;</span>
<span class="nc bnc" id="L1458" title="All 4 branches missed.">                if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L1459">                    continue;</span>
                }
<span class="nc" id="L1461">                input.setRGB(xx, yy, rgbClr);</span>
            }
        }
<span class="nc" id="L1464">    }</span>
    
    /**
     * draw the point over the image using the given rgb colors and the size
     * of the dot beyond 1 pixel.
     * 
     * @param x of point
     * @param y of point
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void addPointToImage(float x, float y, Image input, 
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="fc" id="L1481">        int w = input.getWidth();</span>
<span class="fc" id="L1482">        int h = input.getHeight();</span>
        
<span class="fc bfc" id="L1484" title="All 2 branches covered.">        for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>

<span class="fc" id="L1486">            int xx = Math.round(x + dx);</span>

<span class="pc bpc" id="L1488" title="2 of 4 branches missed.">            if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L1489">                continue;</span>
            }
<span class="fc bfc" id="L1491" title="All 2 branches covered.">            for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="fc" id="L1492">                int yy = Math.round(y + dy);</span>
<span class="pc bpc" id="L1493" title="2 of 4 branches missed.">                if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L1494">                    continue;</span>
                }
<span class="fc" id="L1496">                input.setRGB(xx, yy, rClr, gClr, bClr);</span>
            }
        }
<span class="fc" id="L1499">    }</span>
    
    /**
     * draw the edge over the image using the given rgb colors and the size
     * of the dot beyond 1 pixel.
     * 
     * @param edgeX x points of pair (edgeX, edgeY)
     * @param edgeY y points of pair (edgeX, edgeY)
     * @param nPointsInEdge number of points in edgeX 
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void addCurveToImage(int[] edgeX, int[] edgeY, 
        final int nPointsInEdge, Image input, int nExtraForDot, int rClr, 
        int gClr, int bClr) {
        
<span class="nc bnc" id="L1518" title="All 4 branches missed.">        if (edgeX == null || edgeY == null) {</span>
<span class="nc" id="L1519">            return;</span>
        }
<span class="nc bnc" id="L1521" title="All 2 branches missed.">        if (edgeX.length != edgeY.length) {</span>
<span class="nc" id="L1522">            throw new IllegalArgumentException(</span>
                &quot;edgeX and edgeY should be same length&quot;);
        }
        
<span class="nc" id="L1526">        int w = input.getWidth();</span>
<span class="nc" id="L1527">        int h = input.getHeight();</span>
        
<span class="nc bnc" id="L1529" title="All 2 branches missed.">        for (int i = 0; i &lt; nPointsInEdge; i++) {</span>
            
<span class="nc" id="L1531">            int x = edgeX[i];</span>
<span class="nc" id="L1532">            int y = edgeY[i];</span>
            
<span class="nc bnc" id="L1534" title="All 2 branches missed.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
                
<span class="nc" id="L1536">                int xx = x + dx;</span>
                
<span class="nc bnc" id="L1538" title="All 4 branches missed.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L1539">                    continue;</span>
                }
<span class="nc bnc" id="L1541" title="All 2 branches missed.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L1542">                    int yy = y + dy;</span>
<span class="nc bnc" id="L1543" title="All 4 branches missed.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L1544">                        continue;</span>
                    }
<span class="nc" id="L1546">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
        }
<span class="nc" id="L1550">    }</span>
    
    public static void addAlternatingColorCurvesToImage(
        PairIntArray[] curves, String fileName, boolean writeImage, 
        Image input) throws IOException {
        
<span class="nc bnc" id="L1556" title="All 4 branches missed.">        if (curves == null || input == null) {</span>
<span class="nc" id="L1557">            return;</span>
        }
<span class="nc bnc" id="L1559" title="All 2 branches missed.">        if (fileName == null) {</span>
<span class="nc" id="L1560">            throw new IllegalArgumentException(&quot;fileName cannot be null&quot;);</span>
        }
        
<span class="nc" id="L1563">        List&lt;PairIntArray&gt; c = new ArrayList&lt;PairIntArray&gt;();</span>
        
<span class="nc bnc" id="L1565" title="All 2 branches missed.">        for (PairIntArray a : curves) {</span>
<span class="nc" id="L1566">            c.add(a);</span>
        }
        
<span class="nc" id="L1569">        addAlternatingColorCurvesToImage(c, fileName, writeImage, input);</span>
<span class="nc" id="L1570">    }</span>
    
    public static void addAlternatingColorLabelsToRegion(Image img, int[] labels) {
    
<span class="fc" id="L1574">        int nPixels = img.getNPixels();</span>
        
<span class="pc bpc" id="L1576" title="1 of 2 branches missed.">        if (labels.length != nPixels) {</span>
<span class="nc" id="L1577">            throw new IllegalArgumentException(</span>
                &quot;labels.length should == img.nPixels&quot;);
        }
        
<span class="fc" id="L1581">        Map&lt;Integer, Integer&gt; labelColorMap = new HashMap&lt;Integer, Integer&gt;();</span>
        
<span class="fc" id="L1583">        int count = 0;</span>
        
<span class="fc bfc" id="L1585" title="All 2 branches covered.">        for (int i = 0; i &lt; nPixels; ++i) {</span>
            
<span class="fc" id="L1587">            int label = labels[i];</span>
            
<span class="fc" id="L1589">            Integer key = Integer.valueOf(label);            </span>
            
<span class="fc" id="L1591">            Integer clr = labelColorMap.get(key);</span>
            
<span class="fc bfc" id="L1593" title="All 2 branches covered.">            if (clr == null) {</span>
                                
<span class="fc" id="L1595">                clr = Integer.valueOf(getNextColorRGB(count));</span>
                
<span class="fc" id="L1597">                labelColorMap.put(key, clr);</span>
<span class="fc" id="L1598">                count++;</span>
            }
            
<span class="fc" id="L1601">            img.setRGB(img.getCol(i), img.getRow(i), clr);</span>
        }
<span class="fc" id="L1603">    }</span>
    
    public static void addAlternatingColorLabelsToRegion(
        Image img, TIntObjectMap&lt;TIntSet&gt; labelsMap) {
                    
<span class="nc" id="L1608">        TIntObjectIterator&lt;TIntSet&gt; iter = labelsMap.iterator();</span>
<span class="nc bnc" id="L1609" title="All 2 branches missed.">        for (int i = 0; i &lt; labelsMap.size(); ++i) {</span>

<span class="nc" id="L1611">            iter.advance();</span>
            
<span class="nc" id="L1613">            int clr = getNextColorRGB(i);</span>
            
<span class="nc" id="L1615">            TIntSet indexes = iter.value();</span>
<span class="nc" id="L1616">            TIntIterator iter2 = indexes.iterator();</span>
<span class="nc bnc" id="L1617" title="All 2 branches missed.">            while (iter2.hasNext()) {</span>
<span class="nc" id="L1618">                int pixIdx = iter2.next();</span>
<span class="nc" id="L1619">                img.setRGB(img.getCol(pixIdx), </span>
<span class="nc" id="L1620">                    img.getRow(pixIdx), clr);</span>
<span class="nc" id="L1621">            }</span>
        }
<span class="nc" id="L1623">    }</span>
    
    public static void addAlternatingColorPointsToImages(
        Map&lt;PairInt, List&lt;PairInt&gt;&gt; points, Image imgCp1, 
        Image imgCp2, int nExtraForDot) {
        
<span class="nc" id="L1629">        int w1 = imgCp1.getWidth();</span>
<span class="nc" id="L1630">        int h1 = imgCp1.getHeight();</span>
<span class="nc" id="L1631">        int w2 = imgCp2.getWidth();</span>
<span class="nc" id="L1632">        int h2 = imgCp2.getHeight();</span>
        
<span class="nc" id="L1634">        int count = 0;</span>
<span class="nc bnc" id="L1635" title="All 2 branches missed.">        for (Entry&lt;PairInt, List&lt;PairInt&gt;&gt; entry : points.entrySet()) {</span>
<span class="nc" id="L1636">            int clr = getNextColorRGB(count);</span>
<span class="nc" id="L1637">            PairInt p1 = entry.getKey();</span>
<span class="nc" id="L1638">            int x1 = p1.getX();</span>
<span class="nc" id="L1639">            int y1 = p1.getY();</span>
<span class="nc bnc" id="L1640" title="All 2 branches missed.">            for (int dx = (-1 * nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
<span class="nc" id="L1641">                int xx1 = x1 + dx;</span>
<span class="nc bnc" id="L1642" title="All 4 branches missed.">                if ((xx1 &lt; 0) || (xx1 &gt; (w1 - 1))) {</span>
<span class="nc" id="L1643">                    continue;</span>
                }
<span class="nc bnc" id="L1645" title="All 2 branches missed.">                for (int dy = (-1 * nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L1646">                    int yy1 = y1 + dy;</span>
<span class="nc bnc" id="L1647" title="All 4 branches missed.">                    if ((yy1 &lt; 0) || (yy1 &gt; (h1 - 1))) {</span>
<span class="nc" id="L1648">                        continue;</span>
                    }
<span class="nc" id="L1650">                    imgCp1.setRGB(xx1, yy1, clr);</span>
                }
            }                    
<span class="nc bnc" id="L1653" title="All 2 branches missed.">            for (PairInt p2 : entry.getValue()) {</span>
<span class="nc" id="L1654">                int x2 = p2.getX();</span>
<span class="nc" id="L1655">                int y2 = p2.getY();</span>
<span class="nc bnc" id="L1656" title="All 2 branches missed.">                for (int dx = (-1 * nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
<span class="nc" id="L1657">                    int xx2 = x2 + dx;</span>
<span class="nc bnc" id="L1658" title="All 4 branches missed.">                    if ((xx2 &lt; 0) || (xx2 &gt; (w2 - 1))) {</span>
<span class="nc" id="L1659">                        continue;</span>
                    }
<span class="nc bnc" id="L1661" title="All 2 branches missed.">                    for (int dy = (-1 * nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L1662">                        int yy2 = y2 + dy;</span>
<span class="nc bnc" id="L1663" title="All 4 branches missed.">                        if ((yy2 &lt; 0) || (yy2 &gt; (h2 - 1))) {</span>
<span class="nc" id="L1664">                            continue;</span>
                        }
<span class="nc" id="L1666">                        imgCp2.setRGB(xx2, yy2, clr);</span>
                    }
                }
<span class="nc" id="L1669">            }</span>
<span class="nc" id="L1670">            count++;</span>
<span class="nc" id="L1671">        }</span>
<span class="nc" id="L1672">    }</span>
    
    public static void addAlternatingColorPointsToImages(
        List&lt;FeatureComparisonStat&gt; stats, Image imgCp1, 
        Image imgCp2, int nExtraForDot) {
        
<span class="nc" id="L1678">        int w1 = imgCp1.getWidth();</span>
<span class="nc" id="L1679">        int h1 = imgCp1.getHeight();</span>
<span class="nc" id="L1680">        int w2 = imgCp2.getWidth();</span>
<span class="nc" id="L1681">        int h2 = imgCp2.getHeight();</span>
        
<span class="nc" id="L1683">        int count = 0;</span>
<span class="nc bnc" id="L1684" title="All 2 branches missed.">        for (FeatureComparisonStat stat : stats) {</span>
<span class="nc" id="L1685">            int clr = getNextColorRGB(count);</span>
<span class="nc" id="L1686">            PairInt p1 = stat.getImg1Point();</span>
<span class="nc" id="L1687">            PairInt p2 = stat.getImg2Point();</span>
<span class="nc" id="L1688">            int x1 = p1.getX();</span>
<span class="nc" id="L1689">            int y1 = p1.getY();</span>
<span class="nc bnc" id="L1690" title="All 2 branches missed.">            for (int dx = (-1 * nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
<span class="nc" id="L1691">                int xx1 = x1 + dx;</span>
<span class="nc bnc" id="L1692" title="All 4 branches missed.">                if ((xx1 &lt; 0) || (xx1 &gt; (w1 - 1))) {</span>
<span class="nc" id="L1693">                    continue;</span>
                }
<span class="nc bnc" id="L1695" title="All 2 branches missed.">                for (int dy = (-1 * nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L1696">                    int yy1 = y1 + dy;</span>
<span class="nc bnc" id="L1697" title="All 4 branches missed.">                    if ((yy1 &lt; 0) || (yy1 &gt; (h1 - 1))) {</span>
<span class="nc" id="L1698">                        continue;</span>
                    }
<span class="nc" id="L1700">                    imgCp1.setRGB(xx1, yy1, clr);</span>
                }
            }                    
<span class="nc" id="L1703">            int x2 = p2.getX();</span>
<span class="nc" id="L1704">            int y2 = p2.getY();</span>
<span class="nc bnc" id="L1705" title="All 2 branches missed.">            for (int dx = (-1 * nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
<span class="nc" id="L1706">                int xx2 = x2 + dx;</span>
<span class="nc bnc" id="L1707" title="All 4 branches missed.">                if ((xx2 &lt; 0) || (xx2 &gt; (w2 - 1))) {</span>
<span class="nc" id="L1708">                    continue;</span>
                }
<span class="nc bnc" id="L1710" title="All 2 branches missed.">                for (int dy = (-1 * nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L1711">                    int yy2 = y2 + dy;</span>
<span class="nc bnc" id="L1712" title="All 4 branches missed.">                    if ((yy2 &lt; 0) || (yy2 &gt; (h2 - 1))) {</span>
<span class="nc" id="L1713">                        continue;</span>
                    }
<span class="nc" id="L1715">                    imgCp2.setRGB(xx2, yy2, clr);</span>
                }
            }
<span class="nc" id="L1718">            count++;</span>
<span class="nc" id="L1719">        }</span>
<span class="nc" id="L1720">    }</span>
    
    public static void addAlternatingColorCurvesToImage(
        List&lt;PairIntArray&gt; curves, Image input, int nExtraForDot) {
        
<span class="pc bpc" id="L1725" title="2 of 4 branches missed.">        if (curves == null || input == null) {</span>
<span class="nc" id="L1726">            return;</span>
        }
        
<span class="fc" id="L1729">        addAlternatingColorCurvesToImage(</span>
<span class="fc" id="L1730">            curves.toArray(new PairIntArray[curves.size()]),</span>
            input, nExtraForDot);
<span class="fc" id="L1732">    }</span>
    
    public static void addAlternatingColorCurvesToImage(
        List&lt;PairIntArray&gt; curves, Image input, int xOffset, int yOffset,
        int nExtraForDot) {
        
<span class="nc bnc" id="L1738" title="All 4 branches missed.">        if (curves == null || input == null) {</span>
<span class="nc" id="L1739">            return;</span>
        }
        
<span class="nc bnc" id="L1742" title="All 6 branches missed.">        if (curves == null || input == null || curves.isEmpty()) {</span>
<span class="nc" id="L1743">            return;</span>
        }
                
<span class="nc" id="L1746">        int clr = 0;</span>
<span class="nc" id="L1747">        int w = input.getWidth();</span>
<span class="nc" id="L1748">        int h = input.getHeight();</span>
        
<span class="nc bnc" id="L1750" title="All 2 branches missed.">        for (int i = 0; i &lt; curves.size(); i++) {</span>
            
<span class="nc" id="L1752">            PairIntArray edge = curves.get(i);</span>
            
<span class="nc" id="L1754">            int c = getNextColorRGB(clr);</span>
            
<span class="nc bnc" id="L1756" title="All 2 branches missed.">            for (int ii = 0; ii &lt; edge.getN(); ii++) {</span>
                
<span class="nc" id="L1758">                int col = edge.getX(ii) + xOffset;</span>
<span class="nc" id="L1759">                int row = edge.getY(ii) + yOffset;</span>
                
<span class="nc bnc" id="L1761" title="All 2 branches missed.">                for (int dx = (-1 * nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
<span class="nc" id="L1762">                    int xx = col + dx;</span>
<span class="nc bnc" id="L1763" title="All 4 branches missed.">                    if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L1764">                        continue;</span>
                    }
<span class="nc bnc" id="L1766" title="All 2 branches missed.">                    for (int dy = (-1 * nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L1767">                        int yy = row + dy;</span>
<span class="nc bnc" id="L1768" title="All 4 branches missed.">                        if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L1769">                            continue;</span>
                        }
<span class="nc" id="L1771">                        input.setRGB(xx, yy, c);</span>
                    }
                }                
            }
<span class="nc" id="L1775">            clr++;</span>
        }
<span class="nc" id="L1777">    }</span>
    
    public static void addAlternatingColorCurvesToImage2(
        List&lt;PairIntArray&gt; curves, Image input, int nExtraForDot) {
        
<span class="nc bnc" id="L1782" title="All 4 branches missed.">        if (curves == null || input == null) {</span>
<span class="nc" id="L1783">            return;</span>
        }
        
<span class="nc" id="L1786">        addAlternatingColorCurvesToImage(</span>
<span class="nc" id="L1787">            curves.toArray(new PairIntArray[curves.size()]),</span>
            input, nExtraForDot);
<span class="nc" id="L1789">    }</span>
    
    public static void addAlternatingColorCurvesToImage(
        List&lt;PairIntArray&gt; curves, Image input) {
        
<span class="pc bpc" id="L1794" title="2 of 4 branches missed.">        if (curves == null || input == null) {</span>
<span class="nc" id="L1795">            return;</span>
        }
        
<span class="fc" id="L1798">        addAlternatingColorCurvesToImage(</span>
<span class="fc" id="L1799">            curves.toArray(new PairIntArray[curves.size()]),</span>
            input, 1);
<span class="fc" id="L1801">    }</span>
    
    public static int getNextColorRGB(int count) {
        
<span class="fc" id="L1805">        int[] c = getNextRGB(count);</span>
        
<span class="fc" id="L1807">        int rgb = (((c[0] &amp; 0x0ff) &lt;&lt; 16) | ((c[1] &amp; 0x0ff) &lt;&lt; 8) | </span>
            (c[2] &amp; 0x0ff));
        
<span class="fc" id="L1810">        return rgb;</span>
    }
    
    /*
    http://graphicdesign.stackexchange.com/questions/3682/where-can-i-find-a-large-palette-set-of-contrasting-colors-for-coloring-many-d
    
    */
    public static int[] getNextRGB(int count) {
        
        //http://godsnotwheregodsnot.blogspot.ru/2013/11/kmeans-color-quantization-seeding.html
<span class="fc" id="L1820">        String[] indexcolors = new String[]{</span>
            &quot;FFFF00&quot;, &quot;1CE6FF&quot;, &quot;FF34FF&quot;, &quot;FF4A46&quot;, &quot;008941&quot;, &quot;006FA6&quot;, &quot;A30059&quot;,
            &quot;FFDBE5&quot;, &quot;7A4900&quot;, &quot;0000A6&quot;, &quot;63FFAC&quot;, &quot;B79762&quot;, &quot;004D43&quot;, &quot;8FB0FF&quot;, &quot;997D87&quot;,
            &quot;5A0007&quot;, &quot;809693&quot;, &quot;FEFFE6&quot;, &quot;1B4400&quot;, &quot;4FC601&quot;, &quot;3B5DFF&quot;, &quot;4A3B53&quot;, &quot;FF2F80&quot;,
            &quot;61615A&quot;, &quot;BA0900&quot;, &quot;6B7900&quot;, &quot;00C2A0&quot;, &quot;FFAA92&quot;, &quot;FF90C9&quot;, &quot;B903AA&quot;, &quot;D16100&quot;,
            &quot;DDEFFF&quot;, &quot;000035&quot;, &quot;7B4F4B&quot;, &quot;A1C299&quot;, &quot;300018&quot;, &quot;0AA6D8&quot;, &quot;013349&quot;, &quot;00846F&quot;,
            &quot;372101&quot;, &quot;FFB500&quot;, &quot;C2FFED&quot;, &quot;A079BF&quot;, &quot;CC0744&quot;, &quot;C0B9B2&quot;, &quot;C2FF99&quot;, &quot;001E09&quot;,
            &quot;00489C&quot;, &quot;6F0062&quot;, &quot;0CBD66&quot;, &quot;EEC3FF&quot;, &quot;456D75&quot;, &quot;B77B68&quot;, &quot;7A87A1&quot;, &quot;788D66&quot;,
            &quot;885578&quot;, &quot;FAD09F&quot;, &quot;FF8A9A&quot;, &quot;D157A0&quot;, &quot;BEC459&quot;, &quot;456648&quot;, &quot;0086ED&quot;, &quot;886F4C&quot;,
            &quot;34362D&quot;, &quot;B4A8BD&quot;, &quot;00A6AA&quot;, &quot;452C2C&quot;, &quot;636375&quot;, &quot;A3C8C9&quot;, &quot;FF913F&quot;, &quot;938A81&quot;,
            &quot;575329&quot;, &quot;00FECF&quot;, &quot;B05B6F&quot;, &quot;8CD0FF&quot;, &quot;3B9700&quot;, &quot;04F757&quot;, &quot;C8A1A1&quot;, &quot;1E6E00&quot;,
            &quot;7900D7&quot;, &quot;A77500&quot;, &quot;6367A9&quot;, &quot;A05837&quot;, &quot;6B002C&quot;, &quot;772600&quot;, &quot;D790FF&quot;, &quot;9B9700&quot;,
            &quot;549E79&quot;, &quot;FFF69F&quot;, &quot;201625&quot;, &quot;72418F&quot;, &quot;BC23FF&quot;, &quot;99ADC0&quot;, &quot;3A2465&quot;, &quot;922329&quot;,
            &quot;5B4534&quot;, &quot;FDE8DC&quot;, &quot;404E55&quot;, &quot;0089A3&quot;, &quot;CB7E98&quot;, &quot;A4E804&quot;, &quot;324E72&quot;, &quot;6A3A4C&quot;,
            &quot;83AB58&quot;, &quot;001C1E&quot;, &quot;D1F7CE&quot;, &quot;004B28&quot;, &quot;C8D0F6&quot;, &quot;A3A489&quot;, &quot;806C66&quot;, &quot;222800&quot;,
            &quot;BF5650&quot;, &quot;E83000&quot;, &quot;66796D&quot;, &quot;DA007C&quot;, &quot;FF1A59&quot;, &quot;8ADBB4&quot;, &quot;1E0200&quot;, &quot;5B4E51&quot;,
            &quot;C895C5&quot;, &quot;320033&quot;, &quot;FF6832&quot;, &quot;66E1D3&quot;, &quot;CFCDAC&quot;, &quot;D0AC94&quot;, &quot;7ED379&quot;, &quot;012C58&quot;,
            &quot;7A7BFF&quot;, &quot;D68E01&quot;, &quot;353339&quot;, &quot;78AFA1&quot;, &quot;FEB2C6&quot;, &quot;75797C&quot;, &quot;837393&quot;, &quot;943A4D&quot;,
            &quot;B5F4FF&quot;, &quot;D2DCD5&quot;, &quot;9556BD&quot;, &quot;6A714A&quot;, &quot;001325&quot;, &quot;02525F&quot;, &quot;0AA3F7&quot;, &quot;E98176&quot;,
            &quot;DBD5DD&quot;, &quot;5EBCD1&quot;, &quot;3D4F44&quot;, &quot;7E6405&quot;, &quot;02684E&quot;, &quot;962B75&quot;, &quot;8D8546&quot;, &quot;9695C5&quot;,
            &quot;E773CE&quot;, &quot;D86A78&quot;, &quot;3E89BE&quot;, &quot;CA834E&quot;, &quot;518A87&quot;, &quot;5B113C&quot;, &quot;55813B&quot;, &quot;E704C4&quot;,
            &quot;00005F&quot;, &quot;A97399&quot;, &quot;4B8160&quot;, &quot;59738A&quot;, &quot;FF5DA7&quot;, &quot;F7C9BF&quot;, &quot;643127&quot;, &quot;513A01&quot;,
            &quot;6B94AA&quot;, &quot;51A058&quot;, &quot;A45B02&quot;, &quot;1D1702&quot;, &quot;E20027&quot;, &quot;E7AB63&quot;, &quot;4C6001&quot;, &quot;9C6966&quot;,
            &quot;64547B&quot;, &quot;97979E&quot;, &quot;006A66&quot;, &quot;391406&quot;, &quot;F4D749&quot;, &quot;0045D2&quot;, &quot;006C31&quot;, &quot;DDB6D0&quot;,
            &quot;7C6571&quot;, &quot;9FB2A4&quot;, &quot;00D891&quot;, &quot;15A08A&quot;, &quot;BC65E9&quot;, &quot;FFFFFE&quot;, &quot;C6DC99&quot;, &quot;203B3C&quot;,
            &quot;671190&quot;, &quot;6B3A64&quot;, &quot;F5E1FF&quot;, &quot;FFA0F2&quot;, &quot;CCAA35&quot;, &quot;374527&quot;, &quot;8BB400&quot;, &quot;797868&quot;,
            &quot;C6005A&quot;, &quot;3B000A&quot;, &quot;C86240&quot;, &quot;29607C&quot;, &quot;402334&quot;, &quot;7D5A44&quot;, &quot;CCB87C&quot;, &quot;B88183&quot;,
            &quot;AA5199&quot;, &quot;B5D6C3&quot;, &quot;A38469&quot;, &quot;9F94F0&quot;, &quot;A74571&quot;, &quot;B894A6&quot;, &quot;71BB8C&quot;, &quot;00B433&quot;,
            &quot;789EC9&quot;, &quot;6D80BA&quot;, &quot;953F00&quot;, &quot;5EFF03&quot;, &quot;E4FFFC&quot;, &quot;1BE177&quot;, &quot;BCB1E5&quot;, &quot;76912F&quot;,
            &quot;003109&quot;, &quot;0060CD&quot;, &quot;D20096&quot;, &quot;895563&quot;, &quot;29201D&quot;, &quot;5B3213&quot;, &quot;A76F42&quot;, &quot;89412E&quot;,
            &quot;1A3A2A&quot;, &quot;494B5A&quot;, &quot;A88C85&quot;, &quot;F4ABAA&quot;, &quot;A3F3AB&quot;, &quot;00C6C8&quot;, &quot;EA8B66&quot;, &quot;958A9F&quot;,
            &quot;BDC9D2&quot;, &quot;9FA064&quot;, &quot;BE4700&quot;, &quot;658188&quot;, &quot;83A485&quot;, &quot;453C23&quot;, &quot;47675D&quot;, &quot;3A3F00&quot;,
            &quot;061203&quot;, &quot;DFFB71&quot;, &quot;868E7E&quot;, &quot;98D058&quot;, &quot;6C8F7D&quot;, &quot;D7BFC2&quot;, &quot;3C3E6E&quot;, &quot;D83D66&quot;,
            &quot;2F5D9B&quot;, &quot;6C5E46&quot;, &quot;D25B88&quot;, &quot;5B656C&quot;, &quot;00B57F&quot;, &quot;545C46&quot;, &quot;866097&quot;, &quot;365D25&quot;,
            &quot;252F99&quot;, &quot;00CCFF&quot;, &quot;674E60&quot;, &quot;FC009C&quot;, &quot;92896B&quot;
        };
        
<span class="fc" id="L1857">        int n = indexcolors.length - 1;</span>
        
<span class="pc bpc" id="L1859" title="1 of 2 branches missed.">        if (count &lt; 0) {</span>
<span class="nc" id="L1860">            count = 0;</span>
        } else {
<span class="fc" id="L1862">            count = count % n;</span>
        }
    
<span class="fc" id="L1865">        String str = indexcolors[count];</span>
        
<span class="fc" id="L1867">        int rgb = Integer.parseInt(str, 16);</span>
<span class="fc" id="L1868">        int r = (rgb &gt;&gt; 16) &amp; 0xFF;</span>
<span class="fc" id="L1869">        int g = (rgb &gt;&gt; 8) &amp; 0xFF;</span>
<span class="fc" id="L1870">        int b = rgb &amp; 0xFF;</span>
                
<span class="fc" id="L1872">        return new int[]{r, g, b};</span>
    }
    
    public static void addAlternatingColorCurvesToImage(
        PairIntArray[] curves, Image input) {
        
<span class="nc bnc" id="L1878" title="All 4 branches missed.">        if (curves == null || input == null) {</span>
<span class="nc" id="L1879">            return;</span>
        }
        
<span class="nc" id="L1882">        int nExtraForDot = 1;</span>
        
<span class="nc" id="L1884">        addAlternatingColorCurvesToImage(curves, input, nExtraForDot);</span>
<span class="nc" id="L1885">    }</span>
    
    public static void addAlternatingColorCurvesToImage(
        PairIntArray[] curves, Image input, int nExtraForDot) {
        
<span class="pc bpc" id="L1890" title="2 of 4 branches missed.">        if (curves == null || input == null) {</span>
<span class="nc" id="L1891">            return;</span>
        }
                
<span class="fc" id="L1894">        int clr = 0;</span>
<span class="fc" id="L1895">        int w = input.getWidth();</span>
<span class="fc" id="L1896">        int h = input.getHeight();</span>
        
<span class="fc bfc" id="L1898" title="All 2 branches covered.">        for (int i = 0; i &lt; curves.length; i++) {</span>
            
<span class="fc" id="L1900">            PairIntArray edge = curves[i];</span>
            
<span class="fc" id="L1902">            int c = getNextColorRGB(clr);</span>
            
<span class="fc bfc" id="L1904" title="All 2 branches covered.">            for (int ii = 0; ii &lt; edge.getN(); ii++) {</span>
                
<span class="fc" id="L1906">                int col = edge.getX(ii);</span>
<span class="fc" id="L1907">                int row = edge.getY(ii);</span>
                
<span class="fc bfc" id="L1909" title="All 2 branches covered.">                for (int dx = (-1 * nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
<span class="fc" id="L1910">                    int xx = col + dx;</span>
<span class="fc bfc" id="L1911" title="All 4 branches covered.">                    if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="fc" id="L1912">                        continue;</span>
                    }
<span class="fc bfc" id="L1914" title="All 2 branches covered.">                    for (int dy = (-1 * nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="fc" id="L1915">                        int yy = row + dy;</span>
<span class="fc bfc" id="L1916" title="All 4 branches covered.">                        if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="fc" id="L1917">                            continue;</span>
                        }
<span class="fc" id="L1919">                        input.setRGB(xx, yy, c);</span>
                    }
                }                
            }
<span class="fc" id="L1923">            clr++;</span>
        }
<span class="fc" id="L1925">    }</span>
    
    public static void addAlternatingColorPointSetsToImage(
        List&lt;Set&lt;PairInt&gt;&gt; pointSets, int xOffset, int yOffset, 
        int nExtraForDot, Image input) {
        
<span class="pc bpc" id="L1931" title="2 of 4 branches missed.">        if (pointSets == null || input == null) {</span>
<span class="nc" id="L1932">            return;</span>
        }
                
<span class="fc bfc" id="L1935" title="All 2 branches covered.">        for (int i = 0; i &lt; pointSets.size(); i++) {</span>
            
<span class="fc" id="L1937">            Set&lt;PairInt&gt; points = pointSets.get(i);</span>
            
<span class="fc" id="L1939">            int[] c = getNextRGB(i);</span>
            
<span class="fc" id="L1941">            addToImage(points, 0, 0, input, nExtraForDot, c[0], c[1], c[2]);</span>
        }
<span class="fc" id="L1943">    }</span>
    
    public static void addAlternatingColorPointSetsToImage2(
        List&lt;TIntSet&gt; pointSets, int xOffset, int yOffset, 
        int nExtraForDot, Image input) {
        
<span class="nc bnc" id="L1949" title="All 4 branches missed.">        if (pointSets == null || input == null) {</span>
<span class="nc" id="L1950">            return;</span>
        }
                
<span class="nc bnc" id="L1953" title="All 2 branches missed.">        for (int i = 0; i &lt; pointSets.size(); i++) {</span>
            
<span class="nc" id="L1955">            TIntSet pIdxs = pointSets.get(i);</span>
            
<span class="nc" id="L1957">            int[] c = getNextRGB(i);</span>
            
<span class="nc" id="L1959">            addToImage(pIdxs, 0, 0, input, nExtraForDot, c[0], c[1], c[2]);</span>
        }
<span class="nc" id="L1961">    }</span>
    
    public static &lt;T extends Collection&lt;PairInt&gt;&gt; void addToImage(
        T points, int xOffsetToApply, int yOffsetToApply, Image input) {
        
<span class="nc bnc" id="L1966" title="All 4 branches missed.">        if (points == null || input == null) {</span>
<span class="nc" id="L1967">            return;</span>
        }
        
<span class="nc" id="L1970">        int w = input.getWidth();</span>
<span class="nc" id="L1971">        int h = input.getHeight();</span>
        
<span class="nc" id="L1973">        int c = Color.BLUE.getRGB();</span>
          
<span class="nc bnc" id="L1975" title="All 2 branches missed.">        for (PairInt p : points) {</span>

<span class="nc" id="L1977">            int col = p.getX() + xOffsetToApply;</span>
<span class="nc" id="L1978">            int row = p.getY() + yOffsetToApply;</span>

<span class="nc bnc" id="L1980" title="All 8 branches missed.">            if ((col &lt; 0) || (row &lt; 0) || (col &gt; (w - 1)) || (row &gt; (h - 1))) {</span>
<span class="nc" id="L1981">                continue;</span>
            }

<span class="nc" id="L1984">            input.setRGB(col, row, c);</span>
<span class="nc" id="L1985">        }</span>
<span class="nc" id="L1986">    }</span>
    
    public static &lt;T extends Collection&lt;PairInt&gt;&gt; void addToImage(
        T points, int xOffsetToApply, 
        int yOffsetToApply, Image input, int rClr, int gClr, int bClr) throws 
        IOException {
        
<span class="nc bnc" id="L1993" title="All 4 branches missed.">        if (points == null || input == null) {</span>
<span class="nc" id="L1994">            return;</span>
        }
        
<span class="nc" id="L1997">        int w = input.getWidth();</span>
<span class="nc" id="L1998">        int h = input.getHeight();</span>
                  
<span class="nc bnc" id="L2000" title="All 2 branches missed.">        for (PairInt p : points) {</span>

<span class="nc" id="L2002">            int col = p.getX() + xOffsetToApply;</span>
<span class="nc" id="L2003">            int row = p.getY() + yOffsetToApply;</span>
            
<span class="nc bnc" id="L2005" title="All 8 branches missed.">            if ((col &lt; 0) || (row &lt; 0) || (col &gt; (w - 1)) || (row &gt; (h - 1))) {</span>
<span class="nc" id="L2006">                continue;</span>
            }

<span class="nc" id="L2009">            input.setRGB(col, row, rClr, gClr, bClr);</span>
<span class="nc" id="L2010">        }</span>
<span class="nc" id="L2011">    }</span>
    
    public static &lt;T extends Collection&lt;PairInt&gt;&gt; void addToImage(
        T points, int xOffsetToApply, 
        int yOffsetToApply, Image input, int nExtraForDot,
        int rClr, int gClr, int bClr) {
        
<span class="pc bpc" id="L2018" title="2 of 4 branches missed.">        if (points == null || input == null) {</span>
<span class="nc" id="L2019">            return;</span>
        }
        
<span class="fc" id="L2022">        int w = input.getWidth();</span>
<span class="fc" id="L2023">        int h = input.getHeight();</span>
                  
<span class="fc bfc" id="L2025" title="All 2 branches covered.">        for (PairInt p : points) {</span>

<span class="fc" id="L2027">            int x = p.getX() + xOffsetToApply;</span>
<span class="fc" id="L2028">            int y = p.getY() + yOffsetToApply;</span>
            
<span class="fc bfc" id="L2030" title="All 2 branches covered.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); ++dx) {</span>
<span class="fc" id="L2031">                int xx = x + dx;</span>
<span class="fc bfc" id="L2032" title="All 4 branches covered.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="fc" id="L2033">                    continue;</span>
                }
<span class="fc bfc" id="L2035" title="All 2 branches covered.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="fc" id="L2036">                    int yy = y + dy;</span>
<span class="fc bfc" id="L2037" title="All 4 branches covered.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="fc" id="L2038">                        continue;</span>
                    }
<span class="fc" id="L2040">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
<span class="fc" id="L2043">        }</span>
<span class="fc" id="L2044">    }</span>

    public static void addToImage(
        TIntSet pIdxs, int xOffsetToApply, 
        int yOffsetToApply, Image input, int nExtraForDot,
        int rClr, int gClr, int bClr) {
        
<span class="nc bnc" id="L2051" title="All 4 branches missed.">        if (pIdxs == null || input == null) {</span>
<span class="nc" id="L2052">            return;</span>
        }
        
<span class="nc" id="L2055">        int w = input.getWidth();</span>
<span class="nc" id="L2056">        int h = input.getHeight();</span>
             
<span class="nc" id="L2058">        TIntIterator iter = pIdxs.iterator();</span>
<span class="nc bnc" id="L2059" title="All 2 branches missed.">        while (iter.hasNext()) {</span>
<span class="nc" id="L2060">            int pixIdx = iter.next();</span>
<span class="nc" id="L2061">            int y = pixIdx/w;</span>
<span class="nc" id="L2062">            int x = pixIdx - (y * w);</span>
<span class="nc" id="L2063">            x += xOffsetToApply;</span>
<span class="nc" id="L2064">            y += yOffsetToApply;</span>
            
<span class="nc bnc" id="L2066" title="All 2 branches missed.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); ++dx) {</span>
<span class="nc" id="L2067">                int xx = x + dx;</span>
<span class="nc bnc" id="L2068" title="All 4 branches missed.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L2069">                    continue;</span>
                }
<span class="nc bnc" id="L2071" title="All 2 branches missed.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L2072">                    int yy = y + dy;</span>
<span class="nc bnc" id="L2073" title="All 4 branches missed.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L2074">                        continue;</span>
                    }
<span class="nc" id="L2076">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
<span class="nc" id="L2079">        }</span>
<span class="nc" id="L2080">    }</span>

    public static void addAlternatingColorCurvesToImage(
        List&lt;PairIntArray&gt; curves, String fileName, boolean writeImage, 
        Image input) throws IOException {
        
<span class="nc bnc" id="L2086" title="All 4 branches missed.">        if (curves == null || input == null) {</span>
<span class="nc" id="L2087">            return;</span>
        }
<span class="nc bnc" id="L2089" title="All 2 branches missed.">        if (fileName == null) {</span>
<span class="nc" id="L2090">            throw new IllegalArgumentException(&quot;fileName cannot be null&quot;);</span>
        }
        
<span class="nc" id="L2093">        addAlternatingColorCurvesToImage(curves, input);</span>
       
<span class="nc bnc" id="L2095" title="All 2 branches missed.">        if (!writeImage) {</span>
<span class="nc" id="L2096">            return;</span>
        }
        
        try {
<span class="nc" id="L2100">            String dirPath = ResourceFinder.findDirectory(&quot;bin&quot;);</span>
<span class="nc" id="L2101">            ImageIOHelper.writeOutputImage(dirPath + &quot;/&quot; + fileName, input);</span>
<span class="nc" id="L2102">        } catch (IOException ex) {</span>
<span class="nc" id="L2103">            Logger.getLogger(ImageIOHelper.class.getName()).severe(</span>
<span class="nc" id="L2104">                &quot;ERROR: l446&quot; + ex.getMessage());</span>
<span class="nc" id="L2105">        }</span>
<span class="nc" id="L2106">    }</span>

    public static void addCurveToImage(ScaleSpaceCurve curve, Image input, 
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="nc bnc" id="L2111" title="All 4 branches missed.">        if (curve == null || input == null) {</span>
<span class="nc" id="L2112">            return;</span>
        }
        
<span class="nc" id="L2115">        int w = input.getWidth();</span>
<span class="nc" id="L2116">        int h = input.getHeight();</span>
        
<span class="nc bnc" id="L2118" title="All 2 branches missed.">        for (int i = 0; i &lt; curve.getSize(); i++) {</span>
<span class="nc" id="L2119">            int x = Math.round(curve.getX(i));</span>
<span class="nc" id="L2120">            int y = Math.round(curve.getY(i));</span>
            
<span class="nc bnc" id="L2122" title="All 2 branches missed.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); ++dx) {</span>
<span class="nc" id="L2123">                int xx = x + dx;</span>
<span class="nc bnc" id="L2124" title="All 4 branches missed.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L2125">                    continue;</span>
                }
<span class="nc bnc" id="L2127" title="All 2 branches missed.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L2128">                    int yy = y + dy;</span>
<span class="nc bnc" id="L2129" title="All 4 branches missed.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L2130">                        continue;</span>
                    }
<span class="nc" id="L2132">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
        }
<span class="nc" id="L2136">    }</span>

    public static void addToImage(float[] xP, float[] yP, 
        int xOffsetToApply, int yOffsetToApply, Image input,
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="nc bnc" id="L2142" title="All 6 branches missed.">        if (xP == null || yP == null || input == null) {</span>
<span class="nc" id="L2143">            return;</span>
        }
        
<span class="nc" id="L2146">        int w = input.getWidth();</span>
<span class="nc" id="L2147">        int h = input.getHeight();</span>
        
<span class="nc bnc" id="L2149" title="All 2 branches missed.">        for (int i = 0; i &lt; xP.length; i++) {</span>
            
<span class="nc" id="L2151">            int x = Math.round(xP[i]) + xOffsetToApply;</span>
            
<span class="nc" id="L2153">            int y = Math.round(yP[i]) + yOffsetToApply;</span>
            
<span class="nc bnc" id="L2155" title="All 2 branches missed.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); ++dx) {</span>
<span class="nc" id="L2156">                int xx = x + dx;</span>
<span class="nc bnc" id="L2157" title="All 4 branches missed.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L2158">                    continue;</span>
                }
<span class="nc bnc" id="L2160" title="All 2 branches missed.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L2161">                    int yy = y + dy;</span>
<span class="nc bnc" id="L2162" title="All 4 branches missed.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L2163">                        continue;</span>
                    }
<span class="nc" id="L2165">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
        }
<span class="nc" id="L2169">    }</span>
    
    public static void addToImage(int[] xP, int[] yP, 
        int xOffsetToApply, int yOffsetToApply, Image input,
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="nc bnc" id="L2175" title="All 6 branches missed.">        if (xP == null || yP == null || input == null) {</span>
<span class="nc" id="L2176">            return;</span>
        }
        
<span class="nc" id="L2179">        int w = input.getWidth();</span>
<span class="nc" id="L2180">        int h = input.getHeight();</span>
        
<span class="nc bnc" id="L2182" title="All 2 branches missed.">        for (int i = 0; i &lt; xP.length; i++) {</span>
            
<span class="nc" id="L2184">            int x = xP[i] + xOffsetToApply;</span>
            
<span class="nc" id="L2186">            int y = yP[i] + yOffsetToApply;</span>
            
<span class="nc bnc" id="L2188" title="All 2 branches missed.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
<span class="nc" id="L2189">                int xx = x + dx;</span>
<span class="nc bnc" id="L2190" title="All 4 branches missed.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L2191">                    continue;</span>
                }
<span class="nc bnc" id="L2193" title="All 2 branches missed.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L2194">                    int yy = y + dy;</span>
<span class="nc bnc" id="L2195" title="All 4 branches missed.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L2196">                        continue;</span>
                    }
<span class="nc" id="L2198">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
        }
<span class="nc" id="L2202">    }</span>
    
    /**
     * given data, apply a factor and offset to put it in range 0 to 255 and
     * return an image from it.
     * @param data
     * @return 
     */
    public static GreyscaleImage scaleToImgRange(double[][] data) {
        
<span class="nc" id="L2212">        double maxValue = Double.MIN_VALUE;</span>
<span class="nc" id="L2213">        double minValue = Double.MAX_VALUE;</span>
<span class="nc bnc" id="L2214" title="All 2 branches missed.">        for (int i = 0; i &lt; data.length; ++i) {</span>
<span class="nc bnc" id="L2215" title="All 2 branches missed.">            for (int j = 0; j &lt; data[i].length; ++j) {</span>
<span class="nc" id="L2216">                double v = data[i][j];</span>
<span class="nc bnc" id="L2217" title="All 2 branches missed.">                if (v &lt; minValue) {</span>
<span class="nc" id="L2218">                    minValue = v;</span>
                }
<span class="nc bnc" id="L2220" title="All 2 branches missed.">                if (v &gt; maxValue) {</span>
<span class="nc" id="L2221">                    maxValue = v;</span>
                }
            }
        }
        
        /* scale data between 0 and 255
               
        (max - min) * factor = 255 --&gt; factor = 255/(max - min)
        then subtract min, min*factor
        for example 10  20, delta=10, factor = 25.5
        (10*25.5)-(10*25.5) = 0
        (20*25.5)-(10*25.5) = 255
        */
<span class="nc" id="L2234">        double factor = 255./(maxValue - minValue);</span>
<span class="nc" id="L2235">        double zp = minValue * factor;</span>
        
<span class="nc" id="L2237">        GreyscaleImage img = new GreyscaleImage(data.length, data[0].length);</span>
        
<span class="nc bnc" id="L2239" title="All 2 branches missed.">        for (int i = 0; i &lt; data.length; ++i) {</span>
<span class="nc bnc" id="L2240" title="All 2 branches missed.">            for (int j = 0; j &lt; data[i].length; ++j) {</span>
<span class="nc" id="L2241">                double v = data[i][j];</span>
<span class="nc" id="L2242">                int vs = (int)Math.round((v * factor) - zp);</span>
<span class="nc" id="L2243">                img.setValue(i, j, vs);</span>
            }
        }
        
<span class="nc" id="L2247">        return img;</span>
    }
    
    /**
     * given data, apply a factor and offset to put it in range 0 to 255 and
     * return an image from it.
     * @param data
     * @return 
     */
    public static GreyscaleImage scaleToImgRange(int[][] data) {
        
<span class="fc" id="L2258">        int maxValue = Integer.MIN_VALUE;</span>
<span class="fc" id="L2259">        int minValue = Integer.MAX_VALUE;</span>
<span class="fc bfc" id="L2260" title="All 2 branches covered.">        for (int i = 0; i &lt; data.length; ++i) {</span>
<span class="fc bfc" id="L2261" title="All 2 branches covered.">            for (int j = 0; j &lt; data[i].length; ++j) {</span>
<span class="fc" id="L2262">                int v = data[i][j];</span>
<span class="fc bfc" id="L2263" title="All 2 branches covered.">                if (v &lt; minValue) {</span>
<span class="fc" id="L2264">                    minValue = v;</span>
                }
<span class="fc bfc" id="L2266" title="All 2 branches covered.">                if (v &gt; maxValue) {</span>
<span class="fc" id="L2267">                    maxValue = v;</span>
                }
            }
        }
        
        /* scale data between 0 and 255
               
        (max - min) * factor = 255 --&gt; factor = 255/(max - min)
        then subtract min, min*factor
        for example 10  20, delta=10, factor = 25.5
        (10*25.5)-(10*25.5) = 0
        (20*25.5)-(10*25.5) = 255
        */
<span class="fc" id="L2280">        double factor = 255./(double)(maxValue - minValue);</span>
<span class="fc" id="L2281">        double zp = minValue * factor;</span>
        
<span class="fc" id="L2283">        GreyscaleImage img = new GreyscaleImage(data.length, data[0].length);</span>
        
<span class="fc bfc" id="L2285" title="All 2 branches covered.">        for (int i = 0; i &lt; data.length; ++i) {</span>
<span class="fc bfc" id="L2286" title="All 2 branches covered.">            for (int j = 0; j &lt; data[i].length; ++j) {</span>
<span class="fc" id="L2287">                int v = data[i][j];</span>
<span class="fc" id="L2288">                int vs = (int)Math.round((v * factor) - zp);</span>
<span class="fc" id="L2289">                img.setValue(i, j, vs);</span>
            }
        }
        
<span class="fc" id="L2293">        return img;</span>
    }

    public static void addAlternatingColorContoursToImage(
        List&lt;CurvatureScaleSpaceContour&gt; contours, ImageExt img, 
        int xOffset, int yOffset, int nExtraForDot) {
        
        //StringBuilder sb = new StringBuilder();
        
<span class="nc bnc" id="L2302" title="All 2 branches missed.">        for (int i = 0; i &lt; contours.size(); i++) {</span>
            
<span class="nc" id="L2304">            CurvatureScaleSpaceContour cssC = contours.get(i);</span>
            
            /*sb.append(&quot;[&quot;).append(Integer.toString(i))
                .append(&quot;] t=&quot;)
                .append(Float.toString(cssC.getPeakScaleFreeLength()))
                .append(&quot;, s=&quot;)
                .append(Float.toString(cssC.getPeakSigma()))
                .append(&quot; &quot;);*/
            
<span class="nc" id="L2313">            int[] c = getNextRGB(i);</span>
            
<span class="nc" id="L2315">            addContoursToImage(cssC, img, xOffset, yOffset, nExtraForDot, </span>
                c[0], c[1], c[2]);
        }
        
        //Logger.getLogger(ImageIOHelper.class.getName()).info(sb.toString());
<span class="nc" id="L2320">    }</span>

    public static void addAlternatingColorCornerRegionsToImage(
        List&lt;CornerRegion&gt; regions, Image img, 
        int xOffset, int yOffset, int nExtraForDot) {
        
<span class="nc bnc" id="L2326" title="All 2 branches missed.">        for (int i = 0; i &lt; regions.size(); i++) {</span>
            
<span class="nc" id="L2328">            CornerRegion br = regions.get(i);</span>
            
<span class="nc" id="L2330">            int[] c = getNextRGB(i);</span>

<span class="nc" id="L2332">            int x = br.getX()[br.getKMaxIdx()];</span>
<span class="nc" id="L2333">            int y = br.getY()[br.getKMaxIdx()];</span>
            
<span class="nc" id="L2335">            addPointToImage(x, y, img, xOffset, yOffset, nExtraForDot, </span>
                c[0], c[1], c[2]);
        }
<span class="nc" id="L2338">    }</span>
    
    public static &lt;T extends CornerRegion&gt; void 
        addAlternatingColorCornerRegionListsToImage(
        List&lt;List&lt;T&gt;&gt; regions, Image img, int xOffset, int yOffset, 
            int nExtraForDot) {
        
<span class="nc bnc" id="L2345" title="All 2 branches missed.">        for (int i = 0; i &lt; regions.size(); i++) {</span>
            
<span class="nc" id="L2347">            List&lt;T&gt; corners = regions.get(i);</span>
            
<span class="nc" id="L2349">            int[] c = getNextRGB(i);</span>
            
<span class="nc" id="L2351">            addCornerRegionsToImage(corners, img, xOffset, yOffset, </span>
                nExtraForDot, c[0], c[1], c[2]);
        }
<span class="nc" id="L2354">    }</span>
    
    public static void addCornerRegionsToImage(Collection&lt;CornerRegion&gt; regions,
        Image img, int xOffset, int yOffset, int nExtraForDot) {

<span class="nc bnc" id="L2359" title="All 2 branches missed.">        for (CornerRegion br : regions) {</span>

<span class="nc" id="L2361">            int x = br.getX()[br.getKMaxIdx()];</span>
<span class="nc" id="L2362">            int y = br.getY()[br.getKMaxIdx()];</span>

<span class="nc" id="L2364">            addPointToImage(x, y, img, xOffset, yOffset, nExtraForDot, 255, 0, 0);</span>
<span class="nc" id="L2365">        }</span>
<span class="nc" id="L2366">    }</span>
    
    public static &lt;T extends CornerRegion&gt; void addCornerRegionsToImage(
        Collection&lt;T&gt; regions, Image img, int xOffset, int yOffset, 
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="nc bnc" id="L2372" title="All 2 branches missed.">        for (T br : regions ) {</span>
            
<span class="nc" id="L2374">            int x = br.getX()[br.getKMaxIdx()];</span>
<span class="nc" id="L2375">            int y = br.getY()[br.getKMaxIdx()];</span>
            
<span class="nc" id="L2377">            addPointToImage(x, y, img, xOffset, yOffset, nExtraForDot, </span>
                rClr, gClr, bClr);
<span class="nc" id="L2379">        }</span>
<span class="nc" id="L2380">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>