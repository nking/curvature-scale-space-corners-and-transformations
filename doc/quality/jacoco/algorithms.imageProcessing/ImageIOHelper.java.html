<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ImageIOHelper.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Jacoco Report</a> &gt; <a href="index.source.html" class="el_package">algorithms.imageProcessing</a> &gt; <span class="el_source">ImageIOHelper.java</span></div><h1>ImageIOHelper.java</h1><pre class="source lang-java linenums">package algorithms.imageProcessing;

import algorithms.compGeometry.BresenhamsLine;
import algorithms.imageProcessing.features.CornerRegion;
import algorithms.imageProcessing.features.FeatureComparisonStat;
import algorithms.imageProcessing.scaleSpace.CurvatureScaleSpaceContour;
import algorithms.imageProcessing.scaleSpace.CurvatureScaleSpaceImagePoint;
import algorithms.imageProcessing.scaleSpace.ScaleSpaceCurve;
import algorithms.util.PairFloatArray;
import algorithms.util.PairInt;
import algorithms.util.PairIntArray;
import algorithms.util.ResourceFinder;
import gnu.trove.TIntCollection;
import gnu.trove.iterator.TIntIterator;
import gnu.trove.iterator.TIntObjectIterator;
import gnu.trove.map.TIntObjectMap;
import gnu.trove.set.TIntSet;
import java.awt.Color;
import java.awt.color.ColorSpace;
import java.awt.image.BufferedImage;
import java.awt.image.ColorConvertOp;
import java.awt.image.Raster;
import java.awt.image.WritableRaster;
import java.io.File;
import java.io.IOException;
import java.nio.file.Path;
import java.util.ArrayList;
import java.util.Collection;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.Map.Entry;
import java.util.Set;
import java.util.logging.Logger;
import javax.imageio.ImageIO;
import javax.imageio.ImageReadParam;
import javax.imageio.ImageReader;
import javax.imageio.stream.FileImageInputStream;
import javax.swing.ImageIcon;

/**
 *
 * @author nichole
 */
<span class="pc" id="L47">public class ImageIOHelper {</span>

    public static Image readImage(String filePath) throws IOException {
     
<span class="pc bpc" id="L51" title="1 of 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L52">            throw new IllegalStateException(&quot;filePath cannot be null&quot;);</span>
        }
                
        try {
<span class="fc" id="L56">            File file = new File(filePath);</span>
<span class="pc bpc" id="L57" title="1 of 2 branches missed.">            if (!file.exists()) {</span>
<span class="nc" id="L58">                throw new IllegalStateException(filePath + &quot; does not exist&quot;);</span>
            }
            
<span class="fc" id="L61">            String lstPth = null;</span>
<span class="fc" id="L62">            Iterator&lt;Path&gt; iter0 = file.toPath().iterator();</span>
<span class="fc bfc" id="L63" title="All 2 branches covered.">            while (iter0.hasNext()) {</span>
<span class="fc" id="L64">                lstPth = iter0.next().toString();</span>
            }
            
<span class="pc bpc" id="L67" title="1 of 4 branches missed.">            if (lstPth.endsWith(&quot;jpg&quot;) || lstPth.endsWith(&quot;jpeg&quot;) </span>
<span class="pc bpc" id="L68" title="2 of 4 branches missed.">                || lstPth.endsWith(&quot;jPG&quot;) || lstPth.endsWith(&quot;JPEG&quot;)) {</span>
<span class="fc" id="L69">                return readJPEGImage(filePath);</span>
            }
            
            BufferedImage img;
<span class="pc bpc" id="L73" title="1 of 4 branches missed.">            if (filePath.endsWith(&quot;png&quot;) || filePath.endsWith(&quot;PNG&quot;)) {</span>
<span class="fc" id="L74">                ImageIcon imageIcon = new ImageIcon(filePath);</span>
<span class="fc" id="L75">                java.awt.Image tmpImage = imageIcon.getImage();</span>

<span class="fc" id="L77">                img = new BufferedImage(</span>
<span class="fc" id="L78">                    imageIcon.getIconWidth(), imageIcon.getIconHeight(), BufferedImage.TYPE_INT_ARGB);</span>
<span class="fc" id="L79">                img.getGraphics().drawImage(tmpImage, 0, 0, null);</span>
<span class="fc" id="L80">                tmpImage.flush();</span>
<span class="fc" id="L81">            } else {</span>
<span class="fc" id="L82">                img = ImageIO.read(file);</span>
            }
            
            //System.out.println(&quot;imageType=&quot; + img.getType());
            
<span class="fc" id="L87">            int h = img.getHeight();</span>
<span class="fc" id="L88">            int w = img.getWidth();</span>
            
<span class="fc" id="L90">            Image image = new Image(w, h);</span>
            
<span class="fc" id="L92">            convertImage(img, image);</span>
            
<span class="fc" id="L94">            return image;</span>
            
<span class="nc" id="L96">        } catch (IOException e) {</span>
        }
        
<span class="nc" id="L99">        return null;</span>
    }
    
    public static Image readJPEGImage(String filePath) throws IOException {
     
<span class="pc bpc" id="L104" title="1 of 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L105">            throw new IllegalStateException(&quot;filePath cannot be null&quot;);</span>
        }
                
<span class="fc" id="L108">        File file = null;</span>
        
<span class="fc" id="L110">        FileImageInputStream in = null;</span>
        
        try {
<span class="fc" id="L113">            file = new File(filePath);</span>
<span class="pc bpc" id="L114" title="1 of 2 branches missed.">            if (!file.exists()) {</span>
<span class="nc" id="L115">                throw new IllegalStateException(filePath + &quot; does not exist&quot;);</span>
            }
            
<span class="fc" id="L118">            String lstPth = null;</span>
<span class="fc" id="L119">            Iterator&lt;Path&gt; iter0 = file.toPath().iterator();</span>
<span class="fc bfc" id="L120" title="All 2 branches covered.">            while (iter0.hasNext()) {</span>
<span class="fc" id="L121">                lstPth = iter0.next().toString();</span>
            }
            
<span class="pc bnc" id="L124" title="All 4 branches missed.">            assert(lstPth.endsWith(&quot;jpg&quot;) || lstPth.endsWith(&quot;jpeg&quot;) </span>
<span class="nc bnc" id="L125" title="All 4 branches missed.">                || lstPth.endsWith(&quot;jPG&quot;) || lstPth.endsWith(&quot;JPEG&quot;));</span>
            
<span class="fc" id="L127">            in = new FileImageInputStream(file);</span>
            
<span class="fc" id="L129">            Iterator&lt;ImageReader&gt; iter = </span>
<span class="fc" id="L130">                ImageIO.getImageReadersByMIMEType(&quot;image/jpeg&quot;);</span>
                    
<span class="fc" id="L132">            Image output = null;</span>
            
<span class="pc bpc" id="L134" title="1 of 2 branches missed.">            while (iter.hasNext()) {</span>
                
<span class="fc" id="L136">                ImageReader rdr = iter.next();</span>
<span class="fc" id="L137">                System.out.println(&quot;jpegreader instance &quot; + </span>
<span class="fc" id="L138">                    rdr.getClass().getName());</span>
                
<span class="fc" id="L140">                rdr.setInput(in);</span>
                
<span class="fc" id="L142">                ImageReadParam rdrParam = rdr.getDefaultReadParam();</span>
               
<span class="fc" id="L144">                int nImages = rdr.getNumImages(true);</span>
                
<span class="fc" id="L146">                System.out.println(&quot;nJPEG bands=&quot; + nImages);</span>
                
<span class="pc bnc" id="L148" title="All 2 branches missed.">                assert(nImages &gt;= 1);</span>
                                
<span class="fc" id="L150">                int w = rdr.getWidth(0);</span>
<span class="fc" id="L151">                int h = rdr.getHeight(0);</span>
                                
<span class="fc" id="L153">                output = new Image(w, h);</span>
                
<span class="fc" id="L155">                BufferedImage im = rdr.read(0, rdrParam);</span>
                
<span class="fc" id="L157">                int[] col = new int[w];</span>
<span class="fc" id="L158">                int offset = 0;</span>
<span class="fc bfc" id="L159" title="All 2 branches covered.">                for (int y = 0; y &lt; h; ++y) {</span>
<span class="fc" id="L160">                    im.getRGB(0, y, w, 1, col, offset, 1);</span>
<span class="fc bfc" id="L161" title="All 2 branches covered.">                    for (int x = 0; x &lt; w; ++x) {</span>
<span class="fc" id="L162">                        int rgb = col[x];</span>
                        
<span class="fc" id="L164">                        int r = (rgb &gt;&gt; 16) &amp; 0xFF;</span>
<span class="fc" id="L165">                        int g = (rgb &gt;&gt; 8) &amp; 0xFF;</span>
<span class="fc" id="L166">                        int b = rgb &amp; 0xFF;</span>

<span class="fc" id="L168">                        output.setRGB(x, y, r, g, b);</span>
                    }
                }
               
<span class="fc" id="L172">                return output;</span>
            }
          
<span class="nc" id="L175">            return output;</span>
            
<span class="nc" id="L177">        } catch (IOException e) {</span>
      
<span class="nc" id="L179">            System.err.println(e.getMessage());</span>
            
<span class="nc bnc" id="L181" title="All 2 branches missed.">            if (in != null) {</span>
<span class="nc" id="L182">                in.close();</span>
            }
        }

<span class="nc" id="L186">        return null;        </span>
    }
    
    public static GreyscaleImage readImageAsGreyscaleFullRange(String filePath) 
        throws IOException {
     
<span class="pc bpc" id="L192" title="1 of 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L193">            throw new IllegalStateException(&quot;filePath cannot be null&quot;);</span>
        }
                
        try {
<span class="fc" id="L197">            File file = new File(filePath);</span>
<span class="pc bpc" id="L198" title="1 of 2 branches missed.">            if (!file.exists()) {</span>
<span class="nc" id="L199">                throw new IllegalStateException(filePath + &quot; does not exist&quot;);</span>
            }
            
            BufferedImage img;
<span class="pc bpc" id="L203" title="1 of 4 branches missed.">            if (filePath.endsWith(&quot;png&quot;) || filePath.endsWith(&quot;PNG&quot;)) {</span>
<span class="fc" id="L204">                ImageIcon imageIcon = new ImageIcon(filePath);</span>
<span class="fc" id="L205">                java.awt.Image tmpImage = imageIcon.getImage();</span>

<span class="fc" id="L207">                img = new BufferedImage(</span>
<span class="fc" id="L208">                    imageIcon.getIconWidth(), imageIcon.getIconHeight(), BufferedImage.TYPE_INT_ARGB);</span>
<span class="fc" id="L209">                img.getGraphics().drawImage(tmpImage, 0, 0, null);</span>
<span class="fc" id="L210">                tmpImage.flush();</span>
<span class="fc" id="L211">            } else {</span>
<span class="fc" id="L212">                img = ImageIO.read(file);</span>
            }
            
            //System.out.println(&quot;imageType=&quot; + img.getType());
            
<span class="fc" id="L217">            int h = img.getHeight();</span>
<span class="fc" id="L218">            int w = img.getWidth();</span>
            
<span class="fc" id="L220">            ColorSpace cs = ColorSpace.getInstance(ColorSpace.CS_GRAY);  </span>
<span class="fc" id="L221">            ColorConvertOp op = new ColorConvertOp(cs, null);</span>
            try {
<span class="fc" id="L223">                BufferedImage image2 = op.filter(img, null);</span>
<span class="fc" id="L224">                img = image2;</span>
<span class="nc" id="L225">            } catch (NullPointerException e) {</span>
                // if type is custom, the source color space destination is not defined.
<span class="fc" id="L227">            } </span>
            
<span class="fc" id="L229">            GreyscaleImage image = new GreyscaleImage(w, h, </span>
                GreyscaleImage.Type.Bits32FullRangeInt);
                        
<span class="fc bfc" id="L232" title="All 2 branches covered.">            for (int i = 0; i &lt; w; i++) {</span>
<span class="fc bfc" id="L233" title="All 2 branches covered.">                for (int j = 0; j &lt; h; j++) {</span>
                    
<span class="fc" id="L235">                    int rgb = img.getRGB(i, j);</span>
                                        
<span class="fc" id="L237">                    int g = (rgb &gt;&gt; 8) &amp; 0xFF;</span>
                    
<span class="fc" id="L239">                    image.setValue(i, j, g);</span>
                }
            }
                        
<span class="fc" id="L243">            return image;</span>
            
<span class="nc" id="L245">        } catch (IOException e) {</span>
        }
        
<span class="nc" id="L248">        return null;</span>
    }
   
    public static ImageExt readImageExt(String filePath) throws IOException {
     
<span class="pc bpc" id="L253" title="1 of 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L254">            throw new IllegalStateException(&quot;filePath cannot be null&quot;);</span>
        }
            
        try {
<span class="fc" id="L258">            File file = new File(filePath);</span>
<span class="pc bpc" id="L259" title="1 of 2 branches missed.">            if (!file.exists()) {</span>
<span class="nc" id="L260">                throw new IllegalStateException(filePath + &quot; does not exist&quot;);</span>
            }
            
            BufferedImage img;
<span class="pc bpc" id="L264" title="1 of 4 branches missed.">            if (filePath.endsWith(&quot;png&quot;) || filePath.endsWith(&quot;PNG&quot;)) {</span>
<span class="fc" id="L265">                ImageIcon imageIcon = new ImageIcon(filePath);</span>
<span class="fc" id="L266">                java.awt.Image tmpImage = imageIcon.getImage();</span>

<span class="fc" id="L268">                img = new BufferedImage(</span>
<span class="fc" id="L269">                    imageIcon.getIconWidth(), imageIcon.getIconHeight(), BufferedImage.TYPE_INT_ARGB);</span>
<span class="fc" id="L270">                img.getGraphics().drawImage(tmpImage, 0, 0, null);</span>
<span class="fc" id="L271">                tmpImage.flush();</span>
<span class="fc" id="L272">            } else {</span>
<span class="fc" id="L273">                img = ImageIO.read(file);</span>
            }
            
            //System.out.println(&quot;imageType=&quot; + img.getType());
            
<span class="fc" id="L278">            int h = img.getHeight();</span>
<span class="fc" id="L279">            int w = img.getWidth();</span>
            
<span class="fc" id="L281">            ImageExt image = new ImageExt(w, h);</span>
            
<span class="fc" id="L283">            convertImage(img, image);</span>
            
<span class="fc" id="L285">            return image;</span>
            
<span class="nc" id="L287">        } catch (IOException e) {</span>
        }
        
<span class="nc" id="L290">        return null;</span>
    }
    
    private static void convertImage(BufferedImage fromImage, Image toImage) 
        throws IOException {
     
<span class="pc bpc" id="L296" title="1 of 2 branches missed.">        if (fromImage == null) {</span>
<span class="nc" id="L297">            return;</span>
        }
               
<span class="fc" id="L300">        int h = fromImage.getHeight();</span>
<span class="fc" id="L301">        int w = fromImage.getWidth();</span>

<span class="fc bfc" id="L303" title="All 2 branches covered.">        for (int i = 0; i &lt; w; i++) {</span>
<span class="fc bfc" id="L304" title="All 2 branches covered.">            for (int j = 0; j &lt; h; j++) {</span>

                //TYPE_INT_RGB) and default sRGB colorspace
<span class="fc" id="L307">                int rgb = fromImage.getRGB(i, j);</span>

<span class="fc" id="L309">                int r = (rgb &gt;&gt; 16) &amp; 0xFF;</span>
<span class="fc" id="L310">                int g = (rgb &gt;&gt; 8) &amp; 0xFF;</span>
<span class="fc" id="L311">                int b = rgb &amp; 0xFF;</span>

<span class="fc" id="L313">                toImage.setRGB(i, j, r, g, b);</span>
            }
        }
<span class="fc" id="L316">    }</span>
    
    public static ImageExt convertImage(GreyscaleImage fromImage) {
     
<span class="nc bnc" id="L320" title="All 2 branches missed.">        if (fromImage == null) {</span>
<span class="nc" id="L321">            return null;</span>
        }
        
<span class="nc" id="L324">        int h = fromImage.getHeight();</span>
<span class="nc" id="L325">        int w = fromImage.getWidth();</span>

<span class="nc" id="L327">        ImageExt toImage = new ImageExt(w, h);</span>
                
<span class="nc bnc" id="L329" title="All 2 branches missed.">        for (int i = 0; i &lt; w; i++) {</span>
<span class="nc bnc" id="L330" title="All 2 branches missed.">            for (int j = 0; j &lt; h; j++) {</span>
                
<span class="nc" id="L332">                int v = fromImage.getValue(i, j);</span>

<span class="nc" id="L334">                toImage.setRGB(i, j, v, v, v);</span>
            }
        }
        
<span class="nc" id="L338">        return toImage;</span>
    }
    
    /**
     * 
     * @param filePath
     * @return
     * @throws Exception 
     */
    public static GreyscaleImage readImageAsGrayScaleG(String filePath) 
        throws IOException {
     
<span class="pc bpc" id="L350" title="1 of 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L351">            throw new IllegalStateException(&quot;filePath cannot be null&quot;);</span>
        }
                
        try {
<span class="fc" id="L355">            File file = new File(filePath);</span>
<span class="pc bpc" id="L356" title="1 of 2 branches missed.">            if (!file.exists()) {</span>
<span class="nc" id="L357">                throw new IllegalStateException(filePath + &quot; does not exist&quot;);</span>
            }
            
            BufferedImage img;
<span class="pc bpc" id="L361" title="1 of 4 branches missed.">            if (filePath.endsWith(&quot;png&quot;) || filePath.endsWith(&quot;PNG&quot;)) {</span>
<span class="fc" id="L362">                ImageIcon imageIcon = new ImageIcon(filePath);</span>
<span class="fc" id="L363">                java.awt.Image tmpImage = imageIcon.getImage();</span>

<span class="fc" id="L365">                img = new BufferedImage(</span>
<span class="fc" id="L366">                    imageIcon.getIconWidth(), imageIcon.getIconHeight(), BufferedImage.TYPE_INT_ARGB);</span>
<span class="fc" id="L367">                img.getGraphics().drawImage(tmpImage, 0, 0, null);</span>
<span class="fc" id="L368">                tmpImage.flush();</span>
<span class="fc" id="L369">            } else {</span>
<span class="fc" id="L370">                img = ImageIO.read(file);</span>
            }
            
<span class="fc" id="L373">            ColorSpace cs = ColorSpace.getInstance(ColorSpace.CS_GRAY);  </span>
<span class="fc" id="L374">            ColorConvertOp op = new ColorConvertOp(cs, null);</span>
            try {
<span class="fc" id="L376">                BufferedImage image2 = op.filter(img, null);</span>
<span class="fc" id="L377">                img = image2;</span>
<span class="nc" id="L378">            } catch (NullPointerException e) {</span>
                // if type is custom, the source color space destination is not defined.
<span class="fc" id="L380">            }       </span>
<span class="fc" id="L381">            int h = img.getHeight();</span>
<span class="fc" id="L382">            int w = img.getWidth();</span>
            
<span class="fc" id="L384">            GreyscaleImage image = new GreyscaleImage(w, h);</span>
<span class="fc bfc" id="L385" title="All 2 branches covered.">            for (int i = 0; i &lt; w; i++) {</span>
<span class="fc bfc" id="L386" title="All 2 branches covered.">                for (int j = 0; j &lt; h; j++) {</span>
                    
<span class="fc" id="L388">                    int rgb = img.getRGB(i, j);</span>
                                        
<span class="fc" id="L390">                    int g = (rgb &gt;&gt; 8) &amp; 0xFF;</span>
                    
<span class="fc" id="L392">                    image.setValue(i, j, g);</span>
                }
            }
            
<span class="fc" id="L396">            return image;</span>
            
<span class="nc" id="L398">        } catch (IOException e) {</span>
        }
        
<span class="nc" id="L401">        return null;</span>
    }
    
    /**
     * read the Red channel of the image at filePath into a single channel
     * GreyscaleImage image.
     * 
     * @param filePath
     * @return
     * @throws Exception 
     */
    public static GreyscaleImage readImageAsGrayScaleR(String filePath) 
        throws IOException {
     
<span class="nc bnc" id="L415" title="All 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L416">            throw new IllegalStateException(&quot;filePath cannot be null&quot;);</span>
        }
                
        try {
<span class="nc" id="L420">            File file = new File(filePath);</span>
<span class="nc bnc" id="L421" title="All 2 branches missed.">            if (!file.exists()) {</span>
<span class="nc" id="L422">                throw new IllegalStateException(filePath + &quot; does not exist&quot;);</span>
            }
            
            BufferedImage img;
<span class="nc bnc" id="L426" title="All 4 branches missed.">            if (filePath.endsWith(&quot;png&quot;) || filePath.endsWith(&quot;PNG&quot;)) {</span>
<span class="nc" id="L427">                ImageIcon imageIcon = new ImageIcon(filePath);</span>
<span class="nc" id="L428">                java.awt.Image tmpImage = imageIcon.getImage();</span>

<span class="nc" id="L430">                img = new BufferedImage(</span>
<span class="nc" id="L431">                    imageIcon.getIconWidth(), imageIcon.getIconHeight(), BufferedImage.TYPE_INT_ARGB);</span>
<span class="nc" id="L432">                img.getGraphics().drawImage(tmpImage, 0, 0, null);</span>
<span class="nc" id="L433">                tmpImage.flush();</span>
<span class="nc" id="L434">            } else {</span>
<span class="nc" id="L435">                img = ImageIO.read(file);</span>
            }
                       
<span class="nc" id="L438">            ColorSpace cs = ColorSpace.getInstance(ColorSpace.CS_GRAY);  </span>
<span class="nc" id="L439">            ColorConvertOp op = new ColorConvertOp(cs, null);</span>
            try {
<span class="nc" id="L441">                BufferedImage image2 = op.filter(img, null);</span>
<span class="nc" id="L442">                img = image2;</span>
<span class="nc" id="L443">            } catch (NullPointerException e) {</span>
                // if type is custom, the source color space destination is not defined.
<span class="nc" id="L445">            }       </span>
<span class="nc" id="L446">            int h = img.getHeight();</span>
<span class="nc" id="L447">            int w = img.getWidth();</span>
            
<span class="nc" id="L449">            GreyscaleImage image = new GreyscaleImage(w, h);</span>
<span class="nc bnc" id="L450" title="All 2 branches missed.">            for (int i = 0; i &lt; w; i++) {</span>
<span class="nc bnc" id="L451" title="All 2 branches missed.">                for (int j = 0; j &lt; h; j++) {</span>
                    
<span class="nc" id="L453">                    int rgb = img.getRGB(i, j);</span>
                                        
<span class="nc" id="L455">                    int r = (rgb &gt;&gt; 16) &amp; 0xFF;</span>
                    
<span class="nc" id="L457">                    image.setValue(i, j, r);</span>
                }
            }
            
<span class="nc" id="L461">            return image;</span>
            
<span class="nc" id="L463">        } catch (IOException e) {</span>
        }
        
<span class="nc" id="L466">        return null;</span>
    }
    
    /**
     * read the Blue channel of the image at filePath into a single channel
     * GreyscaleImage image.
     * 
     * @param filePath
     * @return
     * @throws Exception 
     */
    public static GreyscaleImage readImageAsGrayScaleB(String filePath) 
        throws IOException {
     
<span class="nc bnc" id="L480" title="All 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L481">            throw new IllegalStateException(&quot;filePath cannot be null&quot;);</span>
        }
                
        try {
<span class="nc" id="L485">            File file = new File(filePath);</span>
<span class="nc bnc" id="L486" title="All 2 branches missed.">            if (!file.exists()) {</span>
<span class="nc" id="L487">                throw new IllegalStateException(filePath + &quot; does not exist&quot;);</span>
            }
            
            BufferedImage img;
<span class="nc bnc" id="L491" title="All 4 branches missed.">            if (filePath.endsWith(&quot;png&quot;) || filePath.endsWith(&quot;PNG&quot;)) {</span>
<span class="nc" id="L492">                ImageIcon imageIcon = new ImageIcon(filePath);</span>
<span class="nc" id="L493">                java.awt.Image tmpImage = imageIcon.getImage();</span>

<span class="nc" id="L495">                img = new BufferedImage(</span>
<span class="nc" id="L496">                    imageIcon.getIconWidth(), imageIcon.getIconHeight(), BufferedImage.TYPE_INT_ARGB);</span>
<span class="nc" id="L497">                img.getGraphics().drawImage(tmpImage, 0, 0, null);</span>
<span class="nc" id="L498">                tmpImage.flush();</span>
<span class="nc" id="L499">            } else {</span>
<span class="nc" id="L500">                img = ImageIO.read(file);</span>
            }
                       
<span class="nc" id="L503">            ColorSpace cs = ColorSpace.getInstance(ColorSpace.CS_GRAY);  </span>
<span class="nc" id="L504">            ColorConvertOp op = new ColorConvertOp(cs, null);</span>
            try {
<span class="nc" id="L506">                BufferedImage image2 = op.filter(img, null);</span>
<span class="nc" id="L507">                img = image2;</span>
<span class="nc" id="L508">            } catch (NullPointerException e) {</span>
                // if type is custom, the source color space destination is not defined.
<span class="nc" id="L510">            }       </span>
<span class="nc" id="L511">            int h = img.getHeight();</span>
<span class="nc" id="L512">            int w = img.getWidth();</span>
            
<span class="nc" id="L514">            GreyscaleImage image = new GreyscaleImage(w, h);</span>
<span class="nc bnc" id="L515" title="All 2 branches missed.">            for (int i = 0; i &lt; w; i++) {</span>
<span class="nc bnc" id="L516" title="All 2 branches missed.">                for (int j = 0; j &lt; h; j++) {</span>
                    
<span class="nc" id="L518">                    int rgb = img.getRGB(i, j);</span>
                                        
<span class="nc" id="L520">                    int b = rgb &amp; 0xFF;</span>
                    
<span class="nc" id="L522">                    image.setValue(i, j, b);</span>
                }
            }
            
<span class="nc" id="L526">            return image;</span>
            
<span class="nc" id="L528">        } catch (IOException e) {</span>
<span class="nc" id="L529">            Logger.getLogger(ImageIOHelper.class.getName()).severe(e.getMessage());</span>
        }
        
<span class="nc" id="L532">        return null;</span>
    }
    
    /**
     * read image at filePath into a greyscale image.
     * 
     * @param filePath
     * @return
     * @throws IOException 
     */
    public static Image readImageAsGrayScale(String filePath) 
        throws IOException {
     
<span class="pc bpc" id="L545" title="1 of 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L546">            throw new IllegalStateException(&quot;filePath cannot be null&quot;);</span>
        }
                
        try {
<span class="fc" id="L550">            File file = new File(filePath);</span>
<span class="pc bpc" id="L551" title="1 of 2 branches missed.">            if (!file.exists()) {</span>
<span class="nc" id="L552">                throw new IllegalStateException(filePath + &quot; does not exist&quot;);</span>
            }
            
            BufferedImage img;
<span class="pc bpc" id="L556" title="1 of 4 branches missed.">            if (filePath.endsWith(&quot;png&quot;) || filePath.endsWith(&quot;PNG&quot;)) {</span>
<span class="fc" id="L557">                ImageIcon imageIcon = new ImageIcon(filePath);</span>
<span class="fc" id="L558">                java.awt.Image tmpImage = imageIcon.getImage();</span>

<span class="fc" id="L560">                img = new BufferedImage(</span>
<span class="fc" id="L561">                    imageIcon.getIconWidth(), imageIcon.getIconHeight(), BufferedImage.TYPE_INT_ARGB);</span>
<span class="fc" id="L562">                img.getGraphics().drawImage(tmpImage, 0, 0, null);</span>
<span class="fc" id="L563">                tmpImage.flush();</span>
<span class="fc" id="L564">            } else {</span>
<span class="fc" id="L565">                img = ImageIO.read(file);</span>
            }

            //ImageDisplayer.displayDisposableImage(&quot;buffered&quot;, img);

<span class="fc" id="L570">            ColorSpace cs = ColorSpace.getInstance(ColorSpace.CS_GRAY);  </span>
<span class="fc" id="L571">            ColorConvertOp op = new ColorConvertOp(cs, null);</span>
            try {
<span class="fc" id="L573">                BufferedImage image2 = op.filter(img, null);</span>
<span class="fc" id="L574">                img = image2;</span>
 
                //ImageDisplayer.displayDisposableImage(&quot;buffered2&quot;, img);
 
<span class="nc" id="L578">            } catch (NullPointerException e) {</span>
                // if type is custom, the source color space destination is not defined.
<span class="fc" id="L580">            }       </span>
<span class="fc" id="L581">            int h = img.getHeight();</span>
<span class="fc" id="L582">            int w = img.getWidth();</span>
            
<span class="fc" id="L584">            Image image = new Image(w, h);</span>
<span class="fc bfc" id="L585" title="All 2 branches covered.">            for (int i = 0; i &lt; w; i++) {</span>
<span class="fc bfc" id="L586" title="All 2 branches covered.">                for (int j = 0; j &lt; h; j++) {</span>
                    
<span class="fc" id="L588">                    int rgb = img.getRGB(i, j);</span>
                    
<span class="fc" id="L590">                    int r = (rgb &gt;&gt; 16) &amp; 0xFF;</span>
<span class="fc" id="L591">                    int g = (rgb &gt;&gt; 8) &amp; 0xFF;</span>
<span class="fc" id="L592">                    int b = rgb &amp; 0xFF;         </span>
                    
<span class="fc" id="L594">                    image.setRGB(i, j, r, g, b);</span>
                }
            }
       
            //ImageDisplayer.displayImageGrey(&quot;image&quot;, image);
       
<span class="fc" id="L600">            return image;</span>
            
<span class="nc" id="L602">        } catch (IOException e) {</span>
        }
        
<span class="nc" id="L605">        return null;</span>
    }
    
    /**
     * read image at filePath into a greyscale image with assumptions that pixel
     * value '0' is '0' and anything else gets stored in output as a '1'.
     * 
     * @param filePath
     * @return
     * @throws Exception 
     */
    public static GreyscaleImage readImageAsBinary(String filePath) 
        throws IOException {
     
<span class="pc bpc" id="L619" title="1 of 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L620">            throw new IllegalStateException(&quot;filePath cannot be null&quot;);</span>
        }
                
        try {
<span class="fc" id="L624">            File file = new File(filePath);</span>
<span class="pc bpc" id="L625" title="1 of 2 branches missed.">            if (!file.exists()) {</span>
<span class="nc" id="L626">                throw new IllegalStateException(filePath + &quot; does not exist&quot;);</span>
            }
            
            BufferedImage img;
<span class="pc bpc" id="L630" title="3 of 4 branches missed.">            if (filePath.endsWith(&quot;png&quot;) || filePath.endsWith(&quot;PNG&quot;)) {</span>
<span class="fc" id="L631">                ImageIcon imageIcon = new ImageIcon(filePath);</span>
<span class="fc" id="L632">                java.awt.Image tmpImage = imageIcon.getImage();</span>

<span class="fc" id="L634">                img = new BufferedImage(</span>
<span class="fc" id="L635">                    imageIcon.getIconWidth(), imageIcon.getIconHeight(), BufferedImage.TYPE_INT_ARGB);</span>
<span class="fc" id="L636">                img.getGraphics().drawImage(tmpImage, 0, 0, null);</span>
<span class="fc" id="L637">                tmpImage.flush();</span>
<span class="fc" id="L638">            } else {</span>
<span class="nc" id="L639">                img = ImageIO.read(file);</span>
            }
                 
<span class="fc" id="L642">            int h = img.getHeight();</span>
<span class="fc" id="L643">            int w = img.getWidth();</span>
           
<span class="fc" id="L645">            Raster raster = img.getData();</span>
            
<span class="fc" id="L647">            GreyscaleImage image = new GreyscaleImage(w, h);</span>
            
<span class="fc" id="L649">            int[] data = null;</span>
<span class="fc bfc" id="L650" title="All 2 branches covered.">            for (int i = 0; i &lt; w; i++) {</span>
<span class="fc bfc" id="L651" title="All 2 branches covered.">                for (int j = 0; j &lt; h; j++) {</span>
<span class="fc" id="L652">                    data = raster.getPixel(i, j, data);</span>
<span class="fc" id="L653">                    int value = data[0];</span>
<span class="fc" id="L654">                    image.setValue(i, j, value);</span>
                }
            }
            
<span class="fc" id="L658">            return image;</span>
            
<span class="nc" id="L660">        } catch (IOException e) {</span>
        }
        
<span class="nc" id="L663">        return null;</span>
    }
    
    /**
     * 
     * @param filePath
     * @return
     * @throws Exception 
     */
    public static GreyscaleImage readImageAsGrayScaleAvgRGB(String filePath)
        throws IOException {
     
<span class="pc bpc" id="L675" title="1 of 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L676">            throw new IllegalStateException(&quot;filePath cannot be null&quot;);</span>
        }
                
        try {
<span class="fc" id="L680">            File file = new File(filePath);</span>
<span class="pc bpc" id="L681" title="1 of 2 branches missed.">            if (!file.exists()) {</span>
<span class="nc" id="L682">                throw new IllegalStateException(filePath + &quot; does not exist&quot;);</span>
            }
            
            BufferedImage img;
<span class="pc bpc" id="L686" title="1 of 4 branches missed.">            if (filePath.endsWith(&quot;png&quot;) || filePath.endsWith(&quot;PNG&quot;)) {</span>
<span class="fc" id="L687">                ImageIcon imageIcon = new ImageIcon(filePath);</span>
<span class="fc" id="L688">                java.awt.Image tmpImage = imageIcon.getImage();</span>

<span class="fc" id="L690">                img = new BufferedImage(</span>
<span class="fc" id="L691">                    imageIcon.getIconWidth(), imageIcon.getIconHeight(), BufferedImage.TYPE_INT_ARGB);</span>
<span class="fc" id="L692">                img.getGraphics().drawImage(tmpImage, 0, 0, null);</span>
<span class="fc" id="L693">                tmpImage.flush();</span>
<span class="fc" id="L694">            } else {</span>
<span class="fc" id="L695">                img = ImageIO.read(file);</span>
            }
            
<span class="fc" id="L698">            ColorSpace cs = ColorSpace.getInstance(ColorSpace.CS_GRAY);  </span>
<span class="fc" id="L699">            ColorConvertOp op = new ColorConvertOp(cs, null);  </span>
            try {
<span class="fc" id="L701">                BufferedImage image2 = op.filter(img, null);</span>
<span class="fc" id="L702">                img = image2;</span>
<span class="nc" id="L703">            } catch (NullPointerException e) {</span>
                // if type is custom, the source color space destination is not defined.
<span class="fc" id="L705">            }</span>
                        
<span class="fc" id="L707">            int h = img.getHeight();</span>
<span class="fc" id="L708">            int w = img.getWidth();</span>
            
<span class="fc" id="L710">            GreyscaleImage image = new GreyscaleImage(w, h);</span>
<span class="fc bfc" id="L711" title="All 2 branches covered.">            for (int i = 0; i &lt; w; i++) {</span>
<span class="fc bfc" id="L712" title="All 2 branches covered.">                for (int j = 0; j &lt; h; j++) {</span>
                    
<span class="fc" id="L714">                    int rgb = img.getRGB(i, j);</span>
                                        
<span class="fc" id="L716">                    int r = (rgb &gt;&gt; 16) &amp; 0xFF;</span>
<span class="fc" id="L717">                    int g = (rgb &gt;&gt; 8) &amp; 0xFF;</span>
<span class="fc" id="L718">                    int b = rgb &amp; 0xFF;</span>
<span class="fc" id="L719">                    float v = (r + g + b)/3.f;</span>
                    
<span class="fc" id="L721">                    image.setValue(i, j, (int)v);</span>
                }
            }
            
<span class="fc" id="L725">            return image;</span>
            
<span class="nc" id="L727">        } catch (IOException e) {</span>
        }
        
<span class="nc" id="L730">        return null;</span>
    }
    
    public static String writeOutputImage(String filePath, Image data) 
        throws IOException {
        
<span class="fc" id="L736">        return writeOutputImage(filePath, data,  BufferedImage.TYPE_INT_RGB);       </span>
    }
    
    public static String writeOutputImage(String filePath, Image data, 
        final int imageType) throws IOException {
                
<span class="pc bpc" id="L742" title="1 of 2 branches missed.">        if (data == null) {</span>
<span class="nc" id="L743">            return &quot;&quot;;</span>
        }
<span class="pc bpc" id="L745" title="1 of 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L746">            throw new IllegalArgumentException(&quot;filePath cannot be null&quot;);</span>
        }
        
<span class="fc" id="L749">        int w = data.getWidth();</span>
        
<span class="fc" id="L751">        int h = data.getHeight();</span>
        
<span class="fc" id="L753">        BufferedImage outputImage = new BufferedImage(w, h, </span>
            BufferedImage.TYPE_INT_RGB);
        
<span class="fc bfc" id="L756" title="All 2 branches covered.">        for (int i = 0; i &lt; w; i++) {</span>
<span class="fc bfc" id="L757" title="All 2 branches covered.">            for (int j = 0; j &lt; h; j++) {</span>
<span class="fc" id="L758">                int rgbValue = data.getRGB(i, j);</span>
<span class="fc" id="L759">                outputImage.setRGB(i, j, rgbValue);</span>
            }
        }
        
<span class="fc" id="L763">        ImageIO.write(outputImage, &quot;PNG&quot;, new File(filePath));</span>
        
<span class="fc" id="L765">        return filePath.toString();</span>
    }
    
    public static void writeOutputImage(String filePath, GreyscaleImage data) 
        throws IOException {
                
<span class="pc bpc" id="L771" title="1 of 2 branches missed.">        if (data == null) {</span>
<span class="nc" id="L772">            return;</span>
        }
<span class="pc bpc" id="L774" title="1 of 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L775">            throw new IllegalArgumentException(&quot;filePath cannot be null&quot;);</span>
        }
        
<span class="fc" id="L778">        int w = data.getWidth();</span>
        
<span class="fc" id="L780">        int h = data.getHeight();</span>
        
<span class="fc" id="L782">        BufferedImage outputImage = new BufferedImage(w, h, </span>
            BufferedImage.TYPE_BYTE_GRAY);
        
<span class="fc" id="L785">        WritableRaster raster = outputImage.getRaster();</span>
        
<span class="fc bfc" id="L787" title="All 2 branches covered.">        for (int i = 0; i &lt; w; i++) {</span>
            
<span class="fc bfc" id="L789" title="All 2 branches covered.">            for (int j = 0; j &lt; h; j++) {</span>
                
<span class="fc" id="L791">                int value = data.getValue(i, j);</span>
                
<span class="fc" id="L793">                raster.setSample(i, j, 0, value);</span>
            }
        }
        
<span class="fc" id="L797">        ImageIO.write(outputImage, &quot;PNG&quot;, new File(filePath));</span>
<span class="fc" id="L798">    }</span>
    
    public static void writeOutputGreyscaleImage(String filePath, Image data) 
        throws IOException {
                
<span class="nc bnc" id="L803" title="All 2 branches missed.">        if (data == null) {</span>
<span class="nc" id="L804">            return;</span>
        }
<span class="nc bnc" id="L806" title="All 2 branches missed.">        if (filePath == null) {</span>
<span class="nc" id="L807">            throw new IllegalArgumentException(&quot;filePath cannot be null&quot;);</span>
        }
        
<span class="nc" id="L810">        int w = data.getWidth();</span>
        
<span class="nc" id="L812">        int h = data.getHeight();</span>
        
<span class="nc" id="L814">        BufferedImage outputImage = new BufferedImage(w, h, </span>
            BufferedImage.TYPE_BYTE_GRAY);
        
<span class="nc" id="L817">        WritableRaster raster = outputImage.getRaster();</span>
        
<span class="nc bnc" id="L819" title="All 2 branches missed.">        for (int i = 0; i &lt; w; i++) {</span>
            
<span class="nc bnc" id="L821" title="All 2 branches missed.">            for (int j = 0; j &lt; h; j++) {</span>
                
<span class="nc" id="L823">                int rgb = data.getRGB(i, j);</span>
                
<span class="nc" id="L825">                int r = (rgb &gt;&gt; 16) &amp; 0xFF;</span>
<span class="nc" id="L826">                int g = (rgb &gt;&gt; 8) &amp; 0xFF;</span>
<span class="nc" id="L827">                int b = rgb &amp; 0xFF;  </span>
                
                // from wikipedia, srgb conversion
<span class="nc" id="L830">                double yLinear = 0.2126 * r + 0.7152 * g + 0.0722 * b;</span>
                /*if (yLinear &gt; 0.0031308) {
                    yLinear = 1.033 * Math.pow(yLinear, 1./2.4) - 0.055f;
                } else {
                    yLinear *= 12.92;
                }*/
<span class="nc" id="L836">                int v = (int)Math.round(yLinear);</span>
                
<span class="nc" id="L838">                raster.setSample(i, j, 0, v);</span>
            }
        }
        
<span class="nc" id="L842">        ImageIO.write(outputImage, &quot;PNG&quot;, new File(filePath));</span>
<span class="nc" id="L843">    }</span>
    
    /**
     * draw the edges over input and mark the corners.  The edges are drawn
     * in rotating colors to make it easier to see closed curves.
     * The corners are drawn in red dots of size 2. For best results, the
     * input image should be greyscale.
     * @param input
     * @param edges
     * @param corners
     * @param fileName
     * @param width
     * @param height
     * @throws IOException 
     */
    public static void writeImage(Image input, PairIntArray[] edges, 
        PairIntArray corners, String fileName, int width, int height) throws 
        IOException {
                
<span class="nc bnc" id="L862" title="All 6 branches missed.">        if (edges == null || input == null || corners == null) {</span>
<span class="nc" id="L863">            return;</span>
        }
<span class="nc bnc" id="L865" title="All 2 branches missed.">        if (fileName == null) {</span>
<span class="nc" id="L866">            throw new IllegalArgumentException(&quot;fileName cannot be null&quot;);</span>
        }
        
<span class="nc" id="L869">        addAlternatingColorCurvesToImage(edges, fileName, false, input);</span>
                
<span class="nc" id="L871">        addCurveToImage(corners, input, 1, 255, 0, 0);</span>
        
<span class="nc" id="L873">        String dirPath = ResourceFinder.findDirectory(&quot;bin&quot;);</span>
       
<span class="nc" id="L875">        ImageIOHelper.writeOutputImage(dirPath + &quot;/&quot; + fileName, input);</span>
<span class="nc" id="L876">    }</span>
    
    public static void addContoursToImage(List&lt;CurvatureScaleSpaceContour&gt; result, 
        ImageExt img, int xOffset, int yOffset,
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="nc bnc" id="L882" title="All 2 branches missed.">        if (result.isEmpty()) {</span>
<span class="nc" id="L883">            return;</span>
        }
        
<span class="nc bnc" id="L886" title="All 2 branches missed.">        for (int i = 0; i &lt; result.size(); i++) {</span>
            
<span class="nc" id="L888">            CurvatureScaleSpaceContour cssC = result.get(i);</span>
            
<span class="nc" id="L890">            addContoursToImage(cssC, img, xOffset, yOffset, nExtraForDot, </span>
                rClr, gClr, bClr);
        }
<span class="nc" id="L893">    }</span>
    
    public static void addContoursToImage(CurvatureScaleSpaceContour contour, 
        ImageExt img, int xOffset, int yOffset,
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="nc bnc" id="L899" title="All 2 branches missed.">        if (contour == null) {</span>
<span class="nc" id="L900">            return;</span>
        }
                    
<span class="nc" id="L903">        CurvatureScaleSpaceImagePoint[] peakDetails = contour.getPeakDetails();</span>

<span class="nc bnc" id="L905" title="All 2 branches missed.">        for (CurvatureScaleSpaceImagePoint peakDetail : peakDetails) {</span>
            
<span class="nc" id="L907">            int x = peakDetail.getXCoord() + xOffset;</span>
<span class="nc" id="L908">            int y = peakDetail.getYCoord() + yOffset;</span>
            
<span class="nc" id="L910">            addPointToImage(x, y, img, xOffset, yOffset, nExtraForDot, </span>
                rClr, gClr, bClr);
        }            
<span class="nc" id="L913">    }</span>
    
    public static void addPointToImage(final int x, final int y, 
        Image img, int xOffset, int yOffset,
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="nc bnc" id="L919" title="All 2 branches missed.">        for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
<span class="nc" id="L920">            float xx = x + dx;</span>
<span class="nc bnc" id="L921" title="All 4 branches missed.">            if ((xx &gt; -1) &amp;&amp; (xx &lt; (img.getWidth() - 1))) {</span>
<span class="nc bnc" id="L922" title="All 2 branches missed.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); </span>
<span class="nc" id="L923">                    dy++) {</span>
<span class="nc" id="L924">                    float yy = y + dy;</span>
<span class="nc bnc" id="L925" title="All 4 branches missed.">                    if ((yy &gt; -1) &amp;&amp; (yy &lt; (img.getHeight() - 1))) {</span>
<span class="nc" id="L926">                        img.setRGB((int)xx, (int)yy, rClr, gClr, bClr);</span>
                    }
                }
            }
        }
<span class="nc" id="L931">    }</span>
    
    private static PairFloatArray getXYOfContourPeaks(
        List&lt;CurvatureScaleSpaceContour&gt; contours, int xOffset, int yOffset) {
        
<span class="nc" id="L936">        PairFloatArray xy = new PairFloatArray();</span>
        
<span class="nc bnc" id="L938" title="All 2 branches missed.">        for (int i = 0; i &lt; contours.size(); ++i) {</span>
            
<span class="nc" id="L940">            CurvatureScaleSpaceContour contour = contours.get(i);</span>
            
<span class="nc" id="L942">            CurvatureScaleSpaceImagePoint[] peakDetails = contour.getPeakDetails();</span>
            
<span class="nc bnc" id="L944" title="All 2 branches missed.">            for (CurvatureScaleSpaceImagePoint peakDetail : peakDetails) {</span>
<span class="nc" id="L945">                int x = peakDetail.getXCoord() + xOffset;</span>
<span class="nc" id="L946">                int y = peakDetail.getYCoord() + yOffset;</span>
<span class="nc" id="L947">                xy.add(x, y);</span>
            }
        }
        
<span class="nc" id="L951">        return xy;</span>
    }
    
    /**
     * draw the edge over the image using the given rgb colors and the size
     * of the dot beyond 1 pixel.
     * 
     * @param edge
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void addCurveToImage(PairIntArray edge, Image input, 
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="pc bpc" id="L968" title="2 of 4 branches missed.">        if (edge == null || input == null) {</span>
<span class="nc" id="L969">            return;</span>
        }
        
<span class="fc" id="L972">        int w = input.getWidth();</span>
<span class="fc" id="L973">        int h = input.getHeight();</span>
        
<span class="fc bfc" id="L975" title="All 2 branches covered.">        for (int i = 0; i &lt; edge.getN(); i++) {</span>
<span class="fc" id="L976">            int x = edge.getX(i);</span>
<span class="fc" id="L977">            int y = edge.getY(i);</span>
            
<span class="fc bfc" id="L979" title="All 2 branches covered.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
                
<span class="fc" id="L981">                int xx = x + dx;</span>
                
<span class="fc bfc" id="L983" title="All 4 branches covered.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="fc" id="L984">                    continue;</span>
                }
<span class="fc bfc" id="L986" title="All 2 branches covered.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="fc" id="L987">                    int yy = y + dy;</span>
<span class="fc bfc" id="L988" title="All 4 branches covered.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="fc" id="L989">                        continue;</span>
                    }
<span class="fc" id="L991">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
        }
<span class="fc" id="L995">    }</span>
    
    /**
     * draw the edge over the image using the given rgb colors and the size
     * of the dot beyond 1 pixel.
     * 
     * @param pixIdxs
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void addCurveToImage(TIntCollection pixIdxs, Image input, 
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="pc bpc" id="L1011" title="2 of 4 branches missed.">        if (pixIdxs == null || input == null) {</span>
<span class="nc" id="L1012">            return;</span>
        }
        
<span class="fc" id="L1015">        int w = input.getWidth();</span>
<span class="fc" id="L1016">        int h = input.getHeight();</span>
        
<span class="fc" id="L1018">        TIntIterator iter = pixIdxs.iterator();</span>
<span class="fc bfc" id="L1019" title="All 2 branches covered.">        while (iter.hasNext()) {</span>
            
<span class="fc" id="L1021">            int pixIdx = iter.next();</span>
            
<span class="fc" id="L1023">            int y = pixIdx/w;</span>
<span class="fc" id="L1024">            int x = pixIdx - (y * w);</span>
            
<span class="fc bfc" id="L1026" title="All 2 branches covered.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
                
<span class="fc" id="L1028">                int xx = x + dx;</span>
                
<span class="pc bpc" id="L1030" title="2 of 4 branches missed.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L1031">                    continue;</span>
                }
<span class="fc bfc" id="L1033" title="All 2 branches covered.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="fc" id="L1034">                    int yy = y + dy;</span>
<span class="pc bpc" id="L1035" title="2 of 4 branches missed.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L1036">                        continue;</span>
                    }
<span class="fc" id="L1038">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
<span class="fc" id="L1041">        }</span>
<span class="fc" id="L1042">    }</span>
    
    /**
     * draw the edge over the image using the given rgb colors and the size
     * of the dot beyond 1 pixel.
     * 
     * @param points
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void addCurveToImage(Collection&lt;PairInt&gt; points, Image input, 
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="pc bpc" id="L1058" title="2 of 4 branches missed.">        if (points == null || input == null) {</span>
<span class="nc" id="L1059">            return;</span>
        }
        
<span class="fc" id="L1062">        int w = input.getWidth();</span>
<span class="fc" id="L1063">        int h = input.getHeight();</span>
        
<span class="fc bfc" id="L1065" title="All 2 branches covered.">        for (PairInt p : points) {</span>
<span class="fc" id="L1066">            int x = p.getX();</span>
<span class="fc" id="L1067">            int y = p.getY();</span>
            
<span class="fc bfc" id="L1069" title="All 2 branches covered.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
                
<span class="fc" id="L1071">                int xx = x + dx;</span>
                
<span class="pc bpc" id="L1073" title="2 of 4 branches missed.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L1074">                    continue;</span>
                }
<span class="fc bfc" id="L1076" title="All 2 branches covered.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="fc" id="L1077">                    int yy = y + dy;</span>
<span class="pc bpc" id="L1078" title="2 of 4 branches missed.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L1079">                        continue;</span>
                    }
<span class="fc" id="L1081">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
<span class="fc" id="L1084">        }</span>
<span class="fc" id="L1085">    }</span>
    
    /**
     * draw the edge over the image using the given rgb colors and the size
     * of the dot beyond 1 pixel.
     * 
     * @param pointGroups
     * @param input
     * @param nExtraForDot
     */
    public static &lt;T extends Collection&lt;PairInt&gt;&gt; void addAlternatingColorCurvesToImage0(
        List&lt;T&gt; pointGroups, Image input, int nExtraForDot) {
        
<span class="nc bnc" id="L1098" title="All 4 branches missed.">        if (pointGroups == null || input == null) {</span>
<span class="nc" id="L1099">            return;</span>
        }
        
<span class="nc bnc" id="L1102" title="All 2 branches missed.">        for (int i = 0; i &lt; pointGroups.size(); ++i) {</span>
            
<span class="nc" id="L1104">            int[] clr = getNextRGB(i);</span>
            
<span class="nc" id="L1106">            addCurveToImage(pointGroups.get(i), input, nExtraForDot,</span>
                clr[0], clr[1], clr[2]);
        }
        
<span class="nc" id="L1110">    }</span>
    
    /**
     * draw the edge over the image using the given rgb colors and the size
     * of the dot beyond 1 pixel.
     * 
     * @param pointGroups
     * @param input
     * @param nExtraForDot
     */
    public static void addAlternatingColorCurvesToImage3(
        List&lt;TIntSet&gt; pointGroups, Image input, int nExtraForDot) {
        
<span class="nc bnc" id="L1123" title="All 4 branches missed.">        if (pointGroups == null || input == null) {</span>
<span class="nc" id="L1124">            return;</span>
        }
        
<span class="nc bnc" id="L1127" title="All 2 branches missed.">        for (int i = 0; i &lt; pointGroups.size(); ++i) {</span>
            
<span class="nc" id="L1129">            int[] clr = getNextRGB(i);</span>
            
<span class="nc" id="L1131">            addCurveToImage(pointGroups.get(i), input, nExtraForDot,</span>
                clr[0], clr[1], clr[2]);
        }
        
<span class="nc" id="L1135">    }</span>
    
    /**
     * draw lines from points at index i to index i+1 
     * in the requested color onto the input.
     * 
     * @param xVertexes
     * @param yVertexes
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void drawLinesInImage(
        int[] xVertexes, int[] yVertexes, 
        Image input, int nExtraForDot, 
        int rClr, int gClr, int bClr) {
        
<span class="nc bnc" id="L1154" title="All 6 branches missed.">        if (xVertexes == null || yVertexes == null || input == null) {</span>
<span class="nc" id="L1155">            return;</span>
        }
<span class="nc bnc" id="L1157" title="All 2 branches missed.">        if (xVertexes.length != yVertexes.length) {</span>
<span class="nc" id="L1158">            return;</span>
        }
        
<span class="nc" id="L1161">        int w = input.getWidth();</span>
<span class="nc" id="L1162">        int h = input.getHeight();</span>
        
<span class="nc bnc" id="L1164" title="All 2 branches missed.">        for (int i = 0; i &lt; (xVertexes.length - 1); i++) {</span>
            
<span class="nc" id="L1166">            int x1 = xVertexes[i];</span>
<span class="nc" id="L1167">            int y1 = yVertexes[i];</span>
            
<span class="nc" id="L1169">            int x2 = xVertexes[i + 1];</span>
<span class="nc" id="L1170">            int y2 = yVertexes[i + 1];</span>
            
<span class="nc" id="L1172">            drawLineInImage(x1, y1, x2, y2, input, </span>
                nExtraForDot, rClr, gClr, bClr);
        }
<span class="nc" id="L1175">    }</span>
    
    /**
     * draw lines from points at index i to index i+1 in the requested color
     * onto the input.
     * 
     * @param x1
     * @param y1
     * @param x2
     * @param y2
     * @param input
     * @param nExtraForDot
     */
    public static void drawLineInImage(int x1, int y1, 
        int x2, int y2,
        Image input, int nExtraForDot, int rgbClr) {
        
<span class="nc" id="L1192">        int r = (rgbClr &gt;&gt; 16) &amp; 0xFF;</span>
<span class="nc" id="L1193">        int g = (rgbClr &gt;&gt; 8) &amp; 0xFF;</span>
<span class="nc" id="L1194">        int b = rgbClr &amp; 0xFF;</span>
        
<span class="nc" id="L1196">        drawLineInImage(x1, y1, x2, y2, input, nExtraForDot, r, g, b);</span>
<span class="nc" id="L1197">    }</span>
    
    /**
     * draw lines from points at index i to index i+1 in the requested color
     * onto the input.
     * 
     * @param x1
     * @param y1
     * @param x2
     * @param y2
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void drawLineInImage(int x1, int y1, 
        int x2, int y2,
        Image input, int nExtraForDot, int rClr, int gClr, 
        int bClr) {
        
<span class="fc" id="L1218">        int w = input.getWidth();</span>
<span class="fc" id="L1219">        int h = input.getHeight();</span>

<span class="fc" id="L1221">        Set&lt;PairInt&gt; output = new HashSet&lt;PairInt&gt;();</span>
        
<span class="fc" id="L1223">        BresenhamsLine.createLinePoints(x1, y1, x2, y2,</span>
            output);
        
<span class="fc bfc" id="L1226" title="All 2 branches covered.">        for (PairInt p : output) {</span>

<span class="fc" id="L1228">            int x = p.getX();</span>
<span class="fc" id="L1229">            int y = p.getY();</span>
            
<span class="fc bfc" id="L1231" title="All 2 branches covered.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); </span>
<span class="fc" id="L1232">                dx++) {</span>

<span class="fc" id="L1234">                int xx = x + dx;</span>

<span class="pc bpc" id="L1236" title="2 of 4 branches missed.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L1237">                    continue;</span>
                }
<span class="fc bfc" id="L1239" title="All 2 branches covered.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="fc" id="L1240">                    int yy = y + dy;</span>
<span class="pc bpc" id="L1241" title="2 of 4 branches missed.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L1242">                        continue;</span>
                    }
<span class="fc" id="L1244">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
<span class="fc" id="L1247">        }</span>
<span class="fc" id="L1248">    }</span>
    
    /**
     * draw lines from points at index i to index i+1 in the requested color
     * onto the input.
     * 
     * @param x1
     * @param y1
     * @param x2
     * @param y2
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void drawLineInImage(int x1, int y1, 
        int x2, int y2, Image input, int nExtraForDot, int gapLength,
        int rClr, int gClr, int bClr) {
        
<span class="fc" id="L1268">        int w = input.getWidth();</span>
<span class="fc" id="L1269">        int h = input.getHeight();</span>

<span class="fc" id="L1271">        Set&lt;PairInt&gt; output = new HashSet&lt;PairInt&gt;();</span>
        
<span class="fc" id="L1273">        BresenhamsLine.createLinePoints(x1, y1, x2, y2, gapLength,</span>
            output);
        
<span class="fc bfc" id="L1276" title="All 2 branches covered.">        for (PairInt p : output) {</span>

<span class="fc" id="L1278">            int x = p.getX();</span>
<span class="fc" id="L1279">            int y = p.getY();</span>
            
<span class="fc bfc" id="L1281" title="All 2 branches covered.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); </span>
<span class="fc" id="L1282">                dx++) {</span>

<span class="fc" id="L1284">                int xx = x + dx;</span>

<span class="pc bpc" id="L1286" title="2 of 4 branches missed.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L1287">                    continue;</span>
                }
<span class="fc bfc" id="L1289" title="All 2 branches covered.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="fc" id="L1290">                    int yy = y + dy;</span>
<span class="pc bpc" id="L1291" title="2 of 4 branches missed.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L1292">                        continue;</span>
                    }
<span class="fc" id="L1294">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
<span class="fc" id="L1297">        }</span>
<span class="fc" id="L1298">    }</span>
    
    /**
     * draw lines from points at index i to index i+1 in the requested color
     * onto the input.
     * 
     * @param xVertexes
     * @param yVertexes
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void addCurveToImage(int[] xVertexes, int[] yVertexes, 
        Image input, int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="nc bnc" id="L1315" title="All 6 branches missed.">        if (xVertexes == null || yVertexes == null || input == null) {</span>
<span class="nc" id="L1316">            return;</span>
        }
<span class="nc bnc" id="L1318" title="All 2 branches missed.">        if (xVertexes.length != yVertexes.length) {</span>
<span class="nc" id="L1319">            return;</span>
        }
        
<span class="nc" id="L1322">        int w = input.getWidth();</span>
<span class="nc" id="L1323">        int h = input.getHeight();</span>
        
<span class="nc bnc" id="L1325" title="All 2 branches missed.">        for (int i = 0; i &lt; xVertexes.length; i++) {</span>
            
<span class="nc" id="L1327">            int x = xVertexes[i];</span>
<span class="nc" id="L1328">            int y = yVertexes[i];</span>
            
<span class="nc bnc" id="L1330" title="All 2 branches missed.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>

<span class="nc" id="L1332">                int xx = x + dx;</span>

<span class="nc bnc" id="L1334" title="All 4 branches missed.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L1335">                    continue;</span>
                }
<span class="nc bnc" id="L1337" title="All 2 branches missed.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L1338">                    int yy = y + dy;</span>
<span class="nc bnc" id="L1339" title="All 4 branches missed.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L1340">                        continue;</span>
                    }
<span class="nc" id="L1342">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
        }
<span class="nc" id="L1346">    }</span>
    
    /**
     * draw the edge over the image using the given rgb colors and the size
     * of the dot beyond 1 pixel.
     * 
     * @param edge
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void addCurveToImage(PairFloatArray edge, Image input, 
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="nc bnc" id="L1362" title="All 4 branches missed.">        if (edge == null || input == null) {</span>
<span class="nc" id="L1363">            return;</span>
        }
        
<span class="nc" id="L1366">        int w = input.getWidth();</span>
<span class="nc" id="L1367">        int h = input.getHeight();</span>
        
<span class="nc bnc" id="L1369" title="All 2 branches missed.">        for (int i = 0; i &lt; edge.getN(); i++) {</span>
<span class="nc" id="L1370">            int x = Math.round(edge.getX(i));</span>
<span class="nc" id="L1371">            int y = Math.round(edge.getY(i));</span>
            
<span class="nc bnc" id="L1373" title="All 2 branches missed.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
                
<span class="nc" id="L1375">                int xx = x + dx;</span>
                
<span class="nc bnc" id="L1377" title="All 4 branches missed.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L1378">                    continue;</span>
                }
<span class="nc bnc" id="L1380" title="All 2 branches missed.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L1381">                    int yy = y + dy;</span>
<span class="nc bnc" id="L1382" title="All 4 branches missed.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L1383">                        continue;</span>
                    }
<span class="nc" id="L1385">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
        }
<span class="nc" id="L1389">    }</span>
    
    /**
     * draw the point over the image using the given rgb colors and the size
     * of the dot beyond 1 pixel.
     * 
     * @param x of point (NOTE that if the points are from a row major reference frame,
     *          you will want to use 'y' here instead).
     * @param y of point (NOTE that if the points are from a row major reference frame,
     *      *          you will want to use 'x' here instead).
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void addPointToImage(int x, int y, Image input, 
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="fc" id="L1408">        int w = input.getWidth();</span>
<span class="fc" id="L1409">        int h = input.getHeight();</span>
        
<span class="fc bfc" id="L1411" title="All 2 branches covered.">        for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>

<span class="fc" id="L1413">            int xx = x + dx;</span>

<span class="fc bfc" id="L1415" title="All 4 branches covered.">            if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="fc" id="L1416">                continue;</span>
            }
<span class="fc bfc" id="L1418" title="All 2 branches covered.">            for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="fc" id="L1419">                int yy = y + dy;</span>
<span class="pc bpc" id="L1420" title="1 of 4 branches missed.">                if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L1421">                    continue;</span>
                }
<span class="fc" id="L1423">                input.setRGB(xx, yy, rClr, gClr, bClr);</span>
            }
        }
<span class="fc" id="L1426">    }</span>
    /**
     * draw the point over the image using the given rgb colors and the size
     * of the dot beyond 1 pixel.
     * 
     * @param x of point
     * @param y of point
     * @param input
     * @param nExtraForDot
     * @param rgbClr
     */
    public static void addPointToImage(int x, int y, Image input, 
        int nExtraForDot, int rgbClr) {
        
<span class="nc" id="L1440">        int w = input.getWidth();</span>
<span class="nc" id="L1441">        int h = input.getHeight();</span>
        
<span class="nc bnc" id="L1443" title="All 2 branches missed.">        for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>

<span class="nc" id="L1445">            int xx = x + dx;</span>

<span class="nc bnc" id="L1447" title="All 4 branches missed.">            if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L1448">                continue;</span>
            }
<span class="nc bnc" id="L1450" title="All 2 branches missed.">            for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L1451">                int yy = y + dy;</span>
<span class="nc bnc" id="L1452" title="All 4 branches missed.">                if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L1453">                    continue;</span>
                }
<span class="nc" id="L1455">                input.setRGB(xx, yy, rgbClr);</span>
            }
        }
<span class="nc" id="L1458">    }</span>
    
    /**
     * draw the point over the image using the given rgb colors and the size
     * of the dot beyond 1 pixel.
     * 
     * @param x of point
     * @param y of point
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void addPointToImage(float x, float y, Image input, 
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="fc" id="L1475">        int w = input.getWidth();</span>
<span class="fc" id="L1476">        int h = input.getHeight();</span>
        
<span class="fc bfc" id="L1478" title="All 2 branches covered.">        for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>

<span class="fc" id="L1480">            int xx = Math.round(x + dx);</span>

<span class="pc bpc" id="L1482" title="2 of 4 branches missed.">            if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L1483">                continue;</span>
            }
<span class="fc bfc" id="L1485" title="All 2 branches covered.">            for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="fc" id="L1486">                int yy = Math.round(y + dy);</span>
<span class="pc bpc" id="L1487" title="2 of 4 branches missed.">                if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L1488">                    continue;</span>
                }
<span class="fc" id="L1490">                input.setRGB(xx, yy, rClr, gClr, bClr);</span>
            }
        }
<span class="fc" id="L1493">    }</span>
    
    /**
     * draw the edge over the image using the given rgb colors and the size
     * of the dot beyond 1 pixel.
     * 
     * @param edgeX x points of pair (edgeX, edgeY)
     * @param edgeY y points of pair (edgeX, edgeY)
     * @param nPointsInEdge number of points in edgeX 
     * @param input
     * @param nExtraForDot
     * @param rClr
     * @param gClr
     * @param bClr 
     */
    public static void addCurveToImage(int[] edgeX, int[] edgeY, 
        final int nPointsInEdge, Image input, int nExtraForDot, int rClr, 
        int gClr, int bClr) {
        
<span class="nc bnc" id="L1512" title="All 4 branches missed.">        if (edgeX == null || edgeY == null) {</span>
<span class="nc" id="L1513">            return;</span>
        }
<span class="nc bnc" id="L1515" title="All 2 branches missed.">        if (edgeX.length != edgeY.length) {</span>
<span class="nc" id="L1516">            throw new IllegalArgumentException(</span>
                &quot;edgeX and edgeY should be same length&quot;);
        }
        
<span class="nc" id="L1520">        int w = input.getWidth();</span>
<span class="nc" id="L1521">        int h = input.getHeight();</span>
        
<span class="nc bnc" id="L1523" title="All 2 branches missed.">        for (int i = 0; i &lt; nPointsInEdge; i++) {</span>
            
<span class="nc" id="L1525">            int x = edgeX[i];</span>
<span class="nc" id="L1526">            int y = edgeY[i];</span>
            
<span class="nc bnc" id="L1528" title="All 2 branches missed.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
                
<span class="nc" id="L1530">                int xx = x + dx;</span>
                
<span class="nc bnc" id="L1532" title="All 4 branches missed.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L1533">                    continue;</span>
                }
<span class="nc bnc" id="L1535" title="All 2 branches missed.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L1536">                    int yy = y + dy;</span>
<span class="nc bnc" id="L1537" title="All 4 branches missed.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L1538">                        continue;</span>
                    }
<span class="nc" id="L1540">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
        }
<span class="nc" id="L1544">    }</span>
    
    public static void addAlternatingColorCurvesToImage(
        PairIntArray[] curves, String fileName, boolean writeImage, 
        Image input) throws IOException {
        
<span class="nc bnc" id="L1550" title="All 4 branches missed.">        if (curves == null || input == null) {</span>
<span class="nc" id="L1551">            return;</span>
        }
<span class="nc bnc" id="L1553" title="All 2 branches missed.">        if (fileName == null) {</span>
<span class="nc" id="L1554">            throw new IllegalArgumentException(&quot;fileName cannot be null&quot;);</span>
        }
        
<span class="nc" id="L1557">        List&lt;PairIntArray&gt; c = new ArrayList&lt;PairIntArray&gt;();</span>
        
<span class="nc bnc" id="L1559" title="All 2 branches missed.">        for (PairIntArray a : curves) {</span>
<span class="nc" id="L1560">            c.add(a);</span>
        }
        
<span class="nc" id="L1563">        addAlternatingColorCurvesToImage(c, fileName, writeImage, input);</span>
<span class="nc" id="L1564">    }</span>
    
    public static void addAlternatingColorLabelsToRegion(Image img, int[] labels) {
    
<span class="fc" id="L1568">        int nPixels = img.getNPixels();</span>
        
<span class="pc bpc" id="L1570" title="1 of 2 branches missed.">        if (labels.length != nPixels) {</span>
<span class="nc" id="L1571">            throw new IllegalArgumentException(</span>
                &quot;labels.length should == img.nPixels&quot;);
        }
        
<span class="fc" id="L1575">        Map&lt;Integer, Integer&gt; labelColorMap = new HashMap&lt;Integer, Integer&gt;();</span>
        
<span class="fc" id="L1577">        int count = 0;</span>
        
<span class="fc bfc" id="L1579" title="All 2 branches covered.">        for (int i = 0; i &lt; nPixels; ++i) {</span>
            
<span class="fc" id="L1581">            int label = labels[i];</span>
            
<span class="fc" id="L1583">            Integer key = Integer.valueOf(label);            </span>
            
<span class="fc" id="L1585">            Integer clr = labelColorMap.get(key);</span>
            
<span class="fc bfc" id="L1587" title="All 2 branches covered.">            if (clr == null) {</span>
                                
<span class="fc" id="L1589">                clr = Integer.valueOf(getNextColorRGB(count));</span>
                
<span class="fc" id="L1591">                labelColorMap.put(key, clr);</span>
<span class="fc" id="L1592">                count++;</span>
            }
            
<span class="fc" id="L1595">            img.setRGB(img.getCol(i), img.getRow(i), clr);</span>
        }
<span class="fc" id="L1597">    }</span>
    
    public static void addAlternatingColorLabelsToRegion(
        Image img, TIntObjectMap&lt;TIntSet&gt; labelsMap) {
                    
<span class="nc" id="L1602">        TIntObjectIterator&lt;TIntSet&gt; iter = labelsMap.iterator();</span>
<span class="nc bnc" id="L1603" title="All 2 branches missed.">        for (int i = 0; i &lt; labelsMap.size(); ++i) {</span>

<span class="nc" id="L1605">            iter.advance();</span>
            
<span class="nc" id="L1607">            int clr = getNextColorRGB(i);</span>
            
<span class="nc" id="L1609">            TIntSet indexes = iter.value();</span>
<span class="nc" id="L1610">            TIntIterator iter2 = indexes.iterator();</span>
<span class="nc bnc" id="L1611" title="All 2 branches missed.">            while (iter2.hasNext()) {</span>
<span class="nc" id="L1612">                int pixIdx = iter2.next();</span>
<span class="nc" id="L1613">                img.setRGB(img.getCol(pixIdx), </span>
<span class="nc" id="L1614">                    img.getRow(pixIdx), clr);</span>
<span class="nc" id="L1615">            }</span>
        }
<span class="nc" id="L1617">    }</span>
    
    public static void addAlternatingColorPointsToImages(
        Map&lt;PairInt, List&lt;PairInt&gt;&gt; points, Image imgCp1, 
        Image imgCp2, int nExtraForDot) {
        
<span class="nc" id="L1623">        int w1 = imgCp1.getWidth();</span>
<span class="nc" id="L1624">        int h1 = imgCp1.getHeight();</span>
<span class="nc" id="L1625">        int w2 = imgCp2.getWidth();</span>
<span class="nc" id="L1626">        int h2 = imgCp2.getHeight();</span>
        
<span class="nc" id="L1628">        int count = 0;</span>
<span class="nc bnc" id="L1629" title="All 2 branches missed.">        for (Entry&lt;PairInt, List&lt;PairInt&gt;&gt; entry : points.entrySet()) {</span>
<span class="nc" id="L1630">            int clr = getNextColorRGB(count);</span>
<span class="nc" id="L1631">            PairInt p1 = entry.getKey();</span>
<span class="nc" id="L1632">            int x1 = p1.getX();</span>
<span class="nc" id="L1633">            int y1 = p1.getY();</span>
<span class="nc bnc" id="L1634" title="All 2 branches missed.">            for (int dx = (-1 * nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
<span class="nc" id="L1635">                int xx1 = x1 + dx;</span>
<span class="nc bnc" id="L1636" title="All 4 branches missed.">                if ((xx1 &lt; 0) || (xx1 &gt; (w1 - 1))) {</span>
<span class="nc" id="L1637">                    continue;</span>
                }
<span class="nc bnc" id="L1639" title="All 2 branches missed.">                for (int dy = (-1 * nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L1640">                    int yy1 = y1 + dy;</span>
<span class="nc bnc" id="L1641" title="All 4 branches missed.">                    if ((yy1 &lt; 0) || (yy1 &gt; (h1 - 1))) {</span>
<span class="nc" id="L1642">                        continue;</span>
                    }
<span class="nc" id="L1644">                    imgCp1.setRGB(xx1, yy1, clr);</span>
                }
            }                    
<span class="nc bnc" id="L1647" title="All 2 branches missed.">            for (PairInt p2 : entry.getValue()) {</span>
<span class="nc" id="L1648">                int x2 = p2.getX();</span>
<span class="nc" id="L1649">                int y2 = p2.getY();</span>
<span class="nc bnc" id="L1650" title="All 2 branches missed.">                for (int dx = (-1 * nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
<span class="nc" id="L1651">                    int xx2 = x2 + dx;</span>
<span class="nc bnc" id="L1652" title="All 4 branches missed.">                    if ((xx2 &lt; 0) || (xx2 &gt; (w2 - 1))) {</span>
<span class="nc" id="L1653">                        continue;</span>
                    }
<span class="nc bnc" id="L1655" title="All 2 branches missed.">                    for (int dy = (-1 * nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L1656">                        int yy2 = y2 + dy;</span>
<span class="nc bnc" id="L1657" title="All 4 branches missed.">                        if ((yy2 &lt; 0) || (yy2 &gt; (h2 - 1))) {</span>
<span class="nc" id="L1658">                            continue;</span>
                        }
<span class="nc" id="L1660">                        imgCp2.setRGB(xx2, yy2, clr);</span>
                    }
                }
<span class="nc" id="L1663">            }</span>
<span class="nc" id="L1664">            count++;</span>
<span class="nc" id="L1665">        }</span>
<span class="nc" id="L1666">    }</span>
    
    public static void addAlternatingColorPointsToImages(
        List&lt;FeatureComparisonStat&gt; stats, Image imgCp1, 
        Image imgCp2, int nExtraForDot) {
        
<span class="nc" id="L1672">        int w1 = imgCp1.getWidth();</span>
<span class="nc" id="L1673">        int h1 = imgCp1.getHeight();</span>
<span class="nc" id="L1674">        int w2 = imgCp2.getWidth();</span>
<span class="nc" id="L1675">        int h2 = imgCp2.getHeight();</span>
        
<span class="nc" id="L1677">        int count = 0;</span>
<span class="nc bnc" id="L1678" title="All 2 branches missed.">        for (FeatureComparisonStat stat : stats) {</span>
<span class="nc" id="L1679">            int clr = getNextColorRGB(count);</span>
<span class="nc" id="L1680">            PairInt p1 = stat.getImg1Point();</span>
<span class="nc" id="L1681">            PairInt p2 = stat.getImg2Point();</span>
<span class="nc" id="L1682">            int x1 = p1.getX();</span>
<span class="nc" id="L1683">            int y1 = p1.getY();</span>
<span class="nc bnc" id="L1684" title="All 2 branches missed.">            for (int dx = (-1 * nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
<span class="nc" id="L1685">                int xx1 = x1 + dx;</span>
<span class="nc bnc" id="L1686" title="All 4 branches missed.">                if ((xx1 &lt; 0) || (xx1 &gt; (w1 - 1))) {</span>
<span class="nc" id="L1687">                    continue;</span>
                }
<span class="nc bnc" id="L1689" title="All 2 branches missed.">                for (int dy = (-1 * nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L1690">                    int yy1 = y1 + dy;</span>
<span class="nc bnc" id="L1691" title="All 4 branches missed.">                    if ((yy1 &lt; 0) || (yy1 &gt; (h1 - 1))) {</span>
<span class="nc" id="L1692">                        continue;</span>
                    }
<span class="nc" id="L1694">                    imgCp1.setRGB(xx1, yy1, clr);</span>
                }
            }                    
<span class="nc" id="L1697">            int x2 = p2.getX();</span>
<span class="nc" id="L1698">            int y2 = p2.getY();</span>
<span class="nc bnc" id="L1699" title="All 2 branches missed.">            for (int dx = (-1 * nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
<span class="nc" id="L1700">                int xx2 = x2 + dx;</span>
<span class="nc bnc" id="L1701" title="All 4 branches missed.">                if ((xx2 &lt; 0) || (xx2 &gt; (w2 - 1))) {</span>
<span class="nc" id="L1702">                    continue;</span>
                }
<span class="nc bnc" id="L1704" title="All 2 branches missed.">                for (int dy = (-1 * nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L1705">                    int yy2 = y2 + dy;</span>
<span class="nc bnc" id="L1706" title="All 4 branches missed.">                    if ((yy2 &lt; 0) || (yy2 &gt; (h2 - 1))) {</span>
<span class="nc" id="L1707">                        continue;</span>
                    }
<span class="nc" id="L1709">                    imgCp2.setRGB(xx2, yy2, clr);</span>
                }
            }
<span class="nc" id="L1712">            count++;</span>
<span class="nc" id="L1713">        }</span>
<span class="nc" id="L1714">    }</span>
    
    public static void addAlternatingColorCurvesToImage(
        List&lt;PairIntArray&gt; curves, Image input, int nExtraForDot) {
        
<span class="pc bpc" id="L1719" title="2 of 4 branches missed.">        if (curves == null || input == null) {</span>
<span class="nc" id="L1720">            return;</span>
        }
        
<span class="fc" id="L1723">        addAlternatingColorCurvesToImage(</span>
<span class="fc" id="L1724">            curves.toArray(new PairIntArray[curves.size()]),</span>
            input, nExtraForDot);
<span class="fc" id="L1726">    }</span>
    
    public static void addAlternatingColorCurvesToImage(
        List&lt;PairIntArray&gt; curves, Image input, int xOffset, int yOffset,
        int nExtraForDot) {
        
<span class="nc bnc" id="L1732" title="All 4 branches missed.">        if (curves == null || input == null) {</span>
<span class="nc" id="L1733">            return;</span>
        }
        
<span class="nc bnc" id="L1736" title="All 6 branches missed.">        if (curves == null || input == null || curves.isEmpty()) {</span>
<span class="nc" id="L1737">            return;</span>
        }
                
<span class="nc" id="L1740">        int clr = 0;</span>
<span class="nc" id="L1741">        int w = input.getWidth();</span>
<span class="nc" id="L1742">        int h = input.getHeight();</span>
        
<span class="nc bnc" id="L1744" title="All 2 branches missed.">        for (int i = 0; i &lt; curves.size(); i++) {</span>
            
<span class="nc" id="L1746">            PairIntArray edge = curves.get(i);</span>
            
<span class="nc" id="L1748">            int c = getNextColorRGB(clr);</span>
            
<span class="nc bnc" id="L1750" title="All 2 branches missed.">            for (int ii = 0; ii &lt; edge.getN(); ii++) {</span>
                
<span class="nc" id="L1752">                int col = edge.getX(ii) + xOffset;</span>
<span class="nc" id="L1753">                int row = edge.getY(ii) + yOffset;</span>
                
<span class="nc bnc" id="L1755" title="All 2 branches missed.">                for (int dx = (-1 * nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
<span class="nc" id="L1756">                    int xx = col + dx;</span>
<span class="nc bnc" id="L1757" title="All 4 branches missed.">                    if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L1758">                        continue;</span>
                    }
<span class="nc bnc" id="L1760" title="All 2 branches missed.">                    for (int dy = (-1 * nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L1761">                        int yy = row + dy;</span>
<span class="nc bnc" id="L1762" title="All 4 branches missed.">                        if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L1763">                            continue;</span>
                        }
<span class="nc" id="L1765">                        input.setRGB(xx, yy, c);</span>
                    }
                }                
            }
<span class="nc" id="L1769">            clr++;</span>
        }
<span class="nc" id="L1771">    }</span>
    
    public static void addAlternatingColorCurvesToImage2(
        List&lt;PairIntArray&gt; curves, Image input, int nExtraForDot) {
        
<span class="nc bnc" id="L1776" title="All 4 branches missed.">        if (curves == null || input == null) {</span>
<span class="nc" id="L1777">            return;</span>
        }
        
<span class="nc" id="L1780">        addAlternatingColorCurvesToImage(</span>
<span class="nc" id="L1781">            curves.toArray(new PairIntArray[curves.size()]),</span>
            input, nExtraForDot);
<span class="nc" id="L1783">    }</span>
    
    public static void addAlternatingColorCurvesToImage(
        List&lt;PairIntArray&gt; curves, Image input) {
        
<span class="pc bpc" id="L1788" title="2 of 4 branches missed.">        if (curves == null || input == null) {</span>
<span class="nc" id="L1789">            return;</span>
        }
        
<span class="fc" id="L1792">        addAlternatingColorCurvesToImage(</span>
<span class="fc" id="L1793">            curves.toArray(new PairIntArray[curves.size()]),</span>
            input, 1);
<span class="fc" id="L1795">    }</span>
    
    public static int getNextColorRGB(int count) {
        
<span class="fc" id="L1799">        int[] c = getNextRGB(count);</span>
        
<span class="fc" id="L1801">        int rgb = (((c[0] &amp; 0x0ff) &lt;&lt; 16) | ((c[1] &amp; 0x0ff) &lt;&lt; 8) | </span>
            (c[2] &amp; 0x0ff));
        
<span class="fc" id="L1804">        return rgb;</span>
    }
    
    /*
    http://graphicdesign.stackexchange.com/questions/3682/where-can-i-find-a-large-palette-set-of-contrasting-colors-for-coloring-many-d
    
    */
    public static int[] getNextRGB(int count) {
        
        //http://godsnotwheregodsnot.blogspot.ru/2013/11/kmeans-color-quantization-seeding.html
<span class="fc" id="L1814">        String[] indexcolors = new String[]{</span>
            &quot;FFFF00&quot;, &quot;1CE6FF&quot;, &quot;FF34FF&quot;, &quot;FF4A46&quot;, &quot;008941&quot;, &quot;006FA6&quot;, &quot;A30059&quot;,
            &quot;FFDBE5&quot;, &quot;7A4900&quot;, &quot;0000A6&quot;, &quot;63FFAC&quot;, &quot;B79762&quot;, &quot;004D43&quot;, &quot;8FB0FF&quot;, &quot;997D87&quot;,
            &quot;5A0007&quot;, &quot;809693&quot;, &quot;FEFFE6&quot;, &quot;1B4400&quot;, &quot;4FC601&quot;, &quot;3B5DFF&quot;, &quot;4A3B53&quot;, &quot;FF2F80&quot;,
            &quot;61615A&quot;, &quot;BA0900&quot;, &quot;6B7900&quot;, &quot;00C2A0&quot;, &quot;FFAA92&quot;, &quot;FF90C9&quot;, &quot;B903AA&quot;, &quot;D16100&quot;,
            &quot;DDEFFF&quot;, &quot;000035&quot;, &quot;7B4F4B&quot;, &quot;A1C299&quot;, &quot;300018&quot;, &quot;0AA6D8&quot;, &quot;013349&quot;, &quot;00846F&quot;,
            &quot;372101&quot;, &quot;FFB500&quot;, &quot;C2FFED&quot;, &quot;A079BF&quot;, &quot;CC0744&quot;, &quot;C0B9B2&quot;, &quot;C2FF99&quot;, &quot;001E09&quot;,
            &quot;00489C&quot;, &quot;6F0062&quot;, &quot;0CBD66&quot;, &quot;EEC3FF&quot;, &quot;456D75&quot;, &quot;B77B68&quot;, &quot;7A87A1&quot;, &quot;788D66&quot;,
            &quot;885578&quot;, &quot;FAD09F&quot;, &quot;FF8A9A&quot;, &quot;D157A0&quot;, &quot;BEC459&quot;, &quot;456648&quot;, &quot;0086ED&quot;, &quot;886F4C&quot;,
            &quot;34362D&quot;, &quot;B4A8BD&quot;, &quot;00A6AA&quot;, &quot;452C2C&quot;, &quot;636375&quot;, &quot;A3C8C9&quot;, &quot;FF913F&quot;, &quot;938A81&quot;,
            &quot;575329&quot;, &quot;00FECF&quot;, &quot;B05B6F&quot;, &quot;8CD0FF&quot;, &quot;3B9700&quot;, &quot;04F757&quot;, &quot;C8A1A1&quot;, &quot;1E6E00&quot;,
            &quot;7900D7&quot;, &quot;A77500&quot;, &quot;6367A9&quot;, &quot;A05837&quot;, &quot;6B002C&quot;, &quot;772600&quot;, &quot;D790FF&quot;, &quot;9B9700&quot;,
            &quot;549E79&quot;, &quot;FFF69F&quot;, &quot;201625&quot;, &quot;72418F&quot;, &quot;BC23FF&quot;, &quot;99ADC0&quot;, &quot;3A2465&quot;, &quot;922329&quot;,
            &quot;5B4534&quot;, &quot;FDE8DC&quot;, &quot;404E55&quot;, &quot;0089A3&quot;, &quot;CB7E98&quot;, &quot;A4E804&quot;, &quot;324E72&quot;, &quot;6A3A4C&quot;,
            &quot;83AB58&quot;, &quot;001C1E&quot;, &quot;D1F7CE&quot;, &quot;004B28&quot;, &quot;C8D0F6&quot;, &quot;A3A489&quot;, &quot;806C66&quot;, &quot;222800&quot;,
            &quot;BF5650&quot;, &quot;E83000&quot;, &quot;66796D&quot;, &quot;DA007C&quot;, &quot;FF1A59&quot;, &quot;8ADBB4&quot;, &quot;1E0200&quot;, &quot;5B4E51&quot;,
            &quot;C895C5&quot;, &quot;320033&quot;, &quot;FF6832&quot;, &quot;66E1D3&quot;, &quot;CFCDAC&quot;, &quot;D0AC94&quot;, &quot;7ED379&quot;, &quot;012C58&quot;,
            &quot;7A7BFF&quot;, &quot;D68E01&quot;, &quot;353339&quot;, &quot;78AFA1&quot;, &quot;FEB2C6&quot;, &quot;75797C&quot;, &quot;837393&quot;, &quot;943A4D&quot;,
            &quot;B5F4FF&quot;, &quot;D2DCD5&quot;, &quot;9556BD&quot;, &quot;6A714A&quot;, &quot;001325&quot;, &quot;02525F&quot;, &quot;0AA3F7&quot;, &quot;E98176&quot;,
            &quot;DBD5DD&quot;, &quot;5EBCD1&quot;, &quot;3D4F44&quot;, &quot;7E6405&quot;, &quot;02684E&quot;, &quot;962B75&quot;, &quot;8D8546&quot;, &quot;9695C5&quot;,
            &quot;E773CE&quot;, &quot;D86A78&quot;, &quot;3E89BE&quot;, &quot;CA834E&quot;, &quot;518A87&quot;, &quot;5B113C&quot;, &quot;55813B&quot;, &quot;E704C4&quot;,
            &quot;00005F&quot;, &quot;A97399&quot;, &quot;4B8160&quot;, &quot;59738A&quot;, &quot;FF5DA7&quot;, &quot;F7C9BF&quot;, &quot;643127&quot;, &quot;513A01&quot;,
            &quot;6B94AA&quot;, &quot;51A058&quot;, &quot;A45B02&quot;, &quot;1D1702&quot;, &quot;E20027&quot;, &quot;E7AB63&quot;, &quot;4C6001&quot;, &quot;9C6966&quot;,
            &quot;64547B&quot;, &quot;97979E&quot;, &quot;006A66&quot;, &quot;391406&quot;, &quot;F4D749&quot;, &quot;0045D2&quot;, &quot;006C31&quot;, &quot;DDB6D0&quot;,
            &quot;7C6571&quot;, &quot;9FB2A4&quot;, &quot;00D891&quot;, &quot;15A08A&quot;, &quot;BC65E9&quot;, &quot;FFFFFE&quot;, &quot;C6DC99&quot;, &quot;203B3C&quot;,
            &quot;671190&quot;, &quot;6B3A64&quot;, &quot;F5E1FF&quot;, &quot;FFA0F2&quot;, &quot;CCAA35&quot;, &quot;374527&quot;, &quot;8BB400&quot;, &quot;797868&quot;,
            &quot;C6005A&quot;, &quot;3B000A&quot;, &quot;C86240&quot;, &quot;29607C&quot;, &quot;402334&quot;, &quot;7D5A44&quot;, &quot;CCB87C&quot;, &quot;B88183&quot;,
            &quot;AA5199&quot;, &quot;B5D6C3&quot;, &quot;A38469&quot;, &quot;9F94F0&quot;, &quot;A74571&quot;, &quot;B894A6&quot;, &quot;71BB8C&quot;, &quot;00B433&quot;,
            &quot;789EC9&quot;, &quot;6D80BA&quot;, &quot;953F00&quot;, &quot;5EFF03&quot;, &quot;E4FFFC&quot;, &quot;1BE177&quot;, &quot;BCB1E5&quot;, &quot;76912F&quot;,
            &quot;003109&quot;, &quot;0060CD&quot;, &quot;D20096&quot;, &quot;895563&quot;, &quot;29201D&quot;, &quot;5B3213&quot;, &quot;A76F42&quot;, &quot;89412E&quot;,
            &quot;1A3A2A&quot;, &quot;494B5A&quot;, &quot;A88C85&quot;, &quot;F4ABAA&quot;, &quot;A3F3AB&quot;, &quot;00C6C8&quot;, &quot;EA8B66&quot;, &quot;958A9F&quot;,
            &quot;BDC9D2&quot;, &quot;9FA064&quot;, &quot;BE4700&quot;, &quot;658188&quot;, &quot;83A485&quot;, &quot;453C23&quot;, &quot;47675D&quot;, &quot;3A3F00&quot;,
            &quot;061203&quot;, &quot;DFFB71&quot;, &quot;868E7E&quot;, &quot;98D058&quot;, &quot;6C8F7D&quot;, &quot;D7BFC2&quot;, &quot;3C3E6E&quot;, &quot;D83D66&quot;,
            &quot;2F5D9B&quot;, &quot;6C5E46&quot;, &quot;D25B88&quot;, &quot;5B656C&quot;, &quot;00B57F&quot;, &quot;545C46&quot;, &quot;866097&quot;, &quot;365D25&quot;,
            &quot;252F99&quot;, &quot;00CCFF&quot;, &quot;674E60&quot;, &quot;FC009C&quot;, &quot;92896B&quot;
        };
        
<span class="fc" id="L1851">        int n = indexcolors.length - 1;</span>
        
<span class="pc bpc" id="L1853" title="1 of 2 branches missed.">        if (count &lt; 0) {</span>
<span class="nc" id="L1854">            count = 0;</span>
        } else {
<span class="fc" id="L1856">            count = count % n;</span>
        }
    
<span class="fc" id="L1859">        String str = indexcolors[count];</span>
        
<span class="fc" id="L1861">        int rgb = Integer.parseInt(str, 16);</span>
<span class="fc" id="L1862">        int r = (rgb &gt;&gt; 16) &amp; 0xFF;</span>
<span class="fc" id="L1863">        int g = (rgb &gt;&gt; 8) &amp; 0xFF;</span>
<span class="fc" id="L1864">        int b = rgb &amp; 0xFF;</span>
                
<span class="fc" id="L1866">        return new int[]{r, g, b};</span>
    }
    
    public static void addAlternatingColorCurvesToImage(
        PairIntArray[] curves, Image input) {
        
<span class="nc bnc" id="L1872" title="All 4 branches missed.">        if (curves == null || input == null) {</span>
<span class="nc" id="L1873">            return;</span>
        }
        
<span class="nc" id="L1876">        int nExtraForDot = 1;</span>
        
<span class="nc" id="L1878">        addAlternatingColorCurvesToImage(curves, input, nExtraForDot);</span>
<span class="nc" id="L1879">    }</span>
    
    public static void addAlternatingColorCurvesToImage(
        PairIntArray[] curves, Image input, int nExtraForDot) {
        
<span class="pc bpc" id="L1884" title="2 of 4 branches missed.">        if (curves == null || input == null) {</span>
<span class="nc" id="L1885">            return;</span>
        }
                
<span class="fc" id="L1888">        int clr = 0;</span>
<span class="fc" id="L1889">        int w = input.getWidth();</span>
<span class="fc" id="L1890">        int h = input.getHeight();</span>
        
<span class="fc bfc" id="L1892" title="All 2 branches covered.">        for (int i = 0; i &lt; curves.length; i++) {</span>
            
<span class="fc" id="L1894">            PairIntArray edge = curves[i];</span>
            
<span class="fc" id="L1896">            int c = getNextColorRGB(clr);</span>
            
<span class="fc bfc" id="L1898" title="All 2 branches covered.">            for (int ii = 0; ii &lt; edge.getN(); ii++) {</span>
                
<span class="fc" id="L1900">                int col = edge.getX(ii);</span>
<span class="fc" id="L1901">                int row = edge.getY(ii);</span>
                
<span class="fc bfc" id="L1903" title="All 2 branches covered.">                for (int dx = (-1 * nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
<span class="fc" id="L1904">                    int xx = col + dx;</span>
<span class="fc bfc" id="L1905" title="All 4 branches covered.">                    if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="fc" id="L1906">                        continue;</span>
                    }
<span class="fc bfc" id="L1908" title="All 2 branches covered.">                    for (int dy = (-1 * nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="fc" id="L1909">                        int yy = row + dy;</span>
<span class="fc bfc" id="L1910" title="All 4 branches covered.">                        if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="fc" id="L1911">                            continue;</span>
                        }
<span class="fc" id="L1913">                        input.setRGB(xx, yy, c);</span>
                    }
                }                
            }
<span class="fc" id="L1917">            clr++;</span>
        }
<span class="fc" id="L1919">    }</span>
    
    public static void addAlternatingColorPointSetsToImage(
        List&lt;Set&lt;PairInt&gt;&gt; pointSets, int xOffset, int yOffset, 
        int nExtraForDot, Image input) {
        
<span class="pc bpc" id="L1925" title="2 of 4 branches missed.">        if (pointSets == null || input == null) {</span>
<span class="nc" id="L1926">            return;</span>
        }
                
<span class="fc bfc" id="L1929" title="All 2 branches covered.">        for (int i = 0; i &lt; pointSets.size(); i++) {</span>
            
<span class="fc" id="L1931">            Set&lt;PairInt&gt; points = pointSets.get(i);</span>
            
<span class="fc" id="L1933">            int[] c = getNextRGB(i);</span>
            
<span class="fc" id="L1935">            addToImage(points, 0, 0, input, nExtraForDot, c[0], c[1], c[2]);</span>
        }
<span class="fc" id="L1937">    }</span>
    
    public static void addAlternatingColorPointSetsToImage2(
        List&lt;TIntSet&gt; pointSets, int xOffset, int yOffset, 
        int nExtraForDot, Image input) {
        
<span class="nc bnc" id="L1943" title="All 4 branches missed.">        if (pointSets == null || input == null) {</span>
<span class="nc" id="L1944">            return;</span>
        }
                
<span class="nc bnc" id="L1947" title="All 2 branches missed.">        for (int i = 0; i &lt; pointSets.size(); i++) {</span>
            
<span class="nc" id="L1949">            TIntSet pIdxs = pointSets.get(i);</span>
            
<span class="nc" id="L1951">            int[] c = getNextRGB(i);</span>
            
<span class="nc" id="L1953">            addToImage(pIdxs, 0, 0, input, nExtraForDot, c[0], c[1], c[2]);</span>
        }
<span class="nc" id="L1955">    }</span>
    
    public static &lt;T extends Collection&lt;PairInt&gt;&gt; void addToImage(
        T points, int xOffsetToApply, int yOffsetToApply, Image input) {
        
<span class="nc bnc" id="L1960" title="All 4 branches missed.">        if (points == null || input == null) {</span>
<span class="nc" id="L1961">            return;</span>
        }
        
<span class="nc" id="L1964">        int w = input.getWidth();</span>
<span class="nc" id="L1965">        int h = input.getHeight();</span>
        
<span class="nc" id="L1967">        int c = Color.BLUE.getRGB();</span>
          
<span class="nc bnc" id="L1969" title="All 2 branches missed.">        for (PairInt p : points) {</span>

<span class="nc" id="L1971">            int col = p.getX() + xOffsetToApply;</span>
<span class="nc" id="L1972">            int row = p.getY() + yOffsetToApply;</span>

<span class="nc bnc" id="L1974" title="All 8 branches missed.">            if ((col &lt; 0) || (row &lt; 0) || (col &gt; (w - 1)) || (row &gt; (h - 1))) {</span>
<span class="nc" id="L1975">                continue;</span>
            }

<span class="nc" id="L1978">            input.setRGB(col, row, c);</span>
<span class="nc" id="L1979">        }</span>
<span class="nc" id="L1980">    }</span>
    
    public static &lt;T extends Collection&lt;PairInt&gt;&gt; void addToImage(
        T points, int xOffsetToApply, 
        int yOffsetToApply, Image input, int rClr, int gClr, int bClr) throws 
        IOException {
        
<span class="nc bnc" id="L1987" title="All 4 branches missed.">        if (points == null || input == null) {</span>
<span class="nc" id="L1988">            return;</span>
        }
        
<span class="nc" id="L1991">        int w = input.getWidth();</span>
<span class="nc" id="L1992">        int h = input.getHeight();</span>
                  
<span class="nc bnc" id="L1994" title="All 2 branches missed.">        for (PairInt p : points) {</span>

<span class="nc" id="L1996">            int col = p.getX() + xOffsetToApply;</span>
<span class="nc" id="L1997">            int row = p.getY() + yOffsetToApply;</span>
            
<span class="nc bnc" id="L1999" title="All 8 branches missed.">            if ((col &lt; 0) || (row &lt; 0) || (col &gt; (w - 1)) || (row &gt; (h - 1))) {</span>
<span class="nc" id="L2000">                continue;</span>
            }

<span class="nc" id="L2003">            input.setRGB(col, row, rClr, gClr, bClr);</span>
<span class="nc" id="L2004">        }</span>
<span class="nc" id="L2005">    }</span>
    
    public static &lt;T extends Collection&lt;PairInt&gt;&gt; void addToImage(
        T points, int xOffsetToApply, 
        int yOffsetToApply, Image input, int nExtraForDot,
        int rClr, int gClr, int bClr) {
        
<span class="pc bpc" id="L2012" title="2 of 4 branches missed.">        if (points == null || input == null) {</span>
<span class="nc" id="L2013">            return;</span>
        }
        
<span class="fc" id="L2016">        int w = input.getWidth();</span>
<span class="fc" id="L2017">        int h = input.getHeight();</span>
                  
<span class="fc bfc" id="L2019" title="All 2 branches covered.">        for (PairInt p : points) {</span>

<span class="fc" id="L2021">            int x = p.getX() + xOffsetToApply;</span>
<span class="fc" id="L2022">            int y = p.getY() + yOffsetToApply;</span>
            
<span class="fc bfc" id="L2024" title="All 2 branches covered.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); ++dx) {</span>
<span class="fc" id="L2025">                int xx = x + dx;</span>
<span class="fc bfc" id="L2026" title="All 4 branches covered.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="fc" id="L2027">                    continue;</span>
                }
<span class="fc bfc" id="L2029" title="All 2 branches covered.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="fc" id="L2030">                    int yy = y + dy;</span>
<span class="fc bfc" id="L2031" title="All 4 branches covered.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="fc" id="L2032">                        continue;</span>
                    }
<span class="fc" id="L2034">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
<span class="fc" id="L2037">        }</span>
<span class="fc" id="L2038">    }</span>

    public static void addToImage(
        TIntSet pIdxs, int xOffsetToApply, 
        int yOffsetToApply, Image input, int nExtraForDot,
        int rClr, int gClr, int bClr) {
        
<span class="nc bnc" id="L2045" title="All 4 branches missed.">        if (pIdxs == null || input == null) {</span>
<span class="nc" id="L2046">            return;</span>
        }
        
<span class="nc" id="L2049">        int w = input.getWidth();</span>
<span class="nc" id="L2050">        int h = input.getHeight();</span>
             
<span class="nc" id="L2052">        TIntIterator iter = pIdxs.iterator();</span>
<span class="nc bnc" id="L2053" title="All 2 branches missed.">        while (iter.hasNext()) {</span>
<span class="nc" id="L2054">            int pixIdx = iter.next();</span>
<span class="nc" id="L2055">            int y = pixIdx/w;</span>
<span class="nc" id="L2056">            int x = pixIdx - (y * w);</span>
<span class="nc" id="L2057">            x += xOffsetToApply;</span>
<span class="nc" id="L2058">            y += yOffsetToApply;</span>
            
<span class="nc bnc" id="L2060" title="All 2 branches missed.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); ++dx) {</span>
<span class="nc" id="L2061">                int xx = x + dx;</span>
<span class="nc bnc" id="L2062" title="All 4 branches missed.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L2063">                    continue;</span>
                }
<span class="nc bnc" id="L2065" title="All 2 branches missed.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L2066">                    int yy = y + dy;</span>
<span class="nc bnc" id="L2067" title="All 4 branches missed.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L2068">                        continue;</span>
                    }
<span class="nc" id="L2070">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
<span class="nc" id="L2073">        }</span>
<span class="nc" id="L2074">    }</span>

    public static void addAlternatingColorCurvesToImage(
        List&lt;PairIntArray&gt; curves, String fileName, boolean writeImage, 
        Image input) throws IOException {
        
<span class="nc bnc" id="L2080" title="All 4 branches missed.">        if (curves == null || input == null) {</span>
<span class="nc" id="L2081">            return;</span>
        }
<span class="nc bnc" id="L2083" title="All 2 branches missed.">        if (fileName == null) {</span>
<span class="nc" id="L2084">            throw new IllegalArgumentException(&quot;fileName cannot be null&quot;);</span>
        }
        
<span class="nc" id="L2087">        addAlternatingColorCurvesToImage(curves, input);</span>
       
<span class="nc bnc" id="L2089" title="All 2 branches missed.">        if (!writeImage) {</span>
<span class="nc" id="L2090">            return;</span>
        }
        
        try {
<span class="nc" id="L2094">            String dirPath = ResourceFinder.findDirectory(&quot;bin&quot;);</span>
<span class="nc" id="L2095">            ImageIOHelper.writeOutputImage(dirPath + &quot;/&quot; + fileName, input);</span>
<span class="nc" id="L2096">        } catch (IOException ex) {</span>
<span class="nc" id="L2097">            Logger.getLogger(ImageIOHelper.class.getName()).severe(</span>
<span class="nc" id="L2098">                &quot;ERROR: l446&quot; + ex.getMessage());</span>
<span class="nc" id="L2099">        }</span>
<span class="nc" id="L2100">    }</span>

    public static void addCurveToImage(ScaleSpaceCurve curve, Image input, 
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="nc bnc" id="L2105" title="All 4 branches missed.">        if (curve == null || input == null) {</span>
<span class="nc" id="L2106">            return;</span>
        }
        
<span class="nc" id="L2109">        int w = input.getWidth();</span>
<span class="nc" id="L2110">        int h = input.getHeight();</span>
        
<span class="nc bnc" id="L2112" title="All 2 branches missed.">        for (int i = 0; i &lt; curve.getSize(); i++) {</span>
<span class="nc" id="L2113">            int x = Math.round(curve.getX(i));</span>
<span class="nc" id="L2114">            int y = Math.round(curve.getY(i));</span>
            
<span class="nc bnc" id="L2116" title="All 2 branches missed.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); ++dx) {</span>
<span class="nc" id="L2117">                int xx = x + dx;</span>
<span class="nc bnc" id="L2118" title="All 4 branches missed.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L2119">                    continue;</span>
                }
<span class="nc bnc" id="L2121" title="All 2 branches missed.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L2122">                    int yy = y + dy;</span>
<span class="nc bnc" id="L2123" title="All 4 branches missed.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L2124">                        continue;</span>
                    }
<span class="nc" id="L2126">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
        }
<span class="nc" id="L2130">    }</span>

    public static void addToImage(float[] xP, float[] yP, 
        int xOffsetToApply, int yOffsetToApply, Image input,
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="nc bnc" id="L2136" title="All 6 branches missed.">        if (xP == null || yP == null || input == null) {</span>
<span class="nc" id="L2137">            return;</span>
        }
        
<span class="nc" id="L2140">        int w = input.getWidth();</span>
<span class="nc" id="L2141">        int h = input.getHeight();</span>
        
<span class="nc bnc" id="L2143" title="All 2 branches missed.">        for (int i = 0; i &lt; xP.length; i++) {</span>
            
<span class="nc" id="L2145">            int x = Math.round(xP[i]) + xOffsetToApply;</span>
            
<span class="nc" id="L2147">            int y = Math.round(yP[i]) + yOffsetToApply;</span>
            
<span class="nc bnc" id="L2149" title="All 2 branches missed.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); ++dx) {</span>
<span class="nc" id="L2150">                int xx = x + dx;</span>
<span class="nc bnc" id="L2151" title="All 4 branches missed.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L2152">                    continue;</span>
                }
<span class="nc bnc" id="L2154" title="All 2 branches missed.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L2155">                    int yy = y + dy;</span>
<span class="nc bnc" id="L2156" title="All 4 branches missed.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L2157">                        continue;</span>
                    }
<span class="nc" id="L2159">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
        }
<span class="nc" id="L2163">    }</span>
    
    public static void addToImage(int[] xP, int[] yP, 
        int xOffsetToApply, int yOffsetToApply, Image input,
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="nc bnc" id="L2169" title="All 6 branches missed.">        if (xP == null || yP == null || input == null) {</span>
<span class="nc" id="L2170">            return;</span>
        }
        
<span class="nc" id="L2173">        int w = input.getWidth();</span>
<span class="nc" id="L2174">        int h = input.getHeight();</span>
        
<span class="nc bnc" id="L2176" title="All 2 branches missed.">        for (int i = 0; i &lt; xP.length; i++) {</span>
            
<span class="nc" id="L2178">            int x = xP[i] + xOffsetToApply;</span>
            
<span class="nc" id="L2180">            int y = yP[i] + yOffsetToApply;</span>
            
<span class="nc bnc" id="L2182" title="All 2 branches missed.">            for (int dx = (-1*nExtraForDot); dx &lt; (nExtraForDot + 1); dx++) {</span>
<span class="nc" id="L2183">                int xx = x + dx;</span>
<span class="nc bnc" id="L2184" title="All 4 branches missed.">                if ((xx &lt; 0) || (xx &gt; (w - 1))) {</span>
<span class="nc" id="L2185">                    continue;</span>
                }
<span class="nc bnc" id="L2187" title="All 2 branches missed.">                for (int dy = (-1*nExtraForDot); dy &lt; (nExtraForDot + 1); ++dy) {</span>
<span class="nc" id="L2188">                    int yy = y + dy;</span>
<span class="nc bnc" id="L2189" title="All 4 branches missed.">                    if ((yy &lt; 0) || (yy &gt; (h - 1))) {</span>
<span class="nc" id="L2190">                        continue;</span>
                    }
<span class="nc" id="L2192">                    input.setRGB(xx, yy, rClr, gClr, bClr);</span>
                }
            }
        }
<span class="nc" id="L2196">    }</span>
    
    /**
     * given data, apply a factor and offset to put it in range 0 to 255 and
     * return an image from it.
     * @param data
     * @return 
     */
    public static GreyscaleImage scaleToImgRange(double[][] data) {
        
<span class="nc" id="L2206">        double maxValue = Double.MIN_VALUE;</span>
<span class="nc" id="L2207">        double minValue = Double.MAX_VALUE;</span>
<span class="nc bnc" id="L2208" title="All 2 branches missed.">        for (int i = 0; i &lt; data.length; ++i) {</span>
<span class="nc bnc" id="L2209" title="All 2 branches missed.">            for (int j = 0; j &lt; data[i].length; ++j) {</span>
<span class="nc" id="L2210">                double v = data[i][j];</span>
<span class="nc bnc" id="L2211" title="All 2 branches missed.">                if (v &lt; minValue) {</span>
<span class="nc" id="L2212">                    minValue = v;</span>
                }
<span class="nc bnc" id="L2214" title="All 2 branches missed.">                if (v &gt; maxValue) {</span>
<span class="nc" id="L2215">                    maxValue = v;</span>
                }
            }
        }
        
        /* scale data between 0 and 255
               
        (max - min) * factor = 255 --&gt; factor = 255/(max - min)
        then subtract min, min*factor
        for example 10  20, delta=10, factor = 25.5
        (10*25.5)-(10*25.5) = 0
        (20*25.5)-(10*25.5) = 255
        */
<span class="nc" id="L2228">        double factor = 255./(maxValue - minValue);</span>
<span class="nc" id="L2229">        double zp = minValue * factor;</span>
        
<span class="nc" id="L2231">        GreyscaleImage img = new GreyscaleImage(data.length, data[0].length);</span>
        
<span class="nc bnc" id="L2233" title="All 2 branches missed.">        for (int i = 0; i &lt; data.length; ++i) {</span>
<span class="nc bnc" id="L2234" title="All 2 branches missed.">            for (int j = 0; j &lt; data[i].length; ++j) {</span>
<span class="nc" id="L2235">                double v = data[i][j];</span>
<span class="nc" id="L2236">                int vs = (int)Math.round((v * factor) - zp);</span>
<span class="nc" id="L2237">                img.setValue(i, j, vs);</span>
            }
        }
        
<span class="nc" id="L2241">        return img;</span>
    }
    
    /**
     * given data, apply a factor and offset to put it in range 0 to 255 and
     * return an image from it.
     * @param data
     * @return 
     */
    public static GreyscaleImage scaleToImgRange(int[][] data) {
        
<span class="fc" id="L2252">        int maxValue = Integer.MIN_VALUE;</span>
<span class="fc" id="L2253">        int minValue = Integer.MAX_VALUE;</span>
<span class="fc bfc" id="L2254" title="All 2 branches covered.">        for (int i = 0; i &lt; data.length; ++i) {</span>
<span class="fc bfc" id="L2255" title="All 2 branches covered.">            for (int j = 0; j &lt; data[i].length; ++j) {</span>
<span class="fc" id="L2256">                int v = data[i][j];</span>
<span class="fc bfc" id="L2257" title="All 2 branches covered.">                if (v &lt; minValue) {</span>
<span class="fc" id="L2258">                    minValue = v;</span>
                }
<span class="fc bfc" id="L2260" title="All 2 branches covered.">                if (v &gt; maxValue) {</span>
<span class="fc" id="L2261">                    maxValue = v;</span>
                }
            }
        }
        
        /* scale data between 0 and 255
               
        (max - min) * factor = 255 --&gt; factor = 255/(max - min)
        then subtract min, min*factor
        for example 10  20, delta=10, factor = 25.5
        (10*25.5)-(10*25.5) = 0
        (20*25.5)-(10*25.5) = 255
        */
<span class="fc" id="L2274">        double factor = 255./(double)(maxValue - minValue);</span>
<span class="fc" id="L2275">        double zp = minValue * factor;</span>
        
<span class="fc" id="L2277">        GreyscaleImage img = new GreyscaleImage(data.length, data[0].length);</span>
        
<span class="fc bfc" id="L2279" title="All 2 branches covered.">        for (int i = 0; i &lt; data.length; ++i) {</span>
<span class="fc bfc" id="L2280" title="All 2 branches covered.">            for (int j = 0; j &lt; data[i].length; ++j) {</span>
<span class="fc" id="L2281">                int v = data[i][j];</span>
<span class="fc" id="L2282">                int vs = (int)Math.round((v * factor) - zp);</span>
<span class="fc" id="L2283">                img.setValue(i, j, vs);</span>
            }
        }
        
<span class="fc" id="L2287">        return img;</span>
    }

    public static void addAlternatingColorContoursToImage(
        List&lt;CurvatureScaleSpaceContour&gt; contours, ImageExt img, 
        int xOffset, int yOffset, int nExtraForDot) {
        
        //StringBuilder sb = new StringBuilder();
        
<span class="nc bnc" id="L2296" title="All 2 branches missed.">        for (int i = 0; i &lt; contours.size(); i++) {</span>
            
<span class="nc" id="L2298">            CurvatureScaleSpaceContour cssC = contours.get(i);</span>
            
            /*sb.append(&quot;[&quot;).append(Integer.toString(i))
                .append(&quot;] t=&quot;)
                .append(Float.toString(cssC.getPeakScaleFreeLength()))
                .append(&quot;, s=&quot;)
                .append(Float.toString(cssC.getPeakSigma()))
                .append(&quot; &quot;);*/
            
<span class="nc" id="L2307">            int[] c = getNextRGB(i);</span>
            
<span class="nc" id="L2309">            addContoursToImage(cssC, img, xOffset, yOffset, nExtraForDot, </span>
                c[0], c[1], c[2]);
        }
        
        //Logger.getLogger(ImageIOHelper.class.getName()).info(sb.toString());
<span class="nc" id="L2314">    }</span>

    public static void addAlternatingColorCornerRegionsToImage(
        List&lt;CornerRegion&gt; regions, Image img, 
        int xOffset, int yOffset, int nExtraForDot) {
        
<span class="nc bnc" id="L2320" title="All 2 branches missed.">        for (int i = 0; i &lt; regions.size(); i++) {</span>
            
<span class="nc" id="L2322">            CornerRegion br = regions.get(i);</span>
            
<span class="nc" id="L2324">            int[] c = getNextRGB(i);</span>

<span class="nc" id="L2326">            int x = br.getX()[br.getKMaxIdx()];</span>
<span class="nc" id="L2327">            int y = br.getY()[br.getKMaxIdx()];</span>
            
<span class="nc" id="L2329">            addPointToImage(x, y, img, xOffset, yOffset, nExtraForDot, </span>
                c[0], c[1], c[2]);
        }
<span class="nc" id="L2332">    }</span>
    
    public static &lt;T extends CornerRegion&gt; void 
        addAlternatingColorCornerRegionListsToImage(
        List&lt;List&lt;T&gt;&gt; regions, Image img, int xOffset, int yOffset, 
            int nExtraForDot) {
        
<span class="nc bnc" id="L2339" title="All 2 branches missed.">        for (int i = 0; i &lt; regions.size(); i++) {</span>
            
<span class="nc" id="L2341">            List&lt;T&gt; corners = regions.get(i);</span>
            
<span class="nc" id="L2343">            int[] c = getNextRGB(i);</span>
            
<span class="nc" id="L2345">            addCornerRegionsToImage(corners, img, xOffset, yOffset, </span>
                nExtraForDot, c[0], c[1], c[2]);
        }
<span class="nc" id="L2348">    }</span>
    
    public static void addCornerRegionsToImage(Collection&lt;CornerRegion&gt; regions,
        Image img, int xOffset, int yOffset, int nExtraForDot) {

<span class="nc bnc" id="L2353" title="All 2 branches missed.">        for (CornerRegion br : regions) {</span>

<span class="nc" id="L2355">            int x = br.getX()[br.getKMaxIdx()];</span>
<span class="nc" id="L2356">            int y = br.getY()[br.getKMaxIdx()];</span>

<span class="nc" id="L2358">            addPointToImage(x, y, img, xOffset, yOffset, nExtraForDot, 255, 0, 0);</span>
<span class="nc" id="L2359">        }</span>
<span class="nc" id="L2360">    }</span>
    
    public static &lt;T extends CornerRegion&gt; void addCornerRegionsToImage(
        Collection&lt;T&gt; regions, Image img, int xOffset, int yOffset, 
        int nExtraForDot, int rClr, int gClr, int bClr) {
        
<span class="nc bnc" id="L2366" title="All 2 branches missed.">        for (T br : regions ) {</span>
            
<span class="nc" id="L2368">            int x = br.getX()[br.getKMaxIdx()];</span>
<span class="nc" id="L2369">            int y = br.getY()[br.getKMaxIdx()];</span>
            
<span class="nc" id="L2371">            addPointToImage(x, y, img, xOffset, yOffset, nExtraForDot, </span>
                rClr, gClr, bClr);
<span class="nc" id="L2373">        }</span>
<span class="nc" id="L2374">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>